FROM davidcaste/alpine-tomcat:jdk8tomcat8
MAINTAINER David Soff <dsoff@worth.systems>

COPY setup-files/scripts/docker/jrebel.jar /jrebel.jar

ENV CATALINA_OPTS="-showversion -javaagent:/jrebel.jar -Drebel.remoting_plugin=true"

EXPOSE 8080

ENTRYPOINT sh /opt/tomcat/bin/catalina.sh run

COPY setup-files/scripts/docker/server.xml /opt/tomcat/conf/server.xml

COPY setup-files/scripts/docker/certificate /certificate

WORKDIR $JAVA_HOME

RUN bin/keytool -import -trustcacerts -keystore jre/lib/security/cacerts -storepass changeit -noprompt -alias iuk-auth-localdev -file /certificate

WORKDIR /
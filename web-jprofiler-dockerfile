FROM davidcaste/debian-tomcat:jre8tomcat8
MAINTAINER David Soff <dsoff@worth.systems>

ENV CATALINA_OPTS="-showversion"
ENV CATALINA_OPTS="$CATALINA_OPTS -Dcom.sun.management.jmxremote"
ENV CATALINA_OPTS="$CATALINA_OPTS -Dcom.sun.management.jmxremote.port=12345"
ENV CATALINA_OPTS="$CATALINA_OPTS -Dcom.sun.management.jmxremote.ssl=false"
ENV CATALINA_OPTS="$CATALINA_OPTS -Dcom.sun.management.jmxremote.authenticate=false"
ENV CATALINA_OPTS="$CATALINA_OPTS -agentlib:jdwp=transport=dt_socket,address=8081,server=y,suspend=n"
ENV CATALINA_OPTS="$CATALINA_OPTS -agentpath:/opt/jprofiler_agent_linux-x64/bin/linux-x64/libjprofilerti.so=port=8849"
ENV JAVA_OPTS="-Xms256m"
ENV JAVA_OPTS="$JAVA_OPTS -Xmx3g"

EXPOSE 8080
EXPOSE 8081
EXPOSE 12345
EXPOSE 8849

ENTRYPOINT sh /opt/tomcat/bin/catalina.sh run

COPY setup-files/scripts/docker/server.xml /opt/tomcat/conf/server.xml
COPY setup-files/scripts/docker/jprofiler_agent_linux-x64 /opt/jprofiler_agent_linux-x64
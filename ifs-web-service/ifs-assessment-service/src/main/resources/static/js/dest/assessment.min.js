if("undefined"==typeof IFS)var IFS={};IFS.assessment={},IFS.assessment.loadOrder={common:{init:function(){},finalize:function(){}},"declaration-form":{init:function(){IFS.assessment.repeatableRows.init()}}},IFS.assessment.repeatableRows=function(){"use strict";return{init:function(){IFS.assessment.repeatableRows.backForwardCacheReload(),jQuery("body").on("click","[data-repeatable-rowcontainer]",function(e){e.preventDefault(),IFS.assessment.repeatableRows.backForwardCacheInvalidate(),IFS.assessment.repeatableRows.addRow(this,e)}),jQuery("body").on("click",".js-remove-row",function(e){IFS.assessment.repeatableRows.backForwardCacheInvalidate(),IFS.assessment.repeatableRows.removeRow(this,e)}),jQuery("body").on("persistUnsavedRow",function(e,a,t){IFS.assessment.repeatableRows.persistUnsavedRow(a,t)})},getAjaxUrl:function(e){var a="";return console.log(e),"undefined"!=typeof jQuery(e).val()&&"undefined"!=typeof jQuery(e).attr("name")&&(a=window.location.protocol+"//"+window.location.host+"/assessment/form/"+jQuery(e).attr("name")+"/"+jQuery(e).val()),a},addRow:function(e,a){var t=IFS.assessment.repeatableRows.getAjaxUrl(e);t.length&&(a.preventDefault(),jQuery.ajaxProtected({url:t,beforeSend:function(){jQuery(e).before('<span class="form-hint">Adding a new row</span>')},cache:!1}).done(function(a){var t=jQuery(e).attr("data-repeatable-rowcontainer");jQuery(e).prev().remove(),jQuery(t).append(a),jQuery("body").trigger("updateSerializedFormState");var r=jQuery(a).find('[type="number"][name],[type="text"][name],[type="email"][name]').first().attr("name");"undefined"!=typeof r&&jQuery("[name="+r+"]").focus()}))},removeRow:function(e,a){var t=IFS.assessment.repeatableRows.getAjaxUrl(e);t.length&&(a.preventDefault(),jQuery.ajaxProtected({url:t}).done(function(a){a=jQuery.parseJSON(a),"OK"==a.status&&(jQuery("[data-repeatable-row="+jQuery(e).val()+"]").remove(),jQuery("body").trigger("recalculateAllFinances").trigger("updateSerializedFormState"))}))},backForwardCacheReload:function(){var e=jQuery("#cacheTest");""!==e.val()&&(jQuery("#cacheTest").val(""),window.location.reload())},backForwardCacheInvalidate:function(){jQuery("#cacheTest").val("cached")},persistUnsavedRow:function(e,a){var t=e.split("-"),r=t.length>2?t[3]:null,n=jQuery('[data-repeatable-row] [name*="'+r+'"]');n.each(function(){var e=jQuery(this).attr("name").split("-");jQuery(this).attr("name",e[0]+"-"+e[1]+"-"+e[2]+"-"+a)});var o=jQuery('[data-repeatable-row="'+r+'"]'),s=o.find(".buttonplaceholder");if(s.length){var i='<button type="submit" name="remove_cost" class="buttonlink js-remove-row" value="'+a+'">Remove</button>';o.find(".buttonplaceholder").replaceWith(i),o.attr("data-repeatable-row",a)}}}}();
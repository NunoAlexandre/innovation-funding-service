if("undefined"==typeof IFS)var IFS={};IFS.application={},IFS.application.loadOrder={common:{init:function(){},finalize:function(){IFS.application.progressiveSelect.init()}},"app-form":{init:function(){IFS.application.repeatableRows.init(),IFS.application.financeSpecifics.init(),IFS.application.application_form.init()}},"app-details":{init:function(){IFS.application.application_page.init()}},"app-invite":{init:function(){IFS.application.invites.init()}},"competition-management":{init:function(){IFS.application.competition_management.init()}}},IFS.application.progressiveSelect=function(){"use strict";var e,t=0;return{settings:{selectEl:"select.prog-menu",dropdownContainer:".assign-container .assign-button"},init:function(){e=this.settings,IFS.application.progressiveSelect.initDomChanges(),IFS.application.progressiveSelect.initEventHandlers()},initEventHandlers:function(){jQuery(document).on("click",function(){IFS.application.progressiveSelect.hideAll()}),jQuery("body").on("click",".assign-button [aria-controls]",function(e){e.stopPropagation(),IFS.application.progressiveSelect.toggleDropdown(this)})},initDomChanges:function(){jQuery(e.dropdownContainer).each(function(){IFS.application.progressiveSelect.initDropDownHTML(this)}),jQuery(e.selectEl).each(function(){IFS.application.progressiveSelect.selectToListHTML(this)})},selectToListHTML:function(e){e=jQuery(e),e.next("button").remove();var t=e.children("option"),a=e.attr("name"),i='<ul class="list-bullet">';t.each(function(){var e=jQuery(this),t=e.text(),n=e.attr("value");i+="disabled"==e.attr("disabled")?"<li>"+t+"</li>":'<li><button value="'+n+'" name="'+a+'" class="buttonlink">'+t+"</button></li>"}),i+="</ul>",e.after(i).remove(),jQuery("body").trigger("updateSerializedFormState")},initDropDownHTML:function(e){var a=jQuery(e),i="dropdown-"+t;a.next().wrapAll('<div id="'+i+'" aria-hidden="true">'),a.wrapInner('<button aria-expanded="false" aria-controls="'+i+'" type="button">'),t++},toggleDropdown:function(e){var t=jQuery(e),a=jQuery("#"+t.attr("aria-controls")),i="false"===t.attr("aria-expanded");IFS.application.progressiveSelect.hideAll(),i&&(t.attr("aria-expanded","true"),a.attr("aria-hidden","false"))},hideAll:function(){jQuery('[aria-controls*="dropdown-"][aria-expanded="true"]').attr("aria-expanded","false"),jQuery('[id^="dropdown-"][aria-hidden="false"]').attr("aria-hidden","true")}}}(),IFS.application.repeatableRows=function(){"use strict";return{init:function(){IFS.application.repeatableRows.backForwardCacheReload(),jQuery("body").on("click","[data-repeatable-rowcontainer]",function(e){e.preventDefault(),IFS.application.repeatableRows.backForwardCacheInvalidate(),IFS.application.repeatableRows.addRow(this,e)}),jQuery("body").on("click",".js-remove-row",function(e){IFS.application.repeatableRows.backForwardCacheInvalidate(),IFS.application.repeatableRows.removeRow(this,e)}),jQuery("body").on("persistUnsavedRow",function(e,t,a){IFS.application.repeatableRows.persistUnsavedRow(t,a)})},getAjaxUrl:function(e){var t="";if("undefined"!=typeof jQuery(e).val()&&"undefined"!=typeof jQuery(e).attr("name")&&1==jQuery("#application_id").length){var a=jQuery("#application_id").val();t=window.location.protocol+"//"+window.location.host+"/application/"+a+"/form/"+jQuery(e).attr("name")+"/"+jQuery(e).val()}return t},addRow:function(e,t){var a=IFS.application.repeatableRows.getAjaxUrl(e);a.length&&(t.preventDefault(),jQuery.ajaxProtected({url:a,beforeSend:function(){jQuery(e).before('<span class="form-hint">Adding a new row</span>')},cache:!1}).done(function(t){var a=jQuery(e).attr("data-repeatable-rowcontainer");jQuery(e).prev().remove(),jQuery(a).append(t),jQuery("body").trigger("updateSerializedFormState");var i=jQuery(t).find('[type="number"][name],[type="text"][name],[type="email"][name]').first().attr("name");"undefined"!=typeof i&&jQuery("[name="+i+"]").focus()}))},removeRow:function(e,t){var a=IFS.application.repeatableRows.getAjaxUrl(e);a.length&&(t.preventDefault(),jQuery.ajaxProtected({url:a}).done(function(t){t=jQuery.parseJSON(t),"OK"==t.status&&(jQuery("[data-repeatable-row="+jQuery(e).val()+"]").remove(),jQuery("body").trigger("recalculateAllFinances").trigger("updateSerializedFormState"))}))},backForwardCacheReload:function(){var e=jQuery("#cacheTest");""!==e.val()&&(jQuery("#cacheTest").val(""),window.location.reload())},backForwardCacheInvalidate:function(){jQuery("#cacheTest").val("cached")},persistUnsavedRow:function(e,t){var a=e.split("-"),i=a.length>2?a[3]:null,n=jQuery('[data-repeatable-row] [name*="'+i+'"]');n.each(function(){var e=jQuery(this).attr("name").split("-");jQuery(this).attr("name",e[0]+"-"+e[1]+"-"+e[2]+"-"+t)});var o=jQuery('[data-repeatable-row="'+i+'"]'),r=o.find(".buttonplaceholder");if(r.length){var s='<button type="submit" name="remove_cost" class="buttonlink js-remove-row" value="'+t+'">Remove</button>';o.find(".buttonplaceholder").replaceWith(s),o.attr("data-repeatable-row",t)}}}}(),IFS.application.application_page=function(){"use strict";return{init:function(){jQuery(document).on("click",'form.application-overview [name="assign_question"]',IFS.application.application_page.handleAssignQuestionFragmentReload)},handleAssignQuestionFragmentReload:function(e){var t,a=jQuery(this),i=a.closest("form.application-overview"),n=a.closest("li.section"),o=n.attr("id");if(n.closest('section[id^="section-"]').length&&(t=n.closest('section[id^="section-"]').attr("id").replace("section-","")),n.length&&t&&o)return jQuery.ajaxProtected({type:"POST",beforeSend:function(){"function"==typeof IFS.application.progressiveSelect.hideAll&&IFS.application.progressiveSelect.hideAll();var e=n.find(".assign-button");e.children("button").attr("aria-hidden","true"),n.find("img.section-status").attr("aria-hidden","true"),e.find(".reassign-status").remove(),e.append('<div class="reassign-status">Assigning to <strong>'+a.text()+"</strong>...</div>")},url:"?singleFragment=true&sectionId="+t,data:i.serialize()+"&"+a.attr("name")+"="+a.attr("value"),timeout:15e3,success:function(e){var t=jQuery("<div>"+e+"</div>"),a=t.find("#"+o);if(n.replaceWith(a),"function"==typeof IFS.application.progressiveSelect.initDropDownHTML){var i=a.find(".assign-button"),r=a.find("select.prog-menu");IFS.application.progressiveSelect.initDropDownHTML(i),IFS.application.progressiveSelect.selectToListHTML(r)}}}).fail(function(e){var t=IFS.core.autoSave.getErrorMessage(e);if(t){var a=n.find(".assign-button");a.children("button").attr("aria-hidden","false"),n.find("img.section-status").attr("aria-hidden","false"),n.find(".reassign-status").html('<div class="error-message">'+t+"</div>")}}),e.preventDefault(),!1}}}(),IFS.application.application_form=function(){"use strict";var e;return{settings:{markAllAsCompleteButton:"#mark-all-as-complete",termsCheckbox:"#agree-terms-page",stateAidCheckbox:"#agree-state-aid-page"},init:function(){e=this.settings,IFS.application.application_form.handleChangeAgreeTermsCheckbox(),jQuery(document).on("change",e.checkbox,IFS.application.application_form.handleChangeAgreeTermsCheckbox)},disableButton:function(){jQuery(e.markAllAsCompleteButton).attr({"aria-disabled":"true"}).addClass("disabled"),jQuery(e.markAllAsCompleteButton).prop("disabled",!0)},enableButton:function(){jQuery(e.markAllAsCompleteButton).removeAttr("aria-disabled").removeClass("disabled"),jQuery(e.markAllAsCompleteButton).prop("disabled",!1)},handleChangeAgreeTermsCheckbox:function(){jQuery(e.termsCheckbox).prop("checked")&&jQuery(e.stateAidCheckbox).prop("checked")?IFS.application.application_form.enableButton():IFS.application.application_form.disableButton()}}}(),IFS.application.financeSpecifics=function(){"use strict";var e;return{settings:{funderOrgFeedback:{funderOrgsizeInputs:'[name="financePosition-organisationSize"]',fundingLevelInput:"#cost-financegrantclaim",orgToFundingMapping:{SMALL:70,MEDIUM:60,LARGE:50}},administrationCostTotal:{adminSupportCosts:'[name*="overheads-type"]',supportCostInTotal:{NONE:"#section-total-10-labour-cost-none",DEFAULT_PERCENTAGE:"#section-total-10-default",CUSTOM_RATE:"#section-total-10-custom"},allTotals:'[id*="section-total-10"]',totalCostInHeaders:'[data-mirror="#section-total-10"]'}},init:function(){e=this.settings,IFS.application.financeSpecifics.initFunderOrgSizeFeedback(),IFS.application.financeSpecifics.initAdministrationCostTotal(),IFS.application.financeSpecifics.initOtherFunding()},initAdministrationCostTotal:function(){jQuery(e.administrationCostTotal.adminSupportCosts+":checked").each(function(){IFS.application.financeSpecifics.resetOtherAdministrationTotal(this),IFS.application.financeSpecifics.placeRightAdministrationTotalInHeader(this)}),jQuery(document).on("change",e.administrationCostTotal.adminSupportCosts,function(){IFS.application.financeSpecifics.resetOtherAdministrationTotal(this),IFS.application.financeSpecifics.placeRightAdministrationTotalInHeader(this)})},placeRightAdministrationTotalInHeader:function(t){var a=jQuery(t).val(),i="undefined"!=typeof e.administrationCostTotal.supportCostInTotal[a]&&e.administrationCostTotal.supportCostInTotal[a],n=jQuery(e.administrationCostTotal.totalCostInHeaders);i&&n.length&&(IFS.core.mirrorElements.updateElement(n,i),jQuery(document).off("change",e.administrationCostTotal.allTotals).on("change",i,function(){IFS.core.mirrorElements.updateElement(n,this)}))},resetOtherAdministrationTotal:function(t){var a=jQuery(t).closest("[data-target]"),i=jQuery("#"+jQuery(a).attr("data-target")),n=a.prevAll("[data-target]").add(a.nextAll("[data-target]"));n.each(function(){var t=jQuery("#"+jQuery(this).attr("data-target")),a=t.find(e.administrationCostTotal.allTotals),i=a.attr("id");a.attr("data-old-id",i).removeAttr("id").val("Â£ 0").attr("data-calculation-rawvalue",0)}),i.find("[data-old-id]").each(function(){var e=jQuery(this).attr("data-old-id");jQuery(this).attr("id",e).removeAttr("data-old-id"),jQuery("#section-total-9").trigger("updateFinances")})},initFunderOrgSizeFeedback:function(){jQuery("body").on("change",e.funderOrgFeedback.funderOrgsizeInputs,function(){var t=jQuery(this).val(),a=jQuery(e.funderOrgFeedback.fundingLevelInput);if(a.length&&"undefined"!=typeof e.funderOrgFeedback.orgToFundingMapping[t]){a.attr("max",e.funderOrgFeedback.orgToFundingMapping[t]).removeClass("field-error");var i=a.closest(".form-group");i.removeClass("error"),i.find(".error-message").remove(),setTimeout(function(){a.trigger("change")},1e3)}})},initOtherFunding:function(){jQuery("#otherFundingShowHideToggle").on("change",'[data-target] input[type="radio"]',function(){setTimeout(function(){jQuery("[id*=fundingAmount]").trigger("updateFinances")},0)})}}}(),IFS.application.invites=function(){"use strict";var e;return{settings:{formid:".contributorsForm",inputs:".contributorsForm input",addRow:".contributorsForm .add-another-row",removeRow:".contributorsForm .remove-another-row",addOrg:'[name="add_partner"]',partnerName:".js-partner-name"},init:function(){e=this.settings,jQuery("body").on("change",e.inputs,function(){IFS.application.invites.saveToCookie()}),jQuery("body").on("click",e.addRow,function(e){IFS.application.invites.addRow(e)}),jQuery("body").on("click",e.removeRow,function(e){IFS.application.invites.removeRow(e)}),jQuery("body").on("click",e.addOrg,function(e){IFS.application.invites.addOrg(e)}),jQuery("body").on("keyup",e.partnerName,function(e){IFS.application.invites.parterNameInHeader(e.target)}),jQuery(e.partnerName).each(function(){IFS.application.invites.parterNameInHeader(this)})},saveToCookie:function(){var t=jQuery(e.formid).serialize();jQuery.ajaxProtected({url:window.location.href,method:"POST",dataType:"json",data:t})},addRow:function(e){e.preventDefault();var t=jQuery(e.target).closest("[data-invite-org]"),a=t.index(),i=t.find("[data-invite-row]").length,n='<tr data-invite-row>                        <td class="form-group">                          <label for="organisations'+a+".invites"+i+'.personName"><span class="visuallyhidden">Name</span></label>                          <input type="text" id="organisations'+a+".invites"+i+'.personName" class="form-control width-full" value="" placeholder="name" name="organisations['+a+"].invites["+i+'].personName"  />                        </td>                        <td class="form-group">                          <label for="organisations'+a+".invites"+i+'.email"><span class="visuallyhidden">Email</span></label>                          <input type="email" class="form-control width-full" value="" placeholder="name@company.co.uk" name="organisations['+a+"].invites["+i+'].email"  />                        </td>                        <td class="alignright"><button value="'+a+"_"+i+'" name="remove_person" type="submit" class="remove-another-row buttonlink">Remove</button></td>                      </tr>';t.find("tbody").append(n),jQuery('[id="organisations'+a+".invites"+i+'.personName"]').focus(),IFS.application.invites.saveToCookie()},addOrg:function(e){e.preventDefault();var t=jQuery("[data-invite-org]"),a=t.length,i='<li data-invite-org>                      <h2 class="heading-medium">Partner Organisation<span></span></h2>                      <div class="form-group">                        <label for="organisations'+a+'.organisationName" class="form-label"><span>Organisation Name</span></label>                        <input type="text" id="organisations'+a+'.organisationName" value="" name="organisations['+a+'].organisationName"  placeholder="Name of the partner company" class="form-control js-partner-name" />                      </div>                          <table>                              <thead><tr>                                  <th>Applicant name</th>                                  <th>Email</th>                                  <th>&nbsp;</th>                              </tr></thead>                              <tbody>                              <tr data-invite-row>                                  <td class="form-group">                                      <label for="organisations'+a+'.invites0.personName"><span class="visuallyhidden">Name</span></label>                                      <input type="text" value="" id="organisations'+a+'.invites0.personName" name="organisations['+a+'].invites[0].personName"  placeholder="name" class="form-control width-full" />                                  </td>                                  <td class="form-group">                                      <label for="organisations'+a+'.invites0.email"><span class="visuallyhidden">Email</span></label>                                      <input type="email" value="" id="organisations'+a+'.invites0.email" name="organisations['+a+'].invites[0].email" placeholder="name@company.co.uk" class="form-control width-full" />                                  </td>                                  <td class="alignright"><button value="'+a+'_0" name="remove_person" type="submit" class="remove-another-row buttonlink">Remove</button></td>                              </tr>                              </tbody>                          </table>                          <p class="alignright">                              <button value="'+a+'" name="add_person" type="submit" class="add-another-row buttonlink">Add another person</button>                          </p>                      </li>';t.last().after(i),jQuery('[id="organisations'+a+'.organisationName"]').focus(),IFS.application.invites.saveToCookie()},recountRows:function(){jQuery("[data-invite-org]").each(function(e,t){jQuery(t).find('[name*="organisations["]').each(function(){var t=jQuery(this).attr("name").split(".");t[0]="organisations["+e+"]",t=t.join("."),jQuery(this).attr("name",t)}),jQuery(t).find("[data-invite-row]").each(function(e,t){jQuery(t).find('[name*="invites["]').each(function(){var t=jQuery(this).attr("name").split(".");t[1]="invites["+e+"]",t=t.join("."),jQuery(this).attr("name",t)})})}),IFS.application.invites.saveToCookie()},removeRow:function(e){e.preventDefault();var t=jQuery(e.target);1==t.closest("[data-invite-org]").find("tbody tr").length?t.closest("[data-invite-org]").remove():t.closest("tr").remove(),IFS.application.invites.recountRows()},parterNameInHeader:function(e){var t=jQuery(e),a=t.closest("[data-invite-org]").children("h2");0===a.children("span").length&&a.append(" <span></span>");var i=t.val().length?'"'+t.val()+'"':"";a.children("span").text(i)}}}();
<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <th:block th:insert="fragments/layout :: head" th:with="pageTitle='Application overview'" />
</head>
<body th:with="context='applicant'" class="app-details">

<th:block th:insert="fragments/layout :: body-start" />
<th:block th:insert="fragments/layout :: global-header" />


<main id="content">
    <th:block th:insert="fragments/layout :: main-content-start" />
    <div th:include="fragments/layout :: header-sub" th:with="linkTitle='Dashboard',linkClass='link-back',linkUrl=@{/applicant/dashboard}"  th:remove="tag"></div>


    <th:block th:insert="fragments/elements :: competition-closing-warning (competition=${currentCompetition})" />
  	<th:block th:insert="fragments/elements :: competition-status-message (app=${currentApplication}, competition=${currentCompetition})" />

    <div class="page-title">
        <th:block th:insert="fragments/elements :: application-title (applicationId=${currentApplication.id},applicationName=${currentApplication.applicationDisplayName})" />
        <h1 class="heading-xlarge">Application overview</h1>
    </div>

    <div class="grid-row">
        <div class="column-half">
          <dl class="dl-left">
            <dd>Competition:</dd>
            <dt th:text="${currentCompetition.name}" />
            <dd>Funding body:</dd>
            <dt>Innovate UK</dt>
            <dd>Application deadline:</dd>
            <dt>
              <div th:remove="tag" th:text="${#strings.toLowerCase(#temporals.format(currentCompetition.endDate, 'hh:mma '))}" />
              <div th:remove="tag" th:text="${#temporals.format(currentCompetition.endDate, 'EEEE d MMMM yyyy')}" />
            </dt>
          </dl>
          <h2 class="heading-medium no-margin-bottom">Application progress</h2>
          <div th:include="fragments/elements :: progress-indicator" th:with="percentage=${completedQuestionsPercentage},size='medium'" class="extra-margin" />
        </div>
        <div class="column-half">
            <ul class="list list-bullet">
                <li><a th:href="'/application/'+${currentApplication.getId()}+'/contributors'">view and add participants to your application</a></li>
                <li><a th:href="'/competition/'+${currentCompetition.id}+'/info/terms-and-conditions'">view conditions of grant offer</a></li>
            </ul>
        </div>
    </div>

    <div th:if="${assessorFeedback != null}" th:remove="tag">
        <div th:replace="question-type/form-elements :: readonly-file-download
                    (filename=${assessorFeedback?.filename},
                     filesizeKbytes=${assessorFeedback?.filesizeKbytes},
                     fileDescription=${'View your application feedback:'},
                     downloadURL=@{/application/{applicationId}/assessorFeedback(applicationId=${currentApplication.getId()})})">
        </div>
    </div>

    <form action="#" th:action="@{${#ifsUtil.uriWithQueryString(#httpServletRequest)}}" method="post" class="application-overview">
        <div th:remove="tag" th:each="section,iteration : ${sections.values()}">
            <section th:id="'section-'+${section.getId()}">
                <h2 th:text="${section.name}" th:class="${iteration.index==0} ? 'bold-medium': 'heading-medium no-margin-bottom'"/>
                <p th:text="${section.description}"></p>
                <ul th:with="currentUser=${#authentication.getDetails()}" class="task-list">
                    <th:block th:if="${subSections.get(section.id).size() ==0}">
                        <div th:replace="application/single-section-details :: sectionDetails (question=${question}, questionAssignee=${questionAssignee}, questionAssignees=${questionAssignees}, responses=${responses}, currentUser=${currentUser}, userIsLeadApplicant=${userIsLeadApplicant}, leadApplicant=${leadApplicant}, section=${section}, currentApplication=${currentApplication})"></div>
                    </th:block>
                    <th:block th:unless="${subSections.get(section.id).size() ==0 }">
                        <li th:each="childSection : ${subSections.get(section.id)}">
                            <div class="task">
                                <h3 class="heading-small">
                                    <a th:href="'/application/'+${currentApplication.getId()}+'/form/section/'+${childSection.getId()}"
                                       th:text="${childSection.getName()}" />
                                </h3>
                            </div>
                            <th:block th:if="${childSection.getId().equals(financeSectionId)}">
                                <th:block th:insert="question-type/form-elements :: assigned-to" />
                                    <div class="task-status-complete"
                                         th:if="${userFinanceSectionCompleted}">
                                        <span class="visuallyhidden" th:text="${childSection.getName()}"></span>
                                        <span>Completed</span>
                                    </div>
                            </th:block>
                        </li>
                        <!--<li class="grid-row" th:classappend="section" th:each="childSection : ${subSections.get(section.id)}">-->
                            <!--<div class="column-two-thirds">-->
                                <!--<h3 class="heading-small">-->
                                    <!--<a th:href="'/application/'+${currentApplication.getId()}+'/form/section/'+${childSection.getId()}"-->
                                       <!--th:text="${childSection.getName()}" />-->
                                <!--</h3>-->
                            <!--</div>-->
                            <!--<div th:if="${childSection.getId().equals(financeSectionId)}">-->
                                <!--<img class="section-status complete"-->
                                     <!--src="/images/field/field-done-right.png"-->
                                     <!--th:src="${@mvcResourceUrlProvider.getForLookupPath('/images/field/field-done-right.png')}"-->
                                     <!--width="30"-->
                                     <!--height="30"-->
                                     <!--th:alt="'The &quot;'+${childSection.getName()}+'&quot; section is marked as done'"-->
                                     <!--th:title="'The &quot;'+${childSection.getName()}+'&quot; section is marked as done'"-->
                                     <!--th:if="${userFinanceSectionCompleted}"/>-->
                                <!--<img class="section-status assigned"-->
                                     <!--src="/images/field/field-assigned-right.png"-->
                                     <!--th:src="${@mvcResourceUrlProvider.getForLookupPath('/images/field/field-assigned-right.png')}"-->
                                     <!--width="30"-->
                                     <!--height="30"-->
                                     <!--th:alt="'The &quot;'+${childSection.getName()}+'&quot; section is assigned to you'"-->
                                     <!--th:title="'The &quot;'+${childSection.getName()}+'&quot; section is assigned to you'"-->
                                     <!--th:unless="${userFinanceSectionCompleted}"/>-->
                            <!--</div>-->
                        <!--</li>-->
                    </th:block>
                </ul>
            </section>
        </div>
    </form>

    <div class="alignright-button">
        <a th:href="@{/application/{id}/print(id=${currentApplication.getId()})}" rel="nofollow" target="_blank"><div class="icon icon-print"></div> Print your application</a>
        <a class="button"  th:href="@{/application/{id}/summary(id=${currentApplication.getId()})}" th:text="${ableToSubmitApplication ? 'Review and submit' : 'Review'}" />
    </div>


    <th:block th:insert="fragments/layout :: main-content-end" />
</main>

<th:block th:insert="fragments/layout :: footer" />
<th:block th:insert="fragments/layout :: body-end" />

</body>
</html>

<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <th:block th:insert="fragments/layout :: head" th:with="pageTitle='Application Details'" cache:name="Application-Details" />
</head>
<body th:with="context='applicant'" class="app-invite-display">

<th:block th:insert="fragments/layout :: body-start"  cache:name="body-start" />
<th:block th:insert="fragments/layout :: global-header"  cache:name="global-header" />
<th:block th:insert="fragments/modals :: modal-overlay" th:if="${userIsLead}"  />
<th:block th:insert="fragments/modals :: modal-submit-remove-collaborator" th:if="${userIsLead}"  />

<main id="content">
    <th:block th:insert="fragments/layout :: main-content-start"  cache:name="main-content-start" />
    <th:block th:insert="fragments/layout :: header-sub" th:with="linkTitle='Application overview',linkClass='link-back',linkUrl=@{/application/{id}/(id=${currentApplication.getId()})},currentApplication=${currentApplication}"  />

    <div class="page-title">
        <th:block th:insert="fragments/elements :: application-title (applicationId=${currentApplication.id},applicationName=${currentApplication.applicationDisplayName})"  />
        <h1 class="heading-xlarge">Application team</h1>
    </div>

    <p>View and manage your contributors and partners in the application. If an individual is ‘pending’ they have not yet confirmed their role within this project. Click on a name to send this person an email.</p>
    <p>To change the lead applicant for this application please email Innovate UK <a href="mailto:support@innovateuk.gov.uk">support@innovateuk.gov.uk</a>.</p>

    <div th:if="${organisationInvites.size() == 0}" th:remove="tag">
      <h2 class="heading-medium">
          <th:block th:text="${leadOrganisation.name}"/><small> (Lead organisation)</small>
      </h2>
      <ul class="list list-bullet">
        <li>
          <a th:href="${'mailto:'+leadApplicant.email}" th:text="${leadApplicant.name}" />
          <small>(Lead Applicant)</small>
        </li>
      </ul>
    </div>
    <div th:each="organisationInviteResource, organisationStats : ${ organisationInvites }">
        <h2 class="heading-medium" th:if="${organisationInviteResource.id == 0}" >
          <span th:remove="tag" th:text="${leadOrganisation.name}"/><small> (Lead organisation)</small>
        </h2>
        <h2 class="heading-medium"  th:unless="${organisationInviteResource.id == 0}">

          <div th:if="${organisationInviteResource.organisationNameConfirmed != null}" th:remove="tag">
              <div th:text="${organisationInviteResource.organisationNameConfirmed}" th:remove="tag"/>
          </div>
          <div th:if="${organisationInviteResource.organisationNameConfirmed == null}" th:remove="tag">
            <div th:remove="tag" th:text="${organisationInviteResource.organisationName}" /><small> (pending)</small>
          </div>
        </h2>
        <ul class="list list-bullet">
            <li th:if="${organisationInviteResource.id == 0}">
              <a th:href="${'mailto:'+leadApplicant.email}" th:text="${leadApplicant.name}" /><small> (Lead Applicant)</small>
            </li>

            <li th:each="invite, inviteStats: ${organisationInviteResource.inviteResources}">
                <a th:if="${invite.nameConfirmed == null}" th:href="${'mailto:'+invite.email}" th:text="${invite.name}" />
                <a th:unless="${invite.nameConfirmed == null}" th:href="${'mailto:'+invite.email}" th:text="${invite.nameConfirmed}" />
                <th:block th:if="${userIsLead}">
                    - <a th:href="'/application/' + ${currentApplication.getId()} + '/contributors/remove/' + ${invite.id} + '/confirm'"
                                   th:attr="data-invite-id=${invite.id}"
                                   data-js-modal="modal-submit-remove-collaborator" class="buttonlink no-margin font-xsmall">Remove</a><br/>
                </th:block>
                <small th:if="${invite.status.name() ==  T(org.innovateuk.ifs.invite.constant.InviteStatus).CREATED.name() || invite.status.name() == T(org.innovateuk.ifs.invite.constant.InviteStatus).SENT.name()}"> (pending)</small>

            </li>
        </ul>
    </div>

    <p><a th:href="'/application/'+${currentApplication.getId()}+'/contributors/invite'" class="button">Invite new contributors</a></p>
    <th:block th:insert="fragments/layout :: main-content-end"  cache:name="main-content-end" />
</main>

<th:block th:insert="fragments/layout :: footer"  cache:name="footer" />
<th:block th:insert="fragments/layout :: body-end"  cache:name="body-end" />
</body>
</html>

<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">

<head>
    <th:block th:insert="fragments/layout :: head" th:with="pageTitle='Application Dashboard'" />
    <link href="/css/prototype.css" media="screen" rel="stylesheet" type="text/css" />
</head>

<body class="app-dashboard">

    <th:block th:insert="prototypes/fragments/layout :: prototype-nav" />
    <th:block th:insert="fragments/layout :: body-start" />
    <th:block th:insert="fragments/layout :: global-header" />
    <th:block th:insert="fragments/modals :: modal-submit-remove-collaborator" />

    <main id="content">
        <th:block th:insert="fragments/layout :: main-content-start" />
        <th:block th:insert="prototypes/fragments/applicant-view :: prototype-subheader(${'Application team'}, ${'/prototypes/632-organisation-collaborator-overview' + (param.company == null or param.company[0] == 'empire' ? '' : '?company='+ param.company[0])})" th:unless="${param.status != null and param.status[0] == 'firstLoad'}" />

        <th:block th:if="${param.status != null and param.status[0] == 'firstLoad'}" th:include="prototypes/fragments/applicant-view :: prototype-subheader(${'Application team'}, ${'/prototypes/632-organisation-collaborator-overview?company=empire&#38;status=firstLoad'})" />

        <!-- HARDCODED PROTOTYPE HTML -->

        <h1 class="heading-xlarge">
          <div class="page-title">
              <th:block th:insert="fragments/elements :: application-title (applicationId=${currentApplication.id},applicationName=${currentApplication.applicationDisplayName})" />
          </div>

          <th:block th:text="'Update ' + ${selectedOrganisation.name}">
          </th:block>

          <th:block th:if="${param.company != null and param.company[0] == 'newOrg'}">
            Add organisation
          </th:block>

        </h1>

        <p>
          <th:block th:if="${authenticatedUser.id == leadApplicant.id and selectedOrganisation.id == leadOrganisation.id}">
            From this page you are able to invite and remove contributors from the lead organisation. This organisation and the lead applicant cannot be removed from the application.
          </th:block>

          <!-- INFUND-7975 -->
          <th:block th:if="${authenticatedUser.id == leadApplicant.id and selectedOrganisation.id != leadOrganisation.id}">
            From this page you are able to invite and remove applicants from a partner organisation.
          </th:block>

          <!-- INFUND-7977 -->
          <th:block th:if="${authenticatedUser.id != leadApplicant.id}">
            From this page you are able to invite and remove applicants from your organisation. Only the lead applicant can remove partners
          </th:block>

          <!-- INFUND-7979 -->
          <th:block th:if="${authenticatedUser.id != leadApplicant.id and selectedOrganisation == null}">
            Add applicants or organisations to your application. Before you can invite an organisation you will need to add at least one individual from that organisation. If an organisation only has one individual you wish to remove, you must add a replacement individual before you can remove the first one.
          </th:block>
        </p>

          <div class="table-display-stacked">

            <h2 class="heading-medium" th:text="${selectedOrganisation.name} + (${selectedOrganisation.id == leadOrganisation.id}? ', Lead organisation' : '')">Empire Ltd, Lead organisation</h2>

            <table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack">
              <thead>
                <tr>
                  <th class="width-30-percent">Applicant</th>
                  <th class="width-40-percent">Email</th>
                  <th class="width-15-percent">Status</th>
                  <th class="width-15-percent alignright">Actions</th>
                  </tr>
                </thead>
                <tbody>
                  <tr th:if="${selectedOrganisation.id == leadOrganisation.id}">
                    <td th:text="${leadApplicant.name}">Steve Smith</td>
                    <td th:text="${leadApplicant.email}">steve.smith@empire.com</td>
                    <td>Lead</td>
                    <td class="alignright"></td>
                  </tr>

                  <tr th:unless="${param.status != null and param.status[0] == 'firstLoad'}">
                    <td>Paul Davidson</td>
                    <td>paul.davidsonh@empire.com</td>
                    <td></td>
                    <td class="alignright"><a th:href="'/application/' + ${currentApplication.getId()} + '/organisation/ + ${selectedOrganisation.id} + /remove/' + ${invite.id} + '/confirm'"
                                              th:attr="data-invite-id=${invite.id}"
                                              data-js-modal="modal-submit-remove-collaborator" class="buttonlink no-margin font-xsmall">Remove</a</td>
                  </tr>
                </tbody>
              </table>
            </div>


        <p th:unless="${param.action != null and param.action[0] == 'addApplicant' or param.company != null and param.company[0] == 'newOrg'}">
          <a th:href="@{'?action=addApplicant&#38;company=' + ${selectedOrganisation.id} + ${(param.user != null and param.user[0] == 'nonLead' ? '&#38;user=' + param.user[0] : '' )}}">Add new applicant</a>
        </p>

        <!-- <th:block th:if="${param.status != null and param.status[0] == 'firstLoad'}">
          <a th:href="@{'?status=firstLoad&#38;company=empire&#38;action=addApplicant'}">Add new applicant</a>
        </th:block> -->

        <th:block th:if="${param.company != null and param.company[0] == 'newOrg'}">
          <fieldset>
            <legend class="heading-medium">Organisation</legend>
            <div class="form-group">
              <label class="form-label-bold" for="new-org-name">Organisation name</label>
              <input class="form-control width-full" id="new-org-name" type="text" />
            </div>
          </fieldset>
        </th:block>

        <th:block th:if="${param.action != null and param.action[0] == 'addApplicant' or param.company != null and param.company[0] == 'newOrg'}">

          <fieldset class="table-display-stacked extra-margin-top">
            <legend class="heading-medium">New applicant</legend>
            <table class="tablesaw tablesaw-stack" data-tablesaw-mode="stack">
              <thead>
                <tr>
                  <th class="width-30-percent" id="new-applicant-name">Applicant name</th>
                  <th class="width-55-percent" id="new-applicant-email">Email</th>
                  <th class="width-15-percent alignright"></th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>
                    <input type="text" id="applicant-name-1" name="applicant-name-1" aria-labelledby="new-applicant-name" required="required" class="form-control width-full">
                  </td>
                  <td>
                    <input type="text" id="applicant-email-1" name="applicant-emaile-1" aria-labelledby="new-applicant-email" required="required" class="form-control width-full">
                  </td>
                  <td class="alignright"><a th:href="@{'?company=' + ${param.company[0]} + ${(param.user != null and param.user[0] == 'nonLead' ? '&#38;user=' + param.user[0] : '' )}}">Remove</a></td>
                </tr>
              </tbody>
            </table>
          </fieldset>

          <p>
            <a href="#">Add new applicant</a>
          </p>

        </th:block>


        <th:block th:unless="${authenticatedUser.id != leadApplicant.id}">

           <!-- INFUND-7975 -->
          <div class="alignright extra-margin-top" th:unless="${selectedOrganisation.id == leadOrganisation.id or selectedOrganisation == null}">
            <a href="/prototypes/635-application-overview" data-js-modal="modal-delete-organisation" class="button-secondary">Delete organisation</a>
            <hr />
          </div>

          <p class="extra-margin-top" th:unless="${selectedOrganisation == null}">Updating the organisation will notify applicants of changes to their position on the project.</p>

        </th:block>

        <p class="extra-margin-top">

          <a th:href="${'/prototypes/635-application-overview' + (param.status != null and param.status[0] == 'firstLoad' ? '&#38;status='+ param.status[0] : '')}" data-js-modal="modal-update-organisation" class="button" th:unless="${selectedOrganisation == null}">Update organisation</a>

          <!-- INFUND-7979 -->
          <th:block th:if="${selectedOrganisation == null}">
            <a href="/prototypes/635-application-overview" data-js-modal="modal-new-organisation" class="button">Add organisation and invite applicants</a>
          </th:block>

          <a href="#" class="button-link-style">Cancel</a>
        </p>

        <div class="modal-update-organisation" role="dialog" aria-hidden="true" style="margin-top: -153px;">
            <a href="#" class="js-close close" aria-label="Close Popup">Close</a>
            <h2 class="heading-medium no-margin">Update organisation</h2>
            <p>Invites will be sent to all new applicants.</p>
            <p>You should not remove applicants without discussing this action with them first. They will not receive any notification about their removal.</p>
            <hr />

            <form method="get" id="submit-remove-collaborator-form">

                <th:block th:if="${param.user == null or param.user[0] == 'nonLead'}">
                  <input type="hidden" name="company" th:value="${selectedOrganisation.id}" />
                </th:block>

                <th:block th:if="${param.status == null or param.status[0] == 'firstLoad'}">
                  <input type="hidden" name="status" value="firstLoad" />
                </th:block>

                <button class="button" type="submit" formaction="/prototypes/632-organisation-collaborator-overview">Update organisation</button>
                <a href="#" class="js-close button-link-style">Cancel</a>

            </form>

        </div>

        <div class="modal-overlay js-close" aria-hidden="true"></div>
        <div class="modal-new-organisation" role="dialog" aria-hidden="true">
          <a href="#" class="js-close close" aria-label="Close Popup">Close</a>
          <h2 class="heading-medium no-margin">Add organisation and invite applicants</h2>
          <p>All applicants that have been added to this organisation will be added at this point.</p>
          <hr />

          <form method="get" id="submit-remove-collaborator-form">

            <th:block th:if="${param.status != null and param.status[0] == 'firstLoad'}">
              <input type="hidden" name="status" th:value="${param.status[0]}" />
            </th:block>

            <button class="button" type="submit" formaction="/prototypes/632-organisation-collaborator-overview">Add organisation and invite applicants</button>
            <a href="#" class="js-close button-link-style">Cancel</a>

          </form>
        </div>

        <div class="modal-delete-organisation" role="dialog" aria-hidden="true" style="margin-top: -153px;">
            <button class="js-close close" type="button" aria-label="Close Popup">X</button>
            <h2 class="heading-medium no-margin">Delete organisation</h2>
            <p>Are you sure you wish to remove this organisation from the application. The innovate funding system will not inform collaborators of their removal, this action should be discussed with all applicants beforehand.</p>
            <p>This will remove all collaborators, and they will no longer be able to access this application. It will also delete the organisations financial details, and any assigned questions will be returned to you as the lead applicant.</p>
            <hr />

            <form method="get">

                <button class="button large" name="publish" value="publish" type="submit" formaction="/prototypes/632-organisation-collaborator-overview">Delete organisation</button>
                <button class="js-close buttonlink large" type="button">Cancel</button>

            </form>

        </div>

        <!-- END OFHARDCODED PROTOTYPE HTML -->

        <th:block th:insert="fragments/layout :: main-content-end" />
    </main>

    <th:block th:insert="fragments/layout :: footer" />
    <th:block th:insert="fragments/layout :: body-end" />

    <script src="/js/ifs_prototype/tablesaw-init.js" type="text/javascript"></script>
    <script src="/js/ifs_prototype/tablesaw.stackonly.jquery.js" type="text/javascript"></script>
</body>

</html>

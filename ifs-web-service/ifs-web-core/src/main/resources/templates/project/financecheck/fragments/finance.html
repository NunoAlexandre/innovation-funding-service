<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">

    <!--/*
        Note: Below empty fragment is need because empty questions have started appearing after merge from developement.
        TODO: Remove it once the cause for it is known. INFUND-4833
    */-->
    <th:block th:fragment="empty (viewmode)"></th:block>

    <!-- ===========================Form: labour =========================== -->
    <th:block th:fragment="labour (viewmode)" th:with="costCategory=${organisationFinance.get(T(org.innovateuk.ifs.finance.resource.cost.FinanceRowType).fromType(formInput.type))},formInputIndex=${status.index}">
        <th:block th:if="${viewmode == 'approved'}">

            <dl class="standard-definition-list">
                <dt>Working days per year</dt>
                <dd th:text="${costCategory.workingDaysPerYear}">232</dd>
            </dl>
            <table class="labour-costs-table">
                <thead>
                    <tr>
                        <th scope="col">Role within project</th>
                        <th scope="col" class="numeric">Gross annual salary</th>
                        <th scope="col" class="numeric">Rate (£/day)</th>
                        <th scope="col" class="numeric">Days to be spent by all staff at this grade</th>
                        <th scope="col" class="numeric">Total costs</th>
                    </tr>
                </thead>
                <tbody>
                    <th:block th:each="cost, iteration : ${costCategory.costs}">
                        <tr>
                            <td th:text="${cost.getRole()}" />
                            <td class="numeric" th:text="${cost.grossAnnualSalary != null ? #numbers.formatDecimal(cost.grossAnnualSalary,0,0) : '0'}" />
                            <td class="numeric" th:text="${(costCategory?.workingDaysPerYear != null and cost.getRate(costCategory.workingDaysPerYear) != null) ? '£ '+#numbers.formatDecimal(cost.getRate(costCategory.workingDaysPerYear),0,0) : '£ 0'}" />
                            <td class="numeric" th:text="${cost.labourDays}" />
                            <td class="numeric" th:text="'£ ' + ${#numbers.formatDecimal(cost.getTotal(costCategory.workingDaysPerYear), 0, 'COMMA', 0, 'POINT')}" />
                        </tr>
                    </th:block>
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="4" scope="row">Total labour costs</th>
                        <td th:id="${'section-total-'+subSection.id}" class="numeric" th:text="'£ ' + ${costCategory.getTotal() != null ? #numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT') : 0}" />
                    </tr>
                </tfoot>
            </table>
        </th:block>

        <th:block th:if="${(viewmode == 'readonly') or (viewmode == 'edit')}">

            <div th:attr="data-repeatable-container=${question.id}" th:if="${costCategory!=null}">
                <div class="form-group inline"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costCategory.workingDaysPerYearCostItem?.id +']}') or #fields.hasErrors('${form.formInput[cost-'+ costCategory.workingDaysPerYearCostItem?.id +'-labourDays]}')} ? 'error' : ''">
                    <label th:for="${'cost-labour-'+costCategory.workingDaysPerYearCostItem?.id+'-labourDaysYearly'}">
                        <span>Working days per year</span>
                        <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costCategory.workingDaysPerYearCostItem?.id})" />
                        <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costCategory.workingDaysPerYearCostItem?.id +'-labourDays'})" />
                    </label>
                    <th:block th:with="rejectedValue=${form.getRejectedValue('cost-'+ costCategory.workingDaysPerYearCostItem?.id +'-labourDays')}">
                    <input type="number"
                           class="form-control"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costCategory.workingDaysPerYearCostItem?.id +']}') or #fields.hasErrors('${form.formInput[cost-'+ costCategory.workingDaysPerYearCostItem?.id +'-labourDays]}')} ? 'field-error' : ''"
                           th:id="${'cost-labour-'+costCategory.workingDaysPerYearCostItem?.id+'-labourDaysYearly'}"
                           th:name="${'labour-labourDaysYearly-' + question.id + '-' + costCategory.workingDaysPerYearCostItem?.id}"
                           ifs:nonZeroValue="${rejectedValue != null ? rejectedValue : costCategory.workingDaysPerYear}"
                           th:readonly="${viewmode == 'readonly'}"
                           placeholder="0"
                           min="1"
                           max="365"
                           required="required" />
                    </th:block>
                </div>
                <div class="form-group">
                    <table class="labour-costs-table">
                        <thead>
                        <tr>
                            <th id="labour-role" scope="col" class="width-medium">Role within project</th>
                            <th id="labour-salary" scope="col" class="numeric">Gross annual salary</th>
                            <th id="labour-rate" scope="col" class="numeric">Rate (£/day)</th>
                            <th id="labour-days" scope="col" class="numeric width-medium">Days to be spent by all staff at this grade</th>
                            <th scope="col"  th:if="${viewmode == 'edit'}">
                                <span class="visuallyhidden">Actions</span>
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                            <th:block th:each="cost, iteration : ${costCategory.costs}">
                                <th:block th:include="project/financecheck/fragments/finance :: labour_row" th:with="iterationIndex=${iteration.count}" />
                            </th:block>
                        </tbody>
                    </table>
                    <p class="alignright" th:if="${viewmode == 'edit'}">
                        <th:block th:include="question-type/types :: add_row(text='Add another role', question=${question},rowcontainer='.labour-costs-table tbody')" />
                    </p>
                </div>
                    <div class="form-group alignright inline">
                        <label th:for="${'section-total-'+subSection.id}">Total labour costs</label>
                        <input class="form-control form-control-1-4 alignright"
                               data-calculation-fields="[id*=labourTotalCost]"
                               data-calculation-operations="+"
                               th:attr="data-calculation-rawvalue=${costCategory.getTotal()}"
                               readonly="readonly"
                               type="text"
                               th:id="${'section-total-'+subSection.id}"
                               th:value="'£ ' + ${costCategory.getTotal() != null ? #numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT') : 0}" />

                    </div>
                </div>
            </th:block>
            <input type="hidden"
                   th:id="${'section-percentage-'+subSection.id}"
                   th:value="${costCategory.getTotal() != null ? #ifsUtil.calculatePercentage(costCategory.getTotal(),summaryModel.eligibilityOverview.totalCost) + '%' : 0}" />

    </th:block>

    <th:block th:fragment="labour_row">
        <th:block  th:with="costIdentifier=${(cost.id == null) ? 'unsaved' + T(java.util.UUID).randomUUID().toString().replaceAll('-','') : cost.id}">
        <tr th:id="${'cost-'+costIdentifier}" th:attr="data-repeatable-row=${costIdentifier}">
            <td class="form-group"   th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-role]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-role')}">

                <label th:for="${'cost-labour-'+costIdentifier+'-role'}">
                    <span class="visuallyhidden">Role within project</span>
                    <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-role'})" />
                </label>
                <input type="text"
                       class="form-control width-full"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-role]}')} ? field-error : ''"
                       th:name="${'labour-role-' + question.id + '-' + costIdentifier}"
                       th:id="${'cost-labour-'+costIdentifier+'-role'}"
                       th:value="${rejectedValue != null ? rejectedValue : cost.getRole()}"
                       th:readonly="${viewmode == 'readonly'}"
                       required="required"
                       maxlength="255" />
            </td>
            <td class="numeric form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-grossAnnualSalary]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-' + costIdentifier + '-grossAnnualSalary')}">
                <label th:for="${'cost-labour-'+costIdentifier+'-labourGrossSalary'}">
                    <span class="visuallyhidden">Gross annual salary</span>
                    <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-grossAnnualSalary'})" />
                </label>
                <input type="number"
                       class="form-control width-full"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+costIdentifier+'-grossAnnualSalary]}')} ? field-error : ''"
                       th:name="${'labour-grossAnnualSalary-' + question.id + '-' + costIdentifier}"
                       th:id="${'cost-labour-'+costIdentifier+'-labourGrossSalary'}"
                       th:readonly="${viewmode == 'readonly'}"
                       ifs:nonZeroValue="${rejectedValue != null ? rejectedValue : (cost.grossAnnualSalary != null ? #numbers.formatDecimal(cost.grossAnnualSalary,0,0) : '0')}"
                       placeholder="0"
                       required="required"
                       min="1"
                       max="9999999999999999999"
                       th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(20)}"
                        />
            </td>
            <td class="numeric">
                <label th:for="${'cost-labour-'+costIdentifier+'-labourRate'}">
                    <span class="visuallyhidden">Rate (&pound;/day)</span>
                </label>
                <input type="text"
                       class="form-control width-full"
                       th:attr="data-calculation-fields=${'#cost-labour-'+costIdentifier+'-labourGrossSalary,#cost-labour-'+costCategory.workingDaysPerYearCostItem?.id+'-labourDaysYearly'},data-calculation-rawValue=${costCategory?.workingDaysPerYear != null ? cost.getRate(costCategory.workingDaysPerYear) : 0}"
                       data-calculation-operations="/"
                       readonly="readonly"
                       th:id="${'cost-labour-'+costIdentifier+'-labourRate'}"
                       th:name="${'labour-labourRate-' + question.id + '-' + costIdentifier}"
                       th:value="${(costCategory?.workingDaysPerYear != null and cost.getRate(costCategory.workingDaysPerYear) != null) ? '£ '+#numbers.formatDecimal(cost.getRate(costCategory.workingDaysPerYear),0,0) : '£ 0'}"
                       maxlength="255" />
            </td>
            <td class="numeric form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-labourDays]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-labourDays')}">
                <label th:for="${'cost-labour-'+costIdentifier+'-labourDays'}">
                    <span class="visuallyhidden">Days to be spent by all staff at this grade</span>
                    <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-labourDays'})" />
                </label>
                <input type="number"
                       class="form-control width-full"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+costIdentifier+'-labourDays]}')} ? field-error : ''"
                       th:readonly="${viewmode == 'readonly'}"
                       th:id="${'cost-labour-'+costIdentifier+'-labourDays'}"
                       th:name="${'labour-labourDays-' + question.id + '-' + costIdentifier}"
                       ifs:nonZeroValue="${rejectedValue != null ? rejectedValue : cost.labourDays}"
                       placeholder="0"
                       required="required"
                       min="1"
                       max="999999999"
                       th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(10)}"
                        />
            </td>
            <td rowspan="2" class="rowspan buttoncolumn" th:if="${viewmode == 'edit'}">
                <button th:unless="${cost.id == null}"
                        type="submit"
                        name="remove_cost"
                        class="buttonlink js-remove-row"
                        th:value="${cost.id}"
                        th:attrappend="formaction='&#35;question-'+${question.id}">Remove
                </button>
              <span th:if="${cost.id == null}" class="buttonplaceholder"></span>
            </td>
        </tr>
        <tr th:attr="data-repeatable-row=${costIdentifier}">
            <td colspan="4" class="numeric colspan">
                <label th:for="${'cost-labour-'+costIdentifier+'-labourTotalCost'}"><span>Total costs</span></label>
                <input type="text"
                       class="form-control width-medium"
                       data-calculation-operations="/,*"
                       th:name="${'labour-total-' + question.id + '-' + costIdentifier}"
                       readonly="readonly"
                       th:id="${'cost-labour-'+costIdentifier+'-labourTotalCost'}"
                       th:attr="data-calculation-fields=${'#cost-labour-'+costIdentifier+'-labourGrossSalary,#cost-labour-'+costCategory.workingDaysPerYearCostItem?.id+'-labourDaysYearly,#cost-labour-'+costIdentifier+'-labourDays'},data-calculation-rawvalue=${cost.getTotal(costCategory.workingDaysPerYear)}"
                       th:value="'£ ' + ${#numbers.formatDecimal(cost.getTotal(costCategory.workingDaysPerYear), 0, 'COMMA', 0, 'POINT')}" />
            </td>

        </tr>
    </th:block>
    </th:block>

    <!-- ===========================Form: overheads =========================== -->
    <th:block th:fragment="overheads(viewmode)">
        <p></p>
    </th:block>

    <!-- ===========================Form: materials =========================== -->
    <th:block th:fragment="materials (viewmode)"  th:with="costCategory=${organisationFinance.get(T(org.innovateuk.ifs.finance.resource.cost.FinanceRowType).fromType(formInput.type))}">
        <p th:text="${question.getDescription()}"></p>

        <th:block th:if="${(viewmode == 'approved')}">
            <table id="material-costs-table">
                <thead>
                <tr>
                    <th id="materials-item" scope="col">Item</th>
                    <th id="materials-quantity" scope="col" class="numeric">Quantity</th>
                    <th id="materials-cost" scope="col" class="numeric">Cost per item</th>
                    <th id="materials-total" scope="col" class="numeric">Total</th>
                    <th scope="col" th:if="${viewmode == 'edit'}">
                        <span class="visuallyhidden">Actions</span>
                    </th>
                </tr>
                </thead>
                <tbody>
                    <tr th:each="cost, iteration : ${costCategory.costs}">
                        <td th:text="${cost.getItem()}"></td>
                        <td class="numeric" th:text="${cost.getQuantity()}"></td>
                        <td class="numeric" th:text="${cost.cost != null ? #numbers.formatDecimal(cost.cost,0,'COMMA',0,'POINT') : '0'}"></td>
                        <td class="numeric" th:id="${'section-total-'+subSection.id}" th:text="'£ ' + ${#numbers.formatDecimal(cost.total,0,'COMMA',0,'POINT')}"></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <th scope="row" colspan="3">Total materials costs</th>
                        <td th:text="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" class="numeric"></td>
                    </tr>
                </tfoot>
            </table>
        </th:block>

        <th:block th:if="${(viewmode == 'readonly') or (viewmode == 'edit')}">

            <div th:attr="data-repeatable-container=${question.id}">
                <div class="form-group">
                    <table id="material-costs-table">
                        <thead>
                        <tr>
                            <th id="materials-item" scope="col">Item</th>
                            <th id="materials-quantity" scope="col" class="numeric">Quantity</th>
                            <th id="materials-cost" scope="col" class="numeric">Cost per item</th>
                            <th id="materials-total" scope="col" class="numeric">Total</th>
                            <th scope="col" th:if="${viewmode == 'edit'}">
                                <span class="visuallyhidden">Actions</span>
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <th:block th:each="cost, iteration : ${costCategory.costs}">
                            <th:block th:include="project/financecheck/fragments/finance :: materials_row" th:with="iterationIndex=${iteration.count}" />
                        </th:block>
                        </tbody>
                    </table>

                    <p class="alignright" th:if="${viewmode == 'edit'}">
                        <th:block th:include="question-type/types :: add_row(text='Add another materials cost', question=${question},rowcontainer='#material-costs-table tbody')" />
                    </p>
                </div>
                <div class="form-group alignright inline">
                    <label th:for="${'section-total-'+subSection.id}">Total materials costs</label>
                    <input class="form-control alignright form-control-1-4"
                           readonly="readonly"
                           type="text"
                           data-calculation-fields="[id*=materialTotal]"
                           data-calculation-operations="+"
                           th:id="${'section-total-'+subSection.id}"
                           th:attr="data-calculation-rawvalue=${costCategory.total}"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" />
                </div>
            </div>
        </th:block>
        <input type="hidden"
               th:id="${'section-percentage-'+subSection.id}"
               th:value="${costCategory.getTotal() != null ? #ifsUtil.calculatePercentage(costCategory.getTotal(),summaryModel.eligibilityOverview.totalCost) + '%' : 0}" />

    </th:block>
    <!-- =========================== repeating rows - Materials  =========================== -->

    <th:block th:fragment="materials_row">
        <th:block th:with="costIdentifier=${(cost.id == null) ? 'unsaved' + T(java.util.UUID).randomUUID().toString().replaceAll('-','') : cost.id}">
            <tr th:id="${'cost-'+costIdentifier}" th:attr="data-repeatable-row=${costIdentifier}">
                <td class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-item]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-item')}">
                    <label th:for="${'cost-materials-'+costIdentifier+'-item'}">
                        <span class="visuallyhidden">Item</span>
                        <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-item'})" />
                    </label>
                    <input type="text"
                           class="form-control width-full"
                           th:name="${'materials-item-' + question.id + '-' + costIdentifier}"
                           th:id="${'cost-materials-'+costIdentifier+'-item'}"
                           th:value="${rejectedValue != null ? rejectedValue : cost.getItem()}"
                           th:readonly="${viewmode == 'readonly'}"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-item]}')} ? 'field-error' : ''"
                           required="required"
                           maxlength="255" />
                </td>
                <td class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-quantity]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-quantity')}">
                  <label th:for="${'cost-materials-'+costIdentifier+'-quantity'}">
                      <span class="visuallyhidden">Quantity</span>
                      <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-quantity'})" />
                  </label>
                    <input type="number"
                           class="form-control width-full"
                           th:name="${'materials-quantity-' + question.id + '-' + costIdentifier}"
                           th:id="${'cost-materials-'+costIdentifier+'-quantity'}"
                           placeholder="0"
                           ifs:nonZeroValue="${rejectedValue != null ? rejectedValue : cost.getQuantity()}"
                           th:readonly="${viewmode == 'readonly'}"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-quantity]}')} ? 'field-error' : ''"
                           min="1"
                           max="999999999"
                           required="required"
                           th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(10)}"
                           />
                </td>
                <td class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-cost]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-cost')}">
                    <label th:for="${'cost-materials-'+costIdentifier+'-cost'}">
                        <span class="visuallyhidden">Cost per item</span>
                        <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-cost'})" />
                    </label>
                    <input type="number"
                           class="form-control width-full"
                           th:name="${'materials-cost-' + question.id + '-' + costIdentifier}"
                           th:id="${'cost-materials-'+costIdentifier+'-cost'}"
                           ifs:nonZeroValue="${rejectedValue != null ? rejectedValue : (cost.cost != null ? #numbers.formatDecimal(cost.cost,0,0) : '0')}"
                           th:readonly="${viewmode == 'readonly'}"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-cost]}')} ? 'field-error' : ''"
                           placeholder="0"
                           min="1"
                           max="9999999999999999999"
                           required="required"
                           th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(20)}" />
                </td>
                <td>
                  <label th:for="${'cost-materials-'+costIdentifier+'-materialTotal'}">
                      <span class="visuallyhidden">Total</span>
                  </label>
                    <input type="text"
                           class="alignright form-control width-full"
                           th:name="${'materials-total-' + question.id + '-' + costIdentifier}"
                           th:attr="data-calculation-fields='#'+${'cost-materials-'+costIdentifier+'-quantity'}+',#'+${'cost-materials-'+costIdentifier+'-cost'},data-calculation-rawvalue=${cost.total}"
                           th:id="${'cost-materials-'+costIdentifier+'-materialTotal'}"
                           data-calculation-operations="*"
                           readonly="readonly"
                           th:value="'£ ' + ${#numbers.formatDecimal(cost.total, 0, 0)}"
                            />
                </td>
                <td class="alignright buttoncolumn remove" th:if="${viewmode == 'edit'}">
                    <button th:unless="${cost.id == null}"
                            type="submit"
                            name="remove_cost"
                            th:value="${cost.id}"
                            th:class="'buttonlink js-remove-row'"
                            th:attrappend="formaction='&#35;question-'+${question.id}">Remove
                    </button>
                    <span th:if="${cost.id == null}" class="buttonplaceholder"></span>
                </td>
            </tr>
        </th:block>
    </th:block>

    <!-- ===========================Form: capital usage =========================== -->
    <th:block th:fragment="capital_usage(viewmode)"  th:with="costCategory=${organisationFinance.get(T(org.innovateuk.ifs.finance.resource.cost.FinanceRowType).fromType(formInput.type))}">
        <p th:text="${question.getDescription()}"></p>
        <th:block th:if="${(viewmode == 'approved')}">
            <table id="capital-usage-table">
                <thead>
                    <tr>
                        <th scope="col" id="cap-usage-description">Item description</th>
                        <th scope="col" id="cap-usage-new-existing">New or Existing</th>
                        <th scope="col" id="cap-usage-depreciation-period">Depreciation period</th>
                        <th scope="col" class="numeric" id="cap-usage-net-present-value">Net present value</th>
                        <th scope="col" class="numeric" id="cap-usage-residual-value">Residual value</th>
                        <th scope="col" class="numeric" id="cap-usage-utilisation">Utilisation</th>
                        <th scope="col" class="numeric" id="cap-usage-cost">Net cost</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="cost : ${costCategory.costs}">
                        <td th:text="${cost.description}"></td>
                        <td th:text="${cost.existing}"></td>
                        <td th:text="${cost.deprecation}"></td>
                        <td class="numeric" th:text="${#numbers.formatDecimal(cost.npv,0,0)}"></td>
                        <td class="numeric" th:text="${#numbers.formatDecimal(cost.residualValue,0,0)}"></td>
                        <td class="numeric" th:text="${cost.utilisation}"></td>
                        <td class="numeric" th:text="'£ ' + ${cost.total &lt; 0 ? 0 : #numbers.formatDecimal(cost.total, 0, 0)}"></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <th colspan="6">Total capital usage</th>
                        <td class="numeric" th:id="${'section-total-'+subSection.id}" th:text="'£ ' + ${#numbers.formatDecimal(costCategory.total &lt; 0 ? 0 : costCategory.total, 0, 'COMMA', 0, 'POINT')}">£0</td>
                    </tr>
                </tfoot>
            </table>
        </th:block>
        <th:block th:if="${(viewmode == 'readonly') or (viewmode == 'edit')}">
            <div id="capital_usage">
                <th:block th:each="cost : ${costCategory.costs}">
                    <th:block th:include="project/financecheck/fragments/finance :: capital_usage_row" />
                </th:block>
            </div>
            <p class="alignright" th:if="${viewmode == 'edit'}">
                <th:block th:include="question-type/types :: add_row(text='Add another asset', question=${question},rowcontainer='#capital_usage')" />
            </p>
            <div class="form-group alignright extra-margin inline">
                <label th:for="${'section-total-'+subSection.id}">Total capital usage costs</label>
                <input class="form-control form-control-1-4 alignright"
                       readonly="readonly"
                       type="text"
                       th:id="${'section-total-'+subSection.id}"
                       data-calculation-fields="[id*=netCost]"
                       data-calculation-operations="+"
                       th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total &lt; 0 ? 0 : costCategory.total, 0, 'COMMA', 0, 'POINT')}" />
            </div>
        </th:block>
        <input type="hidden"
               th:id="${'section-percentage-'+subSection.id}"
               th:value="${costCategory.getTotal() != null ? #ifsUtil.calculatePercentage(costCategory.getTotal(),summaryModel.eligibilityOverview.totalCost) + '%' : 0}" />

    </th:block>

    <!-- ===========================Form: capital usage repeating row =========================== -->

    <th:block th:fragment="capital_usage_row">
        <th:block th:with="costIdentifier=${(cost.id == null) ? 'unsaved' + T(java.util.UUID).randomUUID().toString().replaceAll('-','') : cost.id}">
            <div th:id="${'cost-'+costIdentifier}" th:attr="data-repeatable-row=${costIdentifier}" class="form-row">
                <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-description]}')} ? 'error' : ''">
                    <label th:for="${'cost-capital_usage-'+costIdentifier+'-description'}">
                        <span>Item description</span>
                        <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-description'})" />
                      </label>
                    <th:block th:include="question-type/form-elements :: form-finance-textarea (type='capital_usage', id=${costIdentifier}, name='description', value=${cost.getDescription()},readonly=${viewmode == 'readonly'},required=true)" />
                </div>
                <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-existing]}')} ? 'error' : ''">
                    <fieldset class="inline">
                        <legend>New or existing item</legend>
                        <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-existing'})" />
                        <label class="block-label selection-button-radio selection-button-radio">
                            <input th:id="${'cost-capital_usage-'+costIdentifier+'-existing_0'}"
                                   type="radio"
                                   th:name="${'capital_usage-existing-' + question.id + '-' + costIdentifier}"
                                   value="New"
                                   required="required"
                                   th:checked="${cost.existing == 'New'}"
                                   th:disabled="${viewmode == 'readonly'}" />
                            New
                        </label>
                        <label class="block-label selection-button-radio selection-button-radio">
                            <input th:id="${'cost-capital_usage-'+costIdentifier+'-existing_1'}"
                                   type="radio"
                                   th:name="${'capital_usage-existing-' + question.id + '-' + costIdentifier}"
                                   value="Existing"
                                   required="required"
                                   th:checked="${cost.existing == 'Existing'}"
                                   th:disabled="${viewmode == 'readonly'}" />
                            Existing
                        </label>
                    </fieldset>
                </div>
                <div class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-deprecation]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-deprecation')}">
                    <label th:for="${'cost-capital_usage-'+costIdentifier+'-deprecation_period'}" class="form-label">
                        <span>Depreciation period (months)</span>
                        <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-deprecation'})" />
                    </label>
                    <input  type="number"
                            th:id="${'cost-capital_usage-'+costIdentifier+'-deprecation_period'}"
                            class="form-control form-finances-capital-usage-depreciation"
                            th:name="${'capital_usage-deprecation-' + question.id + '-' + costIdentifier}"
                            ifs:nonZeroValue="${rejectedValue != null ? rejectedValue : cost.deprecation}"
                            th:readonly="${viewmode == 'readonly'}"
                            placeholder="0"
                            min="1"
                            max="999999999"
                            required="required"
                            th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(10)}"
                            th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-deprecation]}')} ? 'field-error' : ''"
                             />
                </div>
                <div class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-npv]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-npv')}">
                    <label th:for="${'cost-capital_usage-'+costIdentifier+'-npv'}" class="form-label">
                        <span>Net present value at the start of your project or the price you bought it for (£)</span>
                        <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-npv'})" />
                    </label>
                    <input
                            type="number"
                            th:id="${'cost-capital_usage-'+costIdentifier+'-npv'}"
                            class="form-control form-finances-capital-usage-npv"
                            th:name="${'capital_usage-npv-' + question.id + '-' + costIdentifier}"
                            ifs:nonZeroValue="${rejectedValue != null ? rejectedValue : (cost.npv != null ? #numbers.formatDecimal(cost.npv,0,0) : '0')}"
                            th:readonly="${viewmode == 'readonly'}"
                            placeholder="0"
                            min="1"
                            max="9999999999999999999"
                            required="required"
                            th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(20)}"
                            th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-npv]}')} ? 'field-error' : ''" />

                </div>
                <div class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-residualValue]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-residualValue')}">
                    <label th:for="${'cost-capital_usage-'+costIdentifier+'-residual_value'}" class="form-label">
                        <span>Residual value at end of project (£)</span>
                        <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-residualValue'})" />
                    </label>
                    <input
                            type="number"
                            th:id="${'cost-capital_usage-'+costIdentifier+'-residual_value'}"
                            class="form-control form-finances-capital-usage-residual-value"
                            th:name="${'capital_usage-residualValue-' + question.id + '-' + costIdentifier}"
                            ifs:nonZeroValue="${rejectedValue != null ? rejectedValue : #numbers.formatDecimal(cost.residualValue,0,0)}"
                            th:readonly="${viewmode == 'readonly'}"
                            placeholder="0"
                            min="0"
                            max="9999999999999999999"
                            required="required"
                            th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(20)}"
                            th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-residualValue]}')} ? 'field-error' : ''"/>
                </div>

                <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-utilisation]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-utilisation')}">
                    <label th:for="${'cost-capital_usage-'+costIdentifier+'-utilisation'}" class="form-label">
                        <span>Utilisation (%)</span>
                        <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-utilisation'})" />
                    </label>
                    <input type="number"
                           th:id="${'cost-capital_usage-'+costIdentifier+'-utilisation'}"
                           class="form-control form-finances-capital-usage-utilisation"
                           th:name="${'capital_usage-utilisation-' + question.id + '-' + costIdentifier}"
                           ifs:nonZeroValue="${rejectedValue != null ? rejectedValue : cost.utilisation}"
                           th:readonly="${viewmode == 'readonly'}"
                           placeholder="0"
                           min="0"
                           max="100"
                           required="required"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-utilisation]}')} ? 'field-error' : ''"/>
                </div>

                <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-netCost]}')} ? 'error' : ''">
                    <label th:for="${'cost-capital_usage-'+costIdentifier+'-netCost'}" class="form-label">
                       <span>Net cost</span>
                       <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-netCost'})" />
                    </label>
                    <input type="text"
                           class="form-control"
                           th:attr="data-calculation-fields=${'#cost-capital_usage-'+costIdentifier+'-npv,#cost-capital_usage-'+costIdentifier+'-residual_value,#cost-capital_usage-'+costIdentifier+'-utilisation,100'}"
                           data-calculation-operations="-,*,/,negativeRoundUp"
                           readonly="readonly"
                           th:id="${'cost-capital_usage-'+costIdentifier+'-netCost'}"
                           th:name="${'capital_usage-netCost-' + question.id + '-' + costIdentifier}"
                           th:value="'£ ' + ${cost.total &lt; 0 ? 0 : #numbers.formatDecimal(cost.total, 0, 0)}"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-netCost]}')} ? 'error' : ''"
                           />
                </div>
                <th:block th:if="${viewmode == 'edit'}">
                    <button type="submit"
                            name="remove_cost"
                            class="buttonlink js-remove-row"
                            th:value="${cost.id}"
                            th:attrappend="formaction='&#35;question-'+${question.id}">Remove
                    </button>
                    <span class="buttonplaceholder"></span>
                </th:block>
            </div>
        </th:block>
    </th:block>

    <!-- ===========================Form: subcontracting cost =========================== -->
    <th:block th:fragment="subcontracting (viewmode)" th:with="costCategory=${organisationFinance.get(T(org.innovateuk.ifs.finance.resource.cost.FinanceRowType).fromType(formInput.type))}">
        <p th:text="${question.getDescription()}"></p>
        <th:block th:if="${viewmode == 'approved'}">
            <table id="subcontracting-table">
                <thead>
                    <tr>
                        <th scope="col" id="subcontracting-name">Suncontractor name</th>
                        <th scope="col" id="subcontracting-country">Country</th>
                        <th scope="col" id="subcontracting-role">Role</th>
                        <th scope="col" class="numeric" id="subcontracting-cost">Cost</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="cost : ${costCategory.costs}">
                        <td th:text="${cost.name}">Mr Francis Bois</td>
                        <td th:text="${cost.country}">France</td>
                        <td th:text="${cost.role}">Specialist consultant</td>
                        <td class="numeric" th:text="'£ '+${cost.cost != null ? #numbers.formatDecimal(cost.cost,0,'COMMA',0,'POINT') : '0'}">£ 150,000</td>
                    </tr>
                </tbody>
                <tfoot>
                <tr>
                    <th colspan="3" scope="row">Total subcontracting costs</th>
                    <td class="numeric" th:id="${'section-total-'+subSection.id}" th:text="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}">£150,000</td>
                </tr>
                </tfoot>
            </table>
        </th:block>
        <th:block th:if="${(viewmode == 'readonly') or (viewmode == 'edit')}">
            <div id="subcontracting">
                <th:block th:each="cost : ${costCategory.costs}">
                    <th:block th:include="project/financecheck/fragments/finance :: subcontracting_row" />
                </th:block>
            </div>
            <p class="alignright" th:if="${viewmode == 'edit'}">
              <th:block th:include="question-type/types :: add_row(text='Add another subcontractor', question=${question},rowcontainer='#subcontracting')" />
            </p>
            <div class="form-group alignright extra-margin inline">
                <label th:for="${'section-total-'+subSection.id}">Total subcontracting costs</label>
                <input class="form-control form-control-1-4 alignright"
                       readonly="readonly"
                       type="text"
                       th:id="${'section-total-'+subSection.id}"
                       data-calculation-fields="[id*=subcontractingCost]"
                       data-calculation-operations="+"
                       th:attr="data-calculation-rawvalue=${costCategory.getTotal()}"
                       th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" />
            </div>
        </th:block>
        <input type="hidden"
               th:id="${'section-percentage-'+subSection.id}"
               th:value="${costCategory.getTotal() != null ? #ifsUtil.calculatePercentage(costCategory.getTotal(),summaryModel.eligibilityOverview.totalCost) + '%' : 0}" />

    </th:block>

    <th:block th:fragment="subcontracting_row">
        <th:block th:with="costIdentifier=${(cost.id == null) ? 'unsaved' + T(java.util.UUID).randomUUID().toString().replaceAll('-','') : cost.id}">
        <div class="form-row" th:id="${'cost-'+costIdentifier}" th:attr="data-repeatable-row=${costIdentifier}">
            <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-name]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-name')}">
                <label class="form-label" th:for="${'cost-subcontracting-'+costIdentifier+'-name'}">
                    <span>Subcontractor name</span>
                    <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-name'})" />
                </label>
                <input type="text"
                       th:name="${'subcontracting-name-' + question.id + '-' + costIdentifier}"
                       class="form-control form-finances-subcontracting-company"
                       th:id="${'cost-subcontracting-'+costIdentifier+'-name'}"
                       th:value="${rejectedValue != null ? rejectedValue : cost.name}"
                       th:readonly="${viewmode == 'readonly'}"
                       maxlength="255"
                       required="required"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-name]}')} ? 'field-error' : ''" />
            </div>
            <div class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-country]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-country')}">
                <label class="form-label" th:for="${'cost-subcontracting-'+costIdentifier+'-country'}">
                    <span>Country where the subcontractor will work</span>
                    <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-country'})" />
                </label>
                <input type="text"
                       th:name="${'subcontracting-country-' + question.id + '-' + costIdentifier}"
                       class="form-control"
                       th:id="${'cost-subcontracting-'+costIdentifier+'-country'}"
                       th:value="${rejectedValue != null ? rejectedValue : cost.country}"
                       th:readonly="${viewmode == 'readonly'}"
                       maxlength="255"
                       required="required"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-country]}')} ? 'field-error' : ''" />
            </div>

            <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-role]}')} ? 'error' : ''">
                <label class="form-label" th:for="${'cost-'+ type + '-'+costIdentifier+'-role'}">
                  <span>Role of the subcontractor in the project and description of the work they’ll do</span>
                    <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-role'})" />
                </label>

                <th:block th:include="question-type/form-elements :: form-finance-textarea (type='subcontracting', id=${costIdentifier}, name='role', value=${cost.role},readonly=${viewmode == 'readonly'},required=true)" />
            </div>

            <div class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-cost]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-cost')}">
                <label class="form-label" th:for="${'cost-subcontracting-'+costIdentifier+'-subcontractingCost'}">
                      <span>Cost</span>
                      <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-cost'})" />
                  </label>
                <input type="number"
                       class="form-control"
                       th:name="${'subcontracting-subcontractingCost-' + question.id + '-' + costIdentifier}"
                       th:id="${'cost-subcontracting-'+costIdentifier+'-subcontractingCost'}"
                       ifs:nonZeroValue="${rejectedValue != null ? rejectedValue : (cost.cost != null ? #numbers.formatDecimal(cost.cost,0,0) : '0')}"
                       th:readonly="${viewmode == 'readonly'}"
                       placeholder="0"
                       min="1"
                       max="9999999999999999999"
                       required="required"
                       th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(20)}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-cost]}')} ? 'field-error' : ''"
                       />
            </div>
            <th:block th:if="${(viewmode == 'edit')}">
                <button th:unless="${cost.id == null}"
                        type="submit"
                        name="remove_cost"
                        class="buttonlink js-remove-row"
                        th:value="${cost.id}">Remove
                </button>
                <span th:if="${cost.id == null}" class="buttonplaceholder"></span>
            </th:block>
        </div>
        </th:block>
    </th:block>

    <!-- ===========================Form: travel cost =========================== -->
    <th:block th:fragment="travel (viewmode)" th:with="costCategory=${organisationFinance.get(T(org.innovateuk.ifs.finance.resource.cost.FinanceRowType).fromType(formInput.type))}">
        <p th:text="${question.description}"></p>

        <th:block th:if="${(viewmode == 'approved')}">
            <table id="travel-costs-table">
                <thead>
                    <tr>
                        <th id="travel-purpose">Purpose of journey or description of subsistence cost</th>
                        <th id="travel-times" class="numeric">Number of times</th>
                        <th id="travel-cost" class="numeric">Cost each (£)</th>
                        <th id="travel-total" class="numeric">Total (£)</th>
                    </tr>
                </thead>
                <tbody>
                    <tr th:each="cost, iteration : ${costCategory.costs}">
                        <td th:text="${cost.item}"></td>
                        <td class="numeric" th:text="${cost.quantity}"></td>
                        <td class="numeric" th:text="${cost.cost != null ? #numbers.formatDecimal(cost.cost,0,0) : '0'}"></td>
                        <td class="numeric" th:text="'£ ' + ${#numbers.formatDecimal(cost.total, 0, 'COMMA', 0, 'POINT')}"></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <th scope="row" colspan="3">Total travel and subsistence</th>
                        <td class="numeric" th:id="${'section-total-'+subSection.id}" th:text="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}"></td>
                    </tr>
                </tfoot>
            </table>
        </th:block>
        <th:block th:if="${(viewmode == 'readonly') or (viewmode == 'edit')}">
            <div th:attr="data-repeatable-container=${question.id}">
                <div class="form-group">
                    <table id="travel-costs-table">
                        <thead>
                        <tr>
                            <th id="travel-purpose">Purpose of journey or description of subsistence cost</th>
                            <th id="travel-times" class="numeric">Number of times</th>
                            <th id="travel-cost" class="numeric">Cost each (£)</th>
                            <th id="travel-total" class="numeric">Total (£)</th>
                            <th th:if="${viewmode == 'edit'}"><span class="visuallyhidden">Actions</span></th>
                        </tr>
                        </thead>
                        <tbody>
                            <th:block th:each="cost, iteration : ${costCategory.costs}">
                                <th:block th:include="project/financecheck/fragments/finance :: travel_row" th:with="iterationIndex=${iteration.count}" />
                            </th:block>
                        </tbody>
                    </table>

                    <p class="alignright" th:if="${viewmode == 'edit'}">
                        <th:block th:include="question-type/types :: add_row(text='Add another travel cost', question=${question},rowcontainer='#travel-costs-table tbody')" />
                    </p>
                </div>
                <div class="form-group alignright inline">
                    <label th:for="${'section-total-'+subSection.id}">Total travel &amp; subsistence costs</label>
                    <input class="form-control form-control-1-4 alignright"
                           readonly="readonly"
                           type="text"
                           data-calculation-fields="[id*=travelCostTotal]"
                           data-calculation-operations="+"
                           th:id="${'section-total-'+subSection.id}"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}"
                           title="Total travel and subsistence costs" />
                </div>
            </div>
        </th:block>
        <input type="hidden"
               th:id="${'section-percentage-'+subSection.id}"
               th:value="${costCategory.getTotal() != null ? #ifsUtil.calculatePercentage(costCategory.getTotal(),summaryModel.eligibilityOverview.totalCost) + '%' : 0}" />

    </th:block>
    <!-- ===========================repeating rows : travel cost =========================== -->

    <th:block th:fragment="travel_row">
        <th:block th:with="costIdentifier=${(cost.id == null) ? 'unsaved' + T(java.util.UUID).randomUUID().toString().replaceAll('-','') : cost.id}">
        <tr th:id="${'cost-'+costIdentifier}" th:attr="data-repeatable-row=${costIdentifier}">
              <td class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-item]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-item')}">
                <label th:for="${'cost-travel-'+costIdentifier+'-item'}">
                      <span class="visuallyhidden">Purpose of journey or description of subsistence cost</span>
                      <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-item'})" />
                </label>
                <input type="text"
                       th:name="${'travel-item-' + question.id + '-' + costIdentifier}"
                       class="form-control width-full"
                       th:id="${'cost-travel-'+costIdentifier+'-item'}"
                       th:value="${rejectedValue != null ? rejectedValue : cost.item}"
                       th:readonly="${viewmode == 'readonly'}"
                       required="required"
                       maxlength="255"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-item]}')} ? 'field-error' : ''"/>
            </td>
            <td class="numeric form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-quantity]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-quantity')}">
                <label th:for="${'cost-travel-'+costIdentifier+'-quantity'}">
                      <span class="visuallyhidden">Number of times</span>
                      <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-quantity'})" />
                </label>
                <input type="number"
                       th:name="${'travel-quantity-' + question.id + '-' + costIdentifier}"
                       class="form-control width-full"
                       th:id="${'cost-travel-'+costIdentifier+'-quantity'}"
                       ifs:nonZeroValue="${rejectedValue != null ? rejectedValue : cost.quantity}"
                       th:readonly="${viewmode == 'readonly'}"
                       placeholder="0"
                       min="1"
                       max="999999999"
                       required="required"
                       th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(10)}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-quantity]}')} ? 'field-error' : ''" />
            </td>
            <td class="numeric form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-cost]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-cost')}">
                <label th:for="${'cost-travel-'+costIdentifier+'-cost'}">
                      <span class="visuallyhidden">Cost each (&pound;)</span>
                      <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-cost'})" />
                </label>
                <input type="number"
                       th:name="${'travel-cost-' + question.id + '-' + costIdentifier}"
                       class="form-control width-full"
                       th:id="${'cost-travel-'+costIdentifier+'-cost'}"
                       ifs:nonZeroValue="${rejectedValue != null ? rejectedValue : (cost.cost != null ? #numbers.formatDecimal(cost.cost,0,0) : '0')}"
                       th:readonly="${viewmode == 'readonly'}"
                       placeholder="0"
                       min="1"
                       max="9999999999999999999"
                       required="required"
                       th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(20)}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-cost]}')} ? 'field-error' : ''" />
            </td>
            <td class="numeric">
                <label th:for="${'cost-travel-'+costIdentifier+'-travelCostTotal'}">
                    <span class="visuallyhidden">Total (&pound;)</span>
                </label>
                <input type="text"
                       th:name="${'travel-travelCostTotal-' + question.id + '-' + costIdentifier}"
                       class="form-control width-full"
                       readonly="readonly"
                       th:id="${'cost-travel-'+costIdentifier+'-travelCostTotal'}"
                       th:attr="data-calculation-fields='#'+${'cost-travel-'+costIdentifier+'-cost'}+',#'+${'cost-travel-'+costIdentifier+'-quantity'},data-calculation-rawValue=${cost.getTotal()}"
                       data-calculation-operations="*"
                       th:value="'£ ' + ${#numbers.formatDecimal(cost.getTotal(), 0, 'COMMA', 0, 'POINT')}" />
            </td>
            <td th:if="${viewmode == 'edit'}">
                <button th:unless="${cost.id == null}"
                        type="submit"
                        name="remove_cost"
                        class="buttonlink js-remove-row"
                        th:value="${cost.id}"
                        th:attrappend="formaction='&#35;question-'+${question.id}">Remove
                </button>
                <span th:if="${cost.id == null}" class="buttonplaceholder"></span>
            </td>
        </tr>
        </th:block>
    </th:block>

    <!-- ===========================Form: other cost =========================== -->
    <th:block th:fragment="other_costs (viewmode)"  th:with="costCategory=${organisationFinance.get(T(org.innovateuk.ifs.finance.resource.cost.FinanceRowType).fromType(formInput.type))},type=${formInput.type.nameLower}">
        <p th:text="${question.description}" />
        <th:block th:if="${(viewmode == 'approved')}">
            <table id="other-costs-table">
                <thead>
                <tr>
                    <th id="other_costs-description" scope="col" >Description and justification of the cost</th>
                    <th id="other_costs-cost" scope="col" class="numeric">Estimated cost (£)</th>
                </tr>
                </thead>
                <tbody>
                    <tr th:each="cost : ${costCategory.costs}">
                        <td th:text="${cost.description}"></td>
                        <td class="numeric" th:text="'£ ' + ${cost.cost != null ? #numbers.formatDecimal(cost.cost,0,'COMMA',0,'POINT') : '0'}"></td>
                    </tr>
                </tbody>
                <tfoot>
                    <tr>
                        <th scope="row">Total other costs</th>
                        <td class="numeric" th:id="${'section-total-'+subSection.id}" th:text="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}"></td>
                    </tr>
                </tfoot>
            </table>
        </th:block>
        <th:block th:if="${(viewmode == 'readonly') or (viewmode == 'edit')}">
            <div th:attr="data-repeatable-container=${question.id}">
                <div class="form-group">
                    <table id="other-costs-table">
                        <thead>
                        <tr>
                            <th id="other_costs-description" scope="col" >Description and justification of the cost</th>
                            <th id="other_costs-cost" scope="col" class="numeric">Estimated cost (£)</th>
                            <th scope="col" th:if="${viewmode == 'edit'}"><span class="visuallyhidden">Actions</span></th>
                        </tr>
                        </thead>
                        <tbody>
                            <th:block th:each="cost : ${costCategory.costs}">
                                <th:block th:include="project/financecheck/fragments/finance :: other_costs_row" />
                            </th:block>
                        </tbody>
                    </table>
                    <p class="alignright" th:if="${viewmode == 'edit'}">
                        <th:block th:include="question-type/types :: add_row(text='Add another cost', question=${question},rowcontainer='#other-costs-table tbody')" />
                    </p>
                </div>
                <div class="form-group alignright inline">
                    <label th:for="${'section-total-'+subSection.id}"> Total other costs</label>
                    <input class="form-control form-control-1-4 alignright"
                           readonly="readonly" type="text"
                           th:id="${'section-total-'+subSection.id}"
                           data-calculation-fields="[id*=otherCost]"
                           data-calculation-operations="+"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}"/>
                </div>
            </div>
        </th:block>
        <input type="hidden"
               th:id="${'section-percentage-'+subSection.id}"
               th:value="${costCategory.getTotal() != null ? #ifsUtil.calculatePercentage(costCategory.getTotal(),summaryModel.eligibilityOverview.totalCost) + '%' : 0}" />

    </th:block>


    <th:block th:fragment="other_costs_row">
        <th:block th:with="costIdentifier=${(cost.id == null) ? 'unsaved' + T(java.util.UUID).randomUUID().toString().replaceAll('-','') : cost.id}">
        <tr th:id="${'cost-'+costIdentifier}" th:attr="data-repeatable-row=${costIdentifier}">
            <td class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-description]}')} ? 'error' : ''">
                <label th:for="${'cost-'+ type + '-'+costIdentifier+'-description'}">
                    <span class="visuallyhidden">Description and justification of the cost</span>
                    <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-description'})" />
                </label>
                <th:block th:include="question-type/form-elements :: form-finance-textarea (type='other_costs', id=${costIdentifier}, name='description', value=${cost.description},readonly=${viewmode == 'readonly'},required=true)" />
            </td>
            <td class="numeric form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-cost]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-cost')}">
                <label th:for="${'cost-other_costs-'+costIdentifier+'-otherCost'}">
                  <span class="visuallyhidden">Estimated cost (&pound;)</span>
                  <th:block th:insert="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-cost'})" />
                </label>
                <input type="number"
                       th:name="${'other_costs-otherCost-' + question.id + '-' + costIdentifier}"
                       class="form-control"
                       th:id="${'cost-other_costs-'+costIdentifier+'-otherCost'}"
                       ifs:nonZeroValue="${rejectedValue != null ? rejectedValue : (cost.cost != null ? #numbers.formatDecimal(cost.cost,0,0) : '0')}"
                       th:readonly="${viewmode == 'readonly'}"
                       placeholder="0"
                       min="1"
                       max="9999999999999999999"
                       required="required"
                       th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(20)}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-cost]}')} ? 'field-error' : ''" />
            </td>
            <td th:if="${viewmode == 'edit'}">
                <button th:unless="${cost.id == null}"
                        type="submit"
                        class="buttonlink js-remove-row"
                        name="remove_cost"
                        th:value="${cost.id}"
                        th:attrappend="formaction='&#35;question-'+${question.id}">Remove
                </button>
                <span th:if="${cost.id == null}" class="buttonplaceholder"></span>
            </td>
        </tr>
        </th:block>
    </th:block>


    <!-- ===========================Form: Other funding=========================== -->
    <th:block th:fragment="other_funding" th:with="costCategory=${organisationFinance.get(T(org.innovateuk.ifs.finance.resource.cost.FinanceRowType).fromType(formInput.type))}">

        <div class="form-group"
             th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costCategory.otherFundingCostItem?.id +'-otherPublicFunding]}') or #fields.hasErrors('${form.formInput['+ question.id +']}')}? 'error'">


            <h2 th:text="${question.getName()}" class="heading-medium" />
            <th:block th:include="question-type/form-elements :: form-hint (hint=${question.getDescription()})" />
            <th:block th:include="question-type/form-elements :: form-validation-messages (id=${question.id})" />
            <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding'})" />
            <th:block th:include="question-type/form-elements :: form-guidance (guidable=${formInput})" />

            <fieldset class="inline" id="otherFundingShowHideToggle">
                <legend class="visuallyhidden" th:text="${question.getName()}" />
                <div class="form-block inline">

                    <label th:class="${'block-label selection-button-radio'  + (costCategory.otherPublicFunding?.equals('Yes') ? ' selected focused' : '')}"
                           th:for="${'cost-otherFunding-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding-yes'}"
                           data-target="other-funding-table">
                        <input type="radio"
                               th:id="${'cost-otherFunding-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding-yes'}"
                               th:name="${'other_funding-otherPublicFunding-' + question.id + '-' + costCategory.otherFundingCostItem?.id}"
                               value="Yes"
                               required="required"
                               th:checked="${costCategory.otherPublicFunding?.equals('Yes')}"
                               th:disabled="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
                                />
                        Yes
                    </label>
                    <label th:class="${'block-label selection-button-radio'  + (costCategory.otherPublicFunding?.equals('No') ? ' selected focused' : '')}"
                           th:for="${'cost-otherFunding-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding-no'}">
                        <input type="radio"
                               th:id="${'cost-otherFunding-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding-no'}"
                               th:name="${'other_funding-otherPublicFunding-' + question.id + '-' + costCategory.otherFundingCostItem?.id}"
                               value="No"
                               required="required"
                               th:checked="${costCategory.otherPublicFunding?.equals('No')}"
                               th:disabled="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"/>
                        No
                    </label>
                </div>
                <div id="other-funding-table">

                <div class="form-group" th:attr="data-repeatable-container=${question.id}">
                    <table>
                        <thead>
                        <tr>
                            <th id="other-funding-source">Source of funding</th>
                            <th id="other-funding-date" class="width-medium">Date secured</th>
                            <th id="other-funding-amount" class="width-medium">Funding amount (£)</th>
                            <th th:unless="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"><span class="visuallyhidden">Actions</span></th>
                        </tr>
                        </thead>
                        <tbody>
                        <th:block th:each="cost : ${costCategory.costs}">
                            <th:block th:include="project/financecheck/fragments/finance :: other_funding_row" />
                        </th:block>
                        </tbody>
                    </table>
                    <p class="alignright" th:unless="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
                        <th:block th:include="question-type/types :: add_row(text='Add another source of funding', question=${question},rowcontainer='#other-funding-table tbody')" />
                    </p>
                </div>
                <div class="form-group alignright inline">
                    <label for="other-funding-total">Total other funding</label>
                    <input class="form-control form-control-1-4 alignright"
                           data-calculation-fields="[id*=fundingAmount]"
                           data-calculation-operations="+"
                           id="other-funding-total"
                           th:attr="data-calculation-rawvalue=${costCategory.getTotal()}"
                           readonly="readonly"
                           type="text"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}" />

                </div>
              </div>

            </fieldset>
        </div>

    </th:block>


    <th:block th:fragment="other_funding_row">
        <th:block th:with="costIdentifier=${(cost.id == null) ? 'unsaved' + T(java.util.UUID).randomUUID().toString().replaceAll('-','') : cost.id}">
            <tr th:id="${'cost-'+costIdentifier}" th:attr="data-repeatable-row=${costIdentifier}">
                <td class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-fundingSource]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-fundingSource')}">
                    <label th:for="${'cost-other_funding-'+costIdentifier+'-source'}">
                        <span class="visuallyhidden">Source of funding</span>
                        <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-fundingSource'})" />
                    </label>
                    <input type="text"
                           th:readonly="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
                           th:name="${'other_funding-fundingSource-' + question.id + '-' + costIdentifier}"
                           class="form-control width-full"
                           th:id="${'cost-other_funding-'+costIdentifier+'-source'}"
                           th:value="${rejectedValue != null ? rejectedValue : cost.fundingSource}"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-fundingSource]}')} ? 'field-error' : ''"
                           required="required"
                           maxlength="255"
                           th:attr="data-required-errormessage=#{validation.finance.funding.source.blank}" />
                </td>
                <td class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-securedDate]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-securedDate')}">
                    <label th:for="${'cost-other_funding-'+costIdentifier+'-date'}">
                        <span class="visuallyhidden">Date secured</span>
                        <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-securedDate'})" />
                    </label>
                    <input type="text"
                           th:readonly="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
                           th:name="${'other_funding-securedDate-' + question.id + '-' + costIdentifier}"
                           class="form-control width-medium"
                           th:id="${'cost-other_funding-'+costIdentifier+'-date'}"
                           placeholder="MM-YYYY"
                           pattern="(0[1-9]|1[012])-[0-9]{4}"
                           th:attr="data-pattern-errormessage=#{validation.finance.secured.date.invalid}"
                           maxlength="7"
                           th:value="${rejectedValue != null ? rejectedValue : cost.securedDate}"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-securedDate]}')} ? 'field-error' : ''"
                           required="required" />
                </td>

                <td class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-fundingAmount]}')} ? 'error' : ''" th:with="rejectedValue=${form.getRejectedValue('cost-'+ costIdentifier +'-fundingAmount')}">
                  <label th:for="${'cost-other_funding-'+costIdentifier+'-fundingAmount'}">
                    <span class="visuallyhidden">Funding amount (&pound;)</span>
                    <th:block th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costIdentifier+'-fundingAmount'})" />
                  </label>
                    <input class="form-control width-medium"
                           type="number"
                           th:readonly="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
                           th:name="${'other_funding-fundingAmount-' + question.id + '-' + costIdentifier}"
                           th:id="${'cost-other_funding-'+costIdentifier+'-fundingAmount'}"
                           ifs:nonZeroValue="${rejectedValue != null ? rejectedValue : (cost.fundingAmount != null ? #numbers.formatDecimal(cost.fundingAmount,0,0) : '0')}"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costIdentifier +'-fundingAmount]}')} ? 'field-error' : ''"
                           required="required"
                           placeholder="0"
                           min="1"
                           max="9999999999999999999"
                           th:attr="data-max-errormessage=#{validation.field.max.number.of.digits(20)}"
                           />
                </td>
                <td th:unless="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
                    <button th:unless="${cost.id == null}"
                            type="submit"
                            name="remove_cost"
                            class="buttonlink js-remove-row"
                            th:value="${cost.id}"
                            th:attrappend="formaction='&#35;question-'+${question.id}">Remove
                    </button>
                    <span th:if="${cost.id == null}" class="buttonplaceholder"></span>
                </td>
            </tr>
        </th:block>
    </th:block>
    <!-- ===========================Research Participation =========================== -->
    <th:block th:fragment="research_participation" th:if="${showResearchParticipation}">
        <div th:class="${researchParticipationPercentage &gt; currentCompetition.maxResearchRatio} ? 'eligibility warning' : 'eligibility'" >
            <dl class="list-eligibility">
                <dt>Maximum research participation</dt>
                <dd th:text="${currentCompetition.maxResearchRatio}+' %'"></dd>
                <dt>Current research participation</dt>
                <dd th:class="${researchParticipationPercentage &gt; currentCompetition.maxResearchRatio} ? 'warning'" th:text="(${researchParticipationPercentage} % 1 == 0 ? ${#numbers.formatDecimal(researchParticipationPercentage,0,0)} : ${researchParticipationPercentage}) +' %'"></dd>
            </dl>

            <div th:replace="fragments/finance :: research_participation_alert"></div>
        </div>
    </th:block>

    <!-- ===========================Research Participation alert messages =========================== -->
    <th:block th:fragment="research_participation_alert">
        <div th:unless="${researchParticipationPercentage &gt; currentCompetition.maxResearchRatio}" class="success-alert">
            <h2 class="heading-small no-margin">The participation levels of this project are within the required range.</h2>
            <p>This application can be submitted with these project costs.</p>
        </div>
        <div th:if="${researchParticipationPercentage &gt; currentCompetition.maxResearchRatio}" class="warning-alert">
            <h2 class="heading-small no-margin">Maximum research participation exceeded</h2>
            <p>Please seek confirmation that the project is still eligible for funding.</p>
        </div>
    </th:block>
</html>

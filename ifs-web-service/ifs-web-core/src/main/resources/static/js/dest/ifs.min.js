if("undefined"==typeof IFS)var IFS={};IFS.core={},IFS.core.loadOrder={common:{init:function(){IFS.core.collapsible.init(),IFS.core.conditionalForms.init(),IFS.core.editor.init(),IFS.core.autoSave.init(),IFS.core.formValidation.init(),IFS.core.wordCount.init(),IFS.core.disableSubmitUntilChecked.init(),IFS.core.finance.init(),IFS.core.progressiveGroupSelect.init(),IFS.core.singleSubmit.init(),IFS.core.submitNotification.init(),IFS.core.passwordToggle.init()},finalize:function(){IFS.core.modal.init(),IFS.core.upload.init(),IFS.core.autoSubmitForm.init(),IFS.core.unsavedChanges.init(),IFS.core.mirrorElements.init(),IFS.core.debug.init()}},commonStateManaged:{mobile:function(){IFS.core.collapsible.init("tabs")},desktop:function(){IFS.core.tabs.init()},mobileLeave:function(){IFS.core.collapsible.destroy("tabs")},desktopLeave:function(){IFS.core.tabs.destroy()}},finance:{init:function(){IFS.core.repeatableFinanceRows.init()},finalize:function(){IFS.core.financeSpecifics.init()}}},function(){"use strict";jQuery.ajaxProtected=function(e){function t(e){return!/^(GET|HEAD|TRACE|OPTIONS)$/.test(e)}function a(){return Cookies.get(i)}var r="X-CSRF-TOKEN",i="CSRF-TOKEN",o=e.beforeSend;return e.beforeSend=function(e,i){t(i.type)&&!this.crossDomain&&e.setRequestHeader(r,a()),"undefined"!=typeof o&&o.call(this,arguments)},this.ajax(e)}}(),IFS.core.autoSave=function(){"use strict";var e,t,a={};return{settings:{inputs:'[data-autosave] input:not([type="button"],[readonly="readonly"],[type="hidden"],[data-autosave-disabled])',select:'[data-autosave] select:not([readonly="readonly"],[data-autosave-disabled])',textareas:'[data-autosave] textarea:not([readonly="readonly"],[data-autosave-disabled])',typeTimeout:500,minimumUpdateTime:800,ajaxTimeOut:15e3},init:function(){e=this.settings,jQuery("[data-autosave]").attr("data-save-status","done"),jQuery("body").on("change keyup",e.textareas,function(a){"keyup"===a.type?(clearTimeout(t),t=setTimeout(function(){IFS.core.autoSave.fieldChanged(a.target)},e.typeTimeout)):IFS.core.autoSave.fieldChanged(a.target)}),jQuery("body").on("change",e.inputs+","+e.select,function(e){IFS.core.autoSave.fieldChanged(e.target)}),jQuery("body").on("ifsAutosave",function(e){IFS.core.autoSave.fieldChanged(e.target)})},fieldChanged:function(e){var t,r=jQuery(e);t=r.closest("[data-repeatable-row]").length?r.closest("[data-repeatable-row]").prop("id"):r.prop("name"),"undefined"==typeof a[t]&&(a[t]=jQuery.when({})),a[t]=a[t].then(IFS.core.autoSave.processAjax(r))},getPostObject:function(e,t){var a,r,i,o,n=jQuery("#application_id").val(),l=t.attr("data-autosave"),s=/\d+/;switch(l){case"application":i=e.is("[data-date]"),i?(r=e.closest(".date-group").find('input[type="hidden"]'),o=r.hasClass("day")?e.attr("data-date").substring(2):e.attr("data-date"),a={applicationId:n,value:o,formInputId:r.prop("id"),fieldName:r.prop("name")}):a=!IFS.core.autoSave.isIdAutoSaveApplicantField(e)&&s.test(e.prop("id"))?{applicationId:n,value:e.val(),formInputId:e.prop("id").match(s)[0],fieldName:e.prop("name")}:{applicationId:n,value:e.val(),formInputId:e.prop("id"),fieldName:e.prop("name")};break;case"fundingDecision":a={applicationId:e.prop("name"),fundingDecision:e.val()};break;case"compSetup":i=e.is("[data-date]");var d=t.attr("data-objectid");i?(r=e.closest(".date-group").find('input[type="hidden"]'),a={objectId:d,value:e.attr("data-date"),fieldName:r.prop("name")}):a={objectId:d,fieldName:e.prop("name"),value:e.val()};break;case"assessorFeedback":a={value:e.val()};break;default:a=!1}return a},getUrl:function(e,t){var a,r,i=t.attr("data-autosave");switch(i){case"application":var o=jQuery("#application_id").val();r=jQuery("#competition_id").val(),a="/application/"+o+"/form/"+r+"/saveFormElement";break;case"fundingDecision":r=e.attr("data-competition"),a="/management/funding/"+r;break;case"compSetup":r=t.attr("data-competition");var n=t.attr("data-section"),l=t.attr("data-subsection");a="undefined"!=typeof l?"/management/competition/setup/"+r+"/section/"+n+"/sub/"+l+"/saveFormElement":"/management/competition/setup/"+r+"/section/"+n+"/saveFormElement";break;case"assessorFeedback":var s=e.closest(".question").prop("id").replace("form-input-",""),d=t.attr("action").split("/")[2];a="/assessment/"+d+"/formInput/"+s;break;default:a=!1}return a},processAjax:function(t){return function(){var a=t.closest("[data-autosave]");a.attr("data-save-status","progress");var r=IFS.core.autoSave.getPostObject(t,a),i=IFS.core.autoSave.getUrl(t,a),o=jQuery.Deferred();if(r===!1||i===!1)return o.resolve(),o.promise();var n=t.prop("name"),l=t.closest(".form-group"),s=l.find(".autosave-info"),d=(new Date).getTime();return 0===s.length&&(l.find(".textarea-footer").append('<span class="autosave-info" />'),s=l.find(".autosave-info")),jQuery.ajaxProtected({type:"POST",url:i,data:r,dataType:"json",beforeSend:function(){s.html("Saving...")},timeout:e.ajaxTimeOut}).done(function(e){var t=(new Date).getTime(),a=IFS.core.autoSave.settings.minimumUpdateTime-(t-d);"undefined"!=typeof e.fieldId&&jQuery("body").trigger("persistUnsavedRow",[n,e.fieldId]),jQuery("body").trigger("updateSerializedFormState"),setTimeout(function(){s.html("Saved!")},a)}).fail(function(e,t){if(s.length){if(e.readyState<4)return!0;var a=IFS.core.autoSave.getErrorMessage(t);s.html('<span class="error-message">'+a+"</span>")}}).always(function(){a.attr("data-save-status","done"),o.resolve()}),o.promise()}},getErrorMessage:function(e){var t;return t="undefined"!=typeof e.responseJson&&"undefined"!=typeof e.responseJson.errorMessage?e.responseJson.errorMessage:"timeout"===e.statusText?"The server is slow responding, your data is not saved":"Something went wrong when saving your data"},isIdAutoSaveApplicantField:function(e){var t=e.prop("id");return t.indexOf("application")!==-1||t.indexOf("financePosition")!==-1||t.indexOf("cost")!==-1}}}(),IFS.core.autoSubmitForm=function(){"use strict";var e;return{settings:{submitElements:".js-auto-submit"},init:function(){e=this.settings,jQuery(e.submitElements).next("button").addClass("visuallyhidden"),jQuery(document).on("change",e.submitElements,function(){IFS.core.autoSubmitForm.submitForm(this)})},submitForm:function(e){jQuery(e).closest("form").submit()}}}(),IFS.core.collapsible=function(){"use strict";var e,t=0;return{settings:{collapsibleEl:".collapsible",collapsibleTabs:".tabs section",statelessClass:"collapsible-stateless",expandedClass:"collapsible-expanded"},init:function(t){e=this.settings,e.collapsible="tabs"===t?e.collapsibleTabs:e.collapsibleEl,jQuery(e.collapsible).each(function(){var t=jQuery(this),a=t.hasClass(e.statelessClass),r=t.hasClass(e.expandedClass);IFS.core.collapsible.initCollapsibleHTML(this,a,r),jQuery(this).on("click","h2 > [aria-controls], h3 > [aria-controls]",function(){IFS.core.collapsible.toggleCollapsible(this,a)})})},initCollapsibleHTML:function(e,a,r){jQuery(e).children("h2,h3").each(function(){var e=jQuery(this),i="collapsible-"+t,o=r||!a&&IFS.core.collapsible.getLoadstateFromCookie(i);e.nextUntil("h2,h3").wrapAll('<div id="'+i+'" aria-hidden="'+!o+'">'),e.wrapInner('<button aria-expanded="'+o+'" aria-controls="'+i+'" type="button">'),t++})},toggleCollapsible:function(e,t){var a=jQuery(e),r=jQuery("#"+a.attr("aria-controls")),i="false"===a.attr("aria-expanded");a.attr("aria-expanded",i),r.attr("aria-hidden",!i),t||IFS.core.collapsible.setLoadStateInCookie(r.attr("id"),i)},getLoadstateFromCookie:function(e){if("undefined"!=typeof Cookies.getJSON("collapsibleStates")){var t=Cookies.getJSON("collapsibleStates"),a=window.location.pathname;if("undefined"!=typeof t[a]&&"undefined"!=typeof t[a][e])return t[a][e]}return!1},setLoadStateInCookie:function(e,t){var a={};"undefined"!=typeof Cookies.getJSON("collapsibleStates")&&(a=Cookies.getJSON("collapsibleStates"));var r=window.location.pathname;if("undefined"==typeof a[r]&&(a[r]={}),t===!0)a[r][e]=t;else if("undefined"!=typeof a[r][e]){delete a[r][e];var i=0;jQuery.each(a[r],function(){i++}),0===i&&delete a[r]}Cookies.set("collapsibleStates",a,{expires:.05})},destroy:function(t){e.collapsible="tabs"===t?e.collapsibleTabs:e.collapsibleEl,jQuery("body").off("click",e.collapsible+" > h2 > [aria-controls], "+e.collapsible+" > h3 > [aria-controls]"),jQuery(e.collapsible+" > h2, "+e.collapsible+" > h3").each(function(){IFS.core.collapsible.destroyHTHL(this)})},destroyHTHL:function(e){var t=jQuery(e);t.next().children(":first").unwrap(),t.find("button").contents().unwrap()}}}(),IFS.core.conditionalForms=function(){"use strict";return{init:function(){jQuery("[data-target]").each(function(){var e=jQuery(this),t=e.attr("data-target"),a=e.find('input[type="radio"],input[type="checkbox"]'),r=!1;if(e.attr("data-target-inverted")&&(r=!0),a&&t){var i=a.attr("name");IFS.core.conditionalForms.toggleVisibility(a,"#"+t,r),jQuery('input[name="'+i+'"]').on("click",function(){IFS.core.conditionalForms.toggleVisibility(a,"#"+t,r)})}})},toggleVisibility:function(e,t,a){t=jQuery(t);var r=e.is(":checked");a&&(r=!r),r?t.attr("aria-hidden","false").removeClass("js-hidden"):t.attr("aria-hidden","true")}}}(),IFS.core.debug=function(){"use strict";return{init:function(){"ifs.local-dev"===window.location.hostname&&window.location.pathname.indexOf("/prototypes")===-1&&(jQuery(document).on("dblclick","#footer",function(){IFS.core.debug.toggleDebug()}),jQuery(document).on("keyup","[data-selector-highlighter] code",function(){var e=jQuery(this).text();IFS.core.debug.resetStyles(),IFS.core.debug.highlightSelected(e)}),"undefined"!=typeof Cookies.get("debugSelectors")&&IFS.core.debug.enableDebug(),jQuery("head").append('<style>a[href="#"],a[href=""],a[href*="prototypes"]{ outline:5px solid red !important; }</style>'))},toggleDebug:function(){jQuery("[data-selector-highlighter]").length?IFS.core.debug.disableDebug():IFS.core.debug.enableDebug()},enableDebug:function(){Cookies.set("debugSelectors","true",{expires:.05}),jQuery("body").append('<div data-selector-highlighter=""><code contenteditable></code><div></div">'),jQuery("[data-selector-highlighter] code").focus()},disableDebug:function(){Cookies.remove("debugSelectors"),jQuery("[data-selector-highlighter]").remove(),IFS.core.debug.resetStyles()},highlightSelected:function(e){var t=jQuery("[data-selector-highlighter] div");if(e=jQuery.trim(e),e.length)try{var a=jQuery(e);if(a.length){jQuery(a).css("outline","5px solid red");var r=a.length>1?a.length+" matches":"1 match";t.text(r)}else t.text("no match")}catch(i){t.text("no match")}else t.text("no match"),jQuery("code").text(" ")},resetStyles:function(){jQuery('[style*="outline"]').removeAttr("style")}}}(),IFS.core.disableSubmitUntilChecked=function(){"use strict";var e;return{settings:{checkBoxesAttribute:"data-switches-button-status"},init:function(){e=this.settings,jQuery("body").on("change","["+e.checkBoxesAttribute+"]",function(){IFS.core.disableSubmitUntilChecked.checkButtonStates(this)}),jQuery("["+e.checkBoxesAttribute+"]").each(function(){IFS.core.disableSubmitUntilChecked.checkButtonStates(this)})},checkButtonStates:function(t){var a=jQuery(t).attr(e.checkBoxesAttribute),r=jQuery(a);if(r.length){var i=r.is("[data-enable-button-when]")?r.attr("data-enable-button-when"):"all-checked",o=IFS.core.disableSubmitUntilChecked.getInputStatus(a);switch(i){case"all-checked":var n=o.indexOf(!1)===-1;IFS.core.disableSubmitUntilChecked.updateButton(r,n);break;case"one-checked":var l=o.indexOf(!0)!==-1;IFS.core.disableSubmitUntilChecked.updateButton(r,l)}}},getInputStatus:function(t){var a=[];return jQuery("["+e.checkBoxesAttribute+'="'+t+'"]').each(function(){var e,t=jQuery(this);t.is('[type="checkbox"]')?e=t.prop("checked"):t.is("select")&&(e="UNSET"!==t.val()),"undefined"!=typeof e&&a.push(e)}),a},updateButton:function(e,t){t===!0?e.removeAttr("aria-disabled").removeClass("disabled").prop("disabled",!1):e.attr({"aria-disabled":"true"}).addClass("disabled").prop("disabled",!0)}}}(),IFS.core.editor=function(){"use strict";var e,t;return{settings:{editorTextarea:"textarea[data-editor]",editorOptions:{plugins:{halloformat:{},hallolists:{},hallocleanhtml:{format:!1,allowedTags:["p","em","strong","ol","ul","li","br","b","div","a"]}},toolbar:"halloToolbarFixed"}},init:function(){e=this.settings,t=new showdown.Converter,jQuery.each(jQuery(e.editorTextarea),function(){IFS.core.editor.prepareEditorHTML(this)}),IFS.core.editor.initEditors(),jQuery("[data-md-to-html]").each(function(){var e=jQuery(this).html(),t=IFS.core.editor.markdownToHtml(e);jQuery(this).html(t)})},prepareEditorHTML:function(t){var a=jQuery(t),r=a.attr("data-editor");if(""!==r){var i="";jQuery('[for="'+a.prop("id")+'"]').length&&(i='labelledby="'+a.prop("id")+'"'),a.attr("readonly")?a.before('<div class="readonly"></div>'):a.before('<div data-editor="'+r+'" class="editor" spellcheck="true" aria-multiline="true" tabindex="0" '+i+' role="textbox"></div>'),a.attr("aria-hidden","true");var o=a.prev();switch(r){case"md":IFS.core.editor.textareaMarkdownToHtml(a,a.prev());break;case"html":var n=jQuery.htmlClean(a.val(),e.editorOptions.plugins.hallocleanhtml);o.html(n)}return o}},initEditors:function(){var t=jQuery.extend(!0,{},e.editorOptions,{plugins:{hallolink:{}}});jQuery('[role="textbox"][data-editor="html"]').hallo(t),jQuery('[role="textbox"][data-editor="md"]').hallo(e.editorOptions),jQuery(document).on("hallomodified",'[role="textbox"][data-editor="md"]',function(e,t){var a=jQuery(this).parent().find("textarea");IFS.core.editor.editorHtmlToMarkdown(t.content,a),jQuery(a).trigger("keyup")}),jQuery(document).on("hallomodified",'[role="textbox"][data-editor="html"]',function(t,a){var r=jQuery(this).parent().find("textarea"),i=jQuery.htmlClean(a.content,e.editorOptions.plugins.hallocleanhtml);0===i.replace(/<[^>]+>/gi,"").length&&(i=""),jQuery(r).get(0).value=i,jQuery(r).trigger("keyup")}),jQuery(document).on("blur",'[role="textbox"][data-editor]',function(){var e=jQuery(this).parent().find("textarea");jQuery(e).trigger("change")})},textareaMarkdownToHtml:function(e,t){var a=e.val();if(IFS.core.editor.htmlToMarkdown(jQuery(t).html())!==a){var r=IFS.core.editor.markdownToHtml(a);jQuery(t).html(r)}},editorHtmlToMarkdown:function(e,t){var a=IFS.core.editor.htmlToMarkdown(e);jQuery(t).get(0).value!==a&&(jQuery(t).get(0).value=a)},htmlToMarkdown:function(t){var a=jQuery.trim(t.replace(/(\r\n|\n|\r)/gm,""));return a=jQuery.htmlClean(a,e.editorOptions.plugins.hallocleanhtml),md(a)},markdownToHtml:function(a){var r;return r=0===a.length?"<p>&nbsp;</p>":t.makeHtml(a),r=jQuery.htmlClean(r,e.editorOptions.plugins.hallocleanhtml)}}}(),IFS.core.filtering=function(){"use strict";return{"with":function(e){jQuery(e.elementsToHide).attr("aria-hidden",!0),jQuery(e.elementsToShow).attr("aria-hidden",!1)}}}(),IFS.core.finance=function(){"use strict";return{MathOperation:{"+":function(e,t){return e+t},"-":function(e,t){return e-t},"*":function(e,t){return e*t},"/":function(e,t){return 0===t?0:e/t},negativeRoundUp:function(e,t){return e<0?0:e}},init:function(){IFS.core.finance.bindCalculationActionToFields()},bindCalculationActionToFields:function(){var e=jQuery("[data-calculation-fields][data-calculation-on-pageload]");e.each(function(){var e=jQuery(this),t=e.attr("data-calculation-fields");IFS.core.finance.doMath(e,t.split(","))}),jQuery("body").on("change","input",function(){jQuery("[data-calculation-fields]:not([data-calculation-binded])").length&&jQuery("[data-calculation-fields]:not([data-calculation-binded])").each(function(){var e=jQuery(this),t=e.attr("data-calculation-fields");jQuery(document).on("change updateFinances",t,function(){IFS.core.finance.doMath(e,t.split(","))}),e.attr("data-calculation-binded","")})}),jQuery("body").on("recalculateAllFinances",function(){jQuery("[data-calculation-fields]").length&&jQuery("[data-calculation-fields]").each(function(){var e=jQuery(this),t=e.attr("data-calculation-fields");IFS.core.finance.doMath(e,t.split(","))})})},getElementValue:function(e){var t=jQuery(e).attr("data-calculation-rawvalue");if("undefined"!=typeof t)return parseFloat(t);if("undefined"!=typeof jQuery(e).val()&&jQuery(e).val().length){var a=jQuery(e).val().replace(",",""),r=0===a.indexOf("£ ")?a.substring(2):a;return parseFloat(r)}return parseFloat(0)},doMath:function(e,t){var a=e.attr("data-calculation-operations").split(","),r=[];jQuery.each(t,function(e,t){jQuery.isNumeric(t)?r.push(parseFloat(t)):jQuery(t).length>1?jQuery.each(jQuery(t),function(e,t){r.push(IFS.core.finance.getElementValue(t))}):r.push(IFS.core.finance.getElementValue(t))});var i;if(i=1===r.length?r[0]:IFS.core.finance.MathOperation[a[0]](r[0],r[1]),1===a.length&&r.length>2)for(var o=2;o<r.length;o++)i=IFS.core.finance.MathOperation[a[0]](i,r[o]);if(a.length>1&&r.length>2)for(var n=1;n<a.length;n++)i=IFS.core.finance.MathOperation[a[n]](i,r[n+1]);e.attr("data-calculation-rawvalue",i);var l=e.is("[data-calculation-format]")?e.attr("data-calculation-format"):"currency",s="";"percentage"===l?s=IFS.core.finance.formatPercentage(i):"currency"===l&&(s=IFS.core.finance.formatCurrency(i)),e.is("input")?e.val(s):e.text(s),e.trigger("change")},formatCurrency:function(e){return e=e.toFixed(),e=e.replace(/(\d)(?=(\d{3})+\b)/g,"$1,"),"£ "+e},formatPercentage:function(e){return e=e.toFixed(),e+"%"}}}(),IFS.core.formValidation=function(){"use strict";var e;return{settings:{number:{fields:'[type="number"]:not([data-date],[readonly])',messageInvalid:"This field can only accept whole numbers."},min:{fields:"[min]:not([data-date],[readonly])",messageInvalid:"This field should be %min% or higher."},max:{fields:"[max]:not([data-date],[readonly])",messageInvalid:"This field should be %max% or lower."},passwordPolicy:{fields:{password:'[name="password"],[name="retypedPassword"]',firstname:"#firstName",lastname:"#lastName"},messageInvalid:{tooWeak:"Password is too weak."}},containsLowercase:{messageInvalid:"Password must contain at least one lower case letter."},containsUppercase:{messageInvalid:"Password must contain at least one upper case letter."},containsNumber:{messageInvalid:"Password must contain at least one number."},email:{fields:'[type="email"]:not([readonly])',messageInvalid:"Please enter a valid email address."},required:{fields:'[required]:not([data-date],[readonly],[name="password"])',messageInvalid:"This field cannot be left blank."},minlength:{fields:'[minlength]:not([readonly],[name="password"])',messageInvalid:"This field should contain at least %minlength% characters."},maxlength:{fields:"[maxlength]:not([readonly])",messageInvalid:"This field cannot contain more than %maxlength% characters."},minwordslength:{fields:"[data-minwordslength]",messageInvalid:"This field has a minimum number of words."},maxwordslength:{fields:"[data-maxwordslength]",messageInvalid:"This field has a maximum number of words."},date:{fields:".date-group input",messageInvalid:{invalid:"Please enter a valid date.",future:"Please enter a future date.",past:"Please enter a past date."}},pattern:{fields:"[pattern]:not([minlength],[readonly])",messageInvalid:"Please correct this field."},tel:{fields:'[type="tel"]:not([readonly])',messageInvalid:"Please enter a valid phone number."},typeTimeout:300,dispaySettings:["none","visuallyhidden","show"],html5validationMode:!1},init:function(){e=this.settings,e.html5validationMode=IFS.core.formValidation.checkHTML5validationMode(),IFS.core.formValidation.initValidation()},initValidation:function(){jQuery("body").on("blur change keyup paste ifsValidate",e.passwordPolicy.fields.password,function(t){var a=jQuery(this);switch(t.type){case"keyup":clearTimeout(window.IFS.core.formValidationTimer),window.IFS.core.formValidationTimer=setTimeout(function(){IFS.core.formValidation.checkPasswordPolicy(jQuery(a),!1)},e.typeTimeout);break;default:IFS.core.formValidation.checkPasswordPolicy(jQuery(a),!0)}}),jQuery("body").on("change ifsValidate",e.email.fields,function(){IFS.core.formValidation.checkEmail(jQuery(this))}),jQuery("body").on("change ifsValidate",e.number.fields,function(){IFS.core.formValidation.checkNumber(jQuery(this))}),jQuery("body").on("change ifsValidate",e.min.fields,function(){IFS.core.formValidation.checkMin(jQuery(this))}),jQuery("body").on("change ifsValidate",e.max.fields,function(){IFS.core.formValidation.checkMax(jQuery(this))}),jQuery("body").on("blur change ifsValidate",e.required.fields,function(){IFS.core.formValidation.checkRequired(jQuery(this))}),jQuery("body").on("change ifsValidate",e.minlength.fields,function(){IFS.core.formValidation.checkMinLength(jQuery(this))}),jQuery("body").on("change ifsValidate",e.maxlength.fields,function(){IFS.core.formValidation.checkMaxLength(jQuery(this))}),jQuery("body").on("change ifsValidate",e.minwordslength.fields,function(){IFS.core.formValidation.checkMinWordsLength(jQuery(this))}),jQuery("body").on("change ifsValidate",e.maxwordslength.fields,function(){IFS.core.formValidation.checkMaxWordsLength(jQuery(this))}),jQuery("body").on("change ifsValidate",e.tel.fields,function(){IFS.core.formValidation.checkTel(jQuery(this))}),jQuery("body").on("change ifsValidate",e.date.fields,function(){IFS.core.formValidation.checkDate(jQuery(this))}),jQuery("body").on("change ifsValidate",e.pattern.fields,function(){IFS.core.formValidation.checkPattern(jQuery(this))}),jQuery("body").on("change","[data-set-section-valid]",function(){var e=jQuery(this).attr("data-set-section-valid");IFS.core.formValidation.setSectionValid(e)}),jQuery(e.date.fields).attr({"data-date":"","data-autosave-disabled":""}),jQuery("form:not([novalidate]) input").on("invalid",function(){jQuery(this).trigger("change")}),IFS.core.formValidation.betterMinLengthSupport()},checkPasswordPolicy:function(e,t){var a=IFS.core.formValidation.checkFieldContainsUppercase(e),r=IFS.core.formValidation.checkFieldContainsNumber(e),i=IFS.core.formValidation.checkMinLength(e),o=IFS.core.formValidation.checkRequired(e),n=e.closest(".form-group"),l=a&&r&&i&&o;return t&&(l?(n.removeClass("form-group-error"),e.removeClass("form-control-error"),IFS.core.formValidation.setValid(e,IFS.core.formValidation.getErrorMessage(e,"passwordPolicy-tooWeak","visuallyhidden"))):(n.addClass("form-group-error"),e.addClass("form-control-error"))),l},checkFieldContainsUppercase:function(e){var t=e.val(),a="containsUppercase",r=IFS.core.formValidation.getMessageDisplaySetting(e,a),i=IFS.core.formValidation.getErrorMessage(e,a),o=/(?=\S*?[A-Z])/,n=o.test(t)!==!1;return IFS.core.formValidation.setStatus(e,a,n),n?(IFS.core.formValidation.setValid(e,i,r),!0):(IFS.core.formValidation.setInvalid(e,i,r),!1)},checkFieldContainsNumber:function(e){var t=e.val(),a="containsNumber",r=IFS.core.formValidation.getMessageDisplaySetting(e,a),i=IFS.core.formValidation.getErrorMessage(e,a),o=/(?=\S*?[0-9])/,n=o.test(t)!==!1;return IFS.core.formValidation.setStatus(e,a,n),n?(IFS.core.formValidation.setValid(e,i,r),!0):(IFS.core.formValidation.setInvalid(e,i,r),!1)},checkEmail:function(e){var t=e.val(),a="email",r=IFS.core.formValidation.getErrorMessage(e,a),i=IFS.core.formValidation.getMessageDisplaySetting(e,a),o=/^(([^<>()[\]\\.,;:\s@\"]+(\.[^<>()[\]\\.,;:\s@\"]+)*)|(\".+\"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/i;if(t){var n=o.test(t);return n?(IFS.core.formValidation.setValid(e,r,i),!0):(IFS.core.formValidation.setInvalid(e,r,i),!1)}return IFS.core.formValidation.setValid(e,r,i),!0},checkNumber:function(t){var a="number",r=IFS.core.formValidation.getMessageDisplaySetting(t,a),i=IFS.core.formValidation.getErrorMessage(t,"number");if(e.html5validationMode){var o=t[0];return o.validity.badInput===!0||o.validity.stepMismatch===!0?(IFS.core.formValidation.setInvalid(t,i,r),!1):(IFS.core.formValidation.setValid(t,i,r),!0)}var n=t.val(),l=n.indexOf(",")===-1&&n.indexOf(".")===-1;return jQuery.isNumeric(n)&&l?(IFS.core.formValidation.setValid(t,i,r),!0):(IFS.core.formValidation.setInvalid(t,i,r),!1)},checkMax:function(t){var a="max",r=IFS.core.formValidation.getMessageDisplaySetting(t,a),i=IFS.core.formValidation.getErrorMessage(t,a);if(e.html5validationMode){var o=t[0];return o.validity.rangeOverflow===!0?(IFS.core.formValidation.setInvalid(t,i,r),!1):(IFS.core.formValidation.setValid(t,i,r),!0)}var n=parseInt(t.attr("max"),10);if(IFS.core.formValidation.checkNumber(t,!0)){var l=parseInt(t.val(),10);return l>n?(IFS.core.formValidation.setInvalid(t,i,r),!1):(IFS.core.formValidation.setValid(t,i,r),!0)}},checkMin:function(t){var a="min",r=IFS.core.formValidation.getMessageDisplaySetting(t,a),i=IFS.core.formValidation.getErrorMessage(t,a);if(e.html5validationMode){var o=t[0];return o.validity.rangeUnderflow===!0?(IFS.core.formValidation.setInvalid(t,i,r),!1):(IFS.core.formValidation.setValid(t,i,r),!0)}var n=parseInt(t.attr("min"),10);if(IFS.core.formValidation.checkNumber(t)){var l=parseInt(t.val(),10);return l<n?(IFS.core.formValidation.setInvalid(t,i,r),!1):(IFS.core.formValidation.setValid(t,i,r),!0)}},checkRequired:function(t){var a="required",r=IFS.core.formValidation.getMessageDisplaySetting(t,a),i=IFS.core.formValidation.getErrorMessage(t,a);if(null!==t.val()){if(!t.is(":checkbox,:radio"))return t.is(e.number.fields)&&e.html5validationMode&&t[0].validity.badInput?(IFS.core.formValidation.setValid(t,i,r),!0):0===t.val().length?(IFS.core.formValidation.setInvalid(t,i,r),!1):(IFS.core.formValidation.setValid(t,i,r),!0);var o=t.attr("name");if("undefined"!=typeof o){var n=jQuery('[name="'+o+'"]');return 0===jQuery('[name="'+o+'"]:checked').length?(n.each(function(){IFS.core.formValidation.setInvalid(jQuery(this),i,r)}),!1):(n.each(function(){IFS.core.formValidation.setValid(jQuery(this),i,r)}),!0)}}},checkMinLength:function(e){var t="minlength",a=IFS.core.formValidation.getMessageDisplaySetting(e,t),r=IFS.core.formValidation.getErrorMessage(e,t),i=parseInt(e.attr("minlength"),10),o=e.val(),n=o.length>0&&o.length>=i;return IFS.core.formValidation.setStatus(e,t,n),n?(IFS.core.formValidation.setValid(e,r,a),!0):(IFS.core.formValidation.setInvalid(e,r,a),!1)},checkMaxLength:function(e){var t="maxlength",a=IFS.core.formValidation.getMessageDisplaySetting(e,t),r=IFS.core.formValidation.getErrorMessage(e,t),i=parseInt(e.attr("maxlength"),10);return e.val().length>i?(IFS.core.formValidation.setInvalid(e,r,a),!1):(IFS.core.formValidation.setValid(e,r,a),!0)},checkMinWordsLength:function(e){var t="minwordslength",a=IFS.core.formValidation.getMessageDisplaySetting(e,t),r=IFS.core.formValidation.getErrorMessage(e,t),i=parseInt(e.attr(t),10),o=e.val(),n=IFS.core.formValidation.countWords(o);return n.length>0&&n.length<i?(IFS.core.formValidation.setInvalid(e,r,a),!1):(IFS.core.formValidation.setValid(e,r,a),!0)},checkMaxWordsLength:function(e){var t="maxwordslength",a=IFS.core.formValidation.getMessageDisplaySetting(e,t),r=IFS.core.formValidation.getErrorMessage(e,t),i=parseInt(e.attr("data-"+t),10),o=e.val(),n=IFS.core.formValidation.countWords(o);return n.length>i?(IFS.core.formValidation.setInvalid(e,r,a),!1):(IFS.core.formValidation.setValid(e,r,a),!0)},checkTel:function(e){var t="tel",a=IFS.core.formValidation.getErrorMessage(e,t),r=IFS.core.formValidation.getMessageDisplaySetting(e,t),i=/^(?=.*[0-9])[- +()0-9]+$/,o=e.val(),n=i.test(o);return n?(IFS.core.formValidation.setValid(e,a,r),!0):(IFS.core.formValidation.setInvalid(e,a,r),!1)},checkDate:function(e){var t=e.closest(".date-group"),a=IFS.core.formValidation.getMessageDisplaySetting(e,"date");e.addClass("js-visited");var r,i,o=t.find(".day input"),n=t.find(".month input"),l=t.find(".year input");i=e.closest("tr").find(".time select").length>0?t.find(".time option[data-time]:selected").attr("data-time"):t.find(".time [data-time]").attr("data-time");var s=t.find(".js-addWeekDay"),d=o.add(n).add(l),c=o.hasClass("js-visited")&&n.hasClass("js-visited")&&l.hasClass("js-visited"),u=o.val().length>0&&n.val().length>0&&l.val().length>0,f=!o.is("[readonly]")||!n.is("[readonly]")||!l.is("[readonly]");d.attr({"data-number-showmessage":"none","data-min-showmessage":"none","data-max-showmessage":"none"});var m=IFS.core.formValidation.checkNumber(o)&&IFS.core.formValidation.checkNumber(n)&&IFS.core.formValidation.checkNumber(l)&&IFS.core.formValidation.checkMin(l)&&IFS.core.formValidation.checkMax(l),p=IFS.core.formValidation.getErrorMessage(t,"date-invalid");if(m&&u){var h=parseInt(n.val(),10),g=parseInt(o.val(),10),y=parseInt(l.val(),10),v=new Date(y,h-1,g);if(void 0!==i?v.setHours(i,0,0,0):v.setHours(0,0,0,0),v.getDate()===g&&v.getMonth()+1===h&&v.getFullYear()===y){if(r=!0,IFS.core.formValidation.setValid(d,p,a),d.attr("data-date",g+"-"+h+"-"+y),s.length){var b=["Sun","Mon","Tues","Wed","Thurs","Fri","Sat"],S=b[v.getDay()];s.text(S)}f&&(e.trigger("ifsAutosave"),t.is("[data-future-date]")&&(r=IFS.core.formValidation.checkFutureDate(t,v,a)),t.is("[data-past-date]")&&(r=IFS.core.formValidation.checkPastDate(t,v,a)))}else f&&(IFS.core.formValidation.setInvalid(d,p,a),d.attr({"data-date":""}),r=!1)}else(u||c)&&f?(IFS.core.formValidation.setInvalid(d,p,a),d.attr({"data-date":""}),r=!1):r=!1;return!r&&s.length&&s.text("-"),r},checkFutureDate:function(e,t,a){var r,i=IFS.core.formValidation.getErrorMessage(e,"date-future"),o=e.find(".day input, .month input, .year input");if(0===jQuery.trim(e.attr("data-future-date")).length)r=new Date,r.setDate(r.getDate()+1);else{var n=e.attr("data-future-date").split("-"),l=parseInt(n[0],10),s=parseInt(n[1],10)-1,d=parseInt(n[2],10),c=n.length>2&&parseInt(n[3],10);r=new Date(d,s,l)}return c?r.setHours(c,0,0,0):r.setHours(0,0,0,0),r<=t?(IFS.core.formValidation.setValid(o,i,a),!0):(IFS.core.formValidation.setInvalid(o,i,a),!1)},checkPastDate:function(e,t,a){var r=IFS.core.formValidation.getErrorMessage(e,"date-past"),i=e.find(".day input, .month input, .year input"),o=new Date;return o.setHours(0,0,0,0)>=t.setHours(0,0,0,0)?(IFS.core.formValidation.setValid(i,r,a),!0):(IFS.core.formValidation.setInvalid(i,r,a),!1)},checkPattern:function(t){var a="pattern",r=IFS.core.formValidation.getMessageDisplaySetting(t,a),i=IFS.core.formValidation.getErrorMessage(t,a);if(e.html5validationMode){var o=t[0];return o.validity.patternMismatch?(IFS.core.formValidation.setInvalid(t,i,r),!1):(IFS.core.formValidation.setValid(t,i,r),!0)}var n=t.attr("pattern"),l=new RegExp(n);return l.test(t.val())?(IFS.core.formValidation.setValid(t,i,r),!0):(IFS.core.formValidation.setInvalid(t,i,r),!1)},getErrorMessage:function(t,a){var r,i=t.attr("data-"+a+"-errormessage");if(a.indexOf("-")!==-1){var o=a.split("-");a=o[0],r=o[1]}else r=!1;return"undefined"==typeof i&&(i=r===!1?e[a].messageInvalid:e[a].messageInvalid[r]),i.indexOf("%"+a+"%")!==-1&&(i=i.replace("%"+a+"%",t.attr(a))),i},getMessageDisplaySetting:function(e,t){var a=e.is("[data-"+t+"-showmessage]")?e.attr("data-"+t+"-showmessage"):"show";return a},setInvalid:function(t,a,r){var i=jQuery.inArray(r,e.dispaySettings)!==-1;if(i!==!1&&"none"!==r){var o=t.closest(".form-group,tr.form-group-row"),n=IFS.core.formValidation.getIdentifier(t),l="visuallyhidden"===r;if(o.length){e.html5validationMode&&t[0].setCustomValidity(a),l===!1&&o.addClass("form-group-error");var s=o.find('[data-errorfield="'+n+'"]:contains("'+a+'"),.error-message:not([data-errorfield]):contains("'+a+'")');if(0===s.length){l===!1&&t.addClass("form-control-error");var d='<span data-errorfield="'+n+'" class="error-message'+(l?" visuallyhidden":"")+'">'+a+"</span>";o.find('legend,label,[scope="row"]').first().append(d)}}0===jQuery('.error-summary-list [data-errorfield="'+n+'"]:contains('+a+'),.error-summary-list li:not([data-errorfield]):contains("'+a+'")').length&&jQuery(".error-summary-list").append('<li data-errorfield="'+n+'">'+a+"</li>"),jQuery(".error-summary:not([data-ignore-errors])").attr("aria-hidden",!1),jQuery(window).trigger("updateWysiwygPosition")}},setValid:function(t,a,r){var i=jQuery.inArray(r,e.dispaySettings)!==-1;if(i!==!1&&"none"!==r){var o=t.closest(".form-group ,tr.form-group-row"),n=jQuery(".error-summary-list"),l=IFS.core.formValidation.getIdentifier(t);o.length&&(o.find('[data-errorfield="'+l+'"]:contains("'+a+'")').remove(),
o.find('.error-message:not([data-errorfield]):contains("'+a+'")').first().remove(),0===o.find("[data-errorfield],.error-message:not([data-errorfield])").length&&(o.removeClass("form-group-error"),t.removeClass("form-control-error"),e.html5validationMode&&jQuery('[name="'+l+'"]').each(function(){this.setCustomValidity("")}))),n.length&&(n.find('[data-errorfield="'+l+'"]:contains('+a+")").remove(),n.find('li:not([data-errorfield]):contains("'+a+'")').first().remove()),0===jQuery(".error-summary-list li:not(.list-header)").length&&jQuery(".error-summary:not([data-ignore-errors])").attr("aria-hidden","true"),jQuery(window).trigger("updateWysiwygPosition")}},setSectionValid:function(t){t=jQuery(t),t.removeClass("error");var a=t.find(".form-control-error");t.find(".error-message").each(function(){var e=jQuery(this),t=e.text();jQuery(".error-summary-list li:contains("+t+")").first().remove(),e.remove()}),jQuery.each(a,function(){jQuery(this).removeClass("form-control-error").val(""),e.html5validationMode&&this.setCustomValidity("")})},setStatus:function(e,t,a){var r=e.closest(".form-group,tr.form-group-row"),i="data-"+t+"-validationStatus",o=r.find("["+i+"]");a=a.toString(),o.length&&jQuery.each(o,function(){jQuery(this).attr("data-valid",a)})},getIdentifier:function(e){return e.is("[data-date]")&&(e=e.closest(".date-group").find('input[type="hidden"]')),e.prop("name").length?e.prop("name"):!!e.prop("id").length&&e.prop("id")},checkHTML5validationMode:function(){var e=jQuery("input");if(e.length)return"undefined"!=typeof e[0].validity},countWords:function(e){var t=e;return"undefined"!=typeof t&&(t=e.replace(/(\r\n|\n|\r)/gm," "),t=e.replace(/([[0-9]+\.\ |\*\ |\*\*|_)/gm,""),jQuery.trim(t).split(" "))},betterMinLengthSupport:function(){e.html5validationMode&&"undefined"==typeof jQuery("input")[0].validity.tooShort&&jQuery(e.minlength.fields).each(function(){var e=jQuery(this),t=parseInt(e.attr("minlength"),10);e.attr("pattern",".{"+t+",}")})}}}(),IFS.core.mirrorElements=function(){"use strict";return{init:function(){jQuery("[data-mirror]").each(function(){var e=jQuery(this),t=e.attr("data-mirror");IFS.core.mirrorElements.updateElement(e,t),IFS.core.mirrorElements.bindMirrorElement(e,t)})},bindMirrorElement:function(e,t){jQuery(document).on("change",t,function(){IFS.core.mirrorElements.updateElement(e,this)})},updateElement:function(e,t){var a=IFS.core.mirrorElements.getSourceText(t);e.is("input")?e.val(a):e.text(a)},getSourceText:function(e){var t=jQuery(e);if(1===t.length){if(t.val().length)return t.val();if(t.text().length)return t.text()}return""}}}(),IFS.core.modal=function(){"use strict";var e;return{settings:{element:"[data-js-modal]",html5validationMode:{}},init:function(){e=this.settings,e.html5validationMode=IFS.core.formValidation.checkHTML5validationMode(),IFS.core.modal.initButtonRole(),jQuery("body").on("click",e.element,function(e){IFS.core.modal.openModal(e,this)}),jQuery("body").on("click",".js-close",function(){IFS.core.modal.closeModal()}),jQuery(document).keyup(function(e){27===e.keyCode&&IFS.core.modal.closeModal()})},initButtonRole:function(){jQuery(e.element).is("a")&&jQuery(e.element).attr({role:"button",tabindex:"0"})},checkForInputErrors:function(t){var a=!0;if(t.closest("form:not([novalidate])").length&&e.html5validationMode){var r=t.closest("form:not([novalidate])");a=r[0].checkValidity()}return a},openModal:function(e,t){t=jQuery(t);var a=IFS.core.modal.checkForInputErrors(t),r=jQuery(e.target).attr("data-js-modal"),i=jQuery(e.target).attr("data-modal-form-action");r=jQuery("."+r),r.length&&(e.preventDefault(),a&&t.is('[aria-disabled="true"]')===!1?(IFS.core.modal.disableTabPage(),r.add(".modal-overlay").attr("aria-hidden","false"),setTimeout(function(){var e=r.outerHeight();r.css({"margin-top":"-"+e/2+"px"})},50)):a||t.closest("form:not([novalidate])").find("input:invalid").first().focus()),r.find("form").length&&(void 0!==i&&r.find("form").attr("action",i),r.find("form").on("submit",function(e){var t=this,a=!0;return jQuery('[required="required"]',t).each(function(){IFS.core.formValidation.checkRequired(jQuery(this))!==!0&&(a=!1)}),!!a||(e.preventDefault(),!1)}))},disableTabPage:function(){jQuery(":tabbable").each(function(){var e=jQuery(this);if(0===e.closest('[role="dialog"]').length){var t=0;e.prop("tabindex")&&(t=e.prop("tabindex")),e.prop("tabindex","-1").attr("data-original-tabindex",t)}})},enableTabPage:function(){jQuery("[data-original-tabindex]").each(function(){var e=jQuery(this),t=e.attr("data-original-tabindex");e.prop("tabindex",t).removeAttr("data-original-tabindex")})},closeModal:function(){IFS.core.modal.enableTabPage(),jQuery('[role="dialog"],.modal-overlay').attr("aria-hidden","true")}}}(),IFS.core.passwordToggle=function(){"use strict";return{init:function(){jQuery(".password-toggle button").on("click",function(e){e.preventDefault();var t=jQuery(this),a=jQuery(this).prev(),r=a.attr("type");"password"===r?(a.prop("type","text"),t.text("Hide"),t.attr("aria-checked",!0)):(a.prop("type","password"),t.text("Show"),t.attr("aria-checked",!1))})}}}(),IFS.core.progressiveGroupSelect=function(){"use strict";var e;return{settings:{progressiveGroupSelect:"[data-progressive-group-select]"},init:function(){e=this.settings,jQuery(e.progressiveGroupSelect).each(function(){var e=jQuery(this);""===e.find("option:selected").val()&&e.prop("disabled",!0),jQuery("optgroup",e).each(function(){var e=jQuery(this),t=e.attr("label");jQuery("option",e).each(function(){jQuery(this).attr("data-optgroup-label",t)})}),IFS.core.progressiveGroupSelect.createParentSelect(e)})},createParentSelect:function(e){var t=e.attr("data-progressive-group-select"),a=e.attr("data-progressive-group-select-instruction"),r=jQuery('<select class="form-control width-full js-progressive-group-select" aria-label="'+t+'"><option value="">'+a+"</option></select>"),i=e.find("optgroup"),o=[],n=[],l=e.find("option:selected");i.each(function(){n.push('<option value="'+jQuery(this).attr("label")+'">'+jQuery(this).attr("label")+"</option>"),jQuery("option",jQuery(this)).each(function(e,t){o.push(t)})}),r.append(n),""!==l.val()&&(jQuery('option[value="'+l.attr("data-optgroup-label")+'"]',r).prop("selected",!0),IFS.core.progressiveGroupSelect.update(e,r,o)),r.on("change",function(){IFS.core.progressiveGroupSelect.update(e,r,o)}),jQuery("optgroup",e).remove(),e.before(r)},update:function(e,t,a){var r=t.val();if(""===r)jQuery("option",e).slice(1).remove(),jQuery("option:first",e).attr("selected","selected"),jQuery(e).prop("disabled",!0);else{jQuery("option",e).slice(1).remove();for(var i=0;i<a.length;i++)jQuery(a[i]).data("optgroup-label")===r&&jQuery(e).append(a[i]);jQuery(e).prop("disabled",!1)}}}}(),IFS.core.repeatableFinanceRows=function(){"use strict";return{init:function(){IFS.core.repeatableFinanceRows.backForwardCacheReload(),jQuery("body").on("click","[data-repeatable-rowcontainer]",function(e){e.preventDefault(),IFS.core.repeatableFinanceRows.backForwardCacheInvalidate(),IFS.core.repeatableFinanceRows.addRow(this,e)}),jQuery("body").on("click",".js-remove-row",function(e){IFS.core.repeatableFinanceRows.backForwardCacheInvalidate(),IFS.core.repeatableFinanceRows.removeRow(this,e)}),jQuery("body").on("persistUnsavedRow",function(e,t,a){IFS.core.repeatableFinanceRows.persistUnsavedRow(t,a)});var e='<button type="submit" name="remove_cost" class="buttonlink js-remove-row" value="">Remove</button>';jQuery("[data-repeatable-row] .buttonplaceholder").replaceWith(e),jQuery("body").trigger("updateSerializedFormState")},getAjaxUrl:function(e){var t=jQuery(e),a=t.val(),r=t.prop("name"),i="undefined"!=typeof a,o="undefined"!=typeof r;if(o&&i){var n=window.location.protocol+"//"+window.location.host,l="";1===jQuery("#application_id").length&&(l=n+"/application/"+jQuery("#application_id").val()+"/form/"+r+"/"+a),1===jQuery("#projectId").length&&(l=n+"/project-setup-management/project/"+jQuery("#projectId").val()+"/finance-check/organisation/"+jQuery("#organisationId").val()+"/eligibility/"+r+"/"+a)}return l},addRow:function(e,t){var a=jQuery(e),r=IFS.core.repeatableFinanceRows.getAjaxUrl(e);r.length&&(t.preventDefault(),jQuery.ajaxProtected({url:r,beforeSend:function(){a.before('<span class="form-hint">Adding a new row</span>')},cache:!1}).done(function(e){var t=jQuery(a.attr("data-repeatable-rowcontainer")),r='<button type="submit" name="remove_cost" class="buttonlink js-remove-row" value="">Remove</button>';a.prevAll(".form-hint").remove(),e=jQuery(e),e.find(".buttonplaceholder").replaceWith(r),t.append(e),jQuery("body").trigger("updateSerializedFormState");var i=e.find('[type="number"][name],[type="text"][name],[type="email"][name],[type="radio"][name],textarea[name]').first().attr("name");"undefined"!=typeof i&&jQuery("[name="+i+"]").focus()}))},removeRow:function(e,t){var a=jQuery(e),r=a.val();if(""!==r){var i=IFS.core.repeatableFinanceRows.getAjaxUrl(e);i.length&&(t.preventDefault(),jQuery.ajaxProtected({url:i}).done(function(e){e=jQuery.parseJSON(e),"OK"===e.status&&(jQuery("[data-repeatable-row="+r+"]").remove(),jQuery("body").trigger("recalculateAllFinances").trigger("updateSerializedFormState"))}))}else{var o=a.closest("[data-repeatable-row]");o.length&&(jQuery("[data-repeatable-row="+o.attr("data-repeatable-row")+"]").remove(),jQuery("body").trigger("updateSerializedFormState"))}},backForwardCacheReload:function(){var e=jQuery("#cacheTest");""!==e.val()&&(jQuery("#cacheTest").val(""),window.location.reload())},backForwardCacheInvalidate:function(){jQuery("#cacheTest").val("cached")},persistUnsavedRow:function(e,t){var a=e.split("-"),r=a.length>2?a[3]:null,i=jQuery('[data-repeatable-row] [name*="'+r+'"]');i.each(function(){var e=jQuery(this).prop("name"),a=e.split("-"),r=a[0]+"-"+a[1]+"-"+a[2]+"-"+t;jQuery(this).prop("name",r),jQuery('[data-errorfield="'+e+'"]').attr("data-errorfield",r)});var o=jQuery('[data-repeatable-row="'+r+'"]'),n=o.find(".js-remove-row");n.length&&(n.val(t),o.attr("data-repeatable-row",t))}}}(),IFS.core.singleSubmit=function(){"use strict";return{init:function(){jQuery(document).on("submit","[data-single-submit]",function(e){var t=jQuery(this);if(t.is("[data-submitting]"))e.preventDefault();else{t.attr("data-submitting","");var a=t.find("button[data-content-on-submit]");a.attr("disabled","disabled"),a.html(a.attr("data-content-on-submit"))}})}}}(),IFS.core.submitNotification=function(){"use strict";var e;return{settings:{element:"[data-submitted-text]"},init:function(){e=this.settings;var t=jQuery(e.element),a=t.closest("form");a.submit(function(){var e=t.data("submittedText");t.text(e)})}}}(),IFS.core.tabs=function(){"use strict";var e;return{settings:{tabContainer:".tabs"},init:function(){e=this.settings,IFS.core.tabs.initTabHTML(),jQuery("body").on("keydown",'[role="tab"]',function(e){37!==e.keyCode&&38!==e.keyCode&&39!==e.keyCode&&40!==e.keyCode||IFS.core.tabs.changeFocus(e,jQuery(this))}),jQuery("body").on("click",'[role="tab"]',function(e){IFS.core.tabs.handleClick(e,jQuery(this))})},initTabHTML:function(){jQuery(e.tabContainer+" > ul").attr({role:"tablist","aria-hidden":null}).show(),jQuery(e.tabContainer+' [role="tablist"] li').attr("role","presentation"),jQuery(e.tabContainer+" section div").removeAttr("aria-hidden"),jQuery('[role="tablist"] a').attr({role:"tab",tabindex:"-1"}),jQuery('[role="tablist"] a').each(function(){var e=jQuery(this);e.prop("aria-controls",e.prop("href").substring(1))}),jQuery(e.tabContainer+" section").attr({role:"tabpanel"}),jQuery(e.tabContainer+" section > *:first-child").attr({tabindex:"0"}),jQuery(e.tabContainer).each(function(){var e=0;location.hash&&jQuery(this).children().find("#"+window.location.hash.substring(1))&&(e=jQuery(this).find("#"+window.location.hash.substring(1)).index()-1),jQuery(this).find("li").eq(e).find("a").attr({"aria-selected":"true",tabindex:"0"}),jQuery(this).find('[role="tabpanel"]').not(":eq("+e+")").attr({"aria-hidden":"true"})})},changeFocus:function(t,a){var r,i=jQuery(a),o=i.parent(),n=o.siblings().length++,l=0===o.index()?o.siblings().eq(n-1).children('[role="tab"]'):o.prev().children('[role="tab"]'),s=o.index()===n?o.siblings().eq(0).children('[role="tab"]'):o.next().children('[role="tab"]');switch(t.keyCode){case 37:r=l;break;case 38:t.preventDefault(),r=l;break;case 39:r=s;break;case 40:t.preventDefault(),r=s;break;default:r=!1}r.length&&(i.attr({tabindex:"-1","aria-selected":null}),r.attr({tabindex:"0","aria-selected":!0}).focus()),i.parents(e.tabContainer).find('[role="tabpanel"]').attr("aria-hidden","true"),i.parents(e.tabContainer).find("#"+jQuery(document.activeElement).attr("href").substring(1)).attr("aria-hidden",null)},handleClick:function(t,a){t.preventDefault();var r=jQuery(a);r.parents('[role="tablist"]').find('[role="tab"]').attr({tabindex:"-1","aria-selected":null}),r.attr({"aria-selected":!0,tabindex:"0"}),r.parents(e.tabContainer).find('[role="tabpanel"]').attr("aria-hidden","true"),r.parents(e.tabContainer).find("#"+r.attr("href").substring(1)).attr("aria-hidden",null)},destroy:function(){jQuery("body").off("keydown",'[role="tab"]'),jQuery("body").off("click",'[role="tab"]'),jQuery('[role="tablist"] a').removeAttr("role tabindex aria-controls aria-selected").attr({"aria-hidden":!0}),jQuery(e.tabContainer+' [role="tablist"] li').removeAttr("role"),jQuery(e.tabContainer+" > ul").removeAttr("role").hide(),jQuery(e.tabContainer+" section > *:first-child").removeAttr("tabindex"),jQuery(e.tabContainer+" section div").removeAttr("tabindex"),jQuery(e.tabContainer+" section").removeAttr("role aria-hidden")}}}(),IFS.core.unsavedChanges=function(){"use strict";var e;return{settings:{formelement:"[data-autosave]"},init:function(){e=this.settings,jQuery(e.formelement).length&&(IFS.core.unsavedChanges.initUnsavedChangesWarning(),IFS.core.unsavedChanges.updateSerializedFormState(),jQuery("body").on("updateSerializedFormState",function(){IFS.core.unsavedChanges.updateSerializedFormState()}))},updateSerializedFormState:function(){var t=jQuery(e.formelement);t.data("serializedFormState",t.serialize())},initUnsavedChangesWarning:function(){var t=!1;jQuery(e.formelement).on("submit",function(){t=!0}),jQuery(window).bind("beforeunload",function(a){var r=jQuery(e.formelement),i=r.attr("data-test");i="undefined"!=typeof i&&i!==!1;var o=r.serialize()===r.data("serializedFormState");return t===!1&&o===!1&&i===!1?"Are you sure you want to leave this page? There are some unsaved changes...":void(a=null)})}}}(),IFS.core.upload=function(){"use strict";var e;return{settings:{uploadEl:'[type="file"][class="inputfile"]'},init:function(){e=this.settings,jQuery("body").on("change",e.uploadEl,function(){var e=jQuery(this).attr("id");jQuery('[data-for-file-upload="'+e+'"]').click()})}}}(),IFS.core.wordCount=function(){"use strict";var e,t;return{settings:{wordcountEl:".word-count textarea",typeTimeout:500},init:function(){e=this.settings,jQuery("body").on("change keyup",e.wordcountEl,function(a){"keyup"===a.type?(clearTimeout(t),t=setTimeout(function(){IFS.core.wordCount.updateWordCount(a.target)},e.typeTimeout)):IFS.core.wordCount.updateWordCount(a.target)})},updateWordCount:function(e){var t=jQuery(e),a=t.val();a=a.replace(/(\r\n|\n|\r)/gm," "),a=a.replace(/([[0-9]+\.\ |\*\ |\*\*|_)/gm,"");for(var r=jQuery.trim(a).split(" "),i=0,o=0;o<r.length;o++)r[o].length>0&&i++;var n=t.attr("data-max_words")-i,l=t.parents(".word-count").find(".count-down");l.html("Words remaining: "+n),n<0?l.removeClass("positive").addClass("negative"):l.removeClass("negative").addClass("positive")}}}(),IFS.core.financeSpecifics=function(){"use strict";var e;return{settings:{adminSupportCostsSelect:'[name*="overheads-type"]',adminSupportCostsSelectTotals:{NONE:'[id^="section-total-"][id$="-cost-none"]',DEFAULT_PERCENTAGE:'[id^="section-total-"][id$="-default"]',CUSTOM_RATE:'[id^="section-total-"][id$="-custom"]',TOTAL:'[id^="section-total-"][id$="-calculate-formatted"]'}},init:function(){e=this.settings,IFS.core.financeSpecifics.initOverheadActiveTotalChanges(),IFS.core.financeSpecifics.initOtherFunding()},initOverheadActiveTotalChanges:function(){IFS.core.financeSpecifics.setOverheadSectionElementValue();var t=jQuery(e.adminSupportCostsSelect+":checked");t.length&&IFS.core.financeSpecifics.makeRightOverheadTotalActive(t),jQuery(document).on("change",e.adminSupportCostsSelect,function(){IFS.core.financeSpecifics.makeRightOverheadTotalActive(this)})},makeRightOverheadTotalActive:function(t){var a=jQuery(t).val(),r="undefined"!=typeof e.adminSupportCostsSelectTotals[a]&&e.adminSupportCostsSelectTotals[a],i=jQuery.map(e.adminSupportCostsSelectTotals,function(e){if(e!==r)return e}).join(",");if(r)if(r=jQuery(r),i=jQuery(i),i.removeAttr("data-current-overhead-total").val("£ 0").attr("data-calculation-rawvalue",0),r.attr("data-current-overhead-total",""),r.is("[data-calculation-fields]")){var o=r.attr("data-calculation-fields");IFS.core.finance.doMath(r,o.split(","))}else r.trigger("change")},setOverheadSectionElementValue:function(){var t=jQuery(e.adminSupportCostsSelect).closest("section.collapsible").find("[data-mirror]");t.each(function(){var e=jQuery(this);e.is('[data-calculation-format="percentage"]')?e.attr("data-calculation-fields","100, #total-cost, [data-current-overhead-total]"):(IFS.core.mirrorElements.updateElement(e,"[data-current-overhead-total]"),IFS.core.mirrorElements.bindMirrorElement(e,"[data-current-overhead-total]"))})},initOtherFunding:function(){jQuery("#otherFundingShowHideToggle").on("change",'[data-target] input[type="radio"]',function(){setTimeout(function(){jQuery("[id*=fundingAmount]").trigger("updateFinances")},0)})}}}(),Object.keys||(Object.keys=function(e){if(e!==Object(e))throw new TypeError("Object.keys called on a non-object");var t,a=[];for(t in e)if(Object.prototype.hasOwnProperty.call(e,t))return a.push(t),a});var UTIL=function(){"use strict";return{fire:function(e,t,a){var r=Object.keys(IFS);jQuery.each(r,function(){if("undefined"!=typeof IFS[this].loadOrder){var r=IFS[this].loadOrder;t=void 0===t?"init":t,""!==e&&r[e]&&"function"==typeof r[e][t]&&r[e][t](a)}})},loadEvents:function(){var e=document.body.className.split(/\s+/);return UTIL.fire("common"),jQuery.each(e,function(e,t){UTIL.fire(t)}),UTIL.fire("common","finalize"),window.matchMedia?(ssm.addState({id:"mobile",query:"(max-width: 639px)",onEnter:function(){UTIL.fire("commonStateManaged","mobile")},onLeave:function(){UTIL.fire("commonStateManaged","mobileLeave")}}),ssm.addState({id:"desktop",query:"(min-width: 640px)",onEnter:function(){UTIL.fire("commonStateManaged","desktop")},onLeave:function(){UTIL.fire("commonStateManaged","desktopLeave")}}),void jQuery.each(e,function(e,t){UTIL.fire(t,"finalize")})):UTIL.fire("commonStateManaged","desktop")}}}();jQuery(document).ready(function(){UTIL.loadEvents()});
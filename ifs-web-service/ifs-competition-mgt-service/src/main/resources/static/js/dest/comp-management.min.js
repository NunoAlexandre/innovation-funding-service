if("undefined"==typeof IFS)var IFS={};IFS.competitionManagement={},IFS.competitionManagement.loadOrder={common:{init:function(){IFS.competitionManagement.various.init()},finalize:function(){IFS.competitionManagement.multipageSelect.init()}},"competition-management":{init:function(){IFS.competitionManagement.repeatableRows.init()}},"competition-setup":{init:function(){IFS.competitionManagement.initialDetails.init(),IFS.competitionManagement.milestones.init(),IFS.competitionManagement.fundingInformation.init(),IFS.competitionManagement.repeater.init(),IFS.core.finance.init()}}},IFS.competitionManagement.multipageSelect=function(){"use strict";var e;return{settings:{multipageCheckboxEl:'[data-multipage-select] [type="checkbox"]',selectAllEl:"[data-select-all]",countEl:"[data-count-selected]",submitEl:"[data-submit-el]",totalListSizeEl:"#total-list-size",totalListSize:0},init:function(){e=this.settings,e.totalListSize=parseInt(jQuery("#total-list-size").val()),jQuery("body").on("change",e.multipageCheckboxEl,function(){IFS.competitionManagement.multipageSelect.processMultipageCheckbox(this)})},getData:function(e,t,n){return n?{addAll:e}:{assessor:t,isSelected:e}},processMultipageCheckbox:function(t){t=jQuery(t);var n=t.is(e.selectAllEl),a=t.is(":checked"),i=t.val(),o=IFS.competitionManagement.multipageSelect.getData(a,i,n),r=window.location.href;jQuery.ajaxProtected({type:"POST",url:r,data:o,dataType:"json",timeout:IFS.core.autoSave.settings.ajaxTimeOut}).done(function(e){if(n&&IFS.competitionManagement.multipageSelect.changeStateCheckboxes(a),"undefined"!=typeof e.selectionCount){var t=parseInt(e.selectionCount);IFS.competitionManagement.multipageSelect.updateCount(t),IFS.competitionManagement.multipageSelect.updateSubmitButton(t),n||IFS.competitionManagement.multipageSelect.changeStateSelectAllCheckbox(t)}}).fail(function(e,n){if(e.readyState<4)return!0;var a="Something went wrong";t.closest("fieldset").find("legend").html('<span class="error-message">'+a+"</span>")})},updateSubmitButton:function(t){var n=jQuery(e.submitEl);n.length&&(t>0?n.removeProp("disabled"):n.prop("disabled","disabled"))},updateCount:function(t){jQuery(e.countEl).length&&jQuery(e.countEl).text(t)},changeStateSelectAllCheckbox:function(t){var n=jQuery(e.selectAllEl);e.totalListSize===t?n.prop("checked","checked"):n.removeProp("checked")},changeStateCheckboxes:function(t){var n=jQuery(e.multipageCheckboxEl);t===!0?n.prop("checked","checked"):n.removeProp("checked")}}}(),IFS.competitionManagement.repeatableRows=function(){"use strict";return{init:function(){jQuery("button[data-repeatable-rowcontainer]").attr("type","button"),jQuery("body").on("click","[data-repeatable-rowcontainer]",function(e){e.preventDefault(),IFS.competitionManagement.repeatableRows.addRow(this,e)}),jQuery("body").on("click",".remove-another-row",function(e){e.preventDefault(),IFS.competitionManagement.repeatableRows.removeRow(this,e)})},addRow:function(e){var t=jQuery(e).attr("data-repeatable-rowcontainer"),n=jQuery(t).children().length||0,a=jQuery('<tr><td class="width-40-percent form-group"><label></label><input aria-labelledby="invite-label-assessor-name" class="form-control width-full" type="text" id="invites'+n+'.name" name="invites['+n+'].name" value="" data-required-errormessage="Please enter a name." required="required" /></td><td class="width-40-percent form-group"><label></label><input aria-labelledby="invite-label-assessor-email" class="form-control width-full" type="email" id="invites'+n+'.email" name="invites['+n+'].email" value="" data-required-errormessage="Please enter an email address." required="required" /></td><td class="alignright width-20-percent"><button class="remove-another-row buttonlink" name="removeNewUser" type="button" value="0">Remove</button></td></tr>');jQuery(t).append(a),jQuery(a).find("input").first().focus()},removeRow:function(e){var t,n=jQuery(e),a=n.closest("tbody");n.closest("tr").remove(),t=jQuery(a).children(),jQuery(t).each(function(e){var t=jQuery(this).find("input");jQuery(t).each(function(){var t=jQuery(this),n=t.attr("id").replace(/\d+/g,e),a=t.attr("name").replace(/\d+/g,e);t.attr({id:n,name:a})})})}}}(),IFS.competitionManagement.repeater=function(){"use strict";return{init:function(){jQuery(document).on("click","[data-add-row]",function(){IFS.competitionManagement.repeater.handleAddRow(this)}),jQuery(document).on("click","[data-remove-row]",function(){IFS.competitionManagement.repeater.handleRemoveRow(this)})},handleAddRow:function(e){var t=jQuery(e).attr("data-add-row");switch(t){case"cofunder":IFS.competitionManagement.repeater.addCoFunder();break;case"guidance":IFS.competitionManagement.repeater.addGuidanceRow();break;case"innovationArea":IFS.competitionManagement.repeater.addInnovationAreaRow();break;case"contentGroup":IFS.competitionManagement.repeater.addContentGroup(e);break;case"dateContentGroup":IFS.competitionManagement.repeater.addDateContentGroup(e)}return jQuery("body").trigger("updateSerializedFormState"),!1},handleRemoveRow:function(e){var t=jQuery(e),n=t.attr("data-remove-row");switch(n){case"cofunder":jQuery('[name="removeFunder"]').val(t.val()),IFS.core.autoSave.fieldChanged('[name="removeFunder"]'),t.closest(".funder-row").remove(),IFS.competitionManagement.repeater.reindexRows(".funder-row"),jQuery("body").trigger("recalculateAllFinances");break;case"guidance":jQuery('[name="removeGuidanceRow"]').val(t.val()),IFS.core.autoSave.fieldChanged('[name="removeGuidanceRow"]'),t.closest("tr").remove(),IFS.competitionManagement.repeater.reindexRows('tr[id^="guidance-"]');break;case"innovationArea":t.closest('[id^="innovation-row"]').remove(),IFS.competitionManagement.repeater.reindexRows('.form-group[id^="innovation-row"]'),IFS.competitionManagement.initialDetails.disableAlreadySelectedOptions(),IFS.competitionManagement.initialDetails.autosaveInnovationAreaIds(),IFS.competitionManagement.initialDetails.rebindInnovationAreas();break;case"contentGroup":t.closest('[id^="contentGroup-row-"]').remove(),IFS.competitionManagement.repeater.reindexRows('[id^="contentGroup-row-"]');break;case"dateContentGroup":t.closest('[id^="contentDateGroup-row-"]').remove(),IFS.competitionManagement.repeater.reindexRows('[id^="contentDateGroup-row-"]')}},addInnovationAreaRow:function(){var e=jQuery('.form-group[id^="innovation-row"]'),t=e.length,n=parseInt(e.last().prop("id").split("innovation-row-")[1],10)+1,a=e.first().clone();a.removeClass("error"),a.find(".error-message").remove(),a.prop("id","innovation-row-"+n),a.find('[id^="innovationAreaCategoryId"]').prop("id","innovationAreaCategoryId-"+n),a.find('[for^="innovationAreaCategoryId"]').prop("for","innovationAreaCategoryId-"+n),a.find("[selected]").removeAttr("selected"),a.find("[disabled]").first().attr("selected",""),a.find(".form-label").children().addClass("visuallyhidden"),a.find("[name]").prop("name","innovationAreaCategoryIds["+t+"]").val(""),a.append('<button data-remove-row="innovationArea" value="'+t+'" class="buttonlink" type="button">Remove</button>'),e.last().after(a),IFS.competitionManagement.initialDetails.disableAlreadySelectedOptions(),IFS.competitionManagement.initialDetails.rebindInnovationAreas()},addContentGroup:function(e){var t=jQuery('[id^="contentGroup-row-"]'),n=0,a=0;t.length&&(n=parseInt(t.length,10),a=parseInt(t.last().prop("id").split("contentGroup-row-")[1],10)+1);var i="Please enter a heading.",o="Please enter content.",r='<div class="contentGroup" id="contentGroup-row-'+a+'"><div class="form-group"><label class="form-label-bold" for="heading-'+a+'">Heading</label><input class="form-control" id="heading-'+a+'" type="text" name="contentGroups['+n+'].heading" data-required-errormessage="'+i+'" required="required" /></div><div class="form-group textarea-wrapped"><label class="form-label-bold" for="content-'+a+'">Content</label><textarea id="content-'+a+'" cols="30" rows="10" class="width-full form-control" data-editor="html" name="contentGroups['+n+'].content" data-required-errormessage="'+o+'" required="required"></textarea></div><div class="form-group upload-section"><input type="file" id="contentGroups-'+a+'.attachment" class="inputfile" name="contentGroups['+n+'].attachment" /><label for="contentGroups-'+a+'.attachment" class="button-secondary extra-margin">+ Upload</label><button class="button-secondary" type="submit" name="uploadFile" data-for-file-upload="contentGroups-'+a+'.attachment" value="'+n+'">Save</button><p class="uploaded-file">No file currently uploaded</p></div><button type="button" class="buttonlink no-margin" data-remove-row="contentGroup">Remove section</button></div>';t.length?t.last().after(r):jQuery(e).parent().before(r),IFS.competitionManagement.repeater.initEditor("#content-"+a)},addDateContentGroup:function(e){var t=jQuery('[id^="contentDateGroup-row-"]'),n=0,a=0;t.length&&(n=parseInt(t.length,10),a=parseInt(t.last().prop("id").split("contentDateGroup-row-")[1],10)+1);var i="Please enter a valid date.",o='<div class="contentGroup" id="contentDateGroup-row-'+a+'"><div class="form-group"><fieldset><legend><span class="form-label form-label-bold">Date</span></legend><div class="date-group"><input type="hidden" disabled name="dates['+n+'].combined" /><div class="day"><label class="form-label" for="dates-'+a+'-day">Day</label><input class="form-control width-extra-small" placeholder="DD" type="number" id="dates-'+a+'-day" name="dates['+n+'].day" min="1" max="31" required="required"  data-required-errormessage="'+i+'"></div><div class="month"><label class="form-label" for="dates-'+a+'-month">Month</label><input class="form-control width-extra-small" placeholder="MM" type="number" id="dates-'+a+'-month" name="dates['+n+'].month" min="1" max="12" required="required" data-required-errormessage="'+i+'" /></div><div class="year"><label class="form-label" for="dates-'+a+'-year">Year</label><input class="form-control width-extra-small" placeholder="YYYY" type="number" id="dates-'+a+'-year" name="dates['+n+'].year" min="1" required="required" data-required-errormessage="'+i+'" /></div></div></fieldset></div><div class="form-group textarea-wrapped"><label class="form-label" for="dates-'+a+'-content"><span class="form-label-bold">Content</span></label><textarea cols="30" rows="5" id="dates-'+a+'-content" name="dates['+n+'].content" data-editor="html" class="width-full form-control-error" required="required" th:attr="data-required-errormessage=#{validation.publiccontent.datesform.content.required}"></textarea></div><div class="form-group"><button class="buttonlink" type="button" data-remove-row="dateContentGroup">Remove event</button></div></div>';t.length?t.last().after(o):jQuery(e).parent().before(o),IFS.competitionManagement.repeater.initEditor("#dates-"+a+"-content")},addCoFunder:function(){var e=0,t=0;jQuery(".funder-row").length&&(e=parseInt(jQuery(".funder-row").length,10),t=parseInt(jQuery(".funder-row[id^=funder-row-]").last().attr("id").split("funder-row-")[1],10)+1);var n='<div class="grid-row funder-row" id="funder-row-'+t+'"><div class="column-half"><div class="form-group"><input type="text" maxlength="255" data-maxlength-errormessage="Funders has a maximum length of 255 characters" class="form-control width-x-large" id="'+t+'-funder" name="funders['+e+'].funder" value=""></div></div><div class="column-half"><div class="form-group"><input type="number" min="0" class="form-control width-x-large" id="'+t+'-funderBudget" name="funders['+e+'].funderBudget" value=""><input required="required" type="hidden" id="'+t+'-coFunder" name="funders['+e+'].coFunder" value="true"><button class="buttonlink" name="remove-funder" value="'+e+'" data-remove-row="cofunder">Remove</button></div></div></div>';jQuery(".funder-row").last().after(n)},addGuidanceRow:function(){var e=jQuery("#guidance-table"),t=e.hasClass("assessed-guidance"),n=0,a=0;e.find("tbody tr").length&&(n=parseInt(e.find("tbody tr").length,10),a=parseInt(jQuery("tr[id^=guidance-]").last().attr("id").split("guidance-")[1],10)+1);var i='<tr id="guidance-'+a+'">';i+=t?'<td class="form-group"><label class="form-label" for="guidancerow-'+a+'-scorefrom"><span class="visuallyhidden">Score from</span></label><input required="required" type="number" min="0" class="form-control width-small" data-required-errormessage="Please enter a from score." data-min-errormessage="Please enter a valid number." id="guidancerow-'+a+'-scorefrom" name="guidanceRows['+n+'].scoreFrom" value=""></td><td class="form-group"><label class="form-label" for="guidancerow-'+a+'-scoreto"><span class="visuallyhidden">Score to</span></label><input required="required" type="number" min="0" class="form-control width-small" value="" data-required-errormessage="Please enter a to score." data-min-errormessage="Please enter a valid number." id="guidancerow-'+a+'-scoreto" name="guidanceRows['+n+'].scoreTo" value=""></td>':'<td class="form-group"><label class="form-label" for="guidancerow-'+a+'-subject"><span class="visuallyhidden">Subject</span></label><input required="required" class="form-control width-small" data-maxlength-errormessage="Subject has a maximum length of 255 characters." data-required-errormessage="Please enter a subject." id="guidancerow-'+a+'-subject" name="question.guidanceRows['+n+'].subject" value=""></td>',i+='<td class="form-group"><label class="form-label" for="guidancerow-'+a+'-justification"><span class="visuallyhidden">Justification</span></label><textarea required="required" rows="3" class="form-control width-full" data-maxlength-errormessage="Justification has a maximum length of 255 characters." data-required-errormessage="Please enter a justification." id="guidancerow-'+n+'-justification" name="'+(t?"":"question.")+"guidanceRows["+n+'].justification"></textarea></td><td><button class="buttonlink alignright remove-guidance-row" name="remove-guidance-row" data-remove-row="guidance" value="'+n+'">Remove</button></td>',i+="</tr>",e.find("tbody").append(i)},reindexRows:function(e){jQuery(e+" [name]").each(function(){var t=jQuery(this);if(t.prop("name").indexOf("[")!==-1){var n=t.closest(e).index(e),a=t.attr("name"),i=a.split("[")[0],o=a.split("]")[1];t.prop("name",i+"["+n+"]"+o)}}),jQuery(e+" [data-remove-row]").each(function(){var t=jQuery(this),n=t.closest(e).index(e);t.val(n)})},initEditor:function(e){var t=IFS.core.editor.prepareEditorHTML(e),n=jQuery.extend(!0,{},IFS.core.editor.settings.editorOptions,{plugins:{hallolink:{}}});jQuery(t).hallo(n)}}}(),IFS.competitionManagement.various=function(){"use strict";var e;return{settings:{fundingDecisionSelects:".funding-decision",assessorFeedbackButton:"#publish-assessor-feedback",noJsAssessorFeedbackButton:"#publish-assessor-feedback-no-js",submitFundingDecisionButton:"#publish-funding-decision",noJsSubmitFundingDecisionButton:"#no-js-notify-applicants",noJsSaveFundingDecisionButton:"#no-js-save-funding-decision",fundingDecisionForm:"#submit-funding-decision-form"},init:function(){e=this.settings,jQuery(document).on("change",e.fundingDecisionSelects,IFS.competitionManagement.various.handleFundingDecisionEnableOrDisable),IFS.competitionManagement.various.handleFundingDecisionEnableOrDisable(),IFS.competitionManagement.various.alterSubmitDecisionFormAction()},disableFundingDecisonButton:function(){var t=jQuery(e.submitFundingDecisionButton),n=t.attr("data-js-modal");t.on("click",function(e){e.preventDefault()}),t.removeAttr("data-js-modal").attr({"data-js-modal-disabled":n,"aria-disabled":"true"}).addClass("disabled")},enableFundingDecisionButton:function(){var t=jQuery(e.submitFundingDecisionButton),n=t.attr("data-js-modal-disabled");t.off("click").removeAttr("data-js-modal-disabled aria-disabled").attr("data-js-modal",n).removeClass("disabled")},alterSubmitDecisionFormAction:function(){var t=jQuery(e.fundingDecisionForm),n=t.attr("action");t.attr("action",n+"submit")},allSelectsDecided:function(){var t=jQuery(e.fundingDecisionSelects);if(null===t||void 0===t||0===t.length)return!1;var n=!0;return t.each(function(){var e=jQuery(this).val(),t="Y"===e||"N"===e;t||(n=!1)}),n},handleFundingDecisionEnableOrDisable:function(){IFS.competitionManagement.various.allSelectsDecided()?IFS.competitionManagement.various.enableFundingDecisionButton():IFS.competitionManagement.various.disableFundingDecisonButton()}}}(),IFS.competitionManagement.fundingInformation=function(){"use strict";return{init:function(){jQuery("#generate-code").prop("type","button"),jQuery(document).on("click","#generate-code",function(){IFS.competitionManagement.fundingInformation.handleCompetitionCode(this)})},handleCompetitionCode:function(e){var t=jQuery(e),n=t.val(),a=t.closest(".form-group").find("input"),i=window.location.protocol+"//"+window.location.host+"/management/competition/setup/"+n+"/generateCompetitionCode";jQuery.ajaxProtected({type:"GET",url:i}).done(function(e){"undefined"!=typeof e&&("true"===e.success?(IFS.core.formValidation.setValid(a,IFS.core.formValidation.getErrorMessage(a,"required")),a.val(e.message),jQuery("body").trigger("updateSerializedFormState")):IFS.core.formValidation.setInvalid(a,e.message))})}}}(),IFS.competitionManagement.initialDetails=function(){"use strict";return{init:function(){jQuery("body.competition-management.competition-setup").on("change","#competitionTypeId",function(){IFS.competitionManagement.initialDetails.handleStateAid()}),IFS.competitionManagement.initialDetails.handleInnovationSector(!0),jQuery("body.competition-management.competition-setup").on("change",'[name="innovationSectorCategoryId"]',function(){IFS.competitionManagement.initialDetails.handleInnovationSector(!1)}),IFS.competitionManagement.initialDetails.disableAlreadySelectedOptions(),IFS.competitionManagement.initialDetails.handleInnovationArea(),IFS.competitionManagement.initialDetails.rebindInnovationAreas()},rebindInnovationAreas:function(){jQuery('.competition-management.competition-setup [name^="innovationAreaCategoryIds"]').unbind("change"),jQuery(".competition-management.competition-setup").on("change",'[name^="innovationAreaCategoryIds"]',function(){IFS.competitionManagement.initialDetails.handleInnovationArea(),IFS.competitionManagement.initialDetails.disableAlreadySelectedOptions(),IFS.competitionManagement.initialDetails.autosaveInnovationAreaIds()})},handleInnovationArea:function(){var e=jQuery('[data-add-row="innovationArea"]'),t=IFS.competitionManagement.initialDetails.hasAllInnovationArea();e.attr("aria-hidden",t),t&&(jQuery('[id*="innovation-row"]').not("#innovation-row-0").remove(),IFS.competitionManagement.initialDetails.disableAlreadySelectedOptions(),jQuery("#innovation-row-0 select").val("-1"),IFS.competitionManagement.initialDetails.autosaveInnovationAreaIds())},hasAllInnovationArea:function(){var e=!1;return jQuery('[name^="innovationAreaCategoryIds"]').each(function(t,n){if("-1"===jQuery(n).val())return e=!0,!1}),e},handleInnovationSector:function(e){var t=jQuery('[name="innovationSectorCategoryId"]').val();if("undefined"==typeof t||null===t){var n=jQuery('[name*="innovationAreaCategoryId"]');n.html('<option value="innovation sector" disabled="disabled" selected="selected">Please select an innovation sector first &hellip;</option>')}else{var a=window.location.protocol+"//"+window.location.host+"/management/competition/setup/getInnovationArea/"+t;jQuery.ajaxProtected({type:"GET",url:a}).done(function(t){e?IFS.competitionManagement.initialDetails.filterInnovationAreasPageLoad(t):(IFS.core.autoSave.fieldChanged('[name="innovationSectorCategoryId"]'),IFS.competitionManagement.initialDetails.fillInnovationAreas(t),jQuery(n).trigger("ifsValidate"))})}},disableAlreadySelectedOptions:function(){var e={};jQuery('[name*="innovationAreaCategoryId"]').each(function(){var t=jQuery(this),n=t.val(),a=t.prop("name");null!==n&&(e[a]=n)}),jQuery('[name*="innovationAreaCategoryId"]').find('[disabled]:not([value=""])').removeAttr("disabled").removeAttr("aria-hidden");for(var t in e)jQuery('[name*="innovationAreaCategoryId"]:not([name="'+t+'"]) option[value="'+e[t]+'"]').attr({disabled:"disabled","aria-hidden":"true"})},fillInnovationAreas:function(e){var t=jQuery('[name*="innovationAreaCategoryId"]');jQuery.each(t,function(){var t=jQuery(this);t.children().remove(),t.append('<option value="" disabled="disabled" selected="selected">Please select &hellip;</option>'),jQuery.each(e,function(){t.append('<option value="'+this.id+'">'+this.name+"</option>")})}),IFS.competitionManagement.initialDetails.autosaveInnovationAreaIds()},autosaveInnovationAreaIds:function(){var e=jQuery('[name="autosaveInnovationAreaIds"]'),t=jQuery.unique(jQuery.map(jQuery('[name*="innovationAreaCategoryId"]'),function(e){return jQuery(e).val()}));e.val(t.join()),IFS.core.autoSave.fieldChanged(e)},filterInnovationAreasPageLoad:function(e){e=jQuery.map(e,function(e){return'[value="'+e.id+'"]'}),e.push('[value=""]'),e=e.join(",");var t=jQuery('[name*="innovationAreaCategoryId"] option');t.not(e).remove()},handleStateAid:function(){var e=jQuery("#competitionTypeId").find('[value="'+jQuery("#competitionTypeId").val()+'"]').attr("data-stateaid");e="true"===e?"yes":"no",jQuery("#stateAid").attr("aria-hidden","false").find("p").html('<span class="'+e+'">'+e+"</span>")}}}(),IFS.competitionManagement.milestones=function(){"use strict";var e;return{settings:{milestonesForm:'[data-section="milestones"]'},init:function(){e=this.settings,jQuery(e.milestonesForm).on("change","input[data-date]",function(){IFS.competitionManagement.milestones.milestonesExtraValidation(),IFS.competitionManagement.milestones.milestonesSetFutureDate(jQuery(this))}),IFS.competitionManagement.milestones.mileStoneValidateOnPageLoad()},milestonesExtraValidation:function(){var t=jQuery(e.milestonesForm+" .form-control-error"),n=jQuery(e.milestonesForm+" input").filter(function(){return!this.value});0===t.length&&0===n.length&&jQuery(e.milestonesForm+" .error-summary").attr("aria-hidden","true")},mileStoneValidateOnPageLoad:function(){jQuery(e.milestonesForm+" .day input").each(function(e,t){var n=jQuery(t);0===e&&IFS.core.formValidation.checkDate(n),IFS.competitionManagement.milestones.milestonesSetFutureDate(n)})},milestonesSetFutureDate:function(e){setTimeout(function(){var t,n=e.closest("tr"),a=n.next("tr"),i=e.attr("data-date");if(t=n.find(".time select").length>0?n.find(".time option:selected").attr("data-time"):n.find(".time [data-time]").attr("data-time"),a.length&&(a.attr({"data-future-date":i+(void 0!==t?"-"+t:"")}),0!==jQuery.trim(i.length))){var o=a.find(".day input");IFS.core.formValidation.checkDate(o)}},0)}}}();
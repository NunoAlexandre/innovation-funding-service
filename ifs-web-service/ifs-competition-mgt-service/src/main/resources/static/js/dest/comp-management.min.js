if("undefined"==typeof IFS)var IFS={};IFS.competitionManagement={},IFS.competitionManagement.loadOrder={common:{init:function(){IFS.competitionManagement.stickyMenu.init(),IFS.competitionManagement.various.init()}},"competition-setup":{init:function(){IFS.competitionManagement.setup.init(),IFS.competitionManagement.repeater.init(),IFS.competitionManagement.milestones.init(),IFS.core.finance.init()}}},IFS.competitionManagement.repeater=function(){"use strict";var e;return{init:function(){e=this.settings,jQuery(document).on("click","[data-add-row]",function(){IFS.competitionManagement.repeater.handleAddRow(this)}),jQuery(document).on("click","[data-remove-row]",function(){IFS.competitionManagement.repeater.handleRemoveRow(this)})},handleAddRow:function(e){var t=jQuery(e).attr("data-add-row");switch(t){case"cofunder":IFS.competitionManagement.repeater.addCoFunder();break;case"guidance":IFS.competitionManagement.repeater.addGuidanceRow();break;case"innovationArea":IFS.competitionManagement.repeater.addInnovationAreaRow()}return jQuery("body").trigger("updateSerializedFormState"),!1},handleRemoveRow:function(e){var t=jQuery(e),n=t.attr("data-remove-row");switch(n){case"cofunder":jQuery('[name="removeFunder"]').val(t.val()),IFS.core.autoSave.fieldChanged('[name="removeFunder"]'),t.closest(".funder-row").remove(),IFS.competitionManagement.repeater.reindexRows(".funder-row"),jQuery("body").trigger("recalculateAllFinances");break;case"guidance":jQuery('[name="removeGuidanceRow"]').val(t.val()),IFS.core.autoSave.fieldChanged('[name="removeGuidanceRow"]'),t.closest("tr").remove(),IFS.competitionManagement.repeater.reindexRows('tr[id^="guidance-"]');break;case"innovationArea":jQuery('[name="removeArea"]').val(t.val()),IFS.core.autoSave.fieldChanged('[name="removeArea"]'),t.closest('[id^="innovation-row"]').remove(),IFS.competitionManagement.repeater.reindexRows('.form-group[id^="innovation-row"]')}},addInnovationAreaRow:function(){var e=jQuery('.form-group[id^="innovation-row"]'),t=e.length,n=parseInt(e.last().prop("id").split("innovation-row-")[1],10)+1,i=e.first().clone();i.removeClass("error"),i.find(".error-message").remove(),i.prop("id","innovation-row-"+n),i.find('[id^="innovationAreaCategoryId"]').prop("id","innovationAreaCategoryId-"+n),i.find('[for^="innovationAreaCategoryId"]').prop("for","innovationAreaCategoryId-"+n),i.find("[selected]").removeAttr("selected"),i.find("[disabled]").first().attr("selected",""),i.find(".form-label").children().addClass("visuallyhidden"),i.find("[name]").prop("name","innovationAreaCategoryIds["+t+"]").val(""),i.append('<button data-remove-row="innovationArea" value="'+t+'" class="buttonlink" type="button">Remove</button>'),e.last().after(i)},addCoFunder:function(){var e=0,t=0;jQuery(".funder-row").length&&(e=parseInt(jQuery(".funder-row").length,10),t=parseInt(jQuery(".funder-row[id^=funder-row-]").last().attr("id").split("funder-row-")[1],10)+1);var n='<div class="grid-row funder-row" id="funder-row-'+t+'"><div class="column-half"><div class="form-group"><input type="text" maxlength="255" data-maxlength-errormessage="Funders has a maximum length of 255 characters" class="form-control width-x-large" id="'+t+'-funder" name="funders['+e+'].funder" value=""></div></div><div class="column-half"><div class="form-group"><input type="number" min="0" class="form-control width-x-large" id="'+t+'-funderBudget" name="funders['+e+'].funderBudget" value=""><input required="required" type="hidden" id="'+t+'-coFunder" name="funders['+e+'].coFunder" value="true"><button class="buttonlink" name="remove-funder" value="'+e+'" data-remove-row="cofunder">Remove</button></div></div></div>';jQuery(".funder-row").last().after(n)},addGuidanceRow:function(){var e=jQuery("#guidance-table"),t=e.hasClass("assessed-guidance"),n=0,i=0;e.find("tbody tr").length&&(n=parseInt(e.find("tbody tr").length,10),i=parseInt(jQuery("tr[id^=guidance-]").last().attr("id").split("guidance-")[1],10)+1);var a='<tr id="guidance-'+i+'">';a+=t?'<td class="form-group"><label class="form-label" for="guidancerow-'+i+'-scorefrom"><span class="visuallyhidden">Score from</span></label><input required="required" type="number" min="0" class="form-control width-small" data-required-errormessage="Please enter a from score." data-min-errormessage="Please enter a valid number." id="guidancerow-'+i+'-scorefrom" name="guidanceRows['+n+'].scoreFrom" value=""></td><td class="form-group"><label class="form-label" for="guidancerow-'+i+'-scoreto"><span class="visuallyhidden">Score to</span></label><input required="required" type="number" min="0" class="form-control width-small" value="" data-required-errormessage="Please enter a to score." data-min-errormessage="Please enter a valid number." id="guidancerow-'+i+'-scoreto" name="guidanceRows['+n+'].scoreTo" value=""></td>':'<td class="form-group"><label class="form-label" for="guidancerow-'+i+'-subject"><span class="visuallyhidden">Subject</span></label><input required="required" class="form-control width-small" data-maxlength-errormessage="Subject has a maximum length of 255 characters." data-required-errormessage="Please enter a subject." id="guidancerow-'+i+'-subject" name="question.guidanceRows['+n+'].subject" value=""></td>',a+='<td class="form-group"><label class="form-label" for="guidancerow-'+i+'-justification"><span class="visuallyhidden">Justification</span></label><textarea required="required" rows="3" class="form-control width-full" data-maxlength-errormessage="Justification has a maximum length of 255 characters." data-required-errormessage="Please enter a justification." id="guidancerow-'+n+'-justification" name="'+(t?"":"question.")+"guidanceRows["+n+'].justification"></textarea></td><td><button class="buttonlink alignright remove-guidance-row" name="remove-guidance-row" data-remove-row="guidance" value="'+n+'">Remove</button></td>',a+="</tr>",e.find("tbody").append(a)},reindexRows:function(e){jQuery(e+" [name]").each(function(){var t=jQuery(this),n=t.closest(e).index(e),i=t.attr("name"),a=i.split("[")[0],o=i.split("]")[1];t.attr("name",a+"["+n+"]"+o)}),jQuery(e+" [data-remove-row]").each(function(){var t=jQuery(this),n=t.closest(e).index(e);t.val(n)})}}}(),IFS.competitionManagement.stickyMenu=function(){"use strict";var e,t,n={};return{settings:{menu:jQuery(".info-area"),container:".competition-data form",breakpoint:1200},init:function(){t=this.settings,IFS.competitionManagement.stickyMenu.getWindowWidth(),IFS.competitionManagement.stickyMenu.getMenuHeight(),IFS.competitionManagement.stickyMenu.getContainerHeight(),IFS.competitionManagement.stickyMenu.stickyEnabled()&&(IFS.competitionManagement.stickyMenu.getMenuWidth(),IFS.competitionManagement.stickyMenu.getMenuOffset(),IFS.competitionManagement.stickyMenu.getContainerOffset(),IFS.competitionManagement.stickyMenu.menuPxToPercentage()),jQuery(window).resize(function(){clearTimeout(e),e=setTimeout(function(){IFS.competitionManagement.stickyMenu.getMenuHeight(),IFS.competitionManagement.stickyMenu.getMenuWidth(),IFS.competitionManagement.stickyMenu.getContainerHeight(),IFS.competitionManagement.stickyMenu.getWindowWidth(),IFS.competitionManagement.stickyMenu.menuPxToPercentage(),IFS.competitionManagement.stickyMenu.stickyScroll()},250)}),jQuery(document).scroll(function(){IFS.competitionManagement.stickyMenu.stickyScroll()})},getWindowWidth:function(){n.windowWidth=jQuery(window).width()},getMenuOffset:function(){n.menuOffsetTop=t.menu.offset().top},getMenuWidth:function(){n.menuWidth=t.menu.width()},getMenuHeight:function(){n.menuHeight=t.menu.outerHeight()},getContainerHeight:function(){n.containerHeight=jQuery(t.container).outerHeight(!0)},getContainerOffset:function(){n.containerOffsetTop=jQuery(t.container).offset().top},stickyEnabled:function(){return t.breakpoint<n.windowWidth&&n.menuHeight<n.containerHeight},menuPxToPercentage:function(){n.menuPercentage=parseFloat(n.menuWidth/n.windowWidth*100).toFixed(2)},stickyScroll:function(){if(IFS.competitionManagement.stickyMenu.stickyEnabled()){var e=jQuery(document).scrollTop();if(n.menuHeight+e>n.containerHeight+n.containerOffsetTop){var i=n.containerHeight+n.containerOffsetTop-n.menuHeight;t.menu.addClass("bottom").removeClass("sticky").css({top:i+"px",width:n.menuPercentage+"%"})}else n.menuOffsetTop<e?t.menu.addClass("sticky").css({top:"0",width:n.menuPercentage+"%"}).removeClass("bottom"):t.menu.removeClass("sticky bottom").removeAttr("style")}else t.menu.removeClass("sticky bottom").removeAttr("style")}}}(),IFS.competitionManagement.various=function(){"use strict";var e;return{settings:{fundingDecisionSelects:".funding-decision",assessorFeedbackButton:"#publish-assessor-feedback",noJsAssessorFeedbackButton:"#publish-assessor-feedback-no-js",submitFundingDecisionButton:"#publish-funding-decision",noJsSubmitFundingDecisionButton:"#no-js-notify-applicants",noJsSaveFundingDecisionButton:"#no-js-save-funding-decision",fundingDecisionForm:"#submit-funding-decision-form"},init:function(){e=this.settings,jQuery(document).on("change",e.fundingDecisionSelects,IFS.competitionManagement.various.handleFundingDecisionEnableOrDisable),IFS.competitionManagement.various.handleFundingDecisionEnableOrDisable(),IFS.competitionManagement.various.alterSubmitDecisionFormAction()},disableFundingDecisonButton:function(){var t=jQuery(e.submitFundingDecisionButton),n=t.attr("data-js-modal");t.on("click",function(e){e.preventDefault()}),t.removeAttr("data-js-modal").attr({"data-js-modal-disabled":n,"aria-disabled":"true"}).addClass("disabled")},enableFundingDecisionButton:function(){var t=jQuery(e.submitFundingDecisionButton),n=t.attr("data-js-modal-disabled");t.off("click").removeAttr("data-js-modal-disabled aria-disabled").attr("data-js-modal",n).removeClass("disabled")},alterSubmitDecisionFormAction:function(){var t=jQuery(e.fundingDecisionForm),n=t.attr("action");t.attr("action",n+"submit")},allSelectsDecided:function(){var t=jQuery(e.fundingDecisionSelects);if(null===t||void 0===t||0===t.length)return!1;var n=!0;return t.each(function(){var e=jQuery(this).val(),t="Y"===e||"N"===e;t||(n=!1)}),n},handleFundingDecisionEnableOrDisable:function(){IFS.competitionManagement.various.allSelectsDecided()?IFS.competitionManagement.various.enableFundingDecisionButton():IFS.competitionManagement.various.disableFundingDecisonButton()}}}(),IFS.competitionManagement.setup=function(){"use strict";var e;return{init:function(){e=this.settings,IFS.competitionManagement.setup.handleCompetitionCode(),jQuery("body.competition-management.competition-setup").on("change","#competitionTypeId",function(){IFS.competitionManagement.setup.handleStateAid()}),IFS.competitionManagement.setup.handleInnovationSector(!0),jQuery("body.competition-management.competition-setup").on("change",'[name="innovationSectorCategoryId"]',function(){IFS.competitionManagement.setup.handleInnovationSector(!1)})},handleCompetitionCode:function(){jQuery(document).on("click","#generate-code",function(){var e=jQuery(this),t=e.val(),n=e.closest(".form-group").find("input"),i=window.location.protocol+"//"+window.location.host+"/management/competition/setup/"+t+"/generateCompetitionCode";return jQuery.ajaxProtected({type:"GET",url:i}).done(function(e){"undefined"!=typeof e&&("true"===e.success?(IFS.core.formValidation.setValid(n,IFS.core.formValidation.getErrorMessage(n,"required")),n.val(e.message),jQuery("body").trigger("updateSerializedFormState")):IFS.core.formValidation.setInvalid(n,e.message))}),!1})},handleInnovationSector:function(e){var t=jQuery('[name="innovationSectorCategoryId"]').val();if(null===t){var n=jQuery('[name^="innovationAreaCategoryIds"]');n.html('<option value="innovation sector" disabled="disabled" selected="selected">Please select an innovation sector first &hellip;</option>')}else{var i=window.location.protocol+"//"+window.location.host+"/management/competition/setup/getInnovationArea/"+t;jQuery.ajaxProtected({type:"GET",url:i}).done(function(t){e?IFS.competitionManagement.setup.filterInnovationAreasPageLoad(t):(IFS.competitionManagement.setup.fillInnovationAreas(t),jQuery(n).trigger("ifsValidate"),IFS.core.autoSave.fieldChanged('[name="innovationAreaCategoryId"]'))})}},fillInnovationAreas:function(e){var t=jQuery('[name^="innovationAreaCategoryIds"]');jQuery.each(t,function(){var t=jQuery(this);t.children().remove(),t.append('<option value="" disabled="disabled" selected="selected">Please select &hellip;</option>'),jQuery.each(e,function(){t.append('<option value="'+this.id+'">'+this.name+"</option>")}),IFS.core.autoSave.fieldChanged(this)})},filterInnovationAreasPageLoad:function(e){e=jQuery.map(e,function(e){return'[value="'+e.id+'"]'}),e.push('[value=""]'),e=e.join(",");var t=jQuery('[name^="innovationAreaCategoryIds"] option');t.not(e).remove()},handleStateAid:function(){var e=jQuery("#competitionTypeId").find('[value="'+jQuery("#competitionTypeId").val()+'"]').attr("data-stateaid");e="true"==e?"yes":"no",jQuery("#stateAid").attr("aria-hidden","false").find("p").html('<span class="'+e+'">'+e+"</span>")}}}(),IFS.competitionManagement.milestones=function(){"use strict";var e;return{settings:{milestonesForm:'[data-section="milestones"]'},init:function(){e=this.settings,jQuery(e.milestonesForm).on("change","input[data-date]",function(){IFS.competitionManagement.milestones.milestonesExtraValidation(),IFS.competitionManagement.milestones.milestonesSetFutureDate(jQuery(this))}),IFS.competitionManagement.milestones.mileStoneValidateOnPageLoad()},milestonesExtraValidation:function(){var t=jQuery(e.milestonesForm+" .field-error"),n=jQuery(e.milestonesForm+" input").filter(function(){return!this.value});0===t.length&&0===n.length&&jQuery(e.milestonesForm+" .error-summary").attr("aria-hidden","true")},mileStoneValidateOnPageLoad:function(){jQuery(e.milestonesForm+" .day input").each(function(e,t){var n=jQuery(t);0===e&&IFS.core.formValidation.checkDate(n,!0),IFS.competitionManagement.milestones.milestonesSetFutureDate(n)})},milestonesSetFutureDate:function(e){setTimeout(function(){var t=e.closest("tr").next("tr"),n=e.attr("data-date");if(t.length&&(t.attr({"data-future-date":n}),0!==jQuery.trim(n.length))){var i=t.find(".day input");IFS.core.formValidation.checkDate(i,!0)}},0)}}}();
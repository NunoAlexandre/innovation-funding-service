<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <div th:include="fragments/layout :: head" th:with="pageTitle='Spend Profile Summary'" th:remove="tag" />
</head>
<body th:with="context='comp-management'" class="competition-management finance-checks-overview">
<div th:include="fragments/modals :: modal-overlay" th:remove="tag"/>

<div th:include="fragments/layout :: body-start" th:remove="tag" />
<div th:include="fragments/layout :: global-header" th:remove="tag" />

<main id="content">
  <div th:include="fragments/layout :: main-content-start" th:remove="tag" />
  <div th:include="fragments/layout :: header-sub" th:with="linkTitle='Competition Dashboard',linkClass='link-back',linkUrl=@{/competition/{competitionId}/status(competitionId=${model.financeCheckSummaryResource.competitionId})}" th:remove="tag" />

  <div class="grid-row">
      <div class="column-two-thirds">
          <div class="page-title">
              <div th:include="fragments/competition-management :: competition-id-simple(${model.financeCheckSummaryResource.competitionId})" th:remove="tag" />
              <h1 class="heading-xlarge" th:text="${model.financeCheckSummaryResource.competitionName}" />
          </div>
      </div>
      <div class="column-third alignright extra-margin">
          <h2 class="bold-small blue-block">Finance Checks</h2>
      </div>
  </div>
  <hr/>

  <div th:if="${model.showSpendProfilesGeneratedMessage}" class="success-alert">
      <p><strong th:text="|The finance checks have been approved and profiles generated. ${model.financeCheckSummaryResource.spendProfileGeneratedBy}, ${#temporals.format(model.financeCheckSummaryResource.spendProfileGeneratedDate, 'd MMMM yyyy')}|">Generated by</strong></p>
  </div>

  <h3 class="heading-medium">Overview</h3>
  <table class="table-overview">
    <thead>
      <tr>
        <th scope="col">Start date</th>
        <th scope="col">Duration</th>
        <th scope="col" class="numeric">Total project cost</th>
        <th scope="col" class="numeric">Grant applied for</th>
        <th scope="col" class="numeric">Other public sector funding</th>
        <th scope="col" class="numeric">Total % grant</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td th:text="${#temporals.format(model.financeCheckSummaryResource.projectStartDate, 'd MMM yyyy')}" />
        <td th:text="${model.financeCheckSummaryResource.durationInMonths+' months'}" />
        <td class="numeric">&pound; <th:block th:text="${#numbers.formatInteger(model.financeCheckSummaryResource.totalProjectCost,1,'COMMA')}" /></td>
        <td class="numeric">&pound; <th:block th:text="${#numbers.formatInteger(model.financeCheckSummaryResource.grantAppliedFor,1,'COMMA')}" /></td>
        <td class="numeric">&pound; <th:block th:text="${#numbers.formatInteger(model.financeCheckSummaryResource.otherPublicSectorFunding,1,'COMMA')}" /></td>
        <td th:text="${#numbers.formatInteger(model.financeCheckSummaryResource.totalPercentageGrant,1,'NONE')+'%'}" class="numeric" />
      </tr>
    </tbody>
  </table>
  <h3 class="heading-medium">Progress</h3>
  <table class="table-progress">
      <thead>
        <tr>
          <th scope="col">Organisation</th>
          <th scope="col">Viability</th>
          <th scope="col">Eligibility</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="orgDetails, status : ${model.financeCheckSummaryResource.partnerStatusResources}">
            <th scope="row" th:text="${orgDetails.name}" />
            <td>
                <a th:if="${!orgDetails.viability.notApplicable}" th:href="@{/project/{projectId}/finance-check/organisation/{organisationId}/viability(projectId=${model.financeCheckSummaryResource.projectId},organisationId=${orgDetails.id})}"
                   th:text="${#messages.msg('ifs.project.setup.viability.' + orgDetails.viability)}"
                   th:classappend="${'viability-' + status.index}"/>

                <span th:if="${orgDetails.viability.notApplicable}"
                      th:text="${#messages.msg('ifs.project.setup.viability.' + orgDetails.viability)}"
                      th:classappend="${'viability-' + status.index}"></span>
            </td>
            <td><a th:href="@{/project/{projectId}/finance-check/organisation/{organisationId}(projectId=${model.financeCheckSummaryResource.projectId},organisationId=${orgDetails.id})}"
                   th:text="${#messages.msg('ifs.project.setup.eligibility.' + orgDetails.eligibility)}"
                   th:classappend="${'eligibility-' + status.index}"/></td>
        </tr>
      </tbody>
  </table>

    <form method="POST" th:action="@{/project/{projectId}/finance-check/generate(projectId=${model.financeCheckSummaryResource.projectId})}" th:if="${model.showEnabledGenerateSpendProfilesButton or model.showDisabledGenerateSpendProfilesButton}">
        <h3 class="heading-medium">Generate spend profile</h3>
        <p>To get your spend profile, both viability and eligibility sections above must be approved for all partners.</p>
        <p>This will then create individual flat profile spends for partners. Partners can edit their profile spends during the course of the project.</p>

        <button th:if="${model.showDisabledGenerateSpendProfilesButton}" disabled="disabled" class="button" >Generate Spend Profile</button>
        <a th:unless="${model.showDisabledGenerateSpendProfilesButton}" th:href="@{/project/{projectId}/finance-check/generate/confirm(projectId=${model.financeCheckSummaryResource.projectId})}" data-js-modal="generate-spend-profile" class="button" >Generate Spend Profile</a>
        <th:block th:unless="${model.showDisabledGenerateSpendProfilesButton}"  th:include="fragments/modals :: generate-spend-profile" />
    </form>

    <div th:include="fragments/layout :: main-content-end" th:remove="tag" />
</main>

<div th:include="fragments/layout :: footer" th:remove="tag" />
<div th:include="fragments/layout :: body-end" th:remove="tag" />

</body>
</html>

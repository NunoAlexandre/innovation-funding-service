<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <th:block th:insert="fragments/layout :: head" th:with="pageTitle='Spend Profile Summary'" />
</head>
<body th:with="context='project-management'" class="competition-management finance-checks-overview">
<th:block th:insert="fragments/modals :: modal-overlay" />

<th:block th:insert="fragments/layout :: body-start" />
<th:block th:insert="fragments/layout :: global-header" />

<main id="content">
  <th:block th:insert="fragments/layout :: main-content-start" />
  <th:block th:insert="fragments/layout :: header-sub" th:with="linkTitle='Projects in setup',linkClass='link-back',linkUrl=@{/competition/{competitionId}/status(competitionId=${model.financeCheckSummaryResource.competitionId})}" />

  <div class="grid-row">
      <div class="column-two-thirds">
          <div class="page-title">
              <th:block th:insert="fragments/competition-management :: competition-id-and-name(${model.financeCheckSummaryResource.competitionId}, ${model.financeCheckSummaryResource.competitionName})" />
              <h1 class="heading-xlarge">Finance checks</h1>
          </div>
      </div>
      <div class="column-third alignright extra-margin">
          <h2 class="bold-small blue-block">Finance checks</h2>
      </div>
  </div>

    <h2 class="heading-medium"><th:block th:text="${model.financeCheckSummaryResource.projectId}"/> : <th:block th:text="${model.financeCheckSummaryResource.projectName}"/></h2>

    <hr/>

  <div th:if="${model.showSpendProfilesGeneratedMessage}" class="success-alert">
      <p><strong th:text="|The finance checks have been approved and profiles generated. ${model.financeCheckSummaryResource.spendProfileGeneratedBy}, ${#temporals.format(model.financeCheckSummaryResource.spendProfileGeneratedDate, 'd MMMM yyyy')}|">Generated by</strong></p>
  </div>

    <th:block th:insert="project/financecheck/fragments/finance :: project-finance-overview(overview=${model.financeCheckSummaryResource})" />
    <th:block th:with="showResearchParticipation=${true},
                maxResearchPercentage=${model.financeCheckSummaryResource.competitionMaximumResearchPercentage},
                researchParticipationPercentage=${model.financeCheckSummaryResource.researchParticipationPercentage}"
              th:insert="project/financecheck/fragments/finance :: research_participation" />
    <h3 class="heading-medium">Progress</h3>
  <table class="table-progress extra-margin-bottom">
      <thead>
        <tr>
          <th scope="col">Organisation</th>
          <th scope="col" class="aligncentre">Viability</th>
          <th scope="col" class="aligncentre cell-border-right">RAG</th>
          <th scope="col" class="aligncentre">Eligibility</th>
          <th scope="col" class="aligncentre">RAG</th>
          <th scope="col" class="aligncentre">Queries raised</th>
          <th scope="col" class="aligncentre">Notes</th>
        </tr>
      </thead>
      <tbody>
        <tr th:each="orgDetails, status : ${model.financeCheckSummaryResource.partnerStatusResources}">
            <th scope="row" th:text="${orgDetails.name}" />
            <td class="aligncentre">
                <a th:if="${!orgDetails.viability.notApplicable}" th:href="@{/project/{projectId}/finance-check/organisation/{organisationId}/viability(projectId=${model.financeCheckSummaryResource.projectId},organisationId=${orgDetails.id})}"
                   th:text="${#messages.msg('ifs.project.setup.viability.' + orgDetails.viability)}"
                   th:classappend="${'viability-' + status.index}"/>

                <span th:if="${orgDetails.viability.notApplicable}"
                      th:text="${#messages.msg('ifs.project.setup.viability.' + orgDetails.viability)}"
                      th:classappend="${'viability-' + status.index}"></span>
            </td>
            <td class="aligncentre cell-border-right">
                <span th:if="${orgDetails.viability.notApplicable}"
                      th:text="${#messages.msg('ifs.project.setup.viability.' + orgDetails.viability)}"
                      th:classappend="${'viability-rag-' + status.index}"></span>
                <span th:unless="${orgDetails.viability.notApplicable}"
                      th:text="${#messages.msg('ifs.project.setup.rag.' + orgDetails.viabilityRagStatus)}"
                      th:classappend="${'viability-rag-' + status.index}">Green</span>
            </td>
            <td class="aligncentre">
                <!--/*TODO INFUND-6716 redirect to eligibility page*/-->
                <a th:href="@{/project/{projectId}/finance-check/organisation/{organisationId}(projectId=${model.financeCheckSummaryResource.projectId},organisationId=${orgDetails.id})}"
                   th:text="${#messages.msg('ifs.project.setup.eligibility.' + orgDetails.eligibility)}"
                   th:classappend="${'eligibility-' + status.index}"/>
            </td>
            <td class="aligncentre cell-border-right">
                <span th:text="${#messages.msg('ifs.project.setup.rag.' + orgDetails.eligibilityRagStatus)}"
                      th:classappend="${'eligibility-rag-' + status.index}">Green</span>
            </td>
            <td class="aligncentre">
                <a th:href="@{/project/{projectId}/finance-check/organisation/{organisationId}/query(projectId=${model.financeCheckSummaryResource.projectId},organisationId=${orgDetails.id})}"
                   th:text="${orgDetails.isAwaitingResponse() ? 'Awaiting response' : 'View'}"/>
            </td>
            <td class="aligncentre">
                <a th:href="@{/project/{projectId}/finance-check/organisation/{organisationId}/note(projectId=${model.financeCheckSummaryResource.projectId},organisationId=${orgDetails.id})}">View</a>
            </td>
        </tr>
      </tbody>
  </table>

    <a th:href="@{/project/{projectId}/finance-check-overview(projectId=${model.financeCheckSummaryResource.projectId})}">Project finance overview</a>

    <form method="POST" th:action="@{/project/{projectId}/finance-check/generate(projectId=${model.financeCheckSummaryResource.projectId})}" th:if="${model.showEnabledGenerateSpendProfilesButton or model.showDisabledGenerateSpendProfilesButton}">
        <h3 class="heading-medium">Generate spend profile</h3>
        <p>To get your spend profile, both viability and eligibility sections must be approved for all partners.</p>
        <p>This will generate flat spend profiles. Partners can edit their spend profiles during the course of the project.</p>

        <button th:if="${model.showDisabledGenerateSpendProfilesButton}" disabled="disabled" class="button generate-spend-profile-main-button">Generate spend profile</button>
        <a th:unless="${model.showDisabledGenerateSpendProfilesButton}" th:href="@{/project/{projectId}/finance-check/generate/confirm(projectId=${model.financeCheckSummaryResource.projectId})}" data-js-modal="generate-spend-profile" class="button generate-spend-profile-main-button">Generate spend profile</a>
        <th:block th:unless="${model.showDisabledGenerateSpendProfilesButton}"  th:include="fragments/modals :: generate-spend-profile" />
    </form>

    <th:block th:insert="fragments/layout :: main-content-end" />
</main>

<th:block th:insert="fragments/layout :: footer" />
<th:block th:insert="fragments/layout :: body-end" />

</body>
</html>

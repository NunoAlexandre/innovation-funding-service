<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <th:block th:insert="fragments/layout :: head" th:with="pageTitle='Finance Checks'" />
</head>
<body th:with="context='project-management'">
<th:block th:insert="fragments/modals :: modal-overlay" />

<th:block th:insert="fragments/layout :: body-start" />
<th:block th:insert="fragments/layout :: global-header" />

<main id="content">
    <th:block th:insert="fragments/layout :: main-content-start" />
    <th:block th:insert="fragments/layout :: header-sub" th:with="linkTitle='Finance checks',linkClass='link-back',linkUrl=@{/project/{projectId}/finance-check(projectId=${model.projectId})}" />


    <div class="grid-row">
      <div class="column-two-thirds">
        <div class="page-title">
          <p class="subtitle no-margin" th:text="|${model.competitionId}: ${model.competitionName}|" />
          <h1 class="heading-xlarge"><th:block th:text="${model.organisationName}" /> <small th:if="${model.isLeadPartner()}">Lead Partner</small></h1>
        </div>
      </div>
      <div class="column-third alignright extra-margin">
        <h2 class="bold-small blue-block">Eligibility</h2>
      </div>
    </div>

    <hr class="no-margin-top"/>
    <div class="success-alert" th:if="${model.showFinanceChecksApprovedMessage}" th:text="|The partner finance eligibility has been approved by ${model.approverName}, ${#temporals.format(model.approvalDate, 'd MMMM yyyy')}|" />

    <div class="error-summary" aria-hidden="true">
       <h2 class="heading-medium error-summary-heading">
          Some of your fields are invalid.
       </h2>
       Please review
       <ul class="error-summary-list">
           <li th:each="err : ${#fields.allErrors()}" th:text="${err}"></li>
       </ul>
   </div>

    <form th:object="${form}" th:action="@{${#ifsUtil.uriWithQueryString(#httpServletRequest)}}" method="post">
        <th:block th:unless="${model.usingJesFinances}">
            <h3 class="heading-medium">Finance contact</h3>
            <p>
                <th:block th:text="${model.financeContactName}">Dave Norman</th:block> <br />
                <a th:href="${'mailto:'+model.financeContactEmail}" th:text="${model.financeContactEmail}">dave@norman.com</a>
            </p>
            <h3 class="heading-medium">Project costs</h3>
            <p>Please enter final project costs below</p>
            <table class="finance-check-form">
                <thead>
                <tr>
                    <th scope="col" class="heading-small">Section</th>
                    <th scope="col" class="heading-small alignright" id="project-cost">Project costs</th>
                </tr>
                </thead>
                <tbody>
                <tr class="form-group-row">
                    <th scope="row" id="labour">Labour</th>
                    <td class="alignright">
                        <input th:unless="${model.financeChecksApproved}" type="number" class="form-control alignright" min="0" aria-labelledby="project-cost labour" th:attr="data-required-errormessage=#{validation.project.eligibility.cost.labour}" th:errorclass="field-error" required="required" name="costs[0].value" th:value="*{#numbers.formatInteger(costs[__0__].value,1,'NONE')}"/>
                        <th:block th:if="${model.financeChecksApproved}">
                            &pound;<th:block th:text="*{#numbers.formatInteger(costs[__0__].value,1,'COMMA')}" />
                        </th:block>
                    </td>
                </tr>
                <tr class="form-group-row">
                    <th scope="row" id="admin-support-costs">Overhead costs</th>
                    <td class="alignright">
                        <input th:unless="${model.financeChecksApproved}" type="number" class="form-control alignright" min="0" aria-labelledby="project-cost admin-support-costs" th:attr="data-required-errormessage=#{validation.project.eligibility.cost.overheads}" th:errorclass="field-error" required="required" name="costs[1].value" th:value="*{#numbers.formatInteger(costs[__1__].value,1,'NONE')}"/>
                        <th:block th:if="${model.financeChecksApproved}">
                            &pound;<th:block th:text="*{#numbers.formatInteger(costs[__1__].value,1,'COMMA')}" />
                        </th:block>
                    </td>
                </tr>
                <tr class="form-group-row">
                    <th scope="row" id="materials">Materials</th>
                    <td class="alignright">
                        <input th:unless="${model.financeChecksApproved}" type="number" class="form-control alignright" min="0" aria-labelledby="project-cost materials" th:attr="data-required-errormessage=#{validation.project.eligibility.cost.materials}" th:errorclass="field-error" required="required" name="costs[2].value" th:value="*{#numbers.formatInteger(costs[__2__].value,1,'NONE')}"/>
                        <th:block th:if="${model.financeChecksApproved}">
                            &pound;<th:block th:text="*{#numbers.formatInteger(costs[__2__].value,1,'COMMA')}" />
                        </th:block>
                    </td>
                </tr>
                <tr class="form-group-row">
                    <th scope="row" id="capital-usage">Capital usage</th>
                    <td class="alignright">
                        <input th:unless="${model.financeChecksApproved}" type="number" class="form-control alignright" min="0" aria-labelledby="project-cost capital-usage" th:attr="data-required-errormessage=#{validation.project.eligibility.cost.capitalusage}" th:errorclass="field-error" required="required"  name="costs[3].value" th:value="*{#numbers.formatInteger(costs[__3__].value,1,'NONE')}"/>
                        <th:block th:if="${model.financeChecksApproved}">
                            &pound;<th:block th:text="*{#numbers.formatInteger(costs[__3__].value,1,'COMMA')}" />
                        </th:block>
                    </td>
                </tr>
                <tr class="form-group-row">
                    <th scope="row" id="subcontracting-costs">Subcontracting costs</th>
                    <td class="alignright">
                        <input th:unless="${model.financeChecksApproved}" type="number" class="form-control alignright" min="0" aria-labelledby="project-cost subcontracting-costs" th:attr="data-required-errormessage=#{validation.project.eligibility.cost.subcontracting}" th:errorclass="field-error" required="required"  name="costs[4].value" th:value="*{#numbers.formatInteger(costs[__4__].value,1,'NONE')}" />
                        <th:block th:if="${model.financeChecksApproved}">
                            &pound;<th:block th:text="*{#numbers.formatInteger(costs[__4__].value,1,'COMMA')}" />
                        </th:block>
                    </td>
                </tr>
                <tr class="form-group-row">
                    <th scope="row" id="travel-subsistence">Travel and subsistence</th>
                    <td class="alignright">
                        <input th:unless="${model.financeChecksApproved}" type="number" class="form-control alignright" min="0" aria-labelledby="project-cost travel-subsistence" th:attr="data-required-errormessage=#{validation.project.eligibility.cost.travelsubsistence}" th:errorclass="field-error" required="required"  name="costs[5].value" th:value="*{#numbers.formatInteger(costs[__5__].value,1,'NONE')}"/>
                        <th:block th:if="${model.financeChecksApproved}">
                            &pound;<th:block th:text="*{#numbers.formatInteger(costs[__5__].value,1,'COMMA')}" />
                        </th:block>
                    </td>
                </tr>
                <tr class="form-group-row">
                    <th scope="row" id="other-costs">Other costs</th>
                    <td class="alignright">
                        <input th:unless="${model.financeChecksApproved}" type="number" class="form-control alignright" min="0" aria-labelledby="project-cost other-costs" th:attr="data-required-errormessage=#{validation.project.eligibility.cost.other}" th:errorclass="field-error" required="required" name="costs[6].value" th:value="*{#numbers.formatInteger(costs[__6__].value,1,'NONE')}"/>
                        <th:block th:if="${model.financeChecksApproved}">
                            &pound;<th:block th:text="*{#numbers.formatInteger(costs[__6__].value,1,'COMMA')}" />
                        </th:block>
                    </td>
                </tr>
                </tbody>
                <tfoot>
                <tr>
                    <th scope="row" class="heading-small">
                        Total project costs
                    </th>
                    <td class="heading-small alignright" data-calculation-operations="+" data-calculation-fields=".finance-check-form tbody input[type='number']" >
                        &pound; <th:block th:text="${#numbers.formatInteger(form.getTotalCost(),1,'COMMA')}"/>
                    </td>
                </tr>
                </tfoot>
            </table>
        </th:block>

        <th:block th:if="${model.usingJesFinances}">
            <h2 class="heading-medium">Academic finances</h2>
            <p>These finances were originally submitted at the application stage in Je-S.</p>
            <div class="upload-section">
              <h3 class="heading-small no-margin">Download Je-S form:</h3>
              <a th:href="@{/project/{projectId}/finance-check/organisation/{organisationId}/jes-file(projectId=${model.projectId}, organisationId=${model.organisationId})}"
                 class="uploaded-file" th:text="${model.jesFileDetails?.filename}">The-uploaded-file-example.pdf</a>
            </div>
        </th:block>

        <th:block th:if="${model.showApproveButton}">
            <th:block th:unless="${model.usingJesFinances}">
              <h3 class="heading-medium">Eligible costs</h3>
              <p>After any required alterations have been made, eligible costs should be approved.</p>
              <p>Changes should be reviewed and understood by the partner before they are approved.</p>
              <div class="form-group">
                  <label class="block-label selection-button-checkbox" for="costs-reviewed">
                      <input id="costs-reviewed" value="costs-reviewed" type="checkbox" data-switches-button-status="#approve-eligibility" />
                      These finances have been reviewed and are eligible for this project
                  </label>
              </div>
              <button data-js-modal="approve-eligibility-modal" id="approve-eligibility" name="approve" class="button" type="button">Approve eligible costs</button>
              <hr />
              <button class="button button-secondary extra-margin">Save and return to finance checks</button>
            </th:block>

            <th:block th:if="${model.usingJesFinances}">
              <h3 class="heading-medium">Approve eligibility</h3>
              <p>After review finance checks should be approved.</p>
              <div class="form-group">
                  <label class="block-label selection-button-checkbox" for="costs-reviewed">
                      <input id="costs-reviewed" value="costs-reviewed" type="checkbox" data-switches-button-status="#approve-eligibility" />
                       <th:block th:text="${model.organisationName}" /> finances are eligible for this project
                  </label>
              </div>
              <button data-js-modal="approve-eligibility-modal" id="approve-eligibility" name="approve" class="button" type="button">Approve finances</button>
              <hr />
              <button class="button button-secondary extra-margin">Return to finance checks</button>
            </th:block>

            <th:block th:insert="fragments/modals :: approve-eligibility-modal" />
        </th:block>
    </form>
    <th:block th:unless="${model.showApproveButton}">
      <hr/>
      <a class="button button-secondary" th:href="@{/project/{projectId}/finance-check(projectId=${model.projectId})}">Return to finance checks</a>
    </th:block>


    <th:block th:insert="fragments/layout :: main-content-end" />
</main>

<th:block th:insert="fragments/layout :: footer" />
<th:block th:insert="fragments/layout :: body-end" />
</body>
</html>

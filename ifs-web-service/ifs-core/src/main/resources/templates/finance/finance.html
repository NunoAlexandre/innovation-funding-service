<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">

    <!-- ===========================Form: finance =========================== -->
    <div th:fragment="finance">
        <div th:class="form-group"
             th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ organisationgrantClaimPercentageId +'-grantClaimPercentage]}')}? 'error'">

            <label class="form-label form-label-bold" for="cost-financegrantclaim">
                <div th:text="${question.name}" />
                <span class="form-hint" th:text="${question.description}" />
                <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+organisationgrantClaimPercentageId+'-grantClaimPercentage'})" th:remove="tag" />
            </label>

            <div th:include="question-type/form-elements :: form-guidance (guidable=${question})" th:remove="tag"/>
            <input type="number"
                   min="0"
                   th:max="${organisationFinanceSize?.getMaxGrantClaimPercentage()}"
                   th:readonly="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
                   th:class="${organisationFinanceSize?.getMaxGrantClaimPercentage() != null and organisationFinanceSize?.getMaxGrantClaimPercentage() &lt; organisationGrantClaimPercentage} ? 'width-small form-control field-error' : 'width-small form-control'"
                   id="cost-financegrantclaim"
                   th:name="${'finance-grantclaimpercentage-' + question.id + '-' + organisationgrantClaimPercentageId}"
                   th:value="${organisationGrantClaimPercentage}"
                   data-max-errormessage="This field should be %max%% or lower"
                    />
            <span>%</span>
        </div>
    </div>

    <!-- ===========================Form: organisation_size =========================== -->
    <div th:fragment="organisation_size" th:if="${organisationType?.name == 'Business'}" th:remove="tag">
        <div class="form-group">
            <fieldset>
                <legend>
                    <span class="form-label form-label-bold" th:text="${question.name}"/>
                    <div th:include="question-type/form-elements :: form-hint (hint=${question.getDescription()})" th:remove="tag" />
                    <div th:include="question-type/form-elements :: form-validation-messages (id=${formInput.getId()})" th:remove="tag" />
                </legend>
                <div th:include="question-type/form-elements :: form-guidance (guidable=${question})" th:remove="tag" />

                <label class="block-label" th:each="size : ${T(com.worth.ifs.user.domain.OrganisationSize).values()}">
                    <input type="radio"  th:disabled="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
                           th:id="'financePosition-organisationSize-'+${size}"
                           th:name="'financePosition-organisationSize'"
                           th:value="${size}"
                           th:checked="${size == organisationFinanceSize}"/>
                    <span th:text="${size.name}" />
                </label>
            </fieldset>
        </div>

    </div>

    <!-- ===========================Form: your_finance =========================== -->
    <div th:fragment="your_finance" th:remove="tag">
        <h2 class="heading-medium no-margin" th:text="${#strings.replace(question.name,'{organisationName}',userOrganisation.name)}" />
        <p ifs:utext="${question.description}" />

        <section class="collapsible" th:each="subSection : ${subSections.get(currentSectionId)}" th:if="${subSections !=null}">
            <h2>
                <span th:text="${subSection.getName()}" th:remove="tag" />
                <span th:attr="data-mirror='#section-total-'+${subSection.id}" />
            </h2>
            <div th:remove="tag" th:each="question : ${subsectionQuestions.get(subSection.id)}">
                <div th:remove="tag" th:each="formInput, status : ${subSectionQuestionFormInputs.get(question.id)}">
                    <div th:replace="finance/finance :: ${formInput.formInputTypeTitle} (complete=${(readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id)))} ? 'complete' : '')" th:with="formInputIndex=(${status.index})" />
                    <div th:replace="question-type/types :: ${formInput.formInputTypeTitle} (complete=${(readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id)))} ? 'complete' : '')" th:with="formInputIndex=(${status.index})" />
                </div>
            </div>
        </section>
        <div class="grid-row total-cost">
            <div class="column-half">
                <label for="total-cost" class="heading-medium">'<span th:text="${userOrganisation.name}" th:remove="tag"></span>' Total project costs</label>
            </div>
            <div class="column-half alignright">
                <input type="text"
                       id="total-cost"
                       readonly="readonly"
                       class="heading-medium width-full alignright"
                       data-calculation-fields="[id*=section-total]"
                       data-calculation-operations="+"
                       th:value="'£ ' + ${#numbers.formatDecimal(organisationFinanceTotal, 0, 'COMMA', 0, 'POINT')}"/>
            </div>
        </div>
    </div>

    <!-- ===========================Form: labour =========================== -->
    <div th:fragment="labour (complete)" th:remove="tag">
        <div th:remove="tag" th:with="formInputType=${formInput.formInputType},costCategory=${organisationFinance.get(T(com.worth.ifs.finance.resource.cost.CostType).fromString(formInput.formInputTypeTitle))},type=${formInput.formInputTypeTitle}">
            <div class="form-group" th:attr="data-repeatable-container=${question.getId()}" th:if="${costCategory!=null}">
                <div class="form-group inline"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costCategory.workingDaysPerYearCostItem?.id +']}')} ? 'error' : ''">
                    <label th:for="${'cost-labour-'+costCategory.workingDaysPerYearCostItem?.id+'-labourDaysYearly'}">
                        <span>Working Days per Year</span>
                        <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costCategory.workingDaysPerYearCostItem?.id})" th:remove="tag" />
                    </label>
                    <input type="number"
                           class="form-control"
                           th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costCategory.workingDaysPerYearCostItem?.id +']}')} ? 'field-error' : ''"
                           th:id="${'cost-labour-'+costCategory.workingDaysPerYearCostItem?.id+'-labourDaysYearly'}"
                           th:name="${type + '-labourDaysYearly-' + question.id + '-' + costCategory.workingDaysPerYearCostItem?.id}"
                           th:value="${costCategory.workingDaysPerYear}"
                           th:readonly="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
                           min="0"
                           max="365"
                           />
                </div>

                <div class="form-group">
                    <table class="labour-costs-table">
                        <thead>
                        <tr>
                            <th id="labour-role" scope="col" class="width-medium">Role within project</th>
                            <th id="labour-salary" scope="col" class="numeric">Gross Annual Salary</th>
                            <th id="labour-rate" scope="col" class="numeric">Rate (£/day)</th>
                            <th id="labour-days" scope="col" class="numeric width-medium">Days to be spent by all staff at this grade</th>
                            <th scope="col"  th:unless="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
                                <span class="visuallyhidden">Actions</span>
                            </th>
                        </tr>
                        </thead>
                        <tbody>
                        <div th:each="cost, iteration : ${costCategory.costs}" th:remove="tag">
                            <div th:include="finance/finance :: labour_row" th:with="iterationIndex=${iteration.count}" th:remove="tag"/>
                        </div>
                        </tbody>
                    </table>
                    <p class="alignright" th:unless="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
                    <div th:include="question-type/types :: add_row(text='Add another role', question=${question},rowcontainer='.labour-costs-table tbody')" th:remove="tag"/>
                    </p>
                </div>
                <div class="form-group alignright inline">
                    <label th:for="${'section-total-'+subSection.id}">Total labour costs</label>
                    <input class="form-control form-control-1-4"
                           data-calculation-fields="[id*=labourTotalCost]"
                           data-calculation-operations="+"
                           th:attr="data-calculation-rawvalue=${costCategory.getTotal()}"
                           readonly="readonly"
                           type="text"
                           th:id="${'section-total-'+subSection.id}"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}" />
                </div>
            </div>
        </div>
    </div>


    <div th:fragment="labour_row" th:remove="tag">

        <tr th:id="${'cost-'+cost.id}" th:attr="data-repeatable-row=${cost.id}">
            <td class="form-group"   th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-role]}')} ? 'error' : ''">
                <label th:for="${'cost-labour-'+cost.id+'-role'}">
                    <span class="visuallyhidden">Role within project</span>
                    <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-role'})" th:remove="tag" />
                </label>
                <input type="text"
                       class="form-control width-full"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-role]}')} ? field-error : ''"
                       th:name="${type +'-role-' + question.id + '-' + cost.id}"
                       th:id="${'cost-labour-'+cost.id+'-role'}"
                       th:value="${cost.getRole()}"
                       th:readonly="${complete == 'complete'}"
                       required="required"
                        />
            </td>
            <td class="numeric form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-grossAnnualSalary]}')} ? 'error' : ''">
                <label th:for="${'cost-labour-'+cost.id+'-labourGrossSalary'}">
                    <span class="visuallyhidden">Gross Annual Salary</span>
                    <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-grossAnnualSalary'})" th:remove="tag" />
                </label>
                <input type="number"
                       class="form-control width-full"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+cost.id+'-grossAnnualSalary]}')} ? field-error : ''"
                       th:name="${type +'-grossAnnualSalary-' + question.id + '-' + cost.id}"
                       th:id="${'cost-labour-'+cost.id+'-labourGrossSalary'}"
                       th:readonly="${complete == 'complete'}"
                       th:value="${#numbers.formatDecimal(cost.grossAnnualSalary,0,0)}"
                       min="0"
                        />
            </td>
            <td class="numeric">
                <label th:for="${'cost-labour-'+cost.id+'-labourRate'}">
                    <span class="visuallyhidden">Rate (&pound;/day)</span>
                </label>
                <input type="text"
                       class="form-control width-full"
                       th:attr="data-calculation-fields=${'#cost-labour-'+cost.id+'-labourGrossSalary,#cost-labour-'+costCategory.workingDaysPerYearCostItem?.id+'-labourDaysYearly'},data-calculation-rawValue=${costCategory?.workingDaysPerYear != null ? cost.getRate(costCategory.workingDaysPerYear) : 0}"
                       data-calculation-operations="/"
                       readonly="readonly"
                       th:id="${'cost-labour-'+cost.id+'-labourRate'}"
                       th:name="${type + '-labourRate-' + question.id + '-' + cost.id}"
                       th:value="${costCategory?.workingDaysPerYear != null ? '£ '+#numbers.formatDecimal(cost.getRate(costCategory.workingDaysPerYear),0,0) : '£ 0'}"
                       />
            </td>
            <td class="numeric form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-labourDays]}')} ? 'error' : ''">
                <label th:for="${'cost-labour-'+cost.id+'-labourDays'}">
                    <span class="visuallyhidden">Days to be spent by all staff at this grade</span>
                    <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-labourDays'})" th:remove="tag" />
                </label>
                <input type="number"
                       class="form-control width-full"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+cost.id+'-labourDays]}')} ? field-error : ''"
                       th:readonly="${complete == 'complete'}"
                       th:id="${'cost-labour-'+cost.id+'-labourDays'}"
                       th:name="${type + '-labourDays-' + question.id + '-' + cost.id}"
                       th:value="${cost.labourDays}"
                       required="required"
                       min="0"
                        />
            </td>
            <td rowspan="2" class="rowspan" th:unless="${complete == 'complete'}">
                <button type="submit"
                        name="remove_cost"
                        class="buttonlink js-remove-row"
                        th:value="${cost.id}"
                        th:attrappend="formaction='&#35;question-'+${question.getId()}">Remove
                </button>
            </td>
        </tr>
        <tr th:attr="data-repeatable-row=${cost.id}">
            <td colspan="4" class="numeric colspan">
                <label th:for="${'cost-labour-'+cost.id+'-labourTotalCost'}"><span>Total costs</span></label>
                <input type="text"
                       class="form-control width-medium"
                       data-calculation-operations="/,*"
                       th:name="${type +'-total-' + question.id + '-' + cost.id}"
                       readonly="readonly"
                       th:id="${'cost-labour-'+cost.id+'-labourTotalCost'}"
                       th:attr="data-calculation-fields=${'#cost-labour-'+cost.id+'-labourGrossSalary,#cost-labour-'+costCategory.workingDaysPerYearCostItem?.id+'-labourDaysYearly,#cost-labour-'+cost.id+'-labourDays'},data-calculation-rawvalue=${cost.getTotal(costCategory.workingDaysPerYear)}"
                       th:value="'£ ' + ${#numbers.formatDecimal(cost.getTotal(costCategory.workingDaysPerYear), 0, 'COMMA', 0, 'POINT')}" />
            </td>

        </tr>
    </div>

    <!-- ===========================Form: overheads =========================== -->
    <div th:fragment="overheads" th:remove="tag">
        <p th:text="${question.getDescription()}" />
        <div th:remove="tag" th:with="formInputType=${formInput.formInputType},costCategory=${organisationFinance.get(T(com.worth.ifs.finance.resource.cost.CostType).fromString(formInput.formInputTypeTitle))},type=${formInput.formInputTypeTitle}">
            <div th:remove="tag" th:with="overheadCosts=${costCategory?.costs?.isEmpty()} ? null : ${costCategory?.costs[0]}, overheadRate=${overheadCosts?.rateType==null} ? ${T(com.worth.ifs.finance.resource.cost.OverheadRateType).NONE} : ${T(com.worth.ifs.finance.resource.cost.OverheadRateType).valueOf(overheadCosts?.rateType)}" >
                <fieldset>
                    <legend class="visuallyhidden">Overhead costs</legend>
                    <div class="form-group">
                        <label class="block-label" th:for="${'cost-'+ type + '-'+overheadCosts?.id+'-rateType_0'}" data-target="overhead-none">
                            <input th:id="${'cost-'+ type + '-'+overheadCosts?.id+'-rateType_0'}"
                                   type="radio"
                                   th:name="${'overheads-rateType-' + question.id + '-'+ overheadCosts?.id}"
                                   th:value="${T(com.worth.ifs.finance.resource.cost.OverheadRateType).NONE}"
                                   th:checked="${overheadRate.equals(T(com.worth.ifs.finance.resource.cost.OverheadRateType).NONE)}"
                                   th:disabled="${!(overheadRate.equals(T(com.worth.ifs.finance.resource.cost.OverheadRateType).NONE)) and (readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id)))}"/>
                            No administration support funding
                        </label>
                        <label class="block-label" th:for="${'cost-'+ type + '-'+overheadCosts?.id+'-rateType_1'}"  data-target="overhead-default-percentage">
                            <input th:id="${'cost-'+ type + '-'+overheadCosts?.id+'-rateType_1'}"
                                   type="radio"
                                   th:name="${'overheads-rateType-' + question.id + '-'+ overheadCosts?.id}"
                                   th:value="${T(com.worth.ifs.finance.resource.cost.OverheadRateType).DEFAULT_PERCENTAGE}"
                                   th:checked="${overheadRate.equals(T(com.worth.ifs.finance.resource.cost.OverheadRateType).DEFAULT_PERCENTAGE)}"
                                   th:disabled="${!(overheadRate.equals(T(com.worth.ifs.finance.resource.cost.OverheadRateType).DEFAULT_PERCENTAGE)) and (readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id)))}" />
                            20% of labour costs
                        </label>
                        <label class="block-label" th:for="${'cost-'+ type + '-'+overheadCosts?.id+'-rateType_2'}"  data-target="overhead-custom-percentage">
                            <input th:id="${'cost-'+ type + '-'+overheadCosts?.id+'-rateType_2'}"
                                   type="radio"
                                   th:name="${'overheads-rateType-' + question.id + '-'+ overheadCosts?.id}"
                                   th:value="${T(com.worth.ifs.finance.resource.cost.OverheadRateType).CUSTOM_RATE}"
                                   th:checked="${overheadRate.equals(T(com.worth.ifs.finance.resource.cost.OverheadRateType).CUSTOM_RATE)}"
                                   th:disabled="${!(overheadRate.equals(T(com.worth.ifs.finance.resource.cost.OverheadRateType).CUSTOM_RATE)) and (readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id)))}"/>
                            Custom administration support cost
                        </label>
                        <label class="block-label" th:for="${'cost-'+ type + '-'+overheadCosts?.id+'-rateType_3'}" data-target="overhead-special-rate">
                            <input th:id="${'cost-'+ type + '-'+overheadCosts?.id+'-rateType_3'}"
                                   type="radio"
                                   th:name="${'overheads-rateType-' + question.id + '-'+overheadCosts?.id}"
                                   th:value="${T(com.worth.ifs.finance.resource.cost.OverheadRateType).SPECIAL_AGREED_RATE}"
                                   th:checked="${overheadRate.equals(T(com.worth.ifs.finance.resource.cost.OverheadRateType).SPECIAL_AGREED_RATE)}"
                                   th:disabled="${!(overheadRate.equals(T(com.worth.ifs.finance.resource.cost.OverheadRateType).SPECIAL_AGREED_RATE)) and (readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id)))}"/>
                            Special rate agreed with Innovate UK
                        </label>
                    </div>
                </fieldset>


                <div id="overhead-none">
                    <h3 class="heading-medium">No Administration support cost funding</h3>
                    <p>You are not currently applying for administration support cost funding</p>
                    <input type="hidden" value="£ 0" data-calculation-rawvalue="0" id="section-total-10-labour-cost-none"/>

                </div>
                <div id="overhead-default-percentage">
                    <h3 class="heading-medium">20% of labour costs</h3>
                    <div class="form-group alignright inline">
                        <label th:for="${'section-total-'+subSection.id+'-default'}">
                            <span>Total administration support cost</span>
                        </label>
                        <input type="text"
                               th:name="${'overheads-totalCosts-' + question.id + '-'+overheadCosts?.id}"
                               class="form-control form-control-1-4 alignright"
                               readonly="readonly"
                               th:id="${'section-total-'+subSection.id+'-default'}"
                               th:attr="data-calculation-fields='#section-total-9,0.2',data-calculation-rawvalue=${overheadCosts?.getTotal()}"
                               data-calculation-operations="*"
                               th:value="${overheadRate.equals(T(com.worth.ifs.finance.resource.cost.OverheadRateType).DEFAULT_PERCENTAGE)} ? '£ ' + ${#numbers.formatDecimal(costCategory?.getTotal(),0, 'COMMA', 0, 'POINT')} : '£ 0'"
                                />
                    </div>
                </div>

                <div id="overhead-custom-percentage">
                    <h3 class="heading-medium">Custom administration support costs</h3>
                    <p>For this Beta service only -  For details on how to calculate your custom administration support costs, please contact Innovate UK via email at <a href="mailto:support@innovateuk.gov.uk"><strong>support@innovateuk.gov.uk</strong></a> or phone <strong>0300 321 4357</strong>.
                        We will assist you in calculating a unique rate based upon your organisation details.
                    </p>
                    <div class="form-group alignright inline" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ overheadCosts?.id +'-rate]}')} ? 'error' : ''">
                        <label th:for="${'cost-'+ type + '-'+overheadCosts?.id+'-customRate'}">
                          <span>Rate calculated (%)</span>
                          <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+overheadCosts?.id+'-rate'})" th:remove="tag" />
                        </label>
                        <input type="number"
                               th:readonly="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
                               th:name="${'overheads-customRate-' + question.id + '-'+overheadCosts?.id}"
                               th:id="${'cost-'+ type + '-'+overheadCosts?.id+'-customRate'}"
                               data-calculation-input="overhead-rate"
                               min="0"
                               max="100"
                               class="form-control form-control-1-4 alignright"
                               th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ overheadCosts?.id +'-rate]}')} ? 'field-error' : ''"
                               th:value="${overheadCosts?.getRate()!=null and overheadRate.equals(T(com.worth.ifs.finance.resource.cost.OverheadRateType).CUSTOM_RATE)} ? ${overheadCosts?.getRate()} : 0" />
                    </div>
                    <div class="form-group alignright inline">
                        <label th:for="${'section-total-'+subSection.id+'-custom'}">
                          <span>Total administration support cost</span>
                        </label>
                        <input type="text"
                               th:name="${'overheads-totalCosts-' + question.id + '-'+overheadCosts?.id}"
                               class="form-control form-control-1-4 alignright"
                               readonly="readonly"
                               th:id="${'section-total-'+subSection.id+'-custom'}"
                               th:attr="data-calculation-fields='#section-total-9,100,#'+${'cost-'+ type + '-'+overheadCosts?.id+'-customRate'},data-calculation-rawvalue=${overheadCosts?.getTotal()}"
                               data-calculation-operations="/,*"
                               th:value="${overheadRate.equals(T(com.worth.ifs.finance.resource.cost.OverheadRateType).CUSTOM_RATE)} ? '£ ' + ${#numbers.formatDecimal(costCategory?.getTotal(),0, 'COMMA', 0, 'POINT')} : '£ 0'"/>
                    </div>
                </div>

                <div id="overhead-special-rate">
                    <h3 class="heading-medium">Special rate agreed with Innovate UK</h3>
                    <p>You should only use this section if you have previously agreed a rate of admin support cost funding with Innovate UK's project finance team. If this project is granted funding then you will need to justify this rate before the project can begin.</p>
                    <div class="form-group alignright inline"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ overheadCosts?.id +'-rate]}')} ? 'error' : ''">
                        <label th:for="${'cost-'+ type + '-'+overheadCosts?.id+'-agreedRate'}">
                          <span>Rate agreed with Innovate UK (%)</span>
                          <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+overheadCosts?.id+'-rate'})" th:remove="tag" />
                        </label>
                        <input type="number"
                               th:readonly="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
                               th:name="${'overheads-agreedRate-' + question.id + '-' + overheadCosts?.id}"
                               th:id="${'cost-'+ type + '-'+overheadCosts?.id+'-agreedRate'}"
                               data-calculation-input="overhead-agreedRate"
                               min="0"
                               max="100"
                               class="form-control form-control-1-4 alignright"
                               th:value="${overheadCosts?.getRate()!=null and overheadRate.equals(T(com.worth.ifs.finance.resource.cost.OverheadRateType).SPECIAL_AGREED_RATE)} ? ${overheadCosts?.getRate()} : 0"
                               th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ overheadCosts?.id +'-rate]}')} ? 'field-error' : ''" />
                    </div>
                    <div class="form-group alignright inline">
                        <label th:for="${'section-total-'+subSection.id+'-special'}">
                          <span>Total overhead costs</span>
                        </label>
                        <input type="text"
                               th:name="${'overheads-totalCosts-' + question.id + '-' + overheadCosts?.id}"
                               class="form-control form-control-1-4 alignright"
                               readonly="readonly"
                               th:id="${'section-total-'+subSection.id+'-special'}"
                               th:attr="data-calculation-fields='#section-total-9,100,#'+${'cost-'+ type + '-'+overheadCosts?.id+'-agreedRate'},data-calculation-rawvalue=${overheadCosts?.getTotal()}"
                               data-calculation-operations="/,*"
                               th:value="${overheadRate.equals(T(com.worth.ifs.finance.resource.cost.OverheadRateType).SPECIAL_AGREED_RATE)} ? '£ ' + ${#numbers.formatDecimal(costCategory?.total,0, 'COMMA', 0, 'POINT')} : '£ 0'"
                                />

                    </div>
                </div>
            </div>
        </div>
    </div>

    <!-- ===========================Form: materials =========================== -->
    <div th:fragment="materials" th:remove="tag">
        <p th:text="${question.getDescription()}"></p>
        <div th:attr="data-repeatable-container=${question.getId()}" th:with="formInputType=${formInput.formInputType},costCategory=${organisationFinance.get(T(com.worth.ifs.finance.resource.cost.CostType).fromString(formInput.formInputTypeTitle))}">
            <div class="form-group">
                <table id="material-costs-table">
                    <thead>
                    <tr>
                        <th id="materials-item" scope="col">Item</th>
                        <th id="materials-quantity" scope="col" class="numeric">Quantity</th>
                        <th id="materials-cost" scope="col" class="numeric">Cost Per Item</th>
                        <th id="materials-total" scope="col" class="numeric">Total</th>
                        <th scope="col" th:unless="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
                            <span class="visuallyhidden">Actions</span>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    <div th:each="cost, iteration : ${costCategory.costs}" th:with="formInputType=${formInput.formInputType},type=${formInput.formInputTypeTitle}" th:remove="tag">
                        <div th:include="finance/finance :: materials_row" th:with="iterationIndex=${iteration.count}" th:remove="tag"/>
                    </div>
                    </tbody>
                </table>

                <p class="alignright" th:unless="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
                <div th:include="question-type/types :: add_row(text='Add another materials cost', question=${question},rowcontainer='#material-costs-table tbody')" th:remove="tag"/>
                </p>
            </div>
            <div class="form-group alignright inline">
                <label th:for="${'section-total-'+subSection.id}">Total materials costs</label>
                <input class="form-control alignright form-control-1-4"
                       readonly="readonly" type="text"
                       data-calculation-fields="[id*=materialTotal]"
                       data-calculation-operations="+"
                       th:id="${'section-total-'+subSection.id}"
                       th:attr="data-calculation-rawvalue=${costCategory.total}"
                       th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" />

            </div>
        </div>
    </div>
    <!-- =========================== repeating rows - Materials  =========================== -->

    <div th:fragment="materials_row" th:remove="tag">
        <tr th:id="${'cost-'+cost.id}" th:attr="data-repeatable-row=${cost.id}">
            <td class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-item]}')} ? 'error' : ''">
                <label th:for="${'cost-materials-'+cost.id+'-item'}">
                    <span class="visuallyhidden">Item</span>
                    <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-item'})" th:remove="tag" />
                </label>
                <input type="text"
                       class="form-control width-full"
                       th:name="${type +'-item-' + question.id + '-' + cost.id}"
                       th:id="${'cost-materials-'+cost.id+'-item'}"
                       th:value="${cost.getItem()}"
                       th:readonly="${complete == 'complete'}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-item]}')} ? 'field-error' : ''"
                       required="required" />
            </td>
            <td class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-quantity]}')} ? 'error' : ''">
              <label th:for="${'cost-materials-'+cost.id+'-quantity'}">
                  <span class="visuallyhidden">Quantity</span>
                  <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-quantity'})" th:remove="tag" />
              </label>
                <input type="number"
                       class="form-control width-full"
                       th:name="${type +'-quantity-' + question.id + '-' + cost.id}"
                       th:id="${'cost-materials-'+cost.id+'-quantity'}"
                       th:value="${cost.getQuantity()}"
                       th:readonly="${complete == 'complete'}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-quantity]}')} ? 'field-error' : ''"
                       min="1"/>
            </td>
            <td class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-cost]}')} ? 'error' : ''">
                <label th:for="${'cost-materials-'+cost.id+'-cost'}">
                    <span class="visuallyhidden">Cost Per Item</span>
                    <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-cost'})" th:remove="tag" />
                </label>
                <input type="number"
                       class="form-control width-full"
                       th:name="${type +'-cost-' + question.id + '-' + cost.id}"
                       th:id="${'cost-materials-'+cost.id+'-cost'}"
                       th:value="${#numbers.formatDecimal(cost.getCost(),0,0)}"
                       th:readonly="${complete == 'complete'}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-cost]}')} ? 'field-error' : ''"
                       min="0" />
            </td>
            <td>
              <label th:for="${'cost-materials-'+cost.id+'-materialTotal'}">
                  <span class="visuallyhidden">Total</span>
              </label>
                <input type="text"
                       class="alignright form-control width-full"
                       th:name="${type +'-total-' + question.id + '-' + cost.id}"
                       th:attr="data-calculation-fields='#'+${'cost-materials-'+cost.id+'-quantity'}+',#'+${'cost-materials-'+cost.id+'-cost'},data-calculation-rawvalue=${cost.total}"
                       th:id="${'cost-materials-'+cost.id+'-materialTotal'}"
                       data-calculation-operations="*"
                       readonly="readonly"
                       th:value="'£ ' + ${#numbers.formatDecimal(cost.total, 0, 0)}"
                        />
            </td>
            <td class="alignright remove" th:unless="${complete == 'complete'}">
                <button type="submit"
                        name="remove_cost"
                        th:value="${cost.id}"
                        th:class="'buttonlink js-remove-row'"
                        th:attrappend="formaction='&#35;question-'+${question.getId()}">Remove
                </button>
            </td>
        </tr>

    </div>

    <!-- ===========================Form: capital usage =========================== -->
    <div th:fragment="capital_usage" th:remove="tag">
        <p th:text="${question.getDescription()}"></p>
        <div th:remove="tag" th:with="formInputType=${formInput.formInputType},costCategory=${organisationFinance.get(T(com.worth.ifs.finance.resource.cost.CostType).fromString(formInput.formInputTypeTitle))},type=${formInput.formInputTypeTitle}">
            <div id="capital_usage">
                <div th:each="cost : ${costCategory.costs}" th:remove="tag">
                    <div th:include="finance/finance :: capital_usage_row" th:remove="tag"/>
                </div>
            </div>
            <p class="alignright" th:unless="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
            <div th:include="question-type/types :: add_row(text='Add another asset', question=${question},rowcontainer='#capital_usage')" th:remove="tag"/>
            </p>
            <div class="form-group alignright inline">
                <label th:for="${'section-total-'+subSection.id}">Total capital usage costs</label>
                <input class="form-control form-control-1-4" readonly="readonly" type="text"
                       th:id="${'section-total-'+subSection.id}"
                       data-calculation-fields="[id*=netCost]"
                       data-calculation-operations="+"
                       th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" />
            </div>
        </div>
    </div>

    <!-- ===========================Form: capital usage repeating row =========================== -->

    <div th:fragment="capital_usage_row" th:remove="tag">
        <div th:id="${'cost-'+cost.id}" th:attr="data-repeatable-row=${cost.id}" class="form-row">
            <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-item]}')} ? 'error' : ''">
                <label th:for="${'cost-capital_usage-'+cost.id+'-item'}">
                    <span>Item description</span>
                    <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-item'})" th:remove="tag" />
                  </label>
                <div th:include="question-type/form-elements :: form-finance-textarea (type=${type}, id=${cost.id}, name='item', value=${cost.getDescription()},readonly=${complete == 'complete'},required=false)" th:remove="tag" />
            </div>
            <div class="form-group">

                <fieldset class="inline">
                    <legend>New or existing item</legend>
                    <label class="block-label">
                        <input th:id="${'cost-capital_usage-'+cost.id+'-existing_0'}"
                               type="radio"
                               th:name="${type +'-existing-' + question.id + '-' + cost.id}"
                               value="New"
                               th:checked="${cost.existing == 'New'}"
                               th:disabled="${complete == 'complete'}">
                        New
                        </input>
                    </label>
                    <label class="block-label">
                        <input th:id="${'cost-capital_usage-'+cost.id+'-existing_1'}"
                               type="radio"
                               th:name="${type +'-existing-' + question.id + '-' + cost.id}"
                               value="Existing"
                               th:checked="${cost.existing == 'Existing'}"
                               th:disabled="${complete == 'complete'}">
                        Existing
                        </input>
                    </label>
                </fieldset>
            </div>

            <div class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-deprecation]}')} ? 'error' : ''">
                <label th:for="${'cost-capital_usage-'+cost.id+'-deprecation_period'}" class="form-label">
                    <span>Depreciation period (months)</span>
                    <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-deprecation'})" th:remove="tag" />
                </label>
                <input  type="number"
                        th:id="${'cost-capital_usage-'+cost.id+'-deprecation_period'}"
                        class="form-control form-finances-capital-usage-depreciation"
                        th:name="${type +'-deprecation_period-' + question.id + '-' +  cost.id}"
                        th:value="${cost.deprecation}"
                        th:readonly="${complete == 'complete'}"
                        min="0"
                        th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-deprecation]}')} ? 'field-error' : ''"
                         />
            </div>

            <div class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-npv]}')} ? 'error' : ''">
                <label th:for="${'cost-capital_usage-'+cost.id+'-npv'}" class="form-label">
                    <span>Net present value at the start of your project or the price you bought it for (£)</span>
                    <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-npv'})" th:remove="tag" />
                </label>
                <input
                        type="number"
                        th:id="${'cost-capital_usage-'+cost.id+'-npv'}"
                        class="form-control form-finances-capital-usage-npv"
                        th:name="${type +'-npv-' + question.id + '-' + cost.id}"
                        th:value="${#numbers.formatDecimal(cost.npv,0,0)}"
                        th:readonly="${complete == 'complete'}"
                        min="0"
                         th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-npv]}')} ? 'field-error' : ''" />

            </div>

            <div class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-residualValue]}')} ? 'error' : ''">
                <label th:for="${'cost-capital_usage-'+cost.id+'-residual_value'}" class="form-label">
                    <span>Residual value at end of project (£)</span>
                    <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-residualValue'})" th:remove="tag" />
                </label>
                <input
                        type="number"
                        th:id="${'cost-capital_usage-'+cost.id+'-residual_value'}"
                        class="form-control form-finances-capital-usage-residual-value"
                        th:name="${type +'-residual_value-' + question.id + '-' + cost.id}"
                        th:value="${#numbers.formatDecimal(cost.residualValue,0,0)}"
                        th:readonly="${complete == 'complete'}"
                        min="0"
                        th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-residualValue]}')} ? 'field-error' : ''"/>
            </div>

            <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-utilisation]}')} ? 'error' : ''">
                <label th:for="${'cost-capital_usage-'+cost.id+'-utilisation'}" class="form-label">
                    <span>Utilisation (%)</span>
                    <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-utilisation'})" th:remove="tag" />
                </label>
                <input type="number"
                       th:id="${'cost-capital_usage-'+cost.id+'-utilisation'}"
                       class="form-control form-finances-capital-usage-utilisation"
                       th:name="${type +'-utilisation-' + question.id + '-' + cost.id}"
                       th:value="${cost.utilisation}"
                       th:readonly="${complete == 'complete'}"
                       min="0"
                       max="100"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-utilisation]}')} ? 'field-error' : ''"/>
            </div>

            <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-netCost]}')} ? 'error' : ''">
                <label th:for="${'cost-capital_usage-'+cost.id+'-netCost'}" class="form-label">
                      <span>Net Cost</span>
                      <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-netCost'})" th:remove="tag" />
                </label>
                <input type="text"
                       class="form-control"
                       th:attr="data-calculation-fields=${'#cost-capital_usage-'+cost.id+'-npv,#cost-capital_usage-'+cost.id+'-residual_value,#cost-capital_usage-'+cost.id+'-utilisation,100'}"
                       data-calculation-operations="-,*,/"
                       readonly="readonly"
                       th:id="${'cost-capital_usage-'+cost.id+'-netCost'}"
                       th:name="${type + '-netCost-' + question.id + '-' + cost.id}"
                       th:value="'£ ' + ${#numbers.formatDecimal(cost.total, 0, 0)}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-netCost]}')} ? 'error' : ''" />
            </div>

            <button type="submit"
                    name="remove_cost"
                    class="buttonlink js-remove-row"
                    th:value="${cost.id}"
                    th:attrappend="formaction='&#35;question-'+${question.getId()}">Remove
            </button>
        </div>
    </div>

    <!-- ===========================Form: subcontracting cost =========================== -->
    <div th:fragment="subcontracting">
        <p th:text="${question.getDescription()}"></p>
        <div th:remove="tag" th:with="formInputType=${formInput.formInputType},costCategory=${organisationFinance.get(T(com.worth.ifs.finance.resource.cost.CostType).fromString(formInput.formInputTypeTitle))},type=${formInput.formInputTypeTitle}">

            <div id="subcontracting">
                <div th:each="cost : ${costCategory.costs}" th:remove="tag">
                    <div th:include="finance/finance :: subcontracting_row" th:remove="tag"/>
                </div>
            </div>


            <p class="alignright" th:unless="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
              <div th:include="question-type/types :: add_row(text='Add another subcontractor', question=${question},rowcontainer='#subcontracting')" th:remove="tag"/>
            </p>
            <div class="form-group alignright">
                <label th:for="${'section-total-'+subSection.id}">Total subcontracting costs</label>
                <input class="form-control form-control-1-4"
                       readonly="readonly"
                       type="text"
                       th:id="${'section-total-'+subSection.id}"
                       data-calculation-fields="[id*=subcontractingCost]"
                       data-calculation-operations="+"
                       th:attr="data-calculation-rawvalue=${costCategory.getTotal()}"
                       th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" />
            </div>
        </div>
    </div>

    <div th:fragment="subcontracting_row" th:remove="tag">
        <div class="form-row" th:id="${'cost-'+cost.id}" th:attr="data-repeatable-row=${cost.id}">
            <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-companyName]}')} ? 'error' : ''">
                <label class="form-label" th:for="${'cost-subcontracting-'+cost.id+'-companyName'}">
                    <span>Subcontractor name</span>
                </label>
                <input type="text"
                       th:name="${type +'-name-' + question.id + '-' +cost.id}"
                       class="form-control form-finances-subcontracting-company"
                       th:id="${'cost-subcontracting-'+cost.id+'-companyName'}"
                       th:value="${cost.name}"
                       th:readonly="${complete == 'complete'}"
                        th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-companyName]}')} ? 'field-error' : ''"  />
            </div>
            <div class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-country]}')} ? 'error' : ''">
                <label class="form-label" th:for="${'cost-subcontracting-'+cost.id+'-country'}">
                    <span>Country where the subcontractor will work</span>
                </label>
                <input type="text"
                       th:name="${type +'-country-' + question.id + '-' + cost.id}"
                       class="form-control"
                       th:id="${'cost-subcontracting-'+cost.id+'-country'}"
                       th:value="${cost.country}"
                       th:readonly="${complete == 'complete'}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-country]}')} ? 'field-error' : ''"   />
            </div>

            <div class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-role]}')} ? 'error' : ''">
                <label class="form-label" th:for="${'cost-'+ type + '-'+cost.id+'-role'}">
                  <span>Role of the subcontractor in the project and description of the work they’ll do</span>
                </label>

                <div th:include="question-type/form-elements :: form-finance-textarea (type=${type}, id=${cost.id}, name='role', value=${cost.role},readonly=${complete == 'complete'},required=false)" th:remove="tag" />
            </div>

            <div class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-cost]}')} ? 'error' : ''">
                <label class="form-label" th:for="${'cost-subcontracting-'+cost.id+'-subcontractingCost'}">
                      <span>Cost</span>
                      <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-cost'})" th:remove="tag" />
                  </label>
                <input type="number"
                       class="form-control"
                       data-calculation-input="subcontracting-cost-row"
                       th:name="${type +'-subcontractingCost-' + question.id + '-' + cost.id}"
                       th:id="${'cost-subcontracting-'+cost.id+'-subcontractingCost'}"
                       th:value="${#numbers.formatDecimal(cost.cost,0,0)}"
                       th:readonly="${complete == 'complete'}"
                       min="0"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-cost]}')} ? 'field-error' : ''"
                       />
            </div>
            <button th:unless="${complete == 'complete'}" type="submit"
                    name="remove_cost"
                    class="buttonlink js-remove-row"
                    th:value="${cost.id}"
                    th:attrappend="formaction='&#35;question-'+${question.getId()}">Remove
            </button>
        </div>

    </div>




    <!-- ===========================Form: travel cost =========================== -->
    <div th:fragment="travel">
        <p th:text="${question.description}"></p>
        <div th:attr="data-repeatable-container=${question.getId()}" th:with="formInputType=${formInput.formInputType},costCategory=${organisationFinance.get(T(com.worth.ifs.finance.resource.cost.CostType).fromString(formInput.formInputTypeTitle))},type=${formInput.formInputTypeTitle}">
            <div class="form-group">
                <table id="travel-costs-table">
                    <thead>
                    <tr>
                        <th id="travel-purpose">Purpose of journey or description of subsistence cost</th>
                        <th id="travel-times" class="numeric">Number of times</th>
                        <th id="travel-cost" class="numeric">Cost each (£)</th>
                        <th id="travel-total" class="numeric">Total (£)</th>
                        <th th:unless="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"><span class="visuallyhidden">Actions</span></th>
                    </tr>
                    </thead>
                    <tbody>
                    <div th:each="cost, iteration : ${costCategory.costs}">
                        <div th:include="finance/finance :: travel_row" th:with="iterationIndex=${iteration.count}" th:remove="tag"/>
                    </div>
                    </tbody>
                </table>

                <p class="alignright" th:unless="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
                <div th:include="question-type/types :: add_row(text='Add another travel cost', question=${question},rowcontainer='#travel-costs-table tbody')" th:remove="tag"/>
                </p>
            </div>
            <div class="form-group alignright inline">
                <label th:for="${'section-total-'+subSection.id}">Total travel &amp; subsistence costs</label>
                <input class="form-control form-control-1-4"
                       readonly="readonly"
                       type="text"
                       data-calculation-fields="[id*=travelCostTotal]"
                       data-calculation-operations="+"
                       th:id="${'section-total-'+subSection.id}"
                       th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}"
                       title="Total travel and subsistence costs" />
            </div>
        </div>
    </div>
    <!-- ===========================repeating rows : travel cost =========================== -->

    <div th:fragment="travel_row" th:remove="tag">
        <tr th:id="${'cost-'+cost.id}" th:attr="data-repeatable-row=${cost.id}">
              <td class="form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-item]}')} ? 'error' : ''">
                <label th:for="${'cost-'+type+'-'+cost.id+'-item'}">
                      <span class="visuallyhidden">Purpose of journey or description of subsistence cost</span>
                      <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-item'})" th:remove="tag" />
                </label>
                <input type="text"
                       th:name="${type +'-item-' + question.id + '-' + cost.id}"
                       class="form-control width-full"
                       th:id="${'cost-'+type+'-'+cost.id+'-item'}"
                       th:value="${cost.getItem()}"
                       th:readonly="${complete == 'complete'}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-item]}')} ? 'field-error' : ''"/>
            </td>
            <td class="numeric form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-quantity]}')} ? 'error' : ''">
                <label th:for="${'cost-'+type+'-'+cost.id+'-quantity'}">
                      <span class="visuallyhidden">Number of times</span>
                      <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-quantity'})" th:remove="tag" />
                </label>
                <input type="number"
                       th:name="${type +'-quantity-' + question.id + '-' + cost.id}"
                       class="form-control width-full"
                       th:id="${'cost-'+type+'-'+cost.id+'-quantity'}"
                       th:value="${cost.getQuantity()}"
                       th:readonly="${complete == 'complete'}"
                       min="0"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-quantity]}')} ? 'field-error' : ''"  />
            </td>
            <td class="numeric form-group"  th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-cost]}')} ? 'error' : ''">
                <label th:for="${'cost-'+type+'-'+cost.id+'-cost'}">
                      <span class="visuallyhidden">Cost each (&pound;)</span>
                      <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-cost'})" th:remove="tag" />
                </label>
                <input type="number"
                       th:name="${type +'-cost-' + question.id + '-' + cost.id}"
                       class="form-control width-full"
                       th:id="${'cost-'+type+'-'+cost.id+'-cost'}"
                       th:value="${#numbers.formatDecimal(cost.cost,0,0)}"
                       th:readonly="${complete == 'complete'}"
                       min="0"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-cost]}')} ? 'field-error' : ''" />
            </td>
            <td class="numeric">
                <label th:for="${'cost-'+type+'-'+cost.id+'-travelCostTotal'}">
                    <span class="visuallyhidden">Total (&pound;)</span>
                </label>
                <input type="text"
                       th:name="${type +'-travelCostTotal-' + question.id + '-' + cost.id}"
                       class="form-control width-full"
                       readonly="readonly"
                       th:id="${'cost-'+type+'-'+cost.id+'-travelCostTotal'}"
                       th:attr="data-calculation-fields='#'+${'cost-'+type+'-'+cost.id+'-cost'}+',#'+${'cost-'+type+'-'+cost.id+'-quantity'},data-calculation-rawValue=${cost.getTotal()}"
                       data-calculation-operations="*"
                       th:value="'£ ' + ${#numbers.formatDecimal(cost.getTotal(), 0, 'COMMA', 0, 'POINT')}" />
            </td>
            <td th:unless="${complete == 'complete'}">
                <button type="submit"
                        name="remove_cost"
                        class="buttonlink js-remove-row"
                        th:value="${cost.id}"
                        th:attrappend="formaction='&#35;question-'+${question.getId()}">Remove
                </button>
            </td>
        </tr>
    </div>

    <!-- ===========================Form: other cost =========================== -->
    <div th:fragment="other_costs">
        <p th:text="${question.description}" />
        <div th:attr="data-repeatable-container=${question.getId()}" th:with="formInputType=${formInput.formInputType},costCategory=${organisationFinance.get(T(com.worth.ifs.finance.resource.cost.CostType).fromString(formInput.formInputTypeTitle))},type=${formInput.formInputTypeTitle}">
            <div class="form-group">
                <table id="other-costs-table">
                    <thead>
                    <tr>
                        <th id="other_costs-description" scope="col" >Description and justification of the cost</th>
                        <th id="other_costs-cost" scope="col" class="numeric">Estimated cost (£)</th>
                        <th scope="col" th:unless="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"><span class="visuallyhidden">Actions</span></th>
                    </tr>
                    </thead>
                    <tbody>
                    <div th:each="cost : ${costCategory.costs}"  th:remove="tag">
                        <div th:include="finance/finance :: other_costs_row" th:remove="tag"/>
                    </div>
                    </tbody>
                </table>

                <p class="alignright" th:unless="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
                <div th:include="question-type/types :: add_row(text='Add another cost', question=${question},rowcontainer='#other-costs-table tbody')" th:remove="tag"/>
                </p>
            </div>
            <div class="form-group alignright inline">
                <label th:for="${'section-total-'+subSection.id}"> Total other costs</label>
                <input class="form-control form-control-1-4 alignright"
                       readonly="readonly" type="text"
                       th:id="${'section-total-'+subSection.id}"
                       data-calculation-fields="[id*=otherCost]"
                       data-calculation-operations="+"
                       th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}"/>
            </div>
        </div>
    </div>


    <div th:fragment="other_costs_row" th:remove="tag">
        <tr th:id="${'cost-'+cost.id}" th:attr="data-repeatable-row=${cost.id}">
            <td class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-description]}')} ? 'error' : ''">
                <label th:for="${'cost-'+ type + '-'+cost.id+'-description'}">
                    <span class="visuallyhidden">Description and justification of the cost</span>
                    <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-description'})" th:remove="tag" />
                </label>
                <div th:include="question-type/form-elements :: form-finance-textarea (type=${type}, id=${cost.id}, name='description', value=${cost.description},readonly=${complete == 'complete'},required=true)" th:remove="tag" />
            </td>
            <td class="numeric form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-cost]}')} ? 'error' : ''"  >
                <label th:for="${'cost-'+type+'-'+cost.id+'-cost'}">
                  <span class="visuallyhidden">Estimated cost (&pound;)</span>
                  <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-cost'})" th:remove="tag" />
                </label>
                <input
                       type="number"
                       th:name="${type +'-otherCost-' + question.id + '-' + cost.id}"
                       class="form-control"
                       th:id="${'cost-'+type+'-'+cost.id+'-otherCost'}"
                       th:value="${#numbers.formatDecimal(cost.getCost(),0,0)}"
                       th:readonly="${complete == 'complete'}"
                       min="0"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-cost]}')} ? 'field-error' : ''"  />
            </td>
            <td th:unless="${complete == 'complete'}">
                <button type="submit"
                        class="buttonlink js-remove-row"
                        name="remove_cost"
                        th:value="${cost.id}"
                        th:attrappend="formaction='&#35;question-'+${question.getId()}">Remove
                </button>
            </td>
        </tr>
    </div>


    <!-- ===========================Form: Other funding=========================== -->
    <div th:fragment="other_funding" th:remove="tag"
         th:with="formInputType=${formInput.formInputType},
                   costCategory=${organisationFinance.get(T(com.worth.ifs.finance.resource.cost.CostType).fromString(formInput.formInputTypeTitle))},
                   type=${formInput.formInputTypeTitle}">
        <div class="form-group"
                th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ costCategory.otherFundingCostItem?.id +'-otherPublicFunding]}')}? 'error'">


        <h2 th:text="${question.getName()}" class="heading-medium" />
        <div th:include="question-type/form-elements :: form-hint (hint=${question.getDescription()})" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding'})" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-guidance (guidable=${question})" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-guidance (guidable=${formInput})" th:remove="tag" />

            <fieldset class="inline" id="otherFundingShowHideToggle">
                <legend class="visuallyhidden" th:text="${question.getName()}" />
                <div class="form-block inline">

                    <label th:class="${'block-label'  + (costCategory.otherPublicFunding?.equals('Yes') ? ' selected focused' : '')}"
                           th:for="${'cost-otherFunding-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding-yes'}"
                           data-target="other-funding-table">
                        <input type="radio"
                               th:id="${'cost-otherFunding-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding-yes'}"
                               th:name="${type + '-otherPublicFunding-' + question.id + '-' + costCategory.otherFundingCostItem?.id}"
                               value="Yes"
                               th:checked="${costCategory.otherPublicFunding?.equals('Yes')}"
                               th:disabled="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
                                />
                        Yes
                    </label>
                    <label th:class="${'block-label'  + (costCategory.otherPublicFunding?.equals('No') ? ' selected focused' : '')}"
                           th:for="${'cost-otherFunding-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding-no'}">
                        <input type="radio"
                               th:id="${'cost-otherFunding-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding-no'}"
                               th:name="${type + '-otherPublicFunding-' + question.id + '-' + costCategory.otherFundingCostItem?.id}"
                               value="No"
                               th:checked="${costCategory.otherPublicFunding?.equals('No')}"
                               th:disabled="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"/>
                        No
                    </label>
                </div>
                <div id="other-funding-table">

                <div class="form-group" th:attr="data-repeatable-container=${question.getId()}">
                    <table>
                        <thead>
                        <tr>
                            <th id="other-funding-source">Source of funding</th>
                            <th id="other-funding-date" class="width-medium">Date secured</th>
                            <th id="other-funding-amount" class="width-medium">Funding amount (£)</th>
                            <th th:unless="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"><span class="visuallyhidden">Actions</span></th>
                        </tr>
                        </thead>
                        <tbody>
                        <div th:each="cost : ${costCategory.costs}"  th:remove="tag">
                            <div th:include="finance/finance :: other_funding_row" th:remove="tag"/>
                        </div>
                        </tbody>
                    </table>
                    <p class="alignright" th:unless="${readonly or (question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
                    <div th:include="question-type/types :: add_row(text='Add another source of funding', question=${question},rowcontainer='#other-funding-table tbody')" th:remove="tag"/>
                    </p>
                </div>
                <div class="form-group alignright inline">
                    <label for="other-funding-total">Total other funding</label>
                    <input class="form-control form-control-1-4 alignright"
                           data-calculation-fields="[id*=fundingAmount]"
                           data-calculation-operations="+"
                           id="other-funding-total"
                           th:attr="data-calculation-rawvalue=${costCategory.getTotal()}"
                           readonly="readonly"
                           type="text"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}" />

                </div>
              </div>

            </fieldset>
        </div>
    </div>


    <div th:fragment="other_funding_row" th:remove="tag">

        <tr th:id="${'cost-'+cost.id}" th:attr="data-repeatable-row=${cost.id}">
            <td class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-fundingSource]}')} ? 'error' : ''">
                <label th:for="${'cost-'+type+'-'+cost.id+'-source'}">
                      <span class="visuallyhidden">Source of funding</span>
                      <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-fundingSource'})" th:remove="tag" />
                </label>
                <input type="text"
                       th:readonly="${(question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
                       th:name="${type +'-fundingSource-' + question.id + '-' + cost.id}"
                       class="form-control width-full"
                       th:id="${'cost-'+type+'-'+cost.id+'-source'}"
                       th:value="${cost.fundingSource}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-fundingSource]}')} ? 'field-error' : ''"
                       required="required"
                       data-required-errormessage="Funding source cannot be blank" />
            </td>
            <td class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-securedDate]}')} ? 'error' : ''">
                <label th:for="${'cost-'+type+'-'+cost.id+'-date'}">
                  <span class="visuallyhidden">Date secured</span>
                  <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-securedDate'})" th:remove="tag" />
                </label>
                <input type="text"
                       th:readonly="${(question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
                       th:name="${type +'-securedDate-' + question.id + '-' + cost.id}"
                       class="form-control width-medium"
                       th:id="${'cost-'+type+'-'+cost.id+'-date'}"
                       placeholder="MM-YYYY"
                       th:value="${cost.securedDate}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-securedDate]}')} ? 'field-error' : ''"
                       required="required"/>
            </td>

            <td class="form-group" th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-fundingAmount]}')} ? 'error' : ''">
              <label th:for="${'cost-'+type+'-'+cost.id+'-fundingAmount'}">
                <span class="visuallyhidden">Funding amount (&pound;)</span>
                <div th:include="question-type/form-elements :: form-validation-messages (id=${'cost-'+cost.id+'-fundingAmount'})" th:remove="tag" />
              </label>
                <input class="form-control width-medium"
                       type="number"
                       th:readonly="${(question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}"
                       th:name="${type +'-fundingAmount-' + question.id + '-' + cost.id}"
                       th:id="${'cost-'+type+'-'+cost.id+'-fundingAmount'}"
                       th:value="${#numbers.formatDecimal(cost.fundingAmount,0,0)}"
                       th:classappend="${#fields.hasErrors('${form.formInput[cost-'+ cost.id +'-fundingAmount]}')} ? 'field-error' : ''"
                       min="0" />
            </td>
            <td th:unless="${(question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))}">
                <button type="submit"
                        name="remove_cost"
                        class="buttonlink js-remove-row"
                        th:value="${cost.id}"
                        th:attrappend="formaction='&#35;question-'+${question.getId()}">Remove
                </button>
            </td>
        </tr>
    </div>
</html>

<!DOCTYPE html>
<html class="no-js" lang="en" xmlns="http://www.w3.org/1999/xhtml" xmlns:th="http://www.thymeleaf.org">
<head>
    <div th:include="fragments/layout :: head" th:with="pageTitle='Assessor Dashboard'" th:remove="tag" />
</head>

<body class="assessment-details">

<div th:include="fragments/layout :: body-start" th:remove="tag" />
<div th:include="fragments/layout :: global-header" th:remove="tag" />

<main id="content" th:with="urlPrefix='/assessor/competitions/' + ${currentCompetition.id} + '/applications/' + ${currentApplication.id}">

    <div th:include="fragments/layout :: main-content-start" th:remove="tag"></div>
    <div th:include="fragments/layout :: header-sub" th:with="currentApplication=${currentApplication}" th:remove="tag"></div>

    <div>
        <br/>
        <small><a th:href="@{/assessor/competitions/{cid}/applications(cid=${currentCompetition.id})}">&lt; Back to competition dashboard</a></small>
    </div>

    <div class="grid-row">
        <div class="column-third">
            <nav role="navigation" class="app-sidebar">
                <ul>
                    <li th:each="sectionEntry : ${sections}"  th:unless='${sectionEntry.value.name.equals("Finances")}' th:class="((${sectionEntry.key} == ${currentSectionId}) ? 'active ':'')">
                        <a th:href="${urlPrefix} + @{/section/{sectionId}/(id=${currentApplication.getId()},sectionId=${sectionEntry.key})}"
                           th:text="${sectionEntry.value.getName()}" th:if="${sectionEntry.value.parentSection}==null"></a>
                        <ul th:unless="${sectionEntry.value.getChildSections()}==null or ${sectionEntry.value.getChildSections().isEmpty()}">
                            <li th:each="subSection : ${sectionEntry.value.getChildSections()}" th:class="((${subSection.getId()} == ${currentSectionId}) ? 'active':'')">
                                <a th:href="${urlPrefix} + @{/application/{id}/form/section/{sectionId}/(id=${currentApplication.getId()},sectionId=${subSection.getId()})}"
                                   th:text="${subSection.getName()}"></a>
                            </li>
                        </ul>
                    </li>
                </ul>
            </nav>
        </div>

        <div class="column-two-thirds">

            <form th:action="${urlPrefix}"  method="post" th:object="${form}">
                <div th:each="sectionEntry : ${sections}"  th:remove="tag">
                    <div th:if="(${sectionEntry.key} == ${currentSectionId})" class="page-header no-pad">
                        <h1 class="heading-xlarge" th:text="${sectionEntry.value.getName()}"></h1>
                        <h2 class="subtitle" th:text="${sectionEntry.value.getAssessorGuidanceDescription()}" th:unless="${#strings.isEmpty(sectionEntry.value.getAssessorGuidanceDescription())}"></h2>
                    </div>
                    <div th:each="subSection : ${sectionEntry.value.getChildSections()}" th:if="${sectionEntry.value.getChildSections()}!=null and ${sectionEntry.key} != ${currentSectionId}"  th:remove="tag">
                        <div th:if="(${subSection.getId()} == ${currentSectionId})" th:remove="tag">
                            <h1 class="heading-xlarge" th:text="${subSection.getName()}"></h1>
                        </div>
                    </div>
                </div>
                <div th:if='${currentSection.name eq "Funding"}' th:remove="tag">
                    <div th:replace="question-type/types-assessment-details :: financial_summary"></div>
                </div>
                <div th:each="question : ${currentSection.getQuestions()}" th:remove="tag">
                    <div th:replace="question-type/types-assessment-details :: question (question=${question})" />
                </div>

                <ul class="pagination">
                    <li class="prev" th:if="${sections.containsKey(currentSectionId-1)}">
                        <a th:href="${urlPrefix} + @{/section/{sectionId}/(id=${currentApplication.getId()},sectionId=${sections.get(currentSectionId-1).getId()})}" rel="prev" title="Navigate to previous part">
                            <span class="pagination-label">Previous</span>
                            <span class="pagination-part-title" th:text="${sections.get(currentSectionId-1).getName()}">Business proposition</span>
                        </a>
                    </li>
                    <li class="next" th:if="${sections.containsKey(currentSectionId+1) and not sections.get(currentSectionId+1).name.equals('Finances')}">
                        <a th:href="${urlPrefix} + @{/section/{sectionId}/(id=${currentApplication.getId()},sectionId=${sections.get(currentSectionId+1).getId()})}" rel="next" title="Navigate to next part">
                            <span class="pagination-label">Next</span>
                            <span class="pagination-part-title" th:text="${sections.get(currentSectionId+1).getName()}">Funding</span>
                        </a>
                    </li>
                </ul>

            </form>

        </div>
    </div>
    <div th:include="fragments/layout :: main-content-end" th:remove="tag" />

    <div class="grid-row" align="right">
        <a class="button button-pull-right no-margin" th:href="${urlPrefix} + '/summary'">Review assessment</a>
    </div>
</main>


<div th:include="fragments/layout :: footer" th:remove="tag" />
<div th:include="fragments/layout :: body-end" th:remove="tag" />
</body>
</html>
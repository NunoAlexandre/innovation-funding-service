<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">

<!-- ===========================Application Details =========================== -->

    <div th:fragment="application_details" th:remove="tag">
        <div class="form-group">
            <label class="form-label form-label-bold" for="application_details-title">Project title</label>
            <input class="form-control width-full" readonly="readonly" id="application_details-title" name="formInput[application_details-title]" th:value="${application_title}" type="text" />
        </div>
        <div class="form-group">
            <label class="form-label form-label-bold" for="details-application-timescale">Estimated timescales</label>
            Project start date
            <br/>
            <div class="date-group">
                <div class="day">
                    <label class="form-label" for="application_details-startdate_day">Day</label>
                    <input class="form-control width-extra-small" placeholder="DD" readonly="readonly" id="application_details-startdate_day" name="formInput[application_details-startdate_day]" th:value="${application_startdate_day}" type="number" />
                </div>
                <div class="month">
                    <label class="form-label" for="application_details-startdate_month">Month</label>
                    <input class="form-control width-extra-small" placeholder="MM" readonly="readonly" id="application_details-startdate_month" name="formInput[application_details-startdate_month]" th:value="${application_startdate_month}" type="number" />
                </div>
                <div class="year">
                    <label class="form-label" for="application_details-startdate_year">Year</label>
                    <input class="form-control width-extra-small" placeholder="YYYY" readonly="readonly" id="application_details-startdate_year" name="formInput[application_details-startdate_year]" th:value="${application_startdate_year}" type="number" />
                </div>
            </div>
            <br/>
            <div class="form-group">
                <label class="form-label" for="application_details-duration">Duration months</label>
                <div class="validation-messages">
                </div>
                <input class="form-control width-extra-small" readonly="readonly" id="application_details-duration" name="formInput[application_details-duration]" th:value="${application_duration}" type="number" />
            </div>
        </div>
        <h2 class="heading-medium">Lead organisation</h2>
        <div th:text="${leadOrganisation.getName()}"></div>

        <h2 class="heading-medium">Partners</h2>
        <ul class="list-bullet">
            <li th:each="organisation : ${applicationOrganisations}" th:unless="${organisation.equals(leadOrganisation)}">
                <span th:text="${organisation.getName()}"></span>
            </li>
        </ul>
    </div>

<!-- ===================== Textarea ======================!-->
<div th:fragment="textarea"  class="form-group" th:id="${formInputIndex}" >

    <label class="form-label form-label-bold" th:for="${formInput.getId()}">
        <span th:unless="${readonly}" th:if="${question.getName()}" th:text="${question.questionNumber!=null ? question.questionNumber + '. ' : '' } + ${question.name}" />
    </label>
    <div class="textarea-wrapped ">
        <div class="readonly">
            <p th:text="${response?.value}"></p>
        </div>
    </div>
</div>

<!-- ===========================Form: funding breakdown =========================== -->
<div th:fragment="application_finances_summary" th:if="${financeTotalPerType}">
    <div class="form-group" style="overflow:auto;">
        <table>
            <thead>
            <tr>
                <th />
                <th scope="col" class="numeric">Total costs</th>
                <th scope="col" class="numeric">% Grant</th>
                <th scope="col" class="numeric">Funding sought</th>
                <th scope="col" class="numeric">Other public sector funding</th>
                <th scope="col" class="numeric">Contribution to project</th>
            </tr>
            </thead>
            <tbody>
            <tr th:each="applicationOrganisation : ${applicationOrganisations}">
                <th scope="row">
                    <div>
                        <div th:text="${applicationOrganisation.name}" />
                        <div th:if="${applicationOrganisation.id.equals(leadOrganisation.id)}">
                            <small>Lead organisation</small>
                        </div>
                        <div th:unless="${applicationOrganisation.id.equals(leadOrganisation.id)}">
                            <small>Partner</small>
                        </div>
                    </div>
                </th>
                <div th:each="organisationFinance : ${organisationFinances}" th:if="${applicationOrganisation.id == organisationFinance.organisation}" th:remove="tag">
                    <td class="numeric">
                        <strong th:text="'£'+${#numbers.formatDecimal(organisationFinance.total, 0, 'COMMA', 0, 'POINT')}" />
                    </td>
                    <td class="numeric" th:text="${organisationFinance.grantClaimPercentage}+'%'"/>
                    <td class="numeric" th:text="'£'+${#numbers.formatDecimal(organisationFinance.totalFundingSought, 0, 'COMMA', 0, 'POINT')}"/>
                    <td class="numeric" th:text="'£'+${#numbers.formatDecimal(organisationFinance.totalOtherFunding, 0, 'COMMA', 0, 'POINT')}"/>
                    <td class="numeric" th:text="'£'+${#numbers.formatDecimal(organisationFinance.totalContribution, 0, 'COMMA', 0, 'POINT')}"/>
                </div>
            </tr>
            <tr>
                <th scope="row">Total</th>
                <td class="numeric">
                    <strong th:text="'£'+${#numbers.formatDecimal(financeTotal, 0, 'COMMA', 0, 'POINT')}" />
                </td>
                <td />
                <td class="numeric" th:text="'£'+${#numbers.formatDecimal(totalFundingSought, 0, 'COMMA', 0, 'POINT')}" />
                <td class="numeric" th:text="'£'+${#numbers.formatDecimal(totalOtherFunding, 0, 'COMMA', 0, 'POINT')}" />
                <td class="numeric" th:text="'£'+${#numbers.formatDecimal(totalContribution, 0, 'COMMA', 0, 'POINT')}" />
            </tr>
            </tbody>
        </table>
    </div>
</div>

<!-- ===========================Form: financial summary/breakdown table =========================== -->
<div th:fragment="financial_summary_table" th:if="${financeTotalPerType}">
    <div class="form-group">
        <div style="overflow: auto;">

            <table>
                <thead>
                <tr>
                    <th scope="col" />
                    <th scope="col" class="numeric">Total</th>
                    <th th:each="financeSubSection, iteration : ${financeSectionChildren}"
                        th:with="question=${financeSectionChildrenQuestionsMap.get(financeSubSection.id).get(0)}, formInputType=${question.getFormInputs().get(0).getFormInputType()}"
                        th:text="${financeSubSection.name}"
                        scope="col"
                        class="numeric"
                        th:classappend="${iteration.count} > 3 ? ' width-small'"/>
                </tr>
                </thead>
                <tbody>
                <tr th:each="applicationOrganisation : ${applicationOrganisations}">
                    <th scope="row">
                        <div th:text="${applicationOrganisation.name}"></div>
                        <div th:if="${applicationOrganisation.id.equals(leadOrganisation.id)}"><small>Lead organisation</small></div>
                        <div th:unless="${applicationOrganisation.id.equals(leadOrganisation.id)}"><small>Partner</small></div>
                    </th>
                    <td class="numeric" th:each="organisationFinance : ${organisationFinances}" th:if="${applicationOrganisation.id == organisationFinance.organisation}">
                        <strong th:text="'£'+${#numbers.formatDecimal(organisationFinance.total, 0, 'COMMA', 0, 'POINT')}" />
                    </td>
                    <div th:each="financeSubSection : ${financeSectionChildren}" th:with="question=${financeSectionChildrenQuestionsMap.get(financeSubSection.id).get(0)},formInputType=${question.getFormInputs().get(0).getFormInputType()}" th:remove="tag">
                        <td class="numeric" th:each="organisationFinance : ${organisationFinances}"
                            th:if="${applicationOrganisation.id == organisationFinance.organisation}"
                            th:with="formInputType=${question.formInputs.get(0).formInputType},category = ${organisationFinance.getFinanceOrganisationDetails(T(com.worth.ifs.finance.resource.cost.CostType).fromString(formInputType.title))}"
                            th:text="'£'+${#numbers.formatDecimal(category.total, 0, 'COMMA', 0, 'POINT')}">
                        </td>
                    </div>
                </tr>
                <tr>
                    <th scope="row">Total</th>
                    <td class="numeric">
                        <strong  th:text="'£'+${#numbers.formatDecimal(financeTotal, 0, 'COMMA', 0, 'POINT')}" />
                    </td>
                    <div th:remove="tag" th:each="financeSubSection : ${financeSectionChildren}"
                         th:with="question=${financeSectionChildrenQuestionsMap.get(financeSubSection.id).get(0)},formInputType=${question.getFormInputs().get(0).getFormInputType()}">
                        <td class="numeric" th:each="financeTotal: ${financeTotalPerType.get(T(com.worth.ifs.finance.resource.cost.CostType).fromString(formInputType.title))}"
                            th:text="'£'+${#numbers.formatDecimal(financeTotal, 0, 'COMMA', 0, 'POINT')}" />
                    </div>
                </tr>
                </tbody>
            </table>

        </div>
    </div>
</div>
</html>
<!DOCTYPE html>
<html xmlns:th="http://www.w3.org/1999/xhtml">

    <!-- ===========================Form: Textinput =========================== -->

    <div th:fragment="textinput" th:class="form-group " th:classappend="${#fields.hasErrors(validationId)} ? adminclass : userclass">
        <div th:include="question-type/form-elements :: form-label (name=${question.getName()}, id=${formInput.getId()}, bold=true)" th:remove="tag" th:if="${formInputIndex == 0}" />
        <div th:include="question-type/form-elements :: form-validation-messages (id=${formInput.getId()})" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-hint (hint=${question.getDescription()})" th:remove="tag" th:if="${formInputIndex == 0}" />
        <div th:include="question-type/form-elements :: form-guidance" th:remove="tag" th:if="${formInputIndex == 0}" />
        <div th:include="question-type/form-elements :: form-textinput (id=${formInput.getId()}, response=${responses?.get(formInput.getId())?.getValue()})" th:remove="tag" />
    </div>

    <!-- =========================== Form: Textarea =========================== -->
    <!-- === (defaults to the wrapped textarea with wordcount and statusses)=== -->

    <div th:fragment="textarea"  class="form-group" th:id="${formInputIndex}"  th:classappend="${#fields.hasErrors('formInput[__${formInput.getId()}__]')} ? error : ''">

        <div th:unless="${readonly}">
            <div th:include="question-type/form-elements :: form-label (name=${question.questionNumber!=null ? question.questionNumber + '. ' : '' } + ${question.name}, id=${formInput.getId()}, bold=true)" th:remove="tag" th:if="${formInputIndex == 0}" />
        </div>
        <div th:if="${readonly}">
            <div th:include="question-type/form-elements :: form-label (name=${question.name}, id=${formInput.getId()}, bold=true)" th:remove="tag" th:if="${formInputIndex == 0}" />
        </div>

        <div th:include="question-type/form-elements :: form-validation-messages (id=${formInput.getId()})" th:remove="tag" />
        <div th:unless="${readonly}" th:include="question-type/form-elements :: form-hint (hint=${question.getDescription()})" th:remove="tag" th:if="${formInputIndex == 0}" />
        <div th:unless="${readonly}" th:include="question-type/form-elements :: form-guidance" th:remove="tag" th:if="${formInputIndex == 0}" />
        <div th:include="question-type/form-elements :: form-textarea-wrapped" th:remove="tag" />
    </div>

    <div th:fragment="textarea-wordcount (name, id, inputName, hint, maxWords, value)"  class="form-group">
        <div th:include="question-type/form-elements :: form-label (name=${name}, id=${id}, bold=true)" th:remove="tag" th:if="${formInputIndex == 0}" />
        <div th:include="question-type/form-elements :: form-validation-messages (id=${id})" th:remove="tag" th:if="${formInputIndex == 0}" />
        <div th:include="question-type/form-elements :: form-hint (hint=${hint})" th:remove="tag" th:if="${formInputIndex == 0}" />
        <div th:include="question-type/form-elements :: form-textarea-wordcount (id=${id}, name=${inputName}, value=${value},readonly=false, maxWords=${maxWords})" th:remove="tag" />
    </div>


    <!-- ===========================Form: Date input =========================== -->

    <div th:fragment="date" class="form-group">
        <div th:include="question-type/form-elements :: form-label (name=${question.getName()}, id=${formInput.getId()}, bold=true)" th:remove="tag" th:if="${formInputIndex == 0}" />
        <div th:include="question-type/form-elements :: form-validation-messages (id=${formInput.getId()})" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-hint (hint=${question.getDescription()})" th:remove="tag" th:if="${formInputIndex == 0}" />
        <div th:include="question-type/form-elements :: form-guidance" th:remove="tag" th:if="${formInputIndex == 0}" />
        <div th:include="question-type/form-elements :: form-dateinput (id=${formInput.getId()}, day='', month='', year='')" th:remove="tag" />
    </div>

    <!-- ===========================Form: Fileupload =========================== -->
    <div th:fragment="fileupload" class="form-group">
        <div th:include="question-type/form-elements :: form-validation-messages (id=${formInput.getId()})" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-hint (hint=${question.getDescription()})" th:remove="tag" th:if="${formInputIndex == 0}" />
        <div th:include="question-type/form-elements :: form-guidance" th:remove="tag" th:if="${formInputIndex == 0}" />
        <div th:include="question-type/form-elements :: form-label (name=${question.getName()}, id=${formInput.getId()}, bold=true)" th:remove="tag" th:if="${formInputIndex == 0}" />
        <input type="file" th:id="${formInput.getId()}" />
    </div>

    <!-- ===========================Form: Percentage =========================== -->

    <div th:fragment="percentage" class="form-group">
        <div th:include="question-type/form-elements :: form-validation-messages (id=${formInput.getId()})" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-label (name=${question.getName()}, id=${formInput.getId()}, bold=false)" th:remove="tag" th:if="${formInputIndex == 0}" />
        <div th:include="question-type/form-elements :: form-hint (hint=${question.getDescription()})" th:remove="tag" th:if="${formInputIndex == 0}" />
        <div th:include="question-type/form-elements :: form-guidance" th:remove="tag" th:if="${formInputIndex == 0}" />
        <div th:include="question-type/form-elements :: form-number-extra-small (id=${formInput.getId()}, field=${field})" th:remove="tag" />
        <span>%</span>
    </div>

    <!-- ===========================Form: application_details =========================== -->

    <div th:fragment="application_details" th:remove="tag">
        <div class="form-group">
            <div th:include="question-type/form-elements :: form-label (name='Project title', id='application_details-title',bold=true) " th:remove="tag" />
            <div th:include="question-type/form-elements :: form-validation-messages (id='application_details-title')" th:remove="tag" />
            <div th:unless="${readonly}" th:include="question-type/form-elements :: form-hint (hint='Enter the full title of your project')" th:remove="tag" />
            <div th:unless="${readonly}" th:include="question-type/form-elements :: form-guidance" th:remove="tag" />
            <div th:include="question-type/form-elements :: form-textinput-full-width (id='application_details-title', field='application.name' )" th:remove="tag" />
        </div>

        <div class="form-group">

            <div th:include="question-type/form-elements :: form-label (name='Estimated timescales', id='details-application-timescale',bold=true)" th:remove="tag" />
            <div th:include="question-type/form-elements :: form-validation-messages (id='details-application-timescale')" th:remove="tag" />

            Project start date
            <br/>

            <div th:unless="${readonly}" th:include="question-type/form-elements :: form-hint (hint='For example: 31 12 2015')" th:remove="tag" />
            <div th:include="question-type/form-elements :: form-dateinput (id='application_details-startdate', field='application.startDate')" th:remove="tag" /><br/>
            <div th:include="question-type/form-elements :: form-duration (id='application_details-duration', field='application.durationInMonths')" th:remove="tag" />
        </div>

        <div class="form-group">
            <h2 class="heading-medium">Lead organisation</h2>
            <div th:text="${leadOrganisation.getName()}"></div>
        </div>

        <div class="form-group">
            <h2 class="heading-medium">Partners</h2>
            <ul class="list-bullet">
                <li th:each="organisation : ${applicationOrganisations}" th:unless="${organisation.equals(leadOrganisation)}">
                    <span th:text="${organisation.getName()}"></span>
                </li>
            </ul>
        </div>
    </div>

    <!-- ===========================Form: empty / no question =========================== -->
    <div th:fragment="empty">
        <div th:utext="${question.getDescription()}"></div>
        <div th:include="question-type/form-elements :: form-guidance" th:remove="tag" ></div>
    </div>

    <!-- ===========================Form: finance =========================== -->


    <div th:fragment="finance">
        <div class="form-group">
            <label class="form-label" for="other-funding">
                <span class="heading-medium" th:text="${question.name}"></span>
                <span class="form-hint" th:text="${question.description}"></span>
            </label>

            <div th:include="question-type/form-elements :: form-guidance" th:remove="tag"/>
            <div th:include="question-type/form-elements :: form-percentage (id='cost-financegrantclaim', title='', field='formInput['+${'finance-grantclaim-'+organisationgrantClaimPercentageId}+']')" th:remove="tag" />
            <span>%</span>
        </div>
    </div>

    <!-- ===========================Form: your_finance =========================== -->
    <div th:fragment="your_finance" th:remove="tag">
        <h2 class="heading-medium no-margin" th:text="${question.name}"></h2>
        <p th:text="${question.description}"></p>
        <div class="collapsible">
            <div th:each="subSection : ${currentSection.getChildSections()}" th:if="${currentSection.getChildSections()}!=null"  th:remove="tag" >
                <h2  th:attr="data-subsection-header=${subSection.id}" th:text="${subSection.getName()}" th:class="((${completedSections.contains(subSection.id)}) ? 'section-status-finance complete':'')"></h2>
                <div th:remove="tag" th:each="question : ${subSection.getQuestions()}">
                    <div th:remove="tag" th:each="formInput, status : ${question.getFormInputs()}">
                        <div th:replace="question-type/types :: ${formInput.getFormInputType().getTitle()} (complete=${(question.isMarkAsCompletedEnabled() and markedAsComplete?.contains(question.id))} ? 'complete' : '')" th:with="formInputIndex=(${status.index})" />
                    </div>
                </div>
            </div>
        </div>
        <hr/>
        <div class="grid-row total-cost">
            <div class="column-half">
                <p class="heading-medium">Total project costs</p>
            </div>
            <div class="column-half alignright">
                <input type="text" readOnly="readonly" class="heading-medium width-medium"
                   data-calculation-fields="[id*=total]"
                   data-calculation-operations="+"
                   th:value="'£ ' + ${#numbers.formatDecimal(organisationFinanceTotal, 0, 'COMMA', 0, 'POINT')}"/>
            </div>
        </div>
    </div>

    <!-- ===========================Form: labour =========================== -->
    <div th:fragment="labour (complete)">
        <div th:attr="data-finance-subsection-table-container=${question.getId()}"
             th:with="formInputType=${question.formInputs.get(0).formInputType},costCategory=${organisationFinance.get(T(com.worth.ifs.application.finance.CostType).fromString(formInputType.title))},type=${formInputType.title}">
            <div class="form-group" th:if="${costCategory!=null}">
                <table>
                    <tbody>
                    <tr>
                        <th class="width-large">
                            <div th:include="question-type/form-elements :: form-label (name='Working Days per Year', id='working_days', bold=false)" th:remove="tag" />
                        </th>
                        <td>
                            <input type="number"
                                   th:class="${'width-small'}"
                                   th:id="${'cost-labour-'+costCategory.workingDaysPerYearCostItem?.id+'-workingDays'}"
                                   th:name="${type + '-workingDays-' + costCategory.workingDaysPerYearCostItem?.id}"
                                   th:value="${costCategory.workingDaysPerYear}"
                            />
                        </td>
                    </tr>
                    </tbody>
                </table>
                <div class="form-group">
                    <table id="labour-costs-table">
                        <thead>
                        <tr>
                            <th class="width-medium">Role within project</th>
                            <th class="numeric">Gross Annual Salary</th>
                            <th class="numeric">Rate (£/day)</th>
                            <th class="numeric width-medium">Days to be spent by all staff at this grade</th>
                        </tr>
                        </thead>
                        <tbody>
                        <div th:each="labourCost : ${costCategory.costs}" th:remove="tag">
                            <tr th:attr="data-cost-row=${labourCost.id}">
                                <td>
                                    <input type="text" th:name="${type +'-role-' + labourCost.id}"  th:id="${'cost-labour-'+labourCost.id+'-labourRole'}" th:value="${labourCost.getRole()}"/>
                                </td>
                                <td class="numeric">
                                    <input type="number"
                                           th:name="${type +'-grossAnnualSalary-' + labourCost.id}"
                                           th:id="${'cost-labour-'+labourCost.id+'-labourGrossSalary'}"
                                           th:value="${#numbers.formatDecimal(labourCost.grossAnnualSalary,0,0)}" />
                                </td>
                                <td class="numeric">
                                    <input type="text"
                                           th:attr="data-calculation-fields=${'#cost-labour-'+labourCost.id+'-labourGrossSalary,#cost-labour-'+costCategory.workingDaysPerYearCostItem.id+'-workingDays'},data-calculation-rawValue=${labourCost.getRate(costCategory.workingDaysPerYear)}"
                                           data-calculation-operations="/"
                                           readonly="readonly"
                                           th:id="${'cost-labour-'+labourCost.id+'-labourRate'}"
                                           th:name="${type + '-labourRate-' + labourCost.id}"
                                           th:value="'£ ' + ${#numbers.formatDecimal(labourCost.getRate(costCategory.workingDaysPerYear),0,0)}" />
                                </td>
                                <td class="numeric">
                                    <input type="number" class="width-small"
                                           th:id="${'cost-labour-'+labourCost.id+'-labourDays'}"
                                           th:name="${type + '-labourDays-' + labourCost.id}"
                                           th:value="${labourCost.labourDays}" />
                                </td>
                            </tr>
                            <tr th:attr="data-cost-row=${labourCost.id}">
                                <td colspan="4" class="numeric">
                                    Total costs
                                    <input type="text"
                                       th:attr="data-calculation-fields=${'#cost-labour-'+labourCost.id+'-labourGrossSalary,#cost-labour-'+costCategory.workingDaysPerYearCostItem.id+'-workingDays,#cost-labour-'+labourCost.id+'-labourDays'},data-calculation-rawvalue=${labourCost.getTotal(costCategory.workingDaysPerYear)}"
                                       data-calculation-operations="/,*"
                                       th:name="${type +'-total-' + labourCost.id}"
                                       readonly="readonly"
                                       th:class="${'width-small-medium'}"
                                       th:id="${'cost-labour-'+labourCost.id+'-labourTotalCost'}"
                                       th:value="'£ ' + ${#numbers.formatDecimal(labourCost.getTotal(costCategory.workingDaysPerYear), 0, 'COMMA', 0, 'POINT')}"/>
                                        <a class="delete-row control" th:attr="data-cost-row=${labourCost.id}" th:href="@{/application/{applicationId}/form/deletecost/{sectionId}/{labourCostId}(labourCostId=${labourCost.id},sectionId=${currentSectionId},applicationId=${applicationId})}">Remove</a>
                                </td>
                            </tr>
                        </div>
                        </tbody>
                    </table>

                    <p class="alignright">
                        <a th:href="@{/application/{applicationId}/form/addcost/{sectionId}/{id}?expand=true&amp;panel=collapsible-0(id=${question.id},sectionId=${currentSectionId},applicationId=${applicationId})}" class="add-another-row" data-clone-rows="0-1">Add another role</a>
                    </p>
                </div>

                <div class="form-group form-group--align-right alignright">
                    <label>
                        Total labour costs
                        <input class="form-control form-control-1-4 alignright"
                               data-calculation-fields="[id*=labourTotalCost]"
                               data-calculation-operations="+"
                               th:attr="data-binding-input=${'subsection-total-' + subSection.id},data-calculation-rawvalue=${costCategory.getTotal()}"
                               readonly="readonly" type="text" id="cost-labour-total-field"
                               th:value="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}" />
                        <span th:class="'section-status ' + ${complete} + ' place-in-header'" th:attr="data-subsection-id=${subSection.id}" style="display: none;">
                            <span th:attr="data-binding-output=${'subsection-total-' + subSection.id}"
                                    th:text="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}">
                            </span>
                        </span>
                    </label>
                </div>
                <div class="alignright-button">
                    <div th:include="question-type/form-elements :: form-mark-as-complete-buttons" th:remove="tag"/>
                </div>
            </div>
        </div>
    </div>

    <!-- ===========================Form: overheads =========================== -->
    <div th:fragment="overheads">
        <p th:text="${question.getDescription()}"></p>
        <div th:with="formInputType=${question.formInputs.get(0).formInputType},costCategory=${organisationFinance.get(T(com.worth.ifs.application.finance.CostType).fromString(formInputType.title))},overheadCosts=${costCategory?.costs[0]}">
            <div class="grid-row">
                <strong class="column-half">
                    20% of labour costs
                </strong>
                <strong class="column-half">
                    Calculated rate: <span id="calculated-rate" data-calculation-field="[data-calculation-input=overhead-calculated]"
                                            data-calculation-operations=""></span>
                </strong>
            </div>
            <br/>
            <fieldset>
                <legend>Do you choose to accept this rate?</legend>
                <ul id="id_overheads-acceptRate">
                    <li>
                        <label class="block-label" th:for="${'cost-'+ type + '-'+overheadCosts.id+'-acceptRate_0'}">
                            <input
                                   th:id="${'cost-'+ type + '-'+overheadCosts.id+'-acceptRate_0'}"
                                   type="radio"
                                   th:name="'overheads-acceptRate-'+${overheadCosts?.id}"
                                   value="Yes"
                                   th:checked="${overheadCosts?.acceptRate == 'Yes'}">
                                20% of labour costs
                            </input>
                        </label>
                    </li>
                    <li>
                        <label class="block-label" th:for="${'cost-'+ type + '-'+overheadCosts.id+'-acceptRate_1'}" data-target="customRate">
                            <input
                                   th:id="${'cost-'+ type + '-'+overheadCosts.id+'-acceptRate_1'}"
                                   type="radio"
                                   th:name="'overheads-acceptRate-'+${overheadCosts?.id}"
                                   value="No"
                                   th:checked="${overheadCosts?.acceptRate == 'No'}">
                                Bespoke rate (I confirm that I will justify this rate if Innovate UK funds my project)
                            </input>
                        </label>
                    </li>
                </ul>
            </fieldset>
            <br/>
            <div id="customRate" class="panel-indent js-hidden">
                <div class="form-group">
                    <label class="form-label" th:for="${'cost-'+ type + '-'+overheadCosts.id+'-customRate'}">Overhead rate</label>
                    <input type="text"
                           th:name="'overheads-customRate-'+${overheadCosts?.id}"
                           th:id="${'cost-'+ type + '-'+overheadCosts.id+'-customRate'}"
                           data-calculation-input="overhead-rate"
                           class="form-control form-control-1-8"
                           th:value="'' + ${#numbers.formatDecimal(overheadCosts?.getCustomRate(),0,0)}" /> %
                </div>
                <div class="form-group">
                    <label class="form-label" th:id="${'cost-'+ type + '-'+overheadCosts.id+'-calculatedRate'}">Overhead calculation</label>
                    <input type="text"
                           th:name="'overheads-calculatedRate-'+${overheadCosts?.id}"
                           th:id="${'cost-'+ type + '-'+overheadCosts.id+'-calculatedRate'}"
                           class="form-control"
                           readonly="readonly"
                           data-binding-input="subsection-total-9"
                           data-calculation-operations=""
                           data-calculation-input="overhead-calculated"
                           th:value="'£ 0'"/>
                </div>
            </div>
            <div class="form-group form-group--align-right alignright">
                <label>
                    Total overhead costs
                    <input type="text"
                           th:name="'overheads-totalCosts-'+${overheadCosts?.id}"
                           class="form-control form-control-1-4 alignright"
                           readonly="readonly"
                           id="id_overheads-totalCosts"
                           data-calculation-fields="[id=cost-labour-total-field],[id=id_overheads-customRate]"
                           data-calculation-operations="*"
                           th:attr="data-binding-input=${'subsection-total-' + subSection.id},data-calculation-rawvalue=${costCategory.getTotal()}"

                           th:value="''"
                           />
                    <span th:class="'section-status ' + ${complete} + ' place-in-header'" th:attr="data-subsection-id=${subSection.id}" style="display: none;">
                        <span th:attr="data-binding-output=${'subsection-total-' + subSection.id}"
                              th:text="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}">
                        </span>
                    </span>
                </label>
            </div>
            <div class="alignright-button">
                <div th:include="question-type/form-elements :: form-mark-as-complete-buttons" th:remove="tag"/>
            </div>
        </div>
    </div>

    <!-- ===========================Form: materials =========================== -->
    <div th:fragment="materials">
        <p th:text="${question.getDescription()}"></p>
        <div th:attr="data-finance-subsection-table-container=${question.getId()}" th:with="formInputType=${question.formInputs.get(0).formInputType},costCategory=${organisationFinance.get(T(com.worth.ifs.application.finance.CostType).fromString(formInputType.title))}">
            <div class="form-group">
                <table id="material-costs-table">
                    <thead>
                    <tr>
                        <th>Item</th>
                        <th class="numeric">Quantity</th>
                        <th class="numeric">Cost Per Item</th>
                        <th class="numeric">Total</th>
                        <th>&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <div th:each="materialCost : ${costCategory.costs}" th:with="formInputType=${question.formInputs.get(0).formInputType},type=${formInputType.title}">
                        <tr th:attr="data-cost-row=${materialCost.id}">
                            <td>
                                <input type="text" th:name="${type +'-item-' + materialCost.id}"  th:id="${'cost-materials-'+materialCost.id+'-item'}" th:value="${materialCost.getItem()}"/>
                            </td>
                            <td>
                                <input type="number" th:name="${type +'-quantity-' + materialCost.id}"
                                       th:id="${'cost-materials-'+materialCost.id+'-quantity'}" th:value="${materialCost.getQuantity()}"/>
                            </td>
                            <td>
                                <input type="number" th:name="${type +'-cost-' + materialCost.id}"
                                       th:id="${'cost-materials-'+materialCost.id+'-cost'}"
                                       th:value="${#numbers.formatDecimal(materialCost.getCost(),0,0)}"
                                />
                            </td>
                            <td>
                                <input type="text" class="alignright" th:name="${type +'-total-' + materialCost.id}"
                                       th:attr="data-calculation-fields='#'+${'cost-materials-'+materialCost.id+'-quantity'}+',#'+${'cost-materials-'+materialCost.id+'-cost'},data-calculation-rawvalue=${materialCost.total}"
                                       th:id="${'cost-materials-'+materialCost.id+'-materialTotal'}"
                                       data-calculation-operations="*"
                                       readonly="readonly"
                                       th:value="'£ ' + ${#numbers.formatDecimal(materialCost.total, 0, 0)}"/>
                            </td>
                            <td class="alignright remove"> 
                                <a class="delete-row" th:attr="data-cost-row=${materialCost.id}" th:href="@{/application/{applicationId}/form/deletecost/{sectionId}/{materialCost}(materialCost=${materialCost.id},sectionId=${currentSectionId},applicationId=${applicationId})}">Remove</a>
                            </td>
                        </tr>
                    </div>
                    </tbody>
                </table>

                <p class="alignright">
                    <a th:href="@{/application/{applicationId}/form/addcost/{sectionId}/{id}(id=${question.id},sectionId=${currentSectionId},applicationId=${applicationId})}" class="add-another-row" data-clone-rows="0">Add another materials cost</a>
                </p>
            </div>
            <div class="form-group form-group--align-right alignright">
                <label>
                    Total materials costs
                    <input class="form-control alignright form-control-1-4 calculation-total-materials-row-js calculation-result-js"
                           readonly="readonly" type="text" id="material-costs-total-field"
                           data-calculation-fields="[id*=materialTotal]"
                           data-calculation-operations="+"
                           th:attr="data-binding-input=${'subsection-total-' + subSection.id},data-calculation-rawvalue=${costCategory.total}"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" />

                    <span th:class="'section-status ' + ${complete} + ' place-in-header'" th:attr="data-subsection-id=${subSection.id}" style="display: none;">
                        <span th:attr="data-binding-output=${'subsection-total-' + subSection.id}"
                                th:text="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}">
                        </span>
                    </span>
                </label>
            </div>
            <div class="alignright-button">
                <div th:include="question-type/form-elements :: form-mark-as-complete-buttons" th:remove="tag"/>
            </div>
        </div>
    </div>

    <!-- ===========================Form: capital usage =========================== -->
    <div th:fragment="capital_usage">
        <p th:text="${question.getDescription()}"></p>
        <div th:attr="data-finance-subsection-table-container=${question.getId()}" th:with="formInputType=${question.formInputs.get(0).formInputType},costCategory=${organisationFinance.get(T(com.worth.ifs.application.finance.CostType).fromString(formInputType.title))},type=${formInputType.title}" >
            <div th:each="capitalUsage : ${costCategory.costs}">
                <div class="form-row" th:attr="data-cost-row=${capitalUsage.id}">
                    <div class="form-group">
                        <label th:for="${'cost-capital_usage-'+capitalUsage.id+'-item'}">Item description</label>

                        <div th:include="question-type/form-elements :: form-finance-textarea (type=${type}, id=${capitalUsage.id}, name='item', value=${capitalUsage.getDescription()})" th:remove="tag" />

                        <a class="delete-row" th:attr="data-cost-row=${capitalUsage.id}" th:href="@{/application/{applicationId}/form/deletecost/{sectionId}/{capitalUsage}(capitalUsage=${capitalUsage.id},sectionId=${currentSectionId},applicationId=${applicationId})}">Remove</a>
                    </div>

                    <div class="form-group inline">
                        <label class="form-label">New or existing item</label>
                            <label class="block-label">
                                <input th:id="${'cost-capital_usage-'+capitalUsage.id+'-existing_0'}"
                                       type="radio"
                                       th:name="${type +'-existing-' + capitalUsage.id}"
                                       value="New"
                                       th:checked="${capitalUsage.existing == 'New'}">
                                New
                                </input>
                            </label>

                            <label class="block-label">
                                <input th:id="${'cost-capital_usage-'+capitalUsage.id+'-existing_1'}"
                                       type="radio"
                                       th:name="${type +'-existing-' + capitalUsage.id}"
                                       value="Existing"
                                       th:checked="${capitalUsage.existing == 'Existing'}">
                                Existing
                                </input>
                            </label>


                    </div>

                    <div class="form-group">
                        <label th:for="${'cost-capital_usage-'+capitalUsage.id+'-deprecation_period'}" class="form-label">Deprecation period (months)</label>
                        <input
                                type="number"
                                th:id="${'cost-capital_usage-'+capitalUsage.id+'-deprecation_period'}"
                                class="form-control form-finances-capital-usage-depreciation"
                                th:name="${type +'-deprecation_period-' + capitalUsage.id}"
                                th:value="${capitalUsage.deprecation}"/>
                    </div>

                    <div class="form-group">
                        <label th:for="${'cost-capital_usage-'+capitalUsage.id+'-npv'}" class="form-label">Net Present Value at the start of your project start or the price you bought it for (£)</label>
                        <input
                                type="number"
                                value="10000"
                                th:id="${'cost-capital_usage-'+capitalUsage.id+'-npv'}"
                                class="form-control form-finances-capital-usage-npv"
                                th:name="${type +'-npv-' + capitalUsage.id}"
                               th:value="${#numbers.formatDecimal(capitalUsage.npv,0,0)}"/>
                    </div>

                    <div class="form-group">
                        <label th:for="${'cost-capital_usage-'+capitalUsage.id+'-residual_value'}" class="form-label">Residual value at end of project (£)</label>
                        <input
                                type="number"
                                value="200"
                                th:id="${'cost-capital_usage-'+capitalUsage.id+'-residual_value'}"
                                class="form-control form-finances-capital-usage-residual-value"
                                th:name="${type +'-residual_value-' + capitalUsage.id}"
                               th:value="${#numbers.formatDecimal(capitalUsage.residualValue,0,0)}"/>
                    </div>

                    <div class="form-group">
                        <label th:for="${'cost-capital_usage-'+capitalUsage.id+'-utilisation'}" class="form-label">Utilisation (%)</label>
                        <input type="number"
                               value="20"
                               th:id="${'cost-capital_usage-'+capitalUsage.id+'-utilisation'}"
                               class="form-control form-finances-capital-usage-utilisation"
                               th:name="${type +'-utilisation-' + capitalUsage.id}"
                               th:value="${capitalUsage.utilisation}"/>
                    </div>

                    <div class="form-group">
                        <label th:for="${'cost-capital_usage-'+capitalUsage.id+'-netCost'}" class="form-label">Net Cost</label>
                        <input type="text"
                               th:attr="data-calculation-fields=${'#cost-capital_usage-'+capitalUsage.id+'-npv,#cost-capital_usage-'+capitalUsage.id+'-residual_value,#cost-capital_usage-'+capitalUsage.id+'-utilisation,#hundred-field'}"
                               data-calculation-operations="-,*,/"
                               readonly="readonly"
                               th:id="${'cost-capital_usage-'+capitalUsage.id+'-netCost'}"
                               th:name="${type + '-netCost-' + capitalUsage.id}"
                               th:value="'£ ' + ${#numbers.formatDecimal(capitalUsage.total, 0, 0)}"/>
                    </div>
                </div>
            </div>
            <p class="alignright">
                <a th:href="@{/application/{applicationId}/form/addcost/{sectionId}/{id}(id=${question.id},sectionId=${currentSectionId},applicationId=${applicationId})}" class="add-another-row" data-clone-rows="0">Add another asset</a>
            </p>
            <hr/>
            <div class="form-group form-group--align-right alignright">
                <label>
                    Total capital usage costs
                    <input class="form-control form-control-1-4 alignright" readonly="readonly" type="text" id="cost-capital-usage-costs-total-field"
                           data-calculation-fields="[id*=netCost]"
                           data-calculation-operations="+"
                           th:attr="data-binding-input=${'subsection-total-' + subSection.id}"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" />

                    <span th:class="'section-status ' + ${complete} + ' place-in-header'" th:attr="data-subsection-id=${subSection.id}" style="display: none;">
                        <span th:attr="data-binding-output=${'subsection-total-' + subSection.id}"
                                th:text="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}">
                        </span>
                    </span>
                </label>
            </div>
            <div class="alignright-button">
                <div th:include="question-type/form-elements :: form-mark-as-complete-buttons" th:remove="tag"/>
            </div>
        </div>
    </div>

    <!-- ===========================Form: subcontracting cost =========================== -->
    <div th:fragment="subcontracting_costs">
        <p th:text="${question.getDescription()}"></p>
        <div th:attr="data-finance-subsection-table-container=${question.getId()}" th:with="formInputType=${question.formInputs.get(0).formInputType},costCategory=${organisationFinance.get(T(com.worth.ifs.application.finance.CostType).fromString(formInputType.title))}">
            <div class="form-row" th:each="subContractingCost : ${costCategory.costs}" th:with="formInputType=${question.formInputs.get(0).formInputType},type=${formInputType.title}">
                <div class="form-group" th:attr="data-cost-row=${subContractingCost.id}">
                    <label class="form-label" th:for="${'cost-subcontracting-'+subContractingCost.id+'-companyName'}">Subcontractor name</label>
                    <input type="text" th:name="${type +'-name-' + subContractingCost.id}" class="form-control form-finances-subcontracting-company" th:id="${'cost-subcontracting-'+subContractingCost.id+'-companyName'}" th:value="${subContractingCost.name}" />
                    <a class="delete-row" th:attr="data-cost-row=${subContractingCost.id}" th:href="@{/application/{applicationId}/form/deletecost/{sectionId}/{subContractingCost}(subContractingCost=${subContractingCost.id},sectionId=${currentSectionId},applicationId=${applicationId})}">Remove</a>
                </div>

                <div class="form-group" th:attr="data-cost-row=${subContractingCost.id}">
                    <label class="form-label" th:for="${'cost-subcontracting-'+subContractingCost.id+'-country'}">Country where the subcontractor will work</label>
                    <input type="text" th:name="${type +'-country-' + subContractingCost.id}" class="form-control form-finances-subcontracting-country"
                           th:id="${'cost-subcontracting-'+subContractingCost.id+'-country'}" th:value="${subContractingCost.country}" />
                </div>

                <div class="form-group" th:attr="data-cost-row=${subContractingCost.id}">
                    <label class="form-label" th:for="${'cost-'+ type + '-'+subContractingCost.id+'-role'}">Role of the subcontractor in the project and description of the work they’ll do</label>

                    <div th:include="question-type/form-elements :: form-finance-textarea (type=${type}, id=${subContractingCost.id}, name='role', value=${subContractingCost.role})" th:remove="tag" />
                </div>

                <div class="form-group" th:attr="data-cost-row=${subContractingCost.id}">
                    <label class="form-label" th:for="${'cost-subcontracting_costs-'+subContractingCost.id+'-subcontractingCost'}">Cost</label>
                    <input type="number"
                           th:name="${type +'-subcontractingCost-' + subContractingCost.id}"
                           class="form-control form-finances-subcontracting-cost"
                           th:id="${'cost-subcontracting_costs-'+subContractingCost.id+'-subcontractingCost'}"
                           data-calculation-input="subcontracting-cost-row"
                           th:value="${#numbers.formatDecimal(subContractingCost.cost,0,0)}" />
                </div>
            </div>
            <p class="alignright">
                <a th:href="@{/application/{applicationId}/form/addcost/{sectionId}/{id}(id=${question.id},sectionId=${currentSectionId},applicationId=${applicationId})}" class="add-another-row" data-clone-rows="0">Add another subcontractor</a>
            </p>
            <div class="form-group form-group--align-right alignright">
                <label>
                    Total subcontracting costs
                    <input class="form-control form-control-1-4 alignright"
                           readonly="readonly"
                           type="text"
                           id="cost-subcontracting-total"
                           data-calculation-fields="[id*=subcontractingCost]"
                           data-calculation-operations="+"
                           th:attr="data-binding-input=${'subsection-total-' + subSection.id},data-calculation-rawvalue=${costCategory.getTotal()}"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" />

                    <span th:class="'section-status ' + ${complete} + ' place-in-header'" th:attr="data-subsection-id=${subSection.id}" style="display: none;">
                        <span th:attr="data-binding-output=${'subsection-total-' + subSection.id}"
                                th:text="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}">
                        </span>
                    </span>
                </label>
            </div>
            <div class="alignright-button">
                <div th:include="question-type/form-elements :: form-mark-as-complete-buttons" th:remove="tag"/>
            </div>
        </div>
    </div>
    <!-- ===========================Form: travel cost =========================== -->
    <div th:fragment="travel">
        <p th:text="${question.description}"></p>
        <div th:attr="data-finance-subsection-table-container=${question.getId()}" th:with="formInputType=${question.formInputs.get(0).formInputType},costCategory=${organisationFinance.get(T(com.worth.ifs.application.finance.CostType).fromString(formInputType.title))},type=${formInputType.title}">
            <div class="form-group">
                <table id="travel-costs-table">
                    <thead>
                    <tr>
                        <th>Purpose of journey or description of subsistence cost</th>
                        <th class="numeric">Number of times</th>
                        <th class="numeric">Cost each (£)</th>
                        <th class="numeric">Total (£)</th>
                        <th>&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <div th:each="travelCost : ${costCategory.costs}" >
                        <tr th:attr="data-cost-row=${travelCost.id}">
                            <td>
                                <input type="text" th:name="${type +'-travelPurpose-' + travelCost.id}" class="form-control form-control-1-1 form-finances-travel-purpose" th:id="${'cost-'+type+'-'+travelCost.id+'-travelPurpose'}" th:value="${travelCost.getItem()}" />
                            </td>
                            <td class="numeric">
                                <input type="number" th:name="${type +'-travelNumTimes-' + travelCost.id}" class="form-control form-control-1-1 form-finances-travel-number" th:id="${'cost-'+type+'-'+travelCost.id+'-travelNumTimes'}" th:value="${travelCost.getQuantity()}" />
                            </td>
                            <td class="numeric">
                                <input type="number" th:name="${type +'-travelCostEach-' + travelCost.id}" class="form-control form-control-1-1 form-finances-travel-cost" th:id="${'cost-'+type+'-'+travelCost.id+'-travelCostEach'}" th:value="${#numbers.formatDecimal(travelCost.getCostPerItem(),0,0)}" />
                            </td>
                            <td class="numeric">
                                <input type="text"
                                       th:name="${type +'-travelCostTotal-' + travelCost.id}"
                                       class="form-finances-travel-total"
                                       readonly="readonly"
                                       th:id="${'cost-'+type+'-'+travelCost.id+'-travelCostTotal'}"
                                       th:attr="data-calculation-fields='#'+${'cost-'+type+'-'+travelCost.id+'-travelCostEach'}+',#'+${'cost-'+type+'-'+travelCost.id+'-travelNumTimes'},data-calculation-rawValue=${travelCost.getTotal()}"
                                       data-calculation-operations="*"
                                       th:value="'£ ' + ${#numbers.formatDecimal(travelCost.getTotal(), 0, 'COMMA', 0, 'POINT')}" />
                            </td>
                            <td>
                                <a class="delete-row" th:attr="data-cost-row=${travelCost.id}" th:href="@{/application/{applicationId}/form/deletecost/{sectionId}/{travelCost}(travelCost=${travelCost.id},sectionId=${currentSectionId},applicationId=${applicationId})}">Remove</a>
                            </td>
                        </tr>
                    </div>
                    </tbody>
                </table>

                <p class="alignright">
                    <a th:href="@{/application/{applicationId}/form/addcost/{sectionId}/{id}(id=${question.id},sectionId=${currentSectionId},applicationId=${applicationId})}" class="add-another-row" data-clone-rows="0">Add another travel cost</a>
                </p>
            </div>
            <div class="form-group form-group--align-right alignright">
                <label>
                    Total travel &amp; subsistence costs
                    <input class="form-control form-control-1-4 alignright" readonly="readonly" type="text" id="travel-costs-total-field"
                           data-calculation-fields="[id*=travelCostTotal]"
                           data-calculation-operations="+"
                           th:attr="data-binding-input=${'subsection-total-' + subSection.id}"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}" />

                    <span th:class="'section-status ' + ${complete} + ' place-in-header'" th:attr="data-subsection-id=${subSection.id}" style="display: none;">
                        <span th:attr="data-binding-output=${'subsection-total-' + subSection.id}"
                                th:text="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}">
                        </span>
                    </span>
                </label>
            </div>
            <div class="alignright-button">
                <div th:include="question-type/form-elements :: form-mark-as-complete-buttons" th:remove="tag"/>
            </div>
        </div>
    </div>

    <!-- ===========================Form: other cost =========================== -->
    <div th:fragment="other_costs">
        <p th:text="${question.description}"></p>
        <div th:attr="data-finance-subsection-table-container=${question.getId()}" th:with="formInputType=${question.formInputs.get(0).formInputType},costCategory=${organisationFinance.get(T(com.worth.ifs.application.finance.CostType).fromString(formInputType.title))},type=${formInputType.title}">
            <div class="form-group">
                <table id="other-costs-table">
                    <thead>
                    <tr>
                        <th>Description and justification of the cost</th>
                        <th class="numeric">Estimated cost (£)</th>
                        <th>&nbsp;</th>
                    </tr>
                    </thead>
                    <tbody>
                    <div th:each="otherCost : ${costCategory.costs}" >
                        <tr th:attr="data-cost-row=${otherCost.id}">
                            <td>
                                <div th:include="question-type/form-elements :: form-finance-textarea (type=${type}, id=${otherCost.id}, name='description', value=${otherCost.description})" th:remove="tag" />
                            </td>
                            <td class="numeric">
                                <input type="number" th:name="${type +'-otherCost-' + otherCost.id}" class="form-control form-control-1-1 form-finances-other-cost" th:id="${'cost-'+type+'-'+otherCost.id+'-otherCost'}" th:value="${#numbers.formatDecimal(otherCost.getCost(),0,0)}"/>
                            </td>
                            <td>
                                <a class="delete-row" th:attr="data-cost-row=${otherCost.id}" th:href="@{/application/{applicationId}/form/deletecost/{sectionId}/{otherCost}(otherCost=${otherCost.id},sectionId=${currentSectionId},applicationId=${applicationId})}">Remove</a>
                            </td>
                        </tr>
                    </div>
                    </tbody>
                </table>

                <p class="alignright">
                    <a th:href="@{/application/{applicationId}/form/addcost/{sectionId}/{id}(id=${question.id},sectionId=${currentSectionId},applicationId=${applicationId})}" class="add-another-row" data-clone-rows="0">Add another cost</a>
                </p>
            </div>
            <div class="form-group form-group--align-right alignright">
                <label>
                    Total other costs
                    <input class="form-control form-control-1-4 alignright" readonly="readonly" type="text" id="other-costs-total-field"
                           th:attr="data-binding-input=${'subsection-total-' + subSection.id}"
                           data-calculation-fields="[id*=otherCost]"
                           data-calculation-operations="+"
                           th:value="'£ ' + ${#numbers.formatDecimal(costCategory.total, 0, 'COMMA', 0, 'POINT')}"/>

                    <span th:class="'section-status ' + ${complete} + ' place-in-header'" th:attr="data-subsection-id=${subSection.id}" style="display: none;">
                        <span th:attr="data-binding-output=${'subsection-total-' + subSection.id}"
                                th:text="'£ ' + ${#numbers.formatDecimal(costCategory.getTotal(), 0, 'COMMA', 0, 'POINT')}">
                        </span>
                    </span>

                </label>
            </div>
            <div class="alignright-button">
                <div th:include="question-type/form-elements :: form-mark-as-complete-buttons" th:remove="tag"/>
            </div>
        </div> 
    </div>

    <!-- ===========================Form: Other funding=========================== -->
    <div th:fragment="other_funding">
        <div th:include="question-type/form-elements :: form-label (name=${question.getName()}, id=${question.getFormInputs().get(0).getId()}, bold=true)" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-hint (hint=${question.getDescription()})" th:remove="tag" />
        <div th:include="question-type/form-elements :: form-guidance" th:remove="tag" />

        <div th:attr="data-finance-subsection-table-container=${question.getId()}"
             th:with="formInputType=${question.formInputs.get(0).formInputType},
                               costCategory=${organisationFinance.get(T(com.worth.ifs.application.finance.CostType).fromString(formInputType.title))}
                     ,type=${formInputType.title}">
        <fieldset class="inline" id="otherFundingShowHideToggle">
            <div class="form-block inline">
                <label th:class="${'block-label'  + (costCategory.otherFunding?.equals('Yes') ? ' selected focused' : '')}" 
                       th:for="${'cost-otherFunding-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding-yes'}"
                       data-target="other-funding-table">
                    <input type="radio"
                           th:id="${'cost-otherFunding-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding-yes'}"
                           th:name="${type + '-otherPublicFunding-' + costCategory.otherFundingCostItem?.id}"
                           th:value="Yes"
                           th:checked="${costCategory.otherFunding?.equals('Yes')}" 
                           />
                    Yes
                </label>
                <label th:class="${'block-label'  + (costCategory.otherFunding?.equals('No') ? ' selected focused' : '')}" 
                       th:for="${'cost-otherFunding-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding-no'}">
                    <input type="radio"
                           th:id="${'cost-otherFunding-'+costCategory.otherFundingCostItem?.id+'-otherPublicFunding-no'}"
                           th:name="${type + '-otherPublicFunding-' + costCategory.otherFundingCostItem?.id}"
                           th:value="No"
                           th:checked="${costCategory.otherFunding?.equals('No')}"/>
                    No
                </label>
            </div>
                <div class="form-group"  id="other-funding-table">
                    <table>
                        <thead>
                        <tr>
                            <th>Source of funding</th>
                            <th class="width-medium">Date secured</th>
                            <th class="width-medium">Funding amount (£)</th>
                        </tr>
                        </thead>
                        <tbody>
                        <div th:each="otherFunding : ${costCategory.costs}" >
                            <tr>
                                <td>
                                    <label th:for="${'cost-'+type+'-'+otherFunding.id+'-source'}" class="visuallyhidden">Source of funding</label>
                                    <input type="text" th:name="${type +'-fundingSource-' + otherFunding.id}" class="width-full" th:id="${'cost-'+type+'-'+otherFunding.id+'-source'}" th:value="${otherFunding.fundingSource}" />
                                </td>
                                <td>
                                    <label th:for="${'cost-'+type+'-'+otherFunding.id+'-date'}" class="visuallyhidden">Date secured</label>
                                    <input type="text" th:name="${type +'-dateSecured-' + otherFunding.id}" class="width-medium" th:id="${'cost-'+type+'-'+otherFunding.id+'-date'}" placeholder="MM-YYYY" th:value="${otherFunding.securedDateMonth}" />
                                </td>
                                <td>
                                    <label th:for="${'cost-'+type+'-'+otherFunding.id+'-fundingAmount'}" class="visuallyhidden">Funding amount (£)</label>
                                    <input type="number" th:name="${type +'-fundingAmount-' + otherFunding.id}"  th:id="${'cost-'+type+'-'+otherFunding.id+'-fundingAmount'}" th:value="${#numbers.formatDecimal(otherFunding.fundingAmount,0,0)}" />
                                </td>
                            </tr>
                            </div>
                        </tbody>
                    </table>
                    <p class="alignright">
                        <a th:href="@{/application/{applicationId}/form/addcost/{sectionId}/{id}(id=${question.id},sectionId=${currentSectionId},applicationId=${applicationId})}" class="add-another-row" data-clone-rows="0">Add another source of funding</a>
                    </p>
                    <p>Your updated funding level is <strong>60%</strong></p>
                    <details>
                        <summary><span class="summary">Why has this changed?</span></summary>
                        <div class="panel-indent">
                            Help text required
                        </div>
                    </details>
                </div>
            </fieldset>
            <div class="alignright-button extra-margin">
                <div th:include="question-type/form-elements :: form-mark-as-complete-buttons" th:remove="tag"/>
            </div>
        </div>
    </div>
    <!-- ===========================Form: financial summary (question type) =========================== -->
    <div th:fragment="financial_summary" th:if="${financeTotalPerType}">
        <h2 class="heading-medium">Finances Summary</h2>
        <div th:include="question-type/types :: application_finances_summary" th:remove="tag" />
        <div class="icon icon-information"></div><span>Please provide your financial breakdown in the <a th:href="@{/application/{id}/form/section/7/(id=${currentApplication.getId()})}" >Your finances</a> section.</span>
        <h2 class="heading-medium">Project cost breakdown</h2>
        <div th:include="question-type/types :: financial_summary_table" th:remove="tag"/>
        <p>This is the level of cost detail that the assessors will see during the assessment process.</p>
    </div>
    <!-- ===========================Form: financial summary/breakdown table =========================== -->
    <div th:fragment="financial_summary_table" th:if="${financeTotalPerType}">
        <div class="form-group">
            <div style="overflow: auto;">
                <table>
                    <thead>
                    <tr>
                        <th scope="col">&nbsp;</th>
                        <th scope="col" class="numeric">Total</th>
                        <th scope="col" class="numeric" th:each="applicationOrganisation : ${applicationOrganisations}">
                            <div th:text="${applicationOrganisation.name}"></div>
                            <div th:if="${applicationOrganisation.equals(leadOrganisation)}"><small>Lead organisation</small></div>
                            <div th:unless="${applicationOrganisation.equals(leadOrganisation)}"><small>Partner</small></div>
                        </th>
                    </tr>
                    </thead>
                    <tbody>
                    <tr th:each="financeSubSection : ${financeSection.ChildSections}" th:with="question=${financeSubSection.questions.get(0)},formInputType=${question.getFormInputs().get(0).getFormInputType()}">
                        <th th:text="${financeSubSection.name}"></th>
                        <td class="numeric" th:each="financeTotal: ${financeTotalPerType.get(T(com.worth.ifs.application.finance.CostType).fromString(formInputType.title))}"
                            th:text="'£'+${#numbers.formatDecimal(financeTotal, 0, 'COMMA', 0, 'POINT')}">
                        </td>
                        <div th:each="applicationOrganisation : ${applicationOrganisations}" th:remove="tag"  >
                            <td class="numeric" th:each="organisationFinance : ${organisationFinances}"
                                th:if="${applicationOrganisation.id == organisationFinance.organisation.id}"
                                th:with="formInputType=${question.formInputs.get(0).formInputType},category = ${organisationFinance.getCostCategory(T(com.worth.ifs.application.finance.CostType).fromString(formInputType.title))}"
                                th:text="'£'+${#numbers.formatDecimal(category.total, 0, 'COMMA', 0, 'POINT')}">
                            </td>
                        </div>
                    </tr>
                    <tr>
                        <th>Total</th>
                        <td class="numeric" style="font-weight: 700;" th:text="'£'+${#numbers.formatDecimal(financeTotal, 0, 'COMMA', 0, 'POINT')}">
                        </td>
                        <div th:each="applicationOrganisation : ${applicationOrganisations}" th:remove="tag"  >
                            <td class="numeric" th:each="organisationFinance : ${organisationFinances}" th:if="${applicationOrganisation.id == organisationFinance.organisation.id}"
                                th:text="'£'+${#numbers.formatDecimal(organisationFinance.total, 0, 'COMMA', 0, 'POINT')}"></td>
                        </div>
                    </tr>
                    </tbody>
                </table>
            </div>
        </div>
    </div>

    <!-- ===========================Form: funding breakdown =========================== -->
    <div th:fragment="application_finances_summary" th:if="${financeTotalPerType}">

      <div class="form-group">

            <table>
                <thead>
                <tr>
                    <th scope="col">&nbsp;</th>
                    <th scope="col" class="numeric">Total</th>
                    <th scope="col" class="numeric" th:each="applicationOrganisation : ${applicationOrganisations}">
                        <div th:text="${applicationOrganisation.name}"></div>
                        <div th:if="${applicationOrganisation.equals(leadOrganisation)}"><small>Lead organisation</small></div>
                        <div th:unless="${applicationOrganisation.equals(leadOrganisation)}"><small>Partner</small></div>
                    </th>
                </tr>
                </thead>
                <tbody>
                <tr>
                    <th>Total costs</th>
                    <td class="numeric" th:text="'£'+${#numbers.formatDecimal(financeTotal, 0, 'COMMA', 0, 'POINT')}">
                    </td>
                    <div th:each="applicationOrganisation : ${applicationOrganisations}" th:remove="tag"  >
                            <td class="numeric" th:each="organisationFinance : ${organisationFinances}" th:if="${applicationOrganisation.id == organisationFinance.organisation.id}"
                            th:text="'£'+${#numbers.formatDecimal(organisationFinance.total, 0, 'COMMA', 0, 'POINT')}"></td>
                    </div>
                </tr>
                <tr>
                    <th>% Grant</th>
                    <td class="numeric" th:text="${#numbers.formatDecimal(grantTotalPercentage, 0, 'COMMA', 0, 'POINT')}"></td>
                    <div th:each="applicationOrganisation : ${applicationOrganisations}" th:remove="tag"  >
                        <td class="numeric" th:each="organisationFinance : ${organisationFinances}" th:if="${applicationOrganisation.id == organisationFinance.organisation.id}"
                            th:text="${organisationFinance.grantClaimPercentage}"></td>
                    </div>
                </tr>
                <tr>
                    <th>Funding sought</th>
                    <td class="numeric">£258,727</td>
                    <td class="numeric">£142,404</td>
                    <td class="numeric">£73,862</td>
                    <td class="numeric">£42,461</td>
                </tr>
                <tr>
                    <th>Other public sector funding</th>
                    <td class="numeric">£0</td>
                    <td class="numeric">£0</td>
                    <td class="numeric">£0</td>
                    <td class="numeric">£0</td>
                </tr>
                <tr>
                    <th>Contribution to project</th>
                    <td class="numeric">£192,256</td>
                    <td class="numeric">£142,404</td>
                    <td class="numeric">£31,655</td>
                    <td class="numeric">£18,198</td>
                </tr>
                </tbody>
            </table>
        </div>
    </div>
</html>
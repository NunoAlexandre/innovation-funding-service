<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <div th:include="fragments/layout :: head" th:with="pageTitle='Application Details'"  th:remove="tag" />
</head>
<body class="app-details">

<div th:include="fragments/layout :: body-start" th:remove="tag" />
<div th:include="fragments/layout :: global-header" th:remove="tag" />


<main id="content">
    <div th:include="fragments/layout :: main-content-start" th:remove="tag" />
    <div th:include="fragments/layout :: header-sub" th:with="currentApplication=${currentApplication}" th:remove="tag" />
    <div th:include="fragments/elements :: notification" th:remove="tag" />

    <h1 class="heading-xlarge">Application overview</h1>
    <div class="grid-row">
        <div class="column-half competition-details">
            <h2 class="bold-medium">Competition details</h2>
            <p th:text="${currentCompetition.getDescription()}" />
            <h3 class="heading-small">Application progress:</h3>
            <div th:include="fragments/elements :: progress-indicator" th:with="percentage=${completedQuestionsPercentage},size='medium'" th:remove="tag" />
        </div>

        <div class="column-half">
            <h2 class="bold-medium">Application Team</h2>
            <ul class="list-bullet">
                <li th:each="organisation : ${applicationOrganisations}">
                    <span th:text="${organisation.getName()}"></span>
                    <small th:if="${organisation.equals(leadOrganisation)}">(Lead partner)</small>
                </li>
            </ul>
        </div>
        <p><a href="">View team members and add collaborators</a></p>
    </div>
   
    <form action="#" method="post">

    <div class="collapsible section-overview js-close-others">
        <div th:remove="tag" th:each="section : ${sections}">
            <h2 th:class="((${section.getId()} == ${currentSectionId}) ? 'open':'')">
                <span th:remove="tag" th:text="${section.getName()}" />
                <span class="section-status complete" th:if="${completedSections.contains(section.getId())}"><span class="visuallyhidden">-</span> Complete</span>
                <span class="section-status assigned" th:if="${assignedSections?.contains(section.id)}"><span class="visuallyhidden">-</span> Assigned</span>
            </h2>
            <ul th:with="currentUser=${#authentication.getDetails()}">
                <li th:class="'section '+(${question.isMarkAsCompletedEnabled() and question.isMarkedAsComplete(userOrganisation.id)} ? 'marked-as-complete ' : (${currentUser.getId() == questionAssignee?.getAssignee()?.getUser()?.getId()} ? 'assigned-to-me ' : ''))"
                    th:each="question : ${section.getQuestions()}" 
                    th:if="${question?.getName() != '' }" 
                    th:with="questionAssignee=(${questionAssignees.get(question.getId())}),response=(${responses.get(question.getId())})">
                         <div class="grid-row">
                            <div class="column-two-thirds">
                                <h4 class="heading-medium">
                                     <a th:href="'/application-form/'+${currentApplication.getId()}+'/section/'+${section.getId()}+'/&#35;question-'+${question.getId()}"
                                        th:text="${question.getName()}" />     
                                </h4>
                                <div th:unless="${response == null or response?.getUpdateDate() == null}" th:include="question-type/form-elements :: last-update-info" th:remove="tag"/>

                            </div>
                            <div class="column-third">
                                <div th:unless="${(question.isMarkAsCompletedEnabled() and question?.isMarkedAsComplete(userOrganisation.id)) or completedSections.contains(section.id)}" class="assignee"  >
                                    <!--prints the last update info-->
                                    <div th:include="question-type/form-elements :: assign-buttons" th:remove="tag"/>
                                    <div  th:if="${questionAssignee?.getAssignee() != null} " th:remove="tag">
                                         <div> Assigned to <strong th:text="${name}" th:with="name=${(questionAssignee?.getAssignee()?.getUser()?.getId() == currentUser.getId()) ? 'You' : questionAssignee?.getAssignee()?.getUser()?.getName()}" /></div>
                                        <span th:if="${questionAssignee?.getAssignedDate()?.getDayOfYear() eq todayDay}" th:text="Today"/>
                                        <span th:if="${questionAssignee?.getAssignedDate()?.getDayOfYear() eq yesterdayDay}" th:text="Yesterday"/>
                                        <span th:unless="${questionAssignee?.getAssignedDate()?.getDayOfYear() eq todayDay or response?.getUpdateDate()?.getDayOfYear() eq yesterdayDay}"
                                            th:text="${#temporals.format(questionAssignee?.getAssignedDate(), 'dd/MMM/yyyy HH:mm')}"/>
                                    </div>
                                </div>  
                            </div>
                        </div>
                 </li>
            </ul>
        </div>
    </div>
    </form>
    <div class="alignright-button">
        <a role="button" tabindex="0" class="button" th:href="@{/application/{id}/summary(id=${currentApplication.getId()})}">Review &amp; submit</a>
    </div>


    <div th:include="fragments/layout :: main-content-end" th:remove="tag" />
</main>

<div th:include="fragments/layout :: footer" th:remove="tag" />
<div th:include="fragments/layout :: body-end" th:remove="tag" />
</body>
</html>

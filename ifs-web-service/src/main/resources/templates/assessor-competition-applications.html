<!DOCTYPE html>
<html class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <div th:include="fragments/layout :: head" th:with="pageTitle='Assessor Dashboard'" th:remove="tag" />
</head>
<body class="app-dashboard">

<div th:include="fragments/layout :: body-start" th:remove="tag" />
<div th:include="fragments/layout :: global-header" th:remove="tag" />



<main id="content">
    <div th:include="fragments/layout :: main-content-start" th:remove="tag" />
    <div th:include="fragments/layout :: header-sub-generic" th:with="daysPercentage = ${competition.getAssessmentDaysLeftPercentage()},
            daysLeft=${competition.getAssessmentDaysLeft()},
            title = ${competition.name},
            deadlineText= 'Days left to accept'" th:remove="tag" />

    <header class="page-header group no-pad">
        <h1 class="heading-xlarge">Competition Details</h1>
    </header>

    <div class="grid-row">
        <div class="column-two-thirds competition-details">
            <!--<p th:text="${competition.getDescription()}" />-->
            <p>Please refer to scoring guidance found alongside each question for mark bandings.
                Use the full range of marks and do not be afraid of the extremes if you believe that
                the application warrants the score. Please provide constructive feedback comments for every question
                on the score sheet, even if you think that the application is out of scope.
            </p>
            <p>
                Please return all competed score sheets by <strong><span th:text="${'Noon ' + #temporals.format(competition.getAssessmentEndDate(),'dd MMMM yyyy')}"/></strong>
            </p>
        </div>

        <div class="column-third">
            <ul class="list-bullet">
                <li><a href="#">Competition brief</a></li>
                <li><a href="#">Guidance for applicants</a></li>
                <li><a href="#">Assessor briefing materials</a></li>
                <li><a href="#">General assessment guidance</a></li>
            </ul>
        </div>
    </div>

    <div class="my-applications">

        <div class="in-progress">
            <h3 class="heading-large">Applications for Assessment (<span th:text="${assessments.size()}"/>)</h3>
            <ul class="boxed-list" th:unless="${assessments.size() == 0 }" >
                <form id="bulk_assessments_submission" action="/assessor/submit-assessments" method="POST" onsubmit="return confirm('This is your final chance to make changes to the assessment. You will not be able to access the application after this point. Are you sure you want to submit?');">
                <li th:each="assessment : ${assessments}" th:unless="${assessment.getProcessStatus().equals('rejected')}">
                    <div class="grid-row">
                        <div class="column-assessment-details">
                            <h4 class="heading-medium">
                                <a th:href="@{/assessor/competitions/{cid}/applications/{aid}(cid=${competition.id},aid=${assessment.application.id})}" th:text="${assessment.application.name}">link for application assessment</a>
                                <!--">-->
                            </h4>
                            <div><p th:text="${assessment.application.getProcessRoles().get(0).getOrganisation().getName()}" /></div>
                        </div>
                        <div class="column-assessment-status navigation-right">
                            <div th:class="${'application-status ' + #strings.toLowerCase(assessment.getProcessStatus()) + ' ' + #strings.toLowerCase(assessment.getRecommendedValue())}">
                                <p th:text="${#strings.capitalizeWords(assessment.getProcessStatus().toLowerCase())}">Assessment Status</p>

                                <!--if assessment is pending acceptance-->
                                <p class="application-listing_pending" th:unless="${assessment.getProcessStatus()} neq 'pending'">
                                    <a th:href="@{/assessor/competitions/{cid}/applications/{aid}(cid=${competition.id},aid=${assessment.application.id})}">accept / reject assessment</a>
                                </p>

                                <!--otherwise shows the overall score -->
                                <p class="application-listing_pending" th:unless="${assessment.getProcessStatus() eq 'pending' or assessment.hasAssessmentStarted() == false}">
                                    <h3 class="score"><span th:text="${assessment.getOverallScore()}"/> %</h3>
                                    <small>Overall score</small>
                                    <div class="recommend-container">
                                        <p th:if="${assessment.getRecommendedValue() == T(com.worth.ifs.assessment.domain.RecommendedValue).YES}" th:class="${'recommend yes'}"> <span>Recommended</span> </p>
                                        <p th:if="${assessment.getRecommendedValue() == T(com.worth.ifs.assessment.domain.RecommendedValue).NO}"  th:class="${'recommend no'}"> <span>Not recommended</span> </p>
                                    </div>
                                </p>
                            </div>
                        </div>
                    </div>
                    <label>
                        <input th:unless="${assessment.getProcessStatus() eq 'pending' or assessment.hasAssessmentStarted() == false}"
                               class="assessment-submit-checkbox" type="checkbox" name="submitted[]" th:value="${assessment.id}" />
                    </label>
                </li>

                    <div class="alignright">
                        <input type="hidden" name="competitionId" th:value="${competition.id}" />
                        <button class="button button-pull-right no-margin" name="submit_assessments" id="formSubmitAssessmentButton" type="submit">Submit applications</button>
                    </div>
                </form>

            </ul>
        </div>


        <!--all the submitted assessments-->
        <div class="submitted" th:unless="${submittedAssessments.size() == 0 }" >
            <h4 class="heading-medium">Submitted Assessment (<span th:text="${submittedAssessments.size()}"/>)</h4>
            <ul class="boxed-list" >
                <li th:each="assessment : ${submittedAssessments}">
                    <div class="grid-row">
                        <div class="column-assessment-details">
                            <h4 class="heading-medium" th:text="${assessment.application.name}"/>

                            <div><p th:text="${assessment.application.getProcessRoles().get(0).getOrganisation().getName()}" /></div>
                        </div>
                        <div class="column-assessment-status navigation-right">
                            <div th:class="${'application-status ' + #strings.toLowerCase(assessment.getProcessStatus()) + ' ' + #strings.toLowerCase(assessment.getRecommendedValue())}">
                                <p th:text="${#strings.capitalizeWords(assessment.getProcessStatus().toLowerCase())}">Assessment Status</p>

                                <!-- shows the overall score -->
                                <h3 class="score"><span th:text="${assessment.getOverallScore()}"/>%</h3>
                                <small>Overall score</small>
                                <div class="recommend-container">
                                    <p th:if="${assessment.getRecommendedValue() == T(com.worth.ifs.assessment.domain.RecommendedValue).YES}" th:class="${'recommend yes'}"> <span>Recommended</span> </p>
                                    <p th:if="${assessment.getRecommendedValue() == T(com.worth.ifs.assessment.domain.RecommendedValue).NO}"  th:class="${'recommend no'}"> <span>Not recommended</span> </p>
                                </div>
                            </div>
                        </div>
                    </div>
                </li>
            </ul>
        </div>
    </div>


    <div th:include="fragments/layout :: main-content-end" th:remove="tag" />
</main>


<div th:include="fragments/layout :: footer" th:remove="tag" />
<div th:include="fragments/layout :: body-end" th:remove="tag" />



</body>
</html>
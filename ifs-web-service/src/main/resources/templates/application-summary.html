<!DOCTYPE html>
<html  class="no-js" lang="en" xmlns:th="http://www.w3.org/1999/xhtml">
<head>
    <div th:include="fragments/layout :: head" th:with="pageTitle='Application Summary'"  th:remove="tag" />
</head>
<body class="app-summary">
<div th:include="fragments/modals :: modal-overlay" th:remove="tag" />
<div th:include="fragments/modals ::modal-confirm-submit
    (messageTitle='This is your final chance to make changes to the application.',
     message='You will not be able to access the application after this point. Are you sure you want to submit?',
     submitLink='/application/'+${currentApplication.getId()}+'/submit',
     submitText='Yes, I want to submit my application',
     cancelText='Cancel')"
     th:remove="tag" />


<div th:include="fragments/layout :: body-start" th:remove="tag" />
<div th:include="fragments/layout :: global-header" th:remove="tag" />

<main id="content">
    <div th:include="fragments/layout :: main-content-start" th:remove="tag" />
    <div th:include="fragments/layout :: header-sub" th:with="currentApplication=${currentApplication}" th:remove="tag" />

    <a class="back" th:href="@{/application-form/{id}/section/1(id=${currentApplication.getId()})}">&lt; Back to application</a>
    
    <h1 class="heading-xlarge">Application Summary</h1>
    <p class="subtitle">
        Please review your application before final submission. Any section where there are errors or problems with the content have been highlighted in red.
    </p>

    <div class="collapsible section-overview">
        <div th:remove="tag" th:each="section : ${sections.values()}" th:unless='${section.name.equals("Finances")}'>
            <h2 th:text="${section.getName()}" th:class="((${section.getId()} == ${currentSectionId}) ? 'open':'') +
                    ' '+ ((${completedSections.contains(section.getId())}) ? 'section-complete':'')+
                    ' '+ ((${incompletedSections.contains(section.getId())}) ? 'section-incomplete':'')" />

                <!-- TODO DW 578 - responses need to be form input responses -->
                <div th:each="question : ${section.getQuestions()}">
                    <div class="question" th:each="formInput : ${question.getFormInputs()}" th:if='${question.getName() != ""}' th:with="readonly=true, response=(${responses.get(question.getId())})" th:id="'question-'+${question.getId()}" >
                        <div th:replace="question-type/types :: ${formInput.getFormInputType().getTitle()}" th:unless='${formInput.getFormInputType().getTitle().equals("finance"}' th:with="$question=(${question}), $currentApplication=(${currentApplication}), $response=(${response}), $section=(${section}), $readonly=${readonly}" />
                    </div>
                </div>
        </div>
        <h2>Finances Summary</h2>
        <div class="question">
            <p>This is the overview of the finances provided by all partners in this project.</p>
            <p>To make changes to your organisations' finances, go back to the <a th:href='${"/application-form/"+currentApplication.id+"/section/7/"}'>your finances</a> section.</p>

            <div th:replace="question-type/types :: application_finances_summary"></div>
            <h2 class="heading-medium">Funding breakdown</h2>
            <div th:include="question-type/types :: financial_summary_table" th:remove="tag"/>
        </div>

    </div>
    <hr/>
    <div>
        <span class="icon icon-information"></span>
        <span> You will not be able to make changes to your application or resubmit after this point. By submitting this application you are agreeing to Innovate UK's <a href="">terms and conditions</a>.</span>
    </div>

    <div class="alignright-button">
        <a role="button" tabindex="0" class="button large" data-js-modal="modal-confirm-submit" th:href="@{/application/{id}/confirm-submit(id=${currentApplication.getId()})}" th:if="${incompletedSections.size() == 0}">Submit application</a>
        <button disabled="disabled" class="button" th:unless="${incompletedSections.size() == 0}">Submit application</button>
    </div>

    <div th:include="fragments/layout :: main-content-end" th:remove="tag" />
</main>

<div th:include="fragments/layout :: footer" th:remove="tag" />
<div th:include="fragments/layout :: body-end" th:remove="tag" />
</body>
</html>

var ifs_autoSave=function(){"use strict";var e;return{settings:{inputFields:jQuery(".form-serialize-js input").not('[type="button"],[readonly="readonly"]'),textareas:jQuery(".form-serialize-js textarea").not('[readonly="readonly"]')},init:function(){e=this.settings;var a=e.inputFields.add(e.textareas);this.initAutosaveElements(a)},initAutosaveElements:function(e){var a={callback:function(e){ifs_autoSave.fieldChanged(this)},wait:500,highlight:!1,captureLength:1};e.typeWatch(a),e.off("change").on("change",function(e){ifs_autoSave.fieldChanged(e.target)})},fieldChanged:function(e){var a=$(e),t=a.attr("id"),r={value:e.value,questionId:t,fieldName:a.attr("name"),applicationId:jQuery(".form-serialize-js #application_id").val()},i=$(".form-serialize-js").serialize(),n=a.closest(".form-group"),s=n.find(".textarea-save-info"),o=(new Date).getTime();0===s.length&&(n.find(".textarea-footer").append('<span class="textarea-save-info" />'),s=n.find(".textarea-save-info")),jQuery.ajax({type:"POST",url:"/application-form/saveFormElement",data:r,dataType:"json",beforeSend:function(){s.html("Saving...")}}).done(function(e){var t=(new Date).getTime();jQuery(".form-serialize-js").data("serializedFormState",i),a.removeClass("error"),n.removeClass("error"),"true"==e.success&&(1500>t-o?setTimeout(function(){s.html("Saved!")},1500):s.html("Saved!"))}).fail(function(e){var r=e.responseJSON.errorMessage;if(n.length)if(n.addClass("error"),s.length)s.html(r);else{var i=n.find("label").first();i.length&&i.append('<span class="error-message" id="error-message-'+t+'">'+r+"</span>")}else a.addClass("error")})}}}();
var ifs_collapsible=function(){"use strict";var a;return{settings:{collapsibleEl:".collapsible > h2, .assign-container .assign-button"},init:function(){a=this.settings,ifs_collapsible.collapsibleWithinScope(jQuery(document))},collapsibleWithinScope:function(i){var e=i.find("[data-collapsible-id]"),l=0;e.each(function(a,i){var e=i.attr("data-collapsible-id");l=Math.max(l,parseInt(e))}),i.find(a.collapsibleEl).each(function(a,i){var e=jQuery(this);ifs_collapsible.addCollapsibleBehaviourToElement(e,a,l+1)})},addCollapsibleBehaviourToElement:function(a,i,e){var l="collapsible-"+(i+e),t=a.hasClass("open"),n=!1;a.closest(".collapsible").hasClass("js-close-others")&&(n=!0),a.nextUntil("h2").wrapAll('<div id="'+l+'" aria-hidden="'+!t+'">');var s=a.next();a.wrapInner('<button aria-expanded="'+t+'" aria-controls="'+l+'" type="button">');var r=a.children("button");r.off("click").on("click",function(){var a="false"===jQuery(this).attr("aria-expanded")?!0:!1;if(n){var i=jQuery(this).closest(".collapsible");i.find("[aria-expanded]").attr("aria-expanded","false"),i.find("[aria-hidden]").attr("aria-hidden","true")}jQuery(this).attr("aria-expanded",a),s.attr("aria-hidden",!a)})}}}();
var ifs_modalLink=function(){"use strict";var e;return{settings:{element:jQuery("[data-js-modal]")},init:function(){e=this.settings,e.element.length&&(e.element.each(function(){ifs_modalLink.modalAttach()}),this.modalCloseLink())},modalAttach:function(){var e=jQuery(this);e.on("click",function(t){var a=jQuery("."+e.attr("data-js-modal"));a.length&&(t.preventDefault(),jQuery(".modal-overlay").removeClass("hidden"),a.attr("aria-hidden","false"),setTimeout(function(){var e=a.outerHeight();a.css({"margin-top":"-"+e/2+"px"})},50))})},modalCloseLink:function(){jQuery("body").on("click",".js-close",function(){jQuery(".modal-overlay").addClass("hidden"),jQuery('[role="dialog"]').attr("aria-hidden","true")})}}}();
var ifs_pieChart=function(){"use strict";var t;return{settings:{pieElement:".pie"},init:function(){t=this.settings,Modernizr.svg&&Modernizr.inlinesvg&&jQuery(t.pieElement).each(function(){ifs_pieChart.pieSVG(this)})},pieSVG:function(t){var e=parseFloat(t.textContent),i="http://www.w3.org/2000/svg",n=document.createElementNS(i,"svg"),r=document.createElementNS(i,"circle"),s=document.createElementNS(i,"title");r.setAttribute("r",16),r.setAttribute("cx",16),r.setAttribute("cy",16),r.setAttribute("stroke-dasharray",e+" 100"),n.setAttribute("viewBox","0 0 32 32"),s.textContent=t.textContent,t.textContent="",n.appendChild(s),n.appendChild(r),t.appendChild(n)}}}();
var ifs_unsavedChanges=function(){"use strict";var e;return{settings:{formelement:jQuery(".form-serialize-js")},init:function(){e=this.settings,this.initUnsavedChangesWarning()},initUnsavedChangesWarning:function(){e.formelement.data("serializedFormState",$(".form-serialize-js").serialize());var i=!1;e.formelement.on("submit",function(e){i=!0}),$(window).bind("beforeunload",function(e){return i===!1&&jQuery(".form-serialize-js").serialize()!=$(".form-serialize-js").data("serializedFormState")?"Are you sure you want to leave this page? There are some unsaved changes...":void(e=null)})}}}();
var ifs_wordCount=function(){"use strict";var t;return{settings:{element:jQuery(".word-count textarea")},init:function(){t=this.settings;var e={callback:function(t){ifs_wordCount.updateWordCount(this)},wait:500,highlight:!1,captureLength:1};t.element.typeWatch(e),t.element.each(function(t,e){ifs_wordCount.updateWordCount(e)})},updateWordCount:function(t){for(var e=$(t),n=e.val(),a=jQuery.trim(n.replace(/(\r\n|\n|\r)/gm," ")).split(" "),r=0,o=0;o<a.length;o++)a[o].length>0&&r++;var i=e.attr("data-max_words")-r,s=e.parents(".word-count").find(".count-down");s.html(i),0>i?s.removeClass("positive").addClass("negative"):s.removeClass("negative").addClass("positive")}}}();
var IFS={common:{init:function(){ifs_modalLink.init(),ifs_collapsible.init()},finalize:function(){ifs_pieChart.init()}},"app-form":{init:function(){ifs_unsavedChanges.init(),ifs_wordCount.init(),ifs_autoSave.init()}}};
UTIL=function(){"use strict";return{fire:function(n,i,o){var e=IFS;i=void 0===i?"init":i,""!==n&&e[n]&&"function"==typeof e[n][i]&&e[n][i](o)},loadEvents:function(){var n=document.body.id;UTIL.fire("common"),$.each(document.body.className.split(/\s+/),function(i,o){UTIL.fire(o),UTIL.fire(o,n)}),UTIL.fire("common","finalize")}}}(),jQuery(document).ready(function(){UTIL.loadEvents()});
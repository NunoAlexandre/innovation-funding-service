(function(){!function(t){return t.widget("IKS.hallo",{toolbar:null,bound:!1,originalContent:"",previousContent:"",uuid:"",selection:null,_keepActivated:!1,originalHref:null,options:{editable:!0,plugins:{},toolbar:"halloToolbarContextual",parentElement:"body",buttonCssClass:null,toolbarCssClass:null,toolbarPositionAbove:!1,toolbarOptions:{},placeholder:"",forceStructured:!0,checkTouch:!0,touchScreen:null},_create:function(){var e,n,o,r=this;this.id=this._generateUUID(),this.options.checkTouch&&null===this.options.touchScreen&&this.checkTouch(),o=this.options.plugins;for(n in o)e=o[n],t.isPlainObject(e)||(e={}),t.extend(e,{editable:this,uuid:this.id,buttonCssClass:this.options.buttonCssClass}),t(this.element)[n](e);return this.element.one("halloactivated",function(){return r._prepareToolbar()}),this.originalContent=this.getContents()},_init:function(){return this.options.editable?this.enable():this.disable()},destroy:function(){var e,n,o;this.disable(),this.toolbar&&(this.toolbar.remove(),this.element[this.options.toolbar]("destroy")),o=this.options.plugins;for(n in o)e=o[n],t(this.element)[n]("destroy");return t.Widget.prototype.destroy.call(this)},disable:function(){var e=this;return this.element.attr("contentEditable",!1),this.element.off("focus",this._activated),this.element.off("blur",this._deactivated),this.element.off("keyup paste change",this._checkModified),this.element.off("keyup",this._keys),this.element.off("keyup mouseup",this._checkSelection),this.bound=!1,t(this.element).removeClass("isModified"),t(this.element).removeClass("inEditMode"),this.element.parents("a").addBack().each(function(n,o){var r;return r=t(o),r.is("a")&&e.originalHref?r.attr("href",e.originalHref):void 0}),this._trigger("disabled",null)},enable:function(){var e=this;return this.element.parents("a[href]").addBack().each(function(n,o){var r;return r=t(o),r.is("a[href]")?(e.originalHref=r.attr("href"),r.removeAttr("href")):void 0}),this.element.attr("contentEditable",!0),t.parseHTML(this.element.html())||(this.element.html(this.options.placeholder),t(this.element).addClass("inPlaceholderMode"),this.element.css({"min-width":this.element.innerWidth(),"min-height":this.element.innerHeight()})),this.bound||(this.element.on("focus",this,this._activated),this.element.on("blur",this,this._deactivated),this.element.on("keyup paste change",this,this._checkModified),this.element.on("keyup",this,this._keys),this.element.on("keyup mouseup",this,this._checkSelection),this.bound=!0),this.options.forceStructured&&this._forceStructured(),this._trigger("enabled",null)},activate:function(){return this.element.focus()},containsSelection:function(){var t;return t=this.getSelection(),this.element.has(t.startContainer).length>0},getSelection:function(){var t,e;return e=rangy.getSelection(),t=null,t=e.rangeCount>0?e.getRangeAt(0):rangy.createRange()},restoreSelection:function(t){var e;return e=rangy.getSelection(),e.setSingleRange(t)},replaceSelection:function(t){var e,n,o,r,i;return"Microsoft Internet Explorer"===navigator.appName?(i=document.selection.createRange().text,n=document.selection.createRange(),n.pasteHTML(t(i))):(r=window.getSelection(),o=r.getRangeAt(0),e=document.createTextNode(t(o.extractContents())),o.insertNode(e),o.setStartAfter(e),r.removeAllRanges(),r.addRange(o))},removeAllSelections:function(){return"Microsoft Internet Explorer"===navigator.appName?range.empty():window.getSelection().removeAllRanges()},getPluginInstance:function(e){var n;if(n=t(this.element).data("IKS-"+e))return n;if(n=t(this.element).data(e))return n;throw new Error("Plugin "+e+" not found")},getContents:function(){var e,n,o;for(o in this.options.plugins)n=this.getPluginInstance(o),n&&(e=n.cleanupContentClone,t.isFunction(e)&&t(this.element)[o]("cleanupContentClone",this.element));return this.element.html()},setContents:function(t){return this.element.html(t)},isModified:function(){return this.previousContent||(this.previousContent=this.originalContent),this.previousContent!==this.getContents()},setUnmodified:function(){return t(this.element).removeClass("isModified"),this.previousContent=this.getContents()},setModified:function(){return t(this.element).addClass("isModified"),this._trigger("modified",null,{editable:this,content:this.getContents()})},restoreOriginalContent:function(){return this.element.html(this.originalContent)},execute:function(t,e){return document.execCommand(t,!1,e)?this.element.trigger("change"):void 0},protectFocusFrom:function(t){var e=this;return t.on("mousedown",function(t){return t.preventDefault(),e._protectToolbarFocus=!0,setTimeout(function(){return e._protectToolbarFocus=!1},300)})},keepActivated:function(t){this._keepActivated=t},_generateUUID:function(){var t;return t=function(){return(65536*(1+Math.random())|0).toString(16).substring(1)},""+t()+t()+"-"+t()+"-"+t()+"-"+t()+"-"+t()+t()+t()},_prepareToolbar:function(){var e,n,o,r,i;this.toolbar=t('<div class="hallotoolbar"></div>').hide(),this.options.toolbarCssClass&&this.toolbar.addClass(this.options.toolbarCssClass),e={editable:this,parentElement:this.options.parentElement,toolbar:this.toolbar,positionAbove:this.options.toolbarPositionAbove},i=t.extend({},e,this.options.toolbarOptions),this.element[this.options.toolbar](i);for(o in this.options.plugins)n=this.getPluginInstance(o),n&&(r=n.populateToolbar,t.isFunction(r)&&this.element[o]("populateToolbar",this.toolbar));return this.element[this.options.toolbar]("setPosition"),this.protectFocusFrom(this.toolbar)},changeToolbar:function(t,e,n){var o;return null==n&&(n=!1),o=this.options.toolbar,this.options.parentElement=t,e&&(this.options.toolbar=e),this.toolbar?(this.element[o]("destroy"),this.toolbar.remove(),this._prepareToolbar(),n?this.toolbar.hide():void 0):void 0},_checkModified:function(t){var e;return e=t.data,e.isModified()?e.setModified():void 0},_keys:function(t){var e,n;return n=t.data,27===t.keyCode?(e=n.getContents(),n.restoreOriginalContent(t),n._trigger("restored",null,{editable:n,content:n.getContents(),thrown:e}),n.turnOff()):void 0},_rangesEqual:function(t,e){return t.startContainer!==e.startContainer?!1:t.startOffset!==e.startOffset?!1:t.endContainer!==e.endContainer?!1:t.endOffset!==e.endOffset?!1:!0},_checkSelection:function(t){var e;if(27!==t.keyCode)return e=t.data,setTimeout(function(){var n;return n=e.getSelection(),e._isEmptySelection(n)||e._isEmptyRange(n)?void(e.selection&&(e.selection=null,e._trigger("unselected",null,{editable:e,originalEvent:t}))):e.selection&&e._rangesEqual(n,e.selection)?void 0:(e.selection=n.cloneRange(),e._trigger("selected",null,{editable:e,selection:e.selection,ranges:[e.selection],originalEvent:t}))},0)},_isEmptySelection:function(t){return"Caret"===t.type?!0:!1},_isEmptyRange:function(t){return t.collapsed?!0:t.isCollapsed?"function"==typeof t.isCollapsed?t.isCollapsed():t.isCollapsed:!1},turnOn:function(){return this.getContents()===this.options.placeholder&&this.setContents(""),t(this.element).removeClass("inPlaceholderMode"),t(this.element).addClass("inEditMode"),this._trigger("activated",null,this)},turnOff:function(){return t(this.element).removeClass("inEditMode"),this._trigger("deactivated",null,this),this.getContents()?void 0:(t(this.element).addClass("inPlaceholderMode"),this.setContents(this.options.placeholder))},_activated:function(t){return t.data.turnOn()},_deactivated:function(e){return e.data._keepActivated?void 0:e.data._protectToolbarFocus!==!0?e.data.turnOff():setTimeout(function(){return t(e.data.element).focus()},300)},_forceStructured:function(t){var e;try{return document.execCommand("styleWithCSS",0,!1)}catch(n){e=n;try{return document.execCommand("useCSS",0,!0)}catch(n){e=n;try{return document.execCommand("styleWithCSS",!1,!1)}catch(n){e=n}}}},checkTouch:function(){return this.options.touchScreen=!!("createTouch"in document)}})}(jQuery)}).call(this),function(){!function(t){var e;return e="The hallocleanhtml plugin requires the selection save and    restore module from Rangy",t.widget("IKS.hallocleanhtml",{_create:function(){var n,o=this;if(void 0===t.htmlClean)throw new Error("The hallocleanhtml plugin requires jQuery.htmlClean");return n=this.element,n.bind("paste",this,function(r){var i,a,s;if(void 0===rangy.saveSelection)throw new Error(e);return s=r.data,s.options.editable.getSelection().deleteContents(),a=rangy.saveSelection(),i=n.html(),n.html(""),setTimeout(function(){var e,r,l,c;if(l=n.html(),e=t.htmlClean(l,o.options),n.html(i),rangy.restoreSelection(a),""!==e)try{return document.execCommand("insertHTML",!1,e)}catch(u){return r=u,c=s.options.editable.getSelection(),c.insertNode(c.createContextualFragment(e))}},4)})}})}(jQuery)}.call(this),function(){!function(t){return t.widget("IKS.halloformat",{options:{editable:null,uuid:"",formattings:{bold:!0,italic:!0,strikeThrough:!1,underline:!1},buttonCssClass:null},populateToolbar:function(e){var n,o,r,i,a,s,l=this;a=this,o=t('<span class="'+a.widgetName+'"></span>'),n=function(e){var n;return n=t("<span></span>"),n.hallobutton({label:e,editable:l.options.editable,command:e,uuid:l.options.uuid,cssClass:l.options.buttonCssClass}),o.append(n)},s=this.options.formattings;for(i in s)r=s[i],r&&n(i);return o.hallobuttonset(),e.append(o)}})}(jQuery)}.call(this),function(){!function(t){return t.widget("IKS.hallolists",{options:{editable:null,toolbar:null,uuid:"",lists:{ordered:!0,unordered:!0},buttonCssClass:null},populateToolbar:function(e){var n,o,r=this;return o=t('<span class="'+this.widgetName+'"></span>'),n=function(e,n){var i;return i=t("<span></span>"),i.hallobutton({uuid:r.options.uuid,editable:r.options.editable,label:n,command:"insert"+e+"List",icon:"fa-list-"+n.toLowerCase(),cssClass:r.options.buttonCssClass}),o.append(i)},this.options.lists.ordered&&n("Ordered","OL"),this.options.lists.unordered&&n("Unordered","UL"),o.hallobuttonset(),e.append(o)}})}(jQuery)}.call(this),function(){!function(t){return t.widget("IKS.halloToolbarContextual",{toolbar:null,options:{parentElement:"body",editable:null,toolbar:null,positionAbove:!1},_create:function(){var e=this;return this.toolbar=this.options.toolbar,t(this.options.parentElement).append(this.toolbar),this._bindEvents(),t(window).resize(function(t){return e._updatePosition(e._getPosition(t))})},_getPosition:function(t,e){var n,o;if(t)switch(n=t.type){case"keydown":case"keyup":case"keypress":return this._getCaretPosition(e);case"click":case"mousedown":case"mouseup":return o={top:t.pageY,left:t.pageX}}},_getCaretPosition:function(e){var n,o,r;return r=t("<span/>"),n=rangy.createRange(),n.setStart(e.endContainer,e.endOffset),n.insertNode(r.get(0)),o={top:r.offset().top,left:r.offset().left},r.remove(),o},setPosition:function(){return"body"!==this.options.parentElement&&(this.options.parentElement="body",t(this.options.parentElement).append(this.toolbar)),this.toolbar.css("position","absolute"),this.toolbar.css("top",this.element.offset().top-20),this.toolbar.css("left",this.element.offset().left)},_updatePosition:function(e,n){var o,r,i,a,s;return null==n&&(n=null),e&&e.top&&e.left?(i=this.toolbar.outerHeight()+10,n&&!n.collapsed&&n.nativeRange?(r=n.nativeRange.getBoundingClientRect(),s=this.options.positionAbove?r.top-i:r.bottom+10,a=t(window).scrollTop()+s,o=t(window).scrollLeft()+r.left):(s=this.options.positionAbove?-10-i:20,a=e.top+s,o=e.left-this.toolbar.outerWidth()/2+30),this.toolbar.css("top",a),this.toolbar.css("left",o)):void 0},_bindEvents:function(){var t=this;return this.element.on("click",function(e,n){var o,r;return o={},r=$("window").scrollTop(),o.top=e.clientY+r,o.left=e.clientX,t._updatePosition(o,null),""!==t.toolbar.html()?t.toolbar.show():void 0}),this.element.on("halloselected",function(e,n){var o;return(o=t._getPosition(n.originalEvent,n.selection))?(t._updatePosition(o,n.selection),""!==t.toolbar.html()?t.toolbar.show():void 0):void 0}),this.element.on("hallounselected",function(e,n){return t.toolbar.hide()}),this.element.on("hallodeactivated",function(e,n){return t.toolbar.hide()})}})}(jQuery)}.call(this),function(){!function(t){return t.widget("IKS.halloToolbarFixed",{toolbar:null,options:{parentElement:"body",editable:null,toolbar:null,affix:!0,affixTopOffset:2},_create:function(){var e,n,o=this;return this.toolbar=this.options.toolbar,this.toolbar.show(),t(this.options.parentElement).append(this.toolbar),this._bindEvents(),t(window).resize(function(t){return o.setPosition()}),t(window).scroll(function(t){return o.setPosition()}),"body"===this.options.parentElement?(e=t(this.element),n=parseFloat(e.css("padding-left")),n+=parseFloat(e.css("padding-right")),n+=parseFloat(e.css("border-left-width")),n+=parseFloat(e.css("border-right-width")),n+=2*parseFloat(e.css("outline-width")),n+=2*parseFloat(e.css("outline-offset")),t(this.toolbar).css("width",e.width()+n)):void 0},_getPosition:function(t,e){var n,o,r;if(t)return r=parseFloat(this.element.css("outline-width")),n=r+parseFloat(this.element.css("outline-offset")),o={top:this.element.offset().top-this.toolbar.outerHeight()-n,left:this.element.offset().left-n}},_getCaretPosition:function(e){var n,o,r;return r=t("<span/>"),n=rangy.createRange(),n.setStart(e.endContainer,e.endOffset),n.insertNode(r.get(0)),o={top:r.offset().top,left:r.offset().left},r.remove(),o},setPosition:function(){var e,n,o,r,i,a;if("body"===this.options.parentElement)return this.toolbar.css("position","absolute"),this.toolbar.css("top",this.element.offset().top-this.toolbar.outerHeight()),this.options.affix&&(i=t(window).scrollTop(),r=this.element.offset(),o=this.element.height(),a=this.options.affixTopOffset,n=r.top-(this.toolbar.height()+this.options.affixTopOffset),e=o-a+(r.top-this.toolbar.height()),i>n&&e>i&&(this.toolbar.css("position","fixed"),this.toolbar.css("top",this.options.affixTopOffset))),this.toolbar.css("left",this.element.offset().left-2)},_updatePosition:function(t){},_bindEvents:function(){var t=this;return this.element.on("halloactivated",function(e,n){return t.setPosition(),t.toolbar.show()}),this.element.on("hallodeactivated",function(e,n){return t.toolbar.hide()})}})}(jQuery)}.call(this),function(){!function(t){return t.widget("IKS.halloToolbarInstant",{toolbar:null,options:{parentElement:"body",editable:null,toolbar:null,positionAbove:!1},_create:function(){var e=this;return this.toolbar=this.options.toolbar,t(this.options.parentElement).append(this.toolbar),this._bindEvents(),t(window).resize(function(t){return e._updatePosition(e._getPosition(t))})},_getPosition:function(t,e){var n,o;if(t)switch(n=t.type){case"keydown":case"keyup":case"keypress":return this._getCaretPosition(e);case"click":case"mousedown":case"mouseup":return o={top:t.pageY,left:t.pageX}}},_getCaretPosition:function(e){var n,o,r;return r=t("<span/>"),n=rangy.createRange(),n.setStart(e.endContainer,e.endOffset),n.insertNode(r.get(0)),o={top:r.offset().top,left:r.offset().left},r.remove(),o},setPosition:function(){return"body"!==this.options.parentElement&&(this.options.parentElement="body",t(this.options.parentElement).append(this.toolbar)),this.toolbar.css("position","absolute"),this.toolbar.css("top",this.element.offset().top-20),this.toolbar.css("left",this.element.offset().left)},_updatePosition:function(e,n){var o,r,i,a,s;return null==n&&(n=null),e&&e.top&&e.left?(i=this.toolbar.outerHeight()+10,n&&!n.collapsed&&n.nativeRange?(r=n.nativeRange.getBoundingClientRect(),s=this.options.positionAbove?r.top-i:r.bottom+10,a=t(window).scrollTop()+s,o=t(window).scrollLeft()+r.left):(s=this.options.positionAbove?-10-i:20,a=e.top+s,o=e.left-this.toolbar.outerWidth()/2+30),this.toolbar.css("top",a),this.toolbar.css("left",o)):void 0},_bindEvents:function(){var t=this;return this.element.on("click",function(e,n){var o,r;return o={},r=$("window").scrollTop(),o.top=e.clientY+r,o.left=e.clientX,t._updatePosition(o,null),""!==t.toolbar.html()?t.toolbar.show():void 0}),this.element.on("halloselected",function(e,n){var o;return(o=t._getPosition(n.originalEvent,n.selection))?(t._updatePosition(o,n.selection),""!==t.toolbar.html()?t.toolbar.show():void 0):void 0}),this.element.on("hallounselected",function(e,n){return t.toolbar.hide()}),this.element.on("hallodeactivated",function(e,n){return t.toolbar.hide()})}})}(jQuery)}.call(this),function(){!function(t){return t.widget("IKS.hallobutton",{button:null,isChecked:!1,options:{uuid:"",label:null,icon:null,editable:null,command:null,commandValue:null,queryState:!0,cssClass:null},_create:function(){var t,e,n,o,r=this;return null==(o=this.options).icon&&(o.icon="fa-"+this.options.label.toLowerCase()),e=""+this.options.uuid+"-"+this.options.label,n=this.options,this.button=this._createButton(e,n.command,n.label,n.icon),this.element.append(this.button),this.options.cssClass&&this.button.addClass(this.options.cssClass),this.options.editable.options.touchScreen&&this.button.addClass("btn-large"),this.button.data("hallo-command",this.options.command),this.options.commandValue&&this.button.data("hallo-command-value",this.options.commandValue),t="ui-state-hover",this.button.on("mouseenter",function(e){return r.isEnabled()?r.button.addClass(t):void 0}),this.button.on("mouseleave",function(e){return r.button.removeClass(t)})},_init:function(){var t,e,n,o=this;return this.button||(this.button=this._prepareButton()),this.element.append(this.button),n=this.options.queryState===!0?function(t){var e,n,r;if(o.options.command)try{return o.options.commandValue?(r=document.queryCommandValue(o.options.command),e=r.match(new RegExp(o.options.commandValue,"i")),o.checked(e?!0:!1)):o.checked(document.queryCommandState(o.options.command))}catch(i){n=i}}:this.options.queryState,this.options.command&&this.button.on("click",function(t){return o.options.commandValue?o.options.editable.execute(o.options.command,o.options.commandValue):o.options.editable.execute(o.options.command),"function"==typeof n&&n(),!1}),this.options.queryState?(t=this.options.editable.element,e="keyup paste change mouseup hallomodified",t.on(e,n),t.on("halloenabled",function(){return t.on(e,n)}),t.on("hallodisabled",function(){return t.off(e,n)})):void 0},enable:function(){return this.button.removeAttr("disabled")},disable:function(){return this.button.attr("disabled","true")},isEnabled:function(){return"true"!==this.button.attr("disabled")},refresh:function(){return this.isChecked?this.button.addClass("ui-state-active"):this.button.removeClass("ui-state-active")},checked:function(t){return this.isChecked=t,this.refresh()},_createButton:function(e,n,o,r){var i;return i=["ui-button","ui-widget","ui-state-default","ui-corner-all","ui-button-text-only",""+n+"_button"],t('<button id="'+e+'"        class="'+i.join(" ")+'" title="'+o+'">          <span class="ui-button-text">            <i class="fa '+r+'"></i>          </span>        </button>')}}),t.widget("IKS.hallobuttonset",{buttons:null,_create:function(){return this.element.addClass("ui-buttonset")},_init:function(){return this.refresh()},refresh:function(){var t;return t="rtl"===this.element.css("direction"),this.buttons=this.element.find(".ui-button"),this.buttons.removeClass("ui-corner-all ui-corner-left ui-corner-right"),t?(this.buttons.filter(":first").addClass("ui-corner-right"),this.buttons.filter(":last").addClass("ui-corner-left")):(this.buttons.filter(":first").addClass("ui-corner-left"),this.buttons.filter(":last").addClass("ui-corner-right"))}})}(jQuery)}.call(this),function(){!function(t){return t.widget("IKS.hallodropdownbutton",{button:null,options:{uuid:"",label:null,icon:null,editable:null,target:"",cssClass:null},_create:function(){var t;return null!=(t=this.options).icon?(t=this.options).icon:t.icon="fa-"+this.options.label.toLowerCase()},_init:function(){var e,n=this;return e=t(this.options.target),e.css("position","absolute"),e.addClass("dropdown-menu"),e.hide(),this.button||(this.button=this._prepareButton()),this.button.on("click",function(){return e.hasClass("open")?void n._hideTarget():n._showTarget()}),e.on("click",function(){return n._hideTarget()}),this.options.editable.element.on("hallodeactivated",function(){return n._hideTarget()}),this.element.append(this.button)},_showTarget:function(){var e;return e=t(this.options.target),this._updateTargetPosition(),e.addClass("open"),e.show()},_hideTarget:function(){var e;return e=t(this.options.target),e.removeClass("open"),e.hide()},_updateTargetPosition:function(){var e,n,o,r;return n=t(this.options.target),r=this.button.position(),o=r.top,e=r.left,o+=this.button.outerHeight(),n.css("top",o),n.css("left",e-20)},_prepareButton:function(){var e,n,o;return o=""+this.options.uuid+"-"+this.options.label,n=["ui-button","ui-widget","ui-state-default","ui-corner-all","ui-button-text-only"],e=t('<button id="'+o+'"       class="'+n.join(" ")+'" title="'+this.options.label+'">         <span class="ui-button-text">           <i class="fa '+this.options.icon+'"></i>         </span>       </button>'),this.options.cssClass&&e.addClass(this.options.cssClass),e}})}(jQuery)}.call(this),function(){var t,e,n,o,r,i,a,s,l,c,u,h,d,f,p={}.hasOwnProperty,g=this;t={absolute:!1,base:"undefined"!=typeof window&&null!==window?window.document.baseURI:"file://"+process.cwd(),debug:!1,inline:!1},n=this.md,r={"\\\\":"\\\\","\\[":"\\[","\\]":"\\]",">":"\\>",_:"\\_","\\*":"\\*","`":"\\`","#":"\\#","([0-9])\\.(\\s|$)":"$1\\.$2","©":"(c)","®":"(r)","™":"(tm)"," ":" ","·":"\\*"," ":" "," ":" "," ":" ","‘":"'","’":"'","“":'"',"”":'"',"…":"...","–":"--","—":"---"},i=/(display|visibility)\s*:\s*[a-z]+/gi,a=/(none|hidden)\s*$/i,s=/^(APPLET|AREA|AUDIO|BUTTON|CANVAS|DATALIST|EMBED|HEAD|INPUT|MAP|MENU|METER|NOFRAMES|NOSCRIPT|OBJECT|OPTGROUP|OPTION|PARAM|PROGRESS|RP|RT|RUBY|SCRIPT|SELECT|STYLE|TEXTAREA|TITLE|VIDEO)$/,l=/^(ADDRESS|ARTICLE|ASIDE|DIV|FIELDSET|FOOTER|HEADER|NAV|P|SECTION)$/,o=function(){d={};for(c in r)p.call(r,c)&&(d[c]=new RegExp(c,"g"));return d}(),h=function(t,e,n){var o,r;if(null==t&&(t=""),null==e&&(e=0),null==n&&(n=" "),!n)return t;for(o=r=0;e>=0?e>r:r>e;o=e>=0?++r:--r)t=n+t;return t},f=function(t){return null==t&&(t=""),t.trim?t.trim():t.replace(/^\s+|\s+$/g,"")},e=function(){function e(e,n){var o,r;this.html=null!=e?e:"",this.options=null!=n?n:{},this.atLeft=this.atNoWS=this.atP=!0,this.buffer="",this.exceptions=[],this.order=1,this.listDepth=0,this.inCode=this.inPre=this.inOrderedList=!1,this.last=null,this.left="\n",this.links=[],this.linkMap={},this.unhandled={},"object"!=typeof this.options&&(this.options={});for(c in t)p.call(t,c)&&(o=t[c],"undefined"==typeof this.options[c]&&(this.options[c]=o));this.win="undefined"!=typeof window&&null!==window?window:null,null==this.win&&(r=require("jsdom").jsdom(null,null,{features:{FetchExternalResources:!1},url:this.options.base}),this.win=r.createWindow()),null==this.win.Node&&(this.win.Node={ELEMENT_NODE:1,TEXT_NODE:3})}return e.prototype.append=function(t){return null!=this.last&&(this.buffer+=this.last),this.last=t},e.prototype.attr=function(t,e,n){var o;return null==n&&(n=!0),o=n||"function"!=typeof t.getAttribute?t[e]:t.getAttribute(e),null!=o?o:""},e.prototype.br=function(){return this.append("  "+this.left),this.atLeft=this.atNoWS=!0},e.prototype.code=function(){var t,e=this;return t=this.inCode,this.inCode=!0,function(){return e.inCode=t}},e.prototype.has=function(t,e,n){return null==n&&(n=!0),n||"function"!=typeof t.hasAttribute?t.hasOwnProperty(e):t.hasAttribute(e)},e.prototype.inCodeProcess=function(t){return t.replace(/`/g,"\\`")},e.prototype.isVisible=function(t){var e,n,o,r,s,l,c,u,h;if(s=this.attr(t,"style",!1),o=null!=s&&"function"==typeof s.match?s.match(i):void 0,c=!0,null!=o)for(u=0,h=o.length;h>u;u++)r=o[u],c=!a.test(r);if(c&&"function"==typeof this.win.getComputedStyle)try{s=this.win.getComputedStyle(t,null),"function"==typeof(null!=s?s.getPropertyValue:void 0)&&(e=s.getPropertyValue("display"),l=s.getPropertyValue("visibility"),c="none"!==e&&"hidden"!==l)}catch(d){n=d,this.thrown(n,"getComputedStyle")}return c},e.prototype.li=function(){var t;return t=this.inOrderedList?""+this.order++ +". ":"* ",t=h(t,2*(this.listDepth-1)),this.append(t)},e.prototype.nonPreProcess=function(t){var e;t=t.replace(/\n([ \t]*\n)+/g,"\n"),t=t.replace(/\n[ \t]+/g,"\n"),t=t.replace(/[ \t]+/g," ");for(c in r)p.call(r,c)&&(e=r[c],t=t.replace(o[c],e));return t},e.prototype.ol=function(){var t,e,n=this;return 0===this.listDepth&&this.p(),t=this.inOrderedList,e=this.order,this.inOrderedList=!0,this.order=1,this.listDepth++,function(){return n.inOrderedList=t,n.order=e,n.listDepth--}},e.prototype.output=function(t){return t&&(this.inPre||(t=this.atNoWS?t.replace(/^[ \t\n]+/,""):/^[ \t]*\n/.test(t)?t.replace(/^[ \t\n]+/,"\n"):t.replace(/^[ \t]+/," ")),""!==t)?(this.atP=/\n\n$/.test(t),this.atLeft=/\n$/.test(t),this.atNoWS=/[ \t\n]$/.test(t),this.append(t.replace(/\n/g,this.left))):void 0},e.prototype.outputLater=function(t){var e=this;return function(){return e.output(t)}},e.prototype.p=function(){return this.atP?void 0:(this.atLeft||(this.append(this.left),this.atLeft=!0),this.append(this.left),this.atNoWS=this.atP=!0)},e.prototype.parse=function(){var t,e,n,o,r,i,a,s;if(this.buffer="",!this.html)return this.buffer;if(t=this.win.document.createElement("div"),"string"==typeof this.html?t.innerHTML=this.html:t.appendChild(this.html),this.process(t),this.links.length)for(this.append("\n\n"),s=this.links,e=i=0,a=s.length;a>i;e=++i)n=s[e],n&&this.append("["+e+"]: "+n+"\n");return this.options.debug&&(r=function(){var t,e;t=this.unhandled,e=[];for(o in t)p.call(t,o)&&e.push(o);return e}.call(this).sort(),console.log(r.length?"Ignored tags;\n"+r.join(", "):"No tags were ignored"),console.log(this.exceptions.length?"Exceptions;\n"+this.exceptions.join("\n"):"No exceptions were thrown")),this.append(""),this.buffer=f(this.buffer)},e.prototype.pre=function(){var t,e=this;return t=this.inPre,this.inPre=!0,function(){return e.inPre=t}},e.prototype.process=function(t){var e,n,o,r,i,a,c,u,h,d,f,p,g,m,v,C,b,R,y;if(this.isVisible(t)){if(t.nodeType===this.win.Node.ELEMENT_NODE){h=!1;try{if(s.test(t.tagName))h=!0;else if(/^H[1-6]$/.test(t.tagName))u=parseInt(t.tagName.match(/([1-6])$/)[1]),this.p(),this.output(""+function(){var t,e;for(e=[],c=t=1;u>=1?u>=t:t>=u;c=u>=1?++t:--t)e.push("#");return e}().join("")+" ");else if(l.test(t.tagName))this.p();else switch(t.tagName){case"BODY":case"FORM":break;case"DETAILS":this.p(),this.has(t,"open",!1)||(h=!0,p=t.getElementsByTagName("summary")[0],p&&this.process(p));break;case"BR":this.br();break;case"HR":this.p(),this.output("---"),this.p();break;case"CITE":case"DFN":case"EM":case"I":case"U":case"VAR":this.output("_"),this.atNoWS=!0,e=this.outputLater("_");break;case"DT":case"B":case"STRONG":"DT"===t.tagName&&this.p(),this.output("**"),this.atNoWS=!0,e=this.outputLater("**");break;case"Q":this.output('"'),this.atNoWS=!0,e=this.outputLater('"');break;case"OL":case"UL":e="OL"===t.tagName?this.ol():this.ul();break;case"LI":this.replaceLeft("\n"),this.li();break;case"PRE":n=this.pushLeft("    "),o=this.pre(),e=function(){return n(),o()};break;case"CODE":case"KBD":case"SAMP":if(this.inPre)break;this.output("`"),n=this.code(),o=this.outputLater("`"),e=function(){return n(),o()};break;case"BLOCKQUOTE":case"DD":e=this.pushLeft("> ");break;case"A":if(a=this.attr(t,"href",this.options.absolute),!a)break;g=this.attr(t,"title"),g&&(a+=' "'+g+'"'),f=this.options.inline?"("+a+")":"["+(null!=(b=(m=this.linkMap)[a])?b:m[a]=this.links.push(a)-1)+"]",this.output("["),this.atNoWS=!0,e=this.outputLater("]"+f);break;case"IMG":if(h=!0,d=this.attr(t,"src",this.options.absolute),!d)break;this.output("!["+this.attr(t,"alt")+"]("+d+")");break;case"FRAME":case"IFRAME":h=!0;try{(null!=(R=t.contentDocument)?R.documentElement:void 0)&&this.process(t.contentDocument.documentElement)}catch(w){i=w,this.thrown(i,"contentDocument")}break;case"TR":e=this.p;break;default:this.options.debug&&(this.unhandled[t.tagName]=null)}}catch(w){i=w,this.thrown(i,t.tagName)}if(!h)for(y=t.childNodes,v=0,C=y.length;C>v;v++)r=y[v],this.process(r);return null!=e?e.call(this):void 0}return t.nodeType===this.win.Node.TEXT_NODE?this.output(this.inPre?t.nodeValue:this.inCode?this.inCodeProcess(t.nodeValue):this.nonPreProcess(t.nodeValue)):void 0}},e.prototype.pushLeft=function(t){var e,n=this;return e=this.left,this.left+=t,this.atP?this.append(t):this.p(),function(){return n.left=e,n.atLeft=n.atP=!1,n.p()}},e.prototype.replaceLeft=function(t){return this.atLeft?this.last?this.last=this.last.replace(/[ ]{2,4}$/,t):void 0:(this.append(this.left.replace(/[ ]{2,4}$/,t)),this.atLeft=this.atNoWS=this.atP=!0)},e.prototype.thrown=function(t,e){return this.options.debug?this.exceptions.push(""+e+": "+t):void 0},e.prototype.ul=function(){var t,e,n=this;return 0===this.listDepth&&this.p(),t=this.inOrderedList,e=this.order,this.inOrderedList=!1,this.order=1,this.listDepth++,function(){return n.inOrderedList=t,n.order=e,n.listDepth--}},e}(),this.md=u=function(t,n){return new e(t,n).parse()},("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=u:"function"==typeof define&&define.amd&&define("md",function(){return u}),u.version=u.VERSION="3.0.2",u.noConflict=function(){return g.md=n,u}}.call(this),function(t){function e(t,e,n,o){if(t.tag.format&&n.length>0){n.push("\n");for(var r=0;o>r;r++)n.push("	")}}function n(o,r){var i=[],a=0==o.attributes.length,s=0;if(o.tag.isComment)r.allowComments&&(i.push("<!--"),i.push(o.tag.rawAttributes),i.push(">"),r.format&&e(o,r,i,s-1));else{var l=o.tag.render&&(0==r.allowedTags.length||t.inArray(o.tag.name,r.allowedTags)>-1)&&(0==r.removeTags.length||-1==t.inArray(o.tag.name,r.removeTags));if(!o.isRoot&&l&&(i.push("<"),i.push(o.tag.name),t.each(o.attributes,function(){if(-1==t.inArray(this.name,r.removeAttrs)){var e=RegExp(/^(['"]?)(.*?)['"]?$/).exec(this.value),n=e[2],a=e[1]||"'";"class"==this.name&&r.allowedClasses.length>0&&(n=t.grep(n.split(" "),function(e){return t.grep(r.allowedClasses,function(n){return n==e||n[0]==e&&(1==n.length||t.inArray(o.tag.name,n[1])>-1)}).length>0}).join(" ")),null!=n&&(n.length>0||t.inArray(this.name,o.tag.requiredAttributes)>-1)&&(i.push(" "),i.push(this.name),i.push("="),i.push(a),i.push(n),i.push(a))}})),o.tag.isSelfClosing)l&&i.push(" />"),a=!1;else if(o.tag.isNonClosing)a=!1;else{if(!o.isRoot&&l&&i.push(">"),s=r.formatIndent++,o.tag.toProtect)f=t.htmlClean.trim(o.children.join("")).replace(/<br>/gi,"\n"),i.push(f),a=0==f.length;else{for(var f=[],g=0;g<o.children.length;g++){var m=o.children[g],v=t.htmlClean.trim(p(h(m)?m:m.childrenToString()));d(m)&&g>0&&v.length>0&&(c(m)||u(o.children[g-1]))&&f.push(" "),h(m)?v.length>0&&f.push(v):(g!=o.children.length-1||"br"!=m.tag.name)&&(r.format&&e(m,r,f,s),f=f.concat(n(m,r)))}r.formatIndent--,f.length>0&&(r.format&&"\n"!=f[0]&&e(o,r,i,s),i=i.concat(f),a=!1)}!o.isRoot&&l&&(r.format&&e(o,r,i,s-1),i.push("</"),i.push(o.tag.name),i.push(">"))}if(!o.tag.allowEmpty&&a)return[]}return i}function o(e,n){return i(e,function(e){return t.inArray(e.tag.nameOriginal,n)>-1})}function r(t){return i(t,function(t){return t.isRoot||!t.tag.isInline})}function i(t,e,n){n=n||1;var o=t[t.length-n];return e(o)?!0:t.length-n>0&&i(t,e,n+1)?(t.pop(),!0):!1}function a(t){return t?(this.tag=t,this.isRoot=!1):(this.tag=new l("root"),this.isRoot=!0),this.attributes=[],this.children=[],this.hasAttribute=function(t){for(var e=0;e<this.attributes.length;e++)if(this.attributes[e].name==t)return!0;return!1},this.childrenToString=function(){return this.children.join("")},this}function s(t,e){return this.name=t,this.value=e,this}function l(e,n,o,r){return this.name=e.toLowerCase(),this.nameOriginal=this.name,this.render=!0,this.init=function(){if("--"==this.name?(this.isComment=!0,this.isSelfClosing=!0,this.format=!0):(this.isComment=!1,this.isSelfClosing=t.inArray(this.name,y)>-1,this.isNonClosing=t.inArray(this.name,w)>-1,this.isClosing=void 0!=n&&n.length>0,this.isInline=t.inArray(this.name,g)>-1,this.disallowNest=t.inArray(this.name,v)>-1,this.requiredParent=b[t.inArray(this.name,b)+1],this.allowEmpty=r&&t.inArray(this.name,r.allowEmpty)>-1,
this.toProtect=t.inArray(this.name,R)>-1,this.format=t.inArray(this.name,m)>-1||!this.isInline),this.rawAttributes=o,this.requiredAttributes=S[t.inArray(this.name,S)+1],r){if(r.tagAttributesCache||(r.tagAttributesCache=[]),-1==t.inArray(this.name,r.tagAttributesCache)){for(var e=E[t.inArray(this.name,E)+1].slice(0),i=0;i<r.allowedAttributes.length;i++){var a=r.allowedAttributes[i][0];(1==r.allowedAttributes[i].length||t.inArray(this.name,r.allowedAttributes[i][1])>-1)&&-1==t.inArray(a,e)&&e.push(a)}r.tagAttributesCache.push(this.name),r.tagAttributesCache.push(e)}this.allowedAttributes=r.tagAttributesCache[t.inArray(this.name,r.tagAttributesCache)+1]}},this.init(),this.rename=function(t){this.name=t,this.init()},this}function c(e){for(;f(e)&&e.children.length>0;)e=e.children[0];if(!h(e))return!1;var n=p(e);return n.length>0&&t.htmlClean.isWhitespace(n.charAt(0))}function u(e){for(;f(e)&&e.children.length>0;)e=e.children[e.children.length-1];if(!h(e))return!1;var n=p(e);return n.length>0&&t.htmlClean.isWhitespace(n.charAt(n.length-1))}function h(t){return t.constructor==String}function d(t){return h(t)||t.tag.isInline}function f(t){return t.constructor==a}function p(t){return t.replace(/&nbsp;|\n/g," ").replace(/\s\s+/g," ")}t.fn.htmlClean=function(e){return this.each(function(){this.value?this.value=t.htmlClean(this.value,e):this.innerHTML=t.htmlClean(this.innerHTML,e)})},t.htmlClean=function(e,i){i=t.extend({},t.htmlClean.defaults,i),i.allowEmpty=C.concat(i.allowEmpty);var c,u=/(<(\/)?(\w+:)?([\w]+)([^>]*)>)|<!--(.*?--)>/gi,d=/([\w\-]+)\s*=\s*(".*?"|'.*?'|[^\s>\/]*)/gi,f=new a,p=[f],g=f;i.bodyOnly&&(c=/<body[^>]*>((\n|.)*)<\/body>/i.exec(e))&&(e=c[1]),e=e.concat("<xxx>");for(var m;c=u.exec(e);){var v=c[6]?new l("--",null,c[6],i):new l(c[4],c[2],c[5],i),b=e.substring(m,c.index);if(b.length>0){var R=g.children[g.children.length-1];g.children.length>0&&h(R=g.children[g.children.length-1])?g.children[g.children.length-1]=R.concat(b):g.children.push(b)}if(m=u.lastIndex,v.isClosing)o(p,[v.name])&&(p.pop(),g=p[p.length-1]);else{for(var y,w=new a(v);y=d.exec(v.rawAttributes);){if("style"==y[1].toLowerCase()&&i.replaceStyles)for(var E=!v.isInline,S=0;S<i.replaceStyles.length;S++)i.replaceStyles[S][0].test(y[2])&&(E||(v.render=!1,E=!0),g.children.push(w),p.push(w),g=w,v=new l(i.replaceStyles[S][1],"","",i),w=new a(v));null!=v.allowedAttributes&&(0==v.allowedAttributes.length||t.inArray(y[1],v.allowedAttributes)>-1)&&w.attributes.push(new s(y[1],y[2]))}t.each(v.requiredAttributes,function(){var t=this.toString();w.hasAttribute(t)||w.attributes.push(new s(t,""))});for(var N=0;N<i.replace.length;N++)for(var T=0;T<i.replace[N][0].length;T++){var _="string"==typeof i.replace[N][0][T];if(_&&i.replace[N][0][T]==v.name||!_&&i.replace[N][0][T].test(c)){v.rename(i.replace[N][1]),N=i.replace.length;break}}var A=!0;if(g.isRoot||(g.tag.isInline&&!v.isInline?(A=r(p))&&(g=p[p.length-1]):g.tag.disallowNest&&v.disallowNest&&!v.requiredParent?A=!1:v.requiredParent&&(A=o(p,v.requiredParent))&&(g=p[p.length-1])),A)if(g.children.push(w),v.toProtect)for(var O;O=u.exec(e);){var x=new l(O[4],O[1],O[5],i);if(x.isClosing&&x.name==v.name){w.children.push(RegExp.leftContext.substring(m)),m=u.lastIndex;break}}else v.isSelfClosing||v.isNonClosing||(p.push(w),g=w)}}return t.htmlClean.trim(n(f,i).join(""))},t.htmlClean.defaults={bodyOnly:!0,allowedTags:[],removeTags:["basefont","center","dir","font","frame","frameset","iframe","isindex","menu","noframes","s","strike","u"],allowedAttributes:[],removeAttrs:[],allowedClasses:[],format:!1,formatIndent:0,replace:[[["b","big"],"strong"],[["i"],"em"]],replaceStyles:[[/font-weight:\s*bold/i,"strong"],[/font-style:\s*italic/i,"em"],[/vertical-align:\s*super/i,"sup"],[/vertical-align:\s*sub/i,"sub"]],allowComments:!1,allowEmpty:[]},t.htmlClean.trim=function(e){return t.htmlClean.trimStart(t.htmlClean.trimEnd(e))},t.htmlClean.trimStart=function(e){return e.substring(t.htmlClean.trimStartIndex(e))},t.htmlClean.trimStartIndex=function(e){for(var n=0;n<e.length-1&&t.htmlClean.isWhitespace(e.charAt(n));n++);return n},t.htmlClean.trimEnd=function(e){return e.substring(0,t.htmlClean.trimEndIndex(e))},t.htmlClean.trimEndIndex=function(e){for(var n=e.length-1;n>=0&&t.htmlClean.isWhitespace(e.charAt(n));n--);return n+1},t.htmlClean.isWhitespace=function(e){return-1!=t.inArray(e,N)};var g=["a","abbr","acronym","address","b","big","br","button","caption","cite","code","del","em","font","hr","i","input","img","ins","label","legend","map","q","s","samp","select","option","param","small","span","strike","strong","sub","sup","tt","u","var"],m=["address","button","caption","code","input","label","legend","select","option","param"],v=["h1","h2","h3","h4","h5","h6","p","th","td","object"],C=["th","td"],b=[null,"li",["ul","ol"],"dt",["dl"],"dd",["dl"],"td",["tr"],"th",["tr"],"tr",["table","thead","tbody","tfoot"],"thead",["table"],"tbody",["table"],"tfoot",["table"],"param",["object"]],R=["script","style","pre","code"],y=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],w=["!doctype","?xml"],E=[["class"],"?xml",[],"!doctype",[],"a",["accesskey","class","href","name","title","rel","rev","type","tabindex"],"abbr",["class","title"],"acronym",["class","title"],"blockquote",["cite","class"],"button",["class","disabled","name","type","value"],"del",["cite","class","datetime"],"form",["accept","action","class","enctype","method","name"],"iframe",["class","height","name","sandbox","seamless","src","srcdoc","width"],"input",["accept","accesskey","alt","checked","class","disabled","ismap","maxlength","name","size","readonly","src","tabindex","type","usemap","value"],"img",["alt","class","height","src","width"],"ins",["cite","class","datetime"],"label",["accesskey","class","for"],"legend",["accesskey","class"],"link",["href","rel","type"],"meta",["content","http-equiv","name","scheme","charset"],"map",["name"],"optgroup",["class","disabled","label"],"option",["class","disabled","label","selected","value"],"q",["class","cite"],"script",["src","type"],"select",["class","disabled","multiple","name","size","tabindex"],"style",["type"],"table",["class","summary"],"th",["class","colspan","rowspan"],"td",["class","colspan","rowspan"],"textarea",["accesskey","class","cols","disabled","name","readonly","rows","tabindex"],"param",["name","value"],"embed",["height","src","type","width"]],S=[[],"img",["alt"]],N=[" "," ","	","\n","\r","\f"]}(jQuery),function(t,e){"function"==typeof define&&define.amd?define(t):"undefined"!=typeof module&&"object"==typeof exports?module.exports=t():e.rangy=t()}(function(){function t(t,e){var n=typeof t[e];return n==R||!(n!=b||!t[e])||"unknown"==n}function e(t,e){return!(typeof t[e]!=b||!t[e])}function n(t,e){return typeof t[e]!=y}function o(t){return function(e,n){for(var o=n.length;o--;)if(!t(e,n[o]))return!1;return!0}}function r(t){return t&&T(t,N)&&A(t,S)}function i(t){return e(t,"body")?t.body:t.getElementsByTagName("body")[0]}function a(e){typeof console!=y&&t(console,"log")&&console.log(e)}function s(t,e){D&&e?alert(t):a(t)}function l(t){k.initialized=!0,k.supported=!1,s("Rangy is not supported in this environment. Reason: "+t,k.config.alertOnFail)}function c(t){s("Rangy warning: "+t,k.config.alertOnWarn)}function u(t){return t.message||t.description||String(t)}function h(){if(D&&!k.initialized){var e,n=!1,o=!1;t(document,"createRange")&&(e=document.createRange(),T(e,E)&&A(e,w)&&(n=!0));var s=i(document);if(!s||"body"!=s.nodeName.toLowerCase())return void l("No body element found");if(s&&t(s,"createTextRange")&&(e=s.createTextRange(),r(e)&&(o=!0)),!n&&!o)return void l("Neither Range nor TextRange are available");k.initialized=!0,k.features={implementsDomRange:n,implementsTextRange:o};var c,h;for(var d in x)(c=x[d])instanceof g&&c.init(c,k);for(var f=0,p=L.length;p>f;++f)try{L[f](k)}catch(m){h="Rangy init listener threw an exception. Continuing. Detail: "+u(m),a(h)}}}function d(t,e,n){n&&(t+=" in module "+n.name),k.warn("DEPRECATED: "+t+" is deprecated. Please use "+e+" instead.")}function f(t,e,n,o){t[e]=function(){return d(e,n,o),t[n].apply(t,P.toArray(arguments))}}function p(t){t=t||window,h();for(var e=0,n=B.length;n>e;++e)B[e](t)}function g(t,e,n){this.name=t,this.dependencies=e,this.initialized=!1,this.supported=!1,this.initializer=n}function m(t,e,n){var o=new g(t,e,function(e){if(!e.initialized){e.initialized=!0;try{n(k,e),e.supported=!0}catch(o){var r="Module '"+t+"' failed to load: "+u(o);a(r),o.stack&&a(o.stack)}}});return x[t]=o,o}function v(){}function C(){}var b="object",R="function",y="undefined",w=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],E=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],S=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],N=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],T=o(t),_=o(e),A=o(n),O=[].forEach?function(t,e){t.forEach(e)}:function(t,e){for(var n=0,o=t.length;o>n;++n)e(t[n],n)},x={},D=typeof window!=y&&typeof document!=y,P={isHostMethod:t,isHostObject:e,isHostProperty:n,areHostMethods:T,areHostObjects:_,areHostProperties:A,isTextRange:r,getBody:i,forEach:O},k={version:"1.3.0",initialized:!1,isBrowser:D,supported:!0,util:P,features:{},modules:x,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==y?!0:rangyAutoInitialize}};k.fail=l,k.warn=c;var I;({}).hasOwnProperty?(P.extend=I=function(t,e,n){var o,r;for(var i in e)e.hasOwnProperty(i)&&(o=t[i],r=e[i],n&&null!==o&&"object"==typeof o&&null!==r&&"object"==typeof r&&I(o,r,!0),t[i]=r);return e.hasOwnProperty("toString")&&(t.toString=e.toString),t},P.createOptions=function(t,e){var n={};return I(n,e),t&&I(n,t),n}):l("hasOwnProperty not supported"),D||l("Rangy can only run in a browser"),function(){var t;if(D){var e=document.createElement("div");e.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(e.childNodes,0)[0].nodeType&&(t=function(t){return n.call(t,0)})}catch(o){}}t||(t=function(t){for(var e=[],n=0,o=t.length;o>n;++n)e[n]=t[n];return e}),P.toArray=t}();var M;D&&(t(document,"addEventListener")?M=function(t,e,n){t.addEventListener(e,n,!1)}:t(document,"attachEvent")?M=function(t,e,n){t.attachEvent("on"+e,n)}:l("Document does not have required addEventListener or attachEvent method"),P.addListener=M);var L=[];P.deprecationNotice=d,P.createAliasForDeprecatedMethod=f,k.init=h,k.addInitListener=function(t){k.initialized?t(k):L.push(t)};var B=[];k.addShimListener=function(t){B.push(t)},D&&(k.shim=k.createMissingNativeApi=p,f(k,"createMissingNativeApi","shim")),g.prototype={init:function(){for(var t,e,n=this.dependencies||[],o=0,r=n.length;r>o;++o){if(e=n[o],t=x[e],!(t&&t instanceof g))throw new Error("required module '"+e+"' not found");if(t.init(),!t.supported)throw new Error("required module '"+e+"' not supported")}this.initializer(this)},fail:function(t){throw this.initialized=!0,this.supported=!1,new Error(t)},warn:function(t){k.warn("Module "+this.name+": "+t)},deprecationNotice:function(t,e){k.warn("DEPRECATED: "+t+" in module "+this.name+" is deprecated. Please use "+e+" instead")},createError:function(t){return new Error("Error in Rangy "+this.name+" module: "+t)}},k.createModule=function(t){var e,n;2==arguments.length?(e=arguments[1],n=[]):(e=arguments[2],n=arguments[1]);var o=m(t,n,e);k.initialized&&k.supported&&o.init()},k.createCoreModule=function(t,e,n){m(t,e,n)},k.RangePrototype=v,k.rangePrototype=new v,k.selectionPrototype=new C,k.createCoreModule("DomUtil",[],function(t,e){function n(t){var e;return typeof t.namespaceURI==D||null===(e=t.namespaceURI)||"http://www.w3.org/1999/xhtml"==e}function o(t){var e=t.parentNode;return 1==e.nodeType?e:null}function r(t){for(var e=0;t=t.previousSibling;)++e;return e}function i(t){switch(t.nodeType){case 7:case 10:return 0;case 3:case 8:return t.length;default:return t.childNodes.length}}function a(t,e){var n,o=[];for(n=t;n;n=n.parentNode)o.push(n);for(n=e;n;n=n.parentNode)if(L(o,n))return n;return null}function s(t,e,n){for(var o=n?e:e.parentNode;o;){if(o===t)return!0;o=o.parentNode}return!1}function l(t,e){return s(t,e,!0)}function c(t,e,n){for(var o,r=n?t:t.parentNode;r;){if(o=r.parentNode,o===e)return r;r=o}return null}function u(t){var e=t.nodeType;return 3==e||4==e||8==e}function h(t){if(!t)return!1;var e=t.nodeType;return 3==e||8==e}function d(t,e){var n=e.nextSibling,o=e.parentNode;return n?o.insertBefore(t,n):o.appendChild(t),t}function f(t,e,n){var o=t.cloneNode(!1);if(o.deleteData(0,e),t.deleteData(e,t.length-e),d(o,t),n)for(var i,a=0;i=n[a++];)i.node==t&&i.offset>e?(i.node=o,i.offset-=e):i.node==t.parentNode&&i.offset>r(t)&&++i.offset;return o}function p(t){if(9==t.nodeType)return t;if(typeof t.ownerDocument!=D)return t.ownerDocument;if(typeof t.document!=D)return t.document;if(t.parentNode)return p(t.parentNode);throw e.createError("getDocument: no document found for node")}function g(t){var n=p(t);if(typeof n.defaultView!=D)return n.defaultView;if(typeof n.parentWindow!=D)return n.parentWindow;throw e.createError("Cannot get a window object for node")}function m(t){if(typeof t.contentDocument!=D)return t.contentDocument;if(typeof t.contentWindow!=D)return t.contentWindow.document;throw e.createError("getIframeDocument: No Document object found for iframe element")}function v(t){if(typeof t.contentWindow!=D)return t.contentWindow;if(typeof t.contentDocument!=D)return t.contentDocument.defaultView;throw e.createError("getIframeWindow: No Window object found for iframe element")}function C(t){return t&&P.isHostMethod(t,"setTimeout")&&P.isHostObject(t,"document")}function b(t,e,n){var o;if(t?P.isHostProperty(t,"nodeType")?o=1==t.nodeType&&"iframe"==t.tagName.toLowerCase()?m(t):p(t):C(t)&&(o=t.document):o=document,!o)throw e.createError(n+"(): Parameter must be a Window object or DOM node");return o}function R(t){for(var e;e=t.parentNode;)t=e;return t}function y(t,n,o,i){var s,l,u,h,d;if(t==o)return n===i?0:i>n?-1:1;if(s=c(o,t,!0))return n<=r(s)?-1:1;if(s=c(t,o,!0))return r(s)<i?-1:1;if(l=a(t,o),!l)throw new Error("comparePoints error: nodes have no common ancestor");if(u=t===l?l:c(t,l,!0),h=o===l?l:c(o,l,!0),u===h)throw e.createError("comparePoints got to case 4 and childA and childB are the same!");for(d=l.firstChild;d;){if(d===u)return-1;if(d===h)return 1;d=d.nextSibling}}function w(t){var e;try{return e=t.parentNode,!1}catch(n){return!0}}function E(t){if(!t)return"[No node]";if(B&&w(t))return"[Broken node]";if(u(t))return'"'+t.data+'"';if(1==t.nodeType){var e=t.id?' id="'+t.id+'"':"";return"<"+t.nodeName+e+">[index:"+r(t)+",length:"+t.childNodes.length+"]["+(t.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return t.nodeName}function S(t){for(var e,n=p(t).createDocumentFragment();e=t.firstChild;)n.appendChild(e);return n}function N(t,e,n){var o=k(t),r=t.createElement("div");r.contentEditable=""+!!n,e&&(r.innerHTML=e);var i=o.firstChild;return i?o.insertBefore(r,i):o.appendChild(r),r}function T(t){return t.parentNode.removeChild(t)}function _(t){this.root=t,this._next=t}function A(t){return new _(t)}function O(t,e){this.node=t,this.offset=e}function x(t){this.code=this[t],this.codeName=t,this.message="DOMException: "+this.codeName}var D="undefined",P=t.util,k=P.getBody;P.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||e.fail("document missing a Node creation method"),P.isHostMethod(document,"getElementsByTagName")||e.fail("document missing getElementsByTagName method");var I=document.createElement("div");P.areHostMethods(I,["insertBefore","appendChild","cloneNode"]||!P.areHostObjects(I,["previousSibling","nextSibling","childNodes","parentNode"]))||e.fail("Incomplete Element implementation"),P.isHostProperty(I,"innerHTML")||e.fail("Element is missing innerHTML property");var M=document.createTextNode("test");P.areHostMethods(M,["splitText","deleteData","insertData","appendData","cloneNode"]||!P.areHostObjects(I,["previousSibling","nextSibling","childNodes","parentNode"])||!P.areHostProperties(M,["data"]))||e.fail("Incomplete Text Node implementation");var L=function(t,e){for(var n=t.length;n--;)if(t[n]===e)return!0;return!1},B=!1;!function(){var e=document.createElement("b");e.innerHTML="1";var n=e.firstChild;e.innerHTML="<br />",B=w(n),t.features.crashyTextNodes=B}();var H;typeof window.getComputedStyle!=D?H=function(t,e){return g(t).getComputedStyle(t,null)[e]}:typeof document.documentElement.currentStyle!=D?H=function(t,e){return t.currentStyle?t.currentStyle[e]:""}:e.fail("No means of obtaining computed style properties found"),_.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var t,e,n=this._current=this._next;if(this._current)if(t=n.firstChild)this._next=t;else{for(e=null;n!==this.root&&!(e=n.nextSibling);)n=n.parentNode;this._next=e}return this._current},detach:function(){this._current=this._next=this.root=null}},O.prototype={equals:function(t){return!!t&&this.node===t.node&&this.offset==t.offset},inspect:function(){return"[DomPosition("+E(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},x.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},x.prototype.toString=function(){return this.message},t.dom={arrayContains:L,isHtmlNamespace:n,parentElement:o,getNodeIndex:r,getNodeLength:i,getCommonAncestor:a,isAncestorOf:s,isOrIsAncestorOf:l,getClosestAncestorIn:c,isCharacterDataNode:u,isTextOrCommentNode:h,insertAfter:d,splitDataNode:f,getDocument:p,getWindow:g,getIframeWindow:v,getIframeDocument:m,getBody:k,isWindow:C,getContentDocument:b,getRootContainer:R,comparePoints:y,isBrokenNode:w,inspectNode:E,getComputedStyleProperty:H,createTestElement:N,removeNode:T,fragmentFromNodeChildren:S,createIterator:A,DomPosition:O},t.DOMException=x}),k.createCoreModule("DomRange",["DomUtil"],function(t,e){function n(t,e){return 3!=t.nodeType&&($(t,e.startContainer)||$(t,e.endContainer))}function o(t){return t.document||j(t.startContainer)}function r(t){return Q(t.startContainer)}function i(t){return new B(t.parentNode,F(t))}function a(t){return new B(t.parentNode,F(t)+1)}function s(t,e,n){var o=11==t.nodeType?t.firstChild:t;return W(e)?n==e.length?M.insertAfter(t,e):e.parentNode.insertBefore(t,0==n?e:V(e,n)):n>=e.childNodes.length?e.appendChild(t):e.insertBefore(t,e.childNodes[n]),o}function l(t,e,n){if(N(t),N(e),o(e)!=o(t))throw new H("WRONG_DOCUMENT_ERR");var r=q(t.startContainer,t.startOffset,e.endContainer,e.endOffset),i=q(t.endContainer,t.endOffset,e.startContainer,e.startOffset);return n?0>=r&&i>=0:0>r&&i>0}function c(t){for(var e,n,r,i=o(t.range).createDocumentFragment();n=t.next();){if(e=t.isPartiallySelectedSubtree(),n=n.cloneNode(!e),e&&(r=t.getSubtreeIterator(),n.appendChild(c(r)),r.detach()),10==n.nodeType)throw new H("HIERARCHY_REQUEST_ERR");i.appendChild(n)}return i}function u(t,e,n){var o,r;n=n||{stop:!1};for(var i,a;i=t.next();)if(t.isPartiallySelectedSubtree()){if(e(i)===!1)return void(n.stop=!0);if(a=t.getSubtreeIterator(),u(a,e,n),a.detach(),n.stop)return}else for(o=M.createIterator(i);r=o.next();)if(e(r)===!1)return void(n.stop=!0)}function h(t){for(var e;t.next();)t.isPartiallySelectedSubtree()?(e=t.getSubtreeIterator(),h(e),e.detach()):t.remove()}function d(t){for(var e,n,r=o(t.range).createDocumentFragment();e=t.next();){if(t.isPartiallySelectedSubtree()?(e=e.cloneNode(!1),n=t.getSubtreeIterator(),e.appendChild(d(n)),n.detach()):t.remove(),10==e.nodeType)throw new H("HIERARCHY_REQUEST_ERR");r.appendChild(e)}return r}function f(t,e,n){var o,r=!(!e||!e.length),i=!!n;r&&(o=new RegExp("^("+e.join("|")+")$"));var a=[];return u(new g(t,!1),function(e){if((!r||o.test(e.nodeType))&&(!i||n(e))){var s=t.startContainer;if(e!=s||!W(s)||t.startOffset!=s.length){var l=t.endContainer;e==l&&W(l)&&0==t.endOffset||a.push(e)}}}),a}function p(t){var e="undefined"==typeof t.getName?"Range":t.getName();return"["+e+"("+M.inspectNode(t.startContainer)+":"+t.startOffset+", "+M.inspectNode(t.endContainer)+":"+t.endOffset+")]"}function g(t,e){if(this.range=t,this.clonePartiallySelectedTextNodes=e,!t.collapsed){this.sc=t.startContainer,this.so=t.startOffset,this.ec=t.endContainer,this.eo=t.endOffset;var n=t.commonAncestorContainer;this.sc===this.ec&&W(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||W(this.sc)?U(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||W(this.ec)?U(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function m(t){return function(e,n){for(var o,r=n?e:e.parentNode;r;){if(o=r.nodeType,K(t,o))return r;r=r.parentNode}return null}}function v(t,e){if(rt(t,e))throw new H("INVALID_NODE_TYPE_ERR")}function C(t,e){if(!K(e,t.nodeType))throw new H("INVALID_NODE_TYPE_ERR")}function b(t,e){if(0>e||e>(W(t)?t.length:t.childNodes.length))throw new H("INDEX_SIZE_ERR")}function R(t,e){if(nt(t,!0)!==nt(e,!0))throw new H("WRONG_DOCUMENT_ERR")}function y(t){if(ot(t,!0))throw new H("NO_MODIFICATION_ALLOWED_ERR")}function w(t,e){if(!t)throw new H(e)}function E(t,e){return e<=(W(t)?t.length:t.childNodes.length)}function S(t){return!!t.startContainer&&!!t.endContainer&&!(Y&&(M.isBrokenNode(t.startContainer)||M.isBrokenNode(t.endContainer)))&&Q(t.startContainer)==Q(t.endContainer)&&E(t.startContainer,t.startOffset)&&E(t.endContainer,t.endOffset)}function N(t){if(!S(t))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+t.inspect()+")")}function T(t,e){N(t);var n=t.startContainer,o=t.startOffset,r=t.endContainer,i=t.endOffset,a=n===r;W(r)&&i>0&&i<r.length&&V(r,i,e),W(n)&&o>0&&o<n.length&&(n=V(n,o,e),a?(i-=o,r=n):r==n.parentNode&&i>=F(n)&&i++,o=0),t.setStartAndEnd(n,o,r,i)}function _(t){N(t);var e=t.commonAncestorContainer.parentNode.cloneNode(!1);return e.appendChild(t.cloneContents()),e.innerHTML}function A(t){t.START_TO_START=ut,t.START_TO_END=ht,t.END_TO_END=dt,t.END_TO_START=ft,t.NODE_BEFORE=pt,t.NODE_AFTER=gt,t.NODE_BEFORE_AND_AFTER=mt,t.NODE_INSIDE=vt}function O(t){A(t),A(t.prototype)}function x(t,e){return function(){N(this);var n,o,r=this.startContainer,i=this.startOffset,s=this.commonAncestorContainer,l=new g(this,!0);r!==s&&(n=U(r,s,!0),o=a(n),r=o.node,i=o.offset),u(l,y),l.reset();var c=t(l);return l.detach(),e(this,r,i,r,i),c}}function D(e,o){function r(t,e){return function(n){C(n,G),C(Q(n),Z);var o=(t?i:a)(n);(e?s:l)(this,o.node,o.offset)}}function s(t,e,n){var r=t.endContainer,i=t.endOffset;(e!==t.startContainer||n!==t.startOffset)&&((Q(e)!=Q(r)||1==q(e,n,r,i))&&(r=e,i=n),o(t,e,n,r,i))}function l(t,e,n){var r=t.startContainer,i=t.startOffset;(e!==t.endContainer||n!==t.endOffset)&&((Q(e)!=Q(r)||-1==q(e,n,r,i))&&(r=e,i=n),o(t,r,i,e,n))}var c=function(){};c.prototype=t.rangePrototype,e.prototype=new c,L.extend(e.prototype,{setStart:function(t,e){v(t,!0),b(t,e),s(this,t,e)},setEnd:function(t,e){v(t,!0),b(t,e),l(this,t,e)},setStartAndEnd:function(){var t=arguments,e=t[0],n=t[1],r=e,i=n;switch(t.length){case 3:i=t[2];break;case 4:r=t[2],i=t[3]}o(this,e,n,r,i)},setBoundary:function(t,e,n){this["set"+(n?"Start":"End")](t,e)},setStartBefore:r(!0,!0),setStartAfter:r(!1,!0),setEndBefore:r(!0,!1),setEndAfter:r(!1,!1),collapse:function(t){N(this),t?o(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):o(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(t){v(t,!0),o(this,t,0,t,z(t))},selectNode:function(t){v(t,!1),C(t,G);var e=i(t),n=a(t);o(this,e.node,e.offset,n.node,n.offset)},extractContents:x(d,o),deleteContents:x(h,o),canSurroundContents:function(){N(this),y(this.startContainer),y(this.endContainer);var t=new g(this,!0),e=t._first&&n(t._first,this)||t._last&&n(t._last,this);return t.detach(),!e},splitBoundaries:function(){T(this)},splitBoundariesPreservingPositions:function(t){T(this,t)},normalizeBoundaries:function(){N(this);var t,e=this.startContainer,n=this.startOffset,r=this.endContainer,i=this.endOffset,a=function(t){var e=t.nextSibling;e&&e.nodeType==t.nodeType&&(r=t,i=t.length,t.appendData(e.data),X(e))},s=function(t){var o=t.previousSibling;if(o&&o.nodeType==t.nodeType){e=t;var a=t.length;if(n=o.length,t.insertData(0,o.data),X(o),e==r)i+=n,r=e;else if(r==t.parentNode){var s=F(t);i==s?(r=t,i=a):i>s&&i--}}},l=!0;if(W(r))i==r.length?a(r):0==i&&(t=r.previousSibling,t&&t.nodeType==r.nodeType&&(i=t.length,e==r&&(l=!1),t.appendData(r.data),X(r),r=t));else{if(i>0){var c=r.childNodes[i-1];c&&W(c)&&a(c)}l=!this.collapsed}if(l){if(W(e))0==n?s(e):n==e.length&&(t=e.nextSibling,t&&t.nodeType==e.nodeType&&(r==t&&(r=e,i+=e.length),e.appendData(t.data),X(t)));else if(n<e.childNodes.length){var u=e.childNodes[n];u&&W(u)&&s(u)}}else e=r,n=i;o(this,e,n,r,i)},collapseToPoint:function(t,e){v(t,!0),b(t,e),this.setStartAndEnd(t,e)}}),O(e)}function P(t){t.collapsed=t.startContainer===t.endContainer&&t.startOffset===t.endOffset,t.commonAncestorContainer=t.collapsed?t.startContainer:M.getCommonAncestor(t.startContainer,t.endContainer)}function k(t,e,n,o,r){t.startContainer=e,t.startOffset=n,t.endContainer=o,t.endOffset=r,t.document=M.getDocument(e),P(t)}function I(t){this.startContainer=t,this.startOffset=0,this.endContainer=t,this.endOffset=0,this.document=t,P(this)}var M=t.dom,L=t.util,B=M.DomPosition,H=t.DOMException,W=M.isCharacterDataNode,F=M.getNodeIndex,$=M.isOrIsAncestorOf,j=M.getDocument,q=M.comparePoints,V=M.splitDataNode,U=M.getClosestAncestorIn,z=M.getNodeLength,K=M.arrayContains,Q=M.getRootContainer,Y=t.features.crashyTextNodes,X=M.removeNode;g.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var t=this._current=this._next;return t&&(this._next=t!==this._last?t.nextSibling:null,W(t)&&this.clonePartiallySelectedTextNodes&&(t===this.ec&&(t=t.cloneNode(!0)).deleteData(this.eo,t.length-this.eo),this._current===this.sc&&(t=t.cloneNode(!0)).deleteData(0,this.so))),t},remove:function(){var t,e,n=this._current;!W(n)||n!==this.sc&&n!==this.ec?n.parentNode&&X(n):(t=n===this.sc?this.so:0,e=n===this.ec?this.eo:n.length,t!=e&&n.deleteData(t,e-t))},isPartiallySelectedSubtree:function(){var t=this._current;return n(t,this.range)},getSubtreeIterator:function(){var t;if(this.isSingleCharacterDataNode)t=this.range.cloneRange(),t.collapse(!1);else{t=new I(o(this.range));var e=this._current,n=e,r=0,i=e,a=z(e);$(e,this.sc)&&(n=this.sc,r=this.so),$(e,this.ec)&&(i=this.ec,a=this.eo),k(t,n,r,i,a)}return new g(t,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var G=[1,3,4,5,7,8,10],Z=[2,9,11],J=[5,6,10,12],tt=[1,3,4,5,7,8,10,11],et=[1,3,4,5,7,8],nt=m([9,11]),ot=m(J),rt=m([6,10,12]),it=document.createElement("style"),at=!1;try{it.innerHTML="<b>x</b>",at=3==it.firstChild.nodeType}catch(st){}t.features.htmlParsingConforms=at;var lt=at?function(t){var e=this.startContainer,n=j(e);if(!e)throw new H("INVALID_STATE_ERR");var o=null;return 1==e.nodeType?o=e:W(e)&&(o=M.parentElement(e)),o=null===o||"HTML"==o.nodeName&&M.isHtmlNamespace(j(o).documentElement)&&M.isHtmlNamespace(o)?n.createElement("body"):o.cloneNode(!1),o.innerHTML=t,M.fragmentFromNodeChildren(o)}:function(t){var e=o(this),n=e.createElement("body");return n.innerHTML=t,M.fragmentFromNodeChildren(n)},ct=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ut=0,ht=1,dt=2,ft=3,pt=0,gt=1,mt=2,vt=3;L.extend(t.rangePrototype,{compareBoundaryPoints:function(t,e){N(this),R(this.startContainer,e.startContainer);var n,o,r,i,a=t==ft||t==ut?"start":"end",s=t==ht||t==ut?"start":"end";return n=this[a+"Container"],o=this[a+"Offset"],r=e[s+"Container"],i=e[s+"Offset"],q(n,o,r,i)},insertNode:function(t){if(N(this),C(t,tt),y(this.startContainer),$(t,this.startContainer))throw new H("HIERARCHY_REQUEST_ERR");var e=s(t,this.startContainer,this.startOffset);this.setStartBefore(e)},cloneContents:function(){N(this);var t,e;if(this.collapsed)return o(this).createDocumentFragment();if(this.startContainer===this.endContainer&&W(this.startContainer))return t=this.startContainer.cloneNode(!0),t.data=t.data.slice(this.startOffset,this.endOffset),e=o(this).createDocumentFragment(),e.appendChild(t),e;var n=new g(this,!0);return t=c(n),n.detach(),t},canSurroundContents:function(){N(this),y(this.startContainer),y(this.endContainer);var t=new g(this,!0),e=t._first&&n(t._first,this)||t._last&&n(t._last,this);return t.detach(),!e},surroundContents:function(t){if(C(t,et),!this.canSurroundContents())throw new H("INVALID_STATE_ERR");var e=this.extractContents();if(t.hasChildNodes())for(;t.lastChild;)t.removeChild(t.lastChild);s(t,this.startContainer,this.startOffset),t.appendChild(e),this.selectNode(t)},cloneRange:function(){N(this);for(var t,e=new I(o(this)),n=ct.length;n--;)t=ct[n],e[t]=this[t];return e},toString:function(){N(this);var t=this.startContainer;if(t===this.endContainer&&W(t))return 3==t.nodeType||4==t.nodeType?t.data.slice(this.startOffset,this.endOffset):"";var e=[],n=new g(this,!0);return u(n,function(t){(3==t.nodeType||4==t.nodeType)&&e.push(t.data)}),n.detach(),e.join("")},compareNode:function(t){N(this);var e=t.parentNode,n=F(t);if(!e)throw new H("NOT_FOUND_ERR");var o=this.comparePoint(e,n),r=this.comparePoint(e,n+1);return 0>o?r>0?mt:pt:r>0?gt:vt},comparePoint:function(t,e){return N(this),w(t,"HIERARCHY_REQUEST_ERR"),R(t,this.startContainer),q(t,e,this.startContainer,this.startOffset)<0?-1:q(t,e,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:lt,toHtml:function(){return _(this)},intersectsNode:function(t,e){if(N(this),Q(t)!=r(this))return!1;var n=t.parentNode,o=F(t);if(!n)return!0;var i=q(n,o,this.endContainer,this.endOffset),a=q(n,o+1,this.startContainer,this.startOffset);return e?0>=i&&a>=0:0>i&&a>0},isPointInRange:function(t,e){return N(this),w(t,"HIERARCHY_REQUEST_ERR"),R(t,this.startContainer),q(t,e,this.startContainer,this.startOffset)>=0&&q(t,e,this.endContainer,this.endOffset)<=0},intersectsRange:function(t){return l(this,t,!1)},intersectsOrTouchesRange:function(t){return l(this,t,!0)},intersection:function(t){if(this.intersectsRange(t)){var e=q(this.startContainer,this.startOffset,t.startContainer,t.startOffset),n=q(this.endContainer,this.endOffset,t.endContainer,t.endOffset),o=this.cloneRange();return-1==e&&o.setStart(t.startContainer,t.startOffset),1==n&&o.setEnd(t.endContainer,t.endOffset),o}return null},union:function(t){if(this.intersectsOrTouchesRange(t)){var e=this.cloneRange();return-1==q(t.startContainer,t.startOffset,this.startContainer,this.startOffset)&&e.setStart(t.startContainer,t.startOffset),1==q(t.endContainer,t.endOffset,this.endContainer,this.endOffset)&&e.setEnd(t.endContainer,t.endOffset),e}throw new H("Ranges do not intersect")},containsNode:function(t,e){return e?this.intersectsNode(t,!1):this.compareNode(t)==vt},containsNodeContents:function(t){return this.comparePoint(t,0)>=0&&this.comparePoint(t,z(t))<=0},containsRange:function(t){var e=this.intersection(t);return null!==e&&t.equals(e)},containsNodeText:function(t){var e=this.cloneRange();e.selectNode(t);var n=e.getNodes([3]);if(n.length>0){e.setStart(n[0],0);var o=n.pop();return e.setEnd(o,o.length),this.containsRange(e)}return this.containsNodeContents(t)},getNodes:function(t,e){return N(this),f(this,t,e)},getDocument:function(){return o(this)},collapseBefore:function(t){this.setEndBefore(t),
this.collapse(!1)},collapseAfter:function(t){this.setStartAfter(t),this.collapse(!0)},getBookmark:function(e){var n=o(this),r=t.createRange(n);e=e||M.getBody(n),r.selectNodeContents(e);var i=this.intersection(r),a=0,s=0;return i&&(r.setEnd(i.startContainer,i.startOffset),a=r.toString().length,s=a+i.toString().length),{start:a,end:s,containerNode:e}},moveToBookmark:function(t){var e=t.containerNode,n=0;this.setStart(e,0),this.collapse(!0);for(var o,r,i,a,s=[e],l=!1,c=!1;!c&&(o=s.pop());)if(3==o.nodeType)r=n+o.length,!l&&t.start>=n&&t.start<=r&&(this.setStart(o,t.start-n),l=!0),l&&t.end>=n&&t.end<=r&&(this.setEnd(o,t.end-n),c=!0),n=r;else for(a=o.childNodes,i=a.length;i--;)s.push(a[i])},getName:function(){return"DomRange"},equals:function(t){return I.rangesEqual(this,t)},isValid:function(){return S(this)},inspect:function(){return p(this)},detach:function(){}}),D(I,k),L.extend(I,{rangeProperties:ct,RangeIterator:g,copyComparisonConstants:O,createPrototypeRange:D,inspect:p,toHtml:_,getRangeDocument:o,rangesEqual:function(t,e){return t.startContainer===e.startContainer&&t.startOffset===e.startOffset&&t.endContainer===e.endContainer&&t.endOffset===e.endOffset}}),t.DomRange=I}),k.createCoreModule("WrappedRange",["DomRange"],function(t,e){var n,o,r=t.dom,i=t.util,a=r.DomPosition,s=t.DomRange,l=r.getBody,c=r.getContentDocument,u=r.isCharacterDataNode;if(t.features.implementsDomRange&&!function(){function o(t){for(var e,n=d.length;n--;)e=d[n],t[e]=t.nativeRange[e];t.collapsed=t.startContainer===t.endContainer&&t.startOffset===t.endOffset}function a(t,e,n,o,r){var i=t.startContainer!==e||t.startOffset!=n,a=t.endContainer!==o||t.endOffset!=r,s=!t.equals(t.nativeRange);(i||a||s)&&(t.setEnd(o,r),t.setStart(e,n))}var u,h,d=s.rangeProperties;n=function(t){if(!t)throw e.createError("WrappedRange: Range must be specified");this.nativeRange=t,o(this)},s.createPrototypeRange(n,a),u=n.prototype,u.selectNode=function(t){this.nativeRange.selectNode(t),o(this)},u.cloneContents=function(){return this.nativeRange.cloneContents()},u.surroundContents=function(t){this.nativeRange.surroundContents(t),o(this)},u.collapse=function(t){this.nativeRange.collapse(t),o(this)},u.cloneRange=function(){return new n(this.nativeRange.cloneRange())},u.refresh=function(){o(this)},u.toString=function(){return this.nativeRange.toString()};var f=document.createTextNode("test");l(document).appendChild(f);var p=document.createRange();p.setStart(f,0),p.setEnd(f,0);try{p.setStart(f,1),u.setStart=function(t,e){this.nativeRange.setStart(t,e),o(this)},u.setEnd=function(t,e){this.nativeRange.setEnd(t,e),o(this)},h=function(t){return function(e){this.nativeRange[t](e),o(this)}}}catch(g){u.setStart=function(t,e){try{this.nativeRange.setStart(t,e)}catch(n){this.nativeRange.setEnd(t,e),this.nativeRange.setStart(t,e)}o(this)},u.setEnd=function(t,e){try{this.nativeRange.setEnd(t,e)}catch(n){this.nativeRange.setStart(t,e),this.nativeRange.setEnd(t,e)}o(this)},h=function(t,e){return function(n){try{this.nativeRange[t](n)}catch(r){this.nativeRange[e](n),this.nativeRange[t](n)}o(this)}}}u.setStartBefore=h("setStartBefore","setEndBefore"),u.setStartAfter=h("setStartAfter","setEndAfter"),u.setEndBefore=h("setEndBefore","setStartBefore"),u.setEndAfter=h("setEndAfter","setStartAfter"),u.selectNodeContents=function(t){this.setStartAndEnd(t,0,r.getNodeLength(t))},p.selectNodeContents(f),p.setEnd(f,3);var m=document.createRange();m.selectNodeContents(f),m.setEnd(f,4),m.setStart(f,2),-1==p.compareBoundaryPoints(p.START_TO_END,m)&&1==p.compareBoundaryPoints(p.END_TO_START,m)?u.compareBoundaryPoints=function(t,e){return e=e.nativeRange||e,t==e.START_TO_END?t=e.END_TO_START:t==e.END_TO_START&&(t=e.START_TO_END),this.nativeRange.compareBoundaryPoints(t,e)}:u.compareBoundaryPoints=function(t,e){return this.nativeRange.compareBoundaryPoints(t,e.nativeRange||e)};var v=document.createElement("div");v.innerHTML="123";var C=v.firstChild,b=l(document);b.appendChild(v),p.setStart(C,1),p.setEnd(C,2),p.deleteContents(),"13"==C.data&&(u.deleteContents=function(){this.nativeRange.deleteContents(),o(this)},u.extractContents=function(){var t=this.nativeRange.extractContents();return o(this),t}),b.removeChild(v),b=null,i.isHostMethod(p,"createContextualFragment")&&(u.createContextualFragment=function(t){return this.nativeRange.createContextualFragment(t)}),l(document).removeChild(f),u.getName=function(){return"WrappedRange"},t.WrappedRange=n,t.createNativeRange=function(t){return t=c(t,e,"createNativeRange"),t.createRange()}}(),t.features.implementsTextRange){var h=function(t){var e=t.parentElement(),n=t.duplicate();n.collapse(!0);var o=n.parentElement();n=t.duplicate(),n.collapse(!1);var i=n.parentElement(),a=o==i?o:r.getCommonAncestor(o,i);return a==e?a:r.getCommonAncestor(e,a)},d=function(t){return 0==t.compareEndPoints("StartToEnd",t)},f=function(t,e,n,o,i){var s=t.duplicate();s.collapse(n);var l=s.parentElement();if(r.isOrIsAncestorOf(e,l)||(l=e),!l.canHaveHTML){var c=new a(l.parentNode,r.getNodeIndex(l));return{boundaryPosition:c,nodeInfo:{nodeIndex:c.offset,containerElement:c.node}}}var h=r.getDocument(l).createElement("span");h.parentNode&&r.removeNode(h);for(var d,f,p,g,m,v=n?"StartToStart":"StartToEnd",C=i&&i.containerElement==l?i.nodeIndex:0,b=l.childNodes.length,R=b,y=R;;){if(y==b?l.appendChild(h):l.insertBefore(h,l.childNodes[y]),s.moveToElementText(h),d=s.compareEndPoints(v,t),0==d||C==R)break;if(-1==d){if(R==C+1)break;C=y}else R=R==C+1?C:y;y=Math.floor((C+R)/2),l.removeChild(h)}if(m=h.nextSibling,-1==d&&m&&u(m)){s.setEndPoint(n?"EndToStart":"EndToEnd",t);var w;if(/[\r\n]/.test(m.data)){var E=s.duplicate(),S=E.text.replace(/\r\n/g,"\r").length;for(w=E.moveStart("character",S);-1==(d=E.compareEndPoints("StartToEnd",E));)w++,E.moveStart("character",1)}else w=s.text.length;g=new a(m,w)}else f=(o||!n)&&h.previousSibling,p=(o||n)&&h.nextSibling,g=p&&u(p)?new a(p,0):f&&u(f)?new a(f,f.data.length):new a(l,r.getNodeIndex(h));return r.removeNode(h),{boundaryPosition:g,nodeInfo:{nodeIndex:y,containerElement:l}}},p=function(t,e){var n,o,i,a,s=t.offset,c=r.getDocument(t.node),h=l(c).createTextRange(),d=u(t.node);return d?(n=t.node,o=n.parentNode):(a=t.node.childNodes,n=s<a.length?a[s]:null,o=t.node),i=c.createElement("span"),i.innerHTML="&#feff;",n?o.insertBefore(i,n):o.appendChild(i),h.moveToElementText(i),h.collapse(!e),o.removeChild(i),d&&h[e?"moveStart":"moveEnd"]("character",s),h};o=function(t){this.textRange=t,this.refresh()},o.prototype=new s(document),o.prototype.refresh=function(){var t,e,n,o=h(this.textRange);d(this.textRange)?e=t=f(this.textRange,o,!0,!0).boundaryPosition:(n=f(this.textRange,o,!0,!1),t=n.boundaryPosition,e=f(this.textRange,o,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(t.node,t.offset),this.setEnd(e.node,e.offset)},o.prototype.getName=function(){return"WrappedTextRange"},s.copyComparisonConstants(o);var g=function(t){if(t.collapsed)return p(new a(t.startContainer,t.startOffset),!0);var e=p(new a(t.startContainer,t.startOffset),!0),n=p(new a(t.endContainer,t.endOffset),!1),o=l(s.getRangeDocument(t)).createTextRange();return o.setEndPoint("StartToStart",e),o.setEndPoint("EndToEnd",n),o};if(o.rangeToTextRange=g,o.prototype.toTextRange=function(){return g(this)},t.WrappedTextRange=o,!t.features.implementsDomRange||t.config.preferTextRange){var m=function(t){return t("return this;")()}(Function);"undefined"==typeof m.Range&&(m.Range=o),t.createNativeRange=function(t){return t=c(t,e,"createNativeRange"),l(t).createTextRange()},t.WrappedRange=o}}t.createRange=function(n){return n=c(n,e,"createRange"),new t.WrappedRange(t.createNativeRange(n))},t.createRangyRange=function(t){return t=c(t,e,"createRangyRange"),new s(t)},i.createAliasForDeprecatedMethod(t,"createIframeRange","createRange"),i.createAliasForDeprecatedMethod(t,"createIframeRangyRange","createRangyRange"),t.addShimListener(function(e){var n=e.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return t.createRange(n)}),n=e=null})}),k.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(t,e){function n(t){return"string"==typeof t?/^backward(s)?$/i.test(t):!!t}function o(t,n){if(t){if(A.isWindow(t))return t;if(t instanceof v)return t.win;var o=A.getContentDocument(t,e,n);return A.getWindow(o)}return window}function r(t){return o(t,"getWinSelection").getSelection()}function i(t){return o(t,"getDocSelection").document.selection}function a(t){var e=!1;return t.anchorNode&&(e=1==A.comparePoints(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset)),e}function s(t,e,n){var o=n?"end":"start",r=n?"start":"end";t.anchorNode=e[o+"Container"],t.anchorOffset=e[o+"Offset"],t.focusNode=e[r+"Container"],t.focusOffset=e[r+"Offset"]}function l(t){var e=t.nativeSelection;t.anchorNode=e.anchorNode,t.anchorOffset=e.anchorOffset,t.focusNode=e.focusNode,t.focusOffset=e.focusOffset}function c(t){t.anchorNode=t.focusNode=null,t.anchorOffset=t.focusOffset=0,t.rangeCount=0,t.isCollapsed=!0,t._ranges.length=0}function u(e){var n;return e instanceof D?(n=t.createNativeRange(e.getDocument()),n.setEnd(e.endContainer,e.endOffset),n.setStart(e.startContainer,e.startOffset)):e instanceof P?n=e.nativeRange:M.implementsDomRange&&e instanceof A.getWindow(e.startContainer).Range&&(n=e),n}function h(t){if(!t.length||1!=t[0].nodeType)return!1;for(var e=1,n=t.length;n>e;++e)if(!A.isAncestorOf(t[0],t[e]))return!1;return!0}function d(t){var n=t.getNodes();if(!h(n))throw e.createError("getSingleElementFromRange: range "+t.inspect()+" did not consist of a single element");return n[0]}function f(t){return!!t&&"undefined"!=typeof t.text}function p(t,e){var n=new P(e);t._ranges=[n],s(t,n,!1),t.rangeCount=1,t.isCollapsed=n.collapsed}function g(e){if(e._ranges.length=0,"None"==e.docSelection.type)c(e);else{var n=e.docSelection.createRange();if(f(n))p(e,n);else{e.rangeCount=n.length;for(var o,r=B(n.item(0)),i=0;i<e.rangeCount;++i)o=t.createRange(r),o.selectNode(n.item(i)),e._ranges.push(o);e.isCollapsed=1==e.rangeCount&&e._ranges[0].collapsed,s(e,e._ranges[e.rangeCount-1],!1)}}}function m(t,n){for(var o=t.docSelection.createRange(),r=d(n),i=B(o.item(0)),a=H(i).createControlRange(),s=0,l=o.length;l>s;++s)a.add(o.item(s));try{a.add(r)}catch(c){throw e.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}a.select(),g(t)}function v(t,e,n){this.nativeSelection=t,this.docSelection=e,this._ranges=[],this.win=n,this.refresh()}function C(t){t.win=t.anchorNode=t.focusNode=t._ranges=null,t.rangeCount=t.anchorOffset=t.focusOffset=0,t.detached=!0}function b(t,e){for(var n,o,r=et.length;r--;)if(n=et[r],o=n.selection,"deleteAll"==e)C(o);else if(n.win==t)return"delete"==e?(et.splice(r,1),!0):o;return"deleteAll"==e&&(et.length=0),null}function R(t,n){for(var o,r=B(n[0].startContainer),i=H(r).createControlRange(),a=0,s=n.length;s>a;++a){o=d(n[a]);try{i.add(o)}catch(l){throw e.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}i.select(),g(t)}function y(t,e){if(t.win.document!=B(e))throw new k("WRONG_DOCUMENT_ERR")}function w(e){return function(n,o){var r;this.rangeCount?(r=this.getRangeAt(0),r["set"+(e?"Start":"End")](n,o)):(r=t.createRange(this.win.document),r.setStartAndEnd(n,o)),this.setSingleRange(r,this.isBackward())}}function E(t){var e=[],n=new I(t.anchorNode,t.anchorOffset),o=new I(t.focusNode,t.focusOffset),r="function"==typeof t.getName?t.getName():"Selection";if("undefined"!=typeof t.rangeCount)for(var i=0,a=t.rangeCount;a>i;++i)e[i]=D.inspect(t.getRangeAt(i));return"["+r+"(Ranges: "+e.join(", ")+")(anchor: "+n.inspect()+", focus: "+o.inspect()+"]"}t.config.checkSelectionRanges=!0;var S,N,T="boolean",_="number",A=t.dom,O=t.util,x=O.isHostMethod,D=t.DomRange,P=t.WrappedRange,k=t.DOMException,I=A.DomPosition,M=t.features,L="Control",B=A.getDocument,H=A.getBody,W=D.rangesEqual,F=x(window,"getSelection"),$=O.isHostObject(document,"selection");M.implementsWinGetSelection=F,M.implementsDocSelection=$;var j=$&&(!F||t.config.preferTextRange);if(j)S=i,t.isSelectionValid=function(t){var e=o(t,"isSelectionValid").document,n=e.selection;return"None"!=n.type||B(n.createRange().parentElement())==e};else{if(!F)return e.fail("Neither document.selection or window.getSelection() detected."),!1;S=r,t.isSelectionValid=function(){return!0}}t.getNativeSelection=S;var q=S();if(!q)return e.fail("Native selection was null (possibly issue 138?)"),!1;var V=t.createNativeRange(document),U=H(document),z=O.areHostProperties(q,["anchorNode","focusNode","anchorOffset","focusOffset"]);M.selectionHasAnchorAndFocus=z;var K=x(q,"extend");M.selectionHasExtend=K;var Q=typeof q.rangeCount==_;M.selectionHasRangeCount=Q;var Y=!1,X=!0,G=K?function(e,n){var o=D.getRangeDocument(n),r=t.createRange(o);r.collapseToPoint(n.endContainer,n.endOffset),e.addRange(u(r)),e.extend(n.startContainer,n.startOffset)}:null;O.areHostMethods(q,["addRange","getRangeAt","removeAllRanges"])&&typeof q.rangeCount==_&&M.implementsDomRange&&!function(){var e=window.getSelection();if(e){for(var n=e.rangeCount,o=n>1,r=[],i=a(e),s=0;n>s;++s)r[s]=e.getRangeAt(s);var l=A.createTestElement(document,"",!1),c=l.appendChild(document.createTextNode("   ")),u=document.createRange();if(u.setStart(c,1),u.collapse(!0),e.removeAllRanges(),e.addRange(u),X=1==e.rangeCount,e.removeAllRanges(),!o){var h=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(h&&parseInt(h[1])>=36)Y=!1;else{var d=u.cloneRange();u.setStart(c,0),d.setEnd(c,3),d.setStart(c,2),e.addRange(u),e.addRange(d),Y=2==e.rangeCount}}for(A.removeNode(l),e.removeAllRanges(),s=0;n>s;++s)0==s&&i?G?G(e,r[s]):(t.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),e.addRange(r[s])):e.addRange(r[s])}}(),M.selectionSupportsMultipleRanges=Y,M.collapsedNonEditableSelectionsSupported=X;var Z,J=!1;U&&x(U,"createControlRange")&&(Z=U.createControlRange(),O.areHostProperties(Z,["item","add"])&&(J=!0)),M.implementsControlRange=J,N=z?function(t){return t.anchorNode===t.focusNode&&t.anchorOffset===t.focusOffset}:function(t){return t.rangeCount?t.getRangeAt(t.rangeCount-1).collapsed:!1};var tt;x(q,"getRangeAt")?tt=function(t,e){try{return t.getRangeAt(e)}catch(n){return null}}:z&&(tt=function(e){var n=B(e.anchorNode),o=t.createRange(n);return o.setStartAndEnd(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset),o.collapsed!==this.isCollapsed&&o.setStartAndEnd(e.focusNode,e.focusOffset,e.anchorNode,e.anchorOffset),o}),v.prototype=t.selectionPrototype;var et=[],nt=function(t){if(t&&t instanceof v)return t.refresh(),t;t=o(t,"getNativeSelection");var e=b(t),n=S(t),r=$?i(t):null;return e?(e.nativeSelection=n,e.docSelection=r,e.refresh()):(e=new v(n,r,t),et.push({win:t,selection:e})),e};t.getSelection=nt,O.createAliasForDeprecatedMethod(t,"getIframeSelection","getSelection");var ot=v.prototype;if(!j&&z&&O.areHostMethods(q,["removeAllRanges","addRange"])){ot.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),c(this)};var rt=function(t,e){G(t.nativeSelection,e),t.refresh()};Q?ot.addRange=function(e,o){if(J&&$&&this.docSelection.type==L)m(this,e);else if(n(o)&&K)rt(this,e);else{var r;Y?r=this.rangeCount:(this.removeAllRanges(),r=0);var i=u(e).cloneRange();try{this.nativeSelection.addRange(i)}catch(a){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==r+1){if(t.config.checkSelectionRanges){var l=tt(this.nativeSelection,this.rangeCount-1);l&&!W(l,e)&&(e=new P(l))}this._ranges[this.rangeCount-1]=e,s(this,e,st(this.nativeSelection)),this.isCollapsed=N(this)}else this.refresh()}}:ot.addRange=function(t,e){n(e)&&K?rt(this,t):(this.nativeSelection.addRange(u(t)),this.refresh())},ot.setRanges=function(t){if(J&&$&&t.length>1)R(this,t);else{this.removeAllRanges();for(var e=0,n=t.length;n>e;++e)this.addRange(t[e])}}}else{if(!(x(q,"empty")&&x(V,"select")&&J&&j))return e.fail("No means of selecting a Range or TextRange was found"),!1;ot.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var t;if(this.anchorNode)t=B(this.anchorNode);else if(this.docSelection.type==L){var e=this.docSelection.createRange();e.length&&(t=B(e.item(0)))}if(t){var n=H(t).createTextRange();n.select(),this.docSelection.empty()}}}catch(o){}c(this)},ot.addRange=function(e){this.docSelection.type==L?m(this,e):(t.WrappedTextRange.rangeToTextRange(e).select(),this._ranges[0]=e,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,s(this,e,!1))},ot.setRanges=function(t){this.removeAllRanges();var e=t.length;e>1?R(this,t):e&&this.addRange(t[0])}}ot.getRangeAt=function(t){if(0>t||t>=this.rangeCount)throw new k("INDEX_SIZE_ERR");return this._ranges[t].cloneRange()};var it;if(j)it=function(e){var n;t.isSelectionValid(e.win)?n=e.docSelection.createRange():(n=H(e.win.document).createTextRange(),n.collapse(!0)),e.docSelection.type==L?g(e):f(n)?p(e,n):c(e)};else if(x(q,"getRangeAt")&&typeof q.rangeCount==_)it=function(e){if(J&&$&&e.docSelection.type==L)g(e);else if(e._ranges.length=e.rangeCount=e.nativeSelection.rangeCount,e.rangeCount){for(var n=0,o=e.rangeCount;o>n;++n)e._ranges[n]=new t.WrappedRange(e.nativeSelection.getRangeAt(n));s(e,e._ranges[e.rangeCount-1],st(e.nativeSelection)),e.isCollapsed=N(e)}else c(e)};else{if(!z||typeof q.isCollapsed!=T||typeof V.collapsed!=T||!M.implementsDomRange)return e.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;it=function(t){var e,n=t.nativeSelection;n.anchorNode?(e=tt(n,0),t._ranges=[e],t.rangeCount=1,l(t),t.isCollapsed=N(t)):c(t)}}ot.refresh=function(t){var e=t?this._ranges.slice(0):null,n=this.anchorNode,o=this.anchorOffset;if(it(this),t){var r=e.length;if(r!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=o)return!0;for(;r--;)if(!W(e[r],this._ranges[r]))return!0;return!1}};var at=function(t,e){var n=t.getAllRanges();t.removeAllRanges();for(var o=0,r=n.length;r>o;++o)W(e,n[o])||t.addRange(n[o]);t.rangeCount||c(t)};J&&$?ot.removeRange=function(t){if(this.docSelection.type==L){for(var e,n=this.docSelection.createRange(),o=d(t),r=B(n.item(0)),i=H(r).createControlRange(),a=!1,s=0,l=n.length;l>s;++s)e=n.item(s),e!==o||a?i.add(n.item(s)):a=!0;i.select(),g(this)}else at(this,t)}:ot.removeRange=function(t){at(this,t)};var st;!j&&z&&M.implementsDomRange?(st=a,ot.isBackward=function(){return st(this)}):st=ot.isBackward=function(){return!1},ot.isBackwards=ot.isBackward,ot.toString=function(){for(var t=[],e=0,n=this.rangeCount;n>e;++e)t[e]=""+this._ranges[e];return t.join("")},ot.collapse=function(e,n){y(this,e);var o=t.createRange(e);o.collapseToPoint(e,n),this.setSingleRange(o),this.isCollapsed=!0},ot.collapseToStart=function(){if(!this.rangeCount)throw new k("INVALID_STATE_ERR");var t=this._ranges[0];this.collapse(t.startContainer,t.startOffset)},ot.collapseToEnd=function(){if(!this.rangeCount)throw new k("INVALID_STATE_ERR");var t=this._ranges[this.rangeCount-1];this.collapse(t.endContainer,t.endOffset)},ot.selectAllChildren=function(e){y(this,e);var n=t.createRange(e);n.selectNodeContents(e),this.setSingleRange(n)},ot.deleteFromDocument=function(){if(J&&$&&this.docSelection.type==L){for(var t,e=this.docSelection.createRange();e.length;)t=e.item(0),e.remove(t),A.removeNode(t);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var o=0,r=n.length;r>o;++o)n[o].deleteContents();this.addRange(n[r-1])}}},ot.eachRange=function(t,e){for(var n=0,o=this._ranges.length;o>n;++n)if(t(this.getRangeAt(n)))return e},ot.getAllRanges=function(){var t=[];return this.eachRange(function(e){t.push(e)}),t},ot.setSingleRange=function(t,e){this.removeAllRanges(),this.addRange(t,e)},ot.callMethodOnEachRange=function(t,e){var n=[];return this.eachRange(function(o){n.push(o[t].apply(o,e||[]))}),n},ot.setStart=w(!0),ot.setEnd=w(!1),t.rangePrototype.select=function(t){nt(this.getDocument()).setSingleRange(this,t)},ot.changeEachRange=function(t){var e=[],n=this.isBackward();this.eachRange(function(n){t(n),e.push(n)}),this.removeAllRanges(),n&&1==e.length?this.addRange(e[0],"backward"):this.setRanges(e)},ot.containsNode=function(t,e){return this.eachRange(function(n){return n.containsNode(t,e)},!0)||!1},ot.getBookmark=function(t){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[t])}},ot.moveToBookmark=function(e){for(var n,o,r=[],i=0;n=e.rangeBookmarks[i++];)o=t.createRange(this.win),o.moveToBookmark(n),r.push(o);e.backward?this.setSingleRange(r[0],"backward"):this.setRanges(r)},ot.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},ot.restoreRanges=function(t){this.removeAllRanges();for(var e,n=0;e=t.ranges[n];++n)this.addRange(e,t.backward&&0==n)},ot.toHtml=function(){var t=[];return this.eachRange(function(e){t.push(D.toHtml(e))}),t.join("")},M.implementsTextRange&&(ot.getNativeTextRange=function(){var n;if(n=this.docSelection){var o=n.createRange();if(f(o))return o;throw e.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return t.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw e.createError("getNativeTextRange: selection contains no range")}),ot.getName=function(){return"WrappedSelection"},ot.inspect=function(){return E(this)},ot.detach=function(){b(this.win,"delete"),C(this)},v.detachAll=function(){b(null,"deleteAll")},v.inspect=E,v.isDirectionBackward=n,t.Selection=v,t.selectionPrototype=ot,t.addShimListener(function(t){"undefined"==typeof t.getSelection&&(t.getSelection=function(){return nt(t)}),t=null})});var H=!1,W=function(t){H||(H=!0,!k.initialized&&k.config.autoInitialize&&h())};return D&&("complete"==document.readyState?W():(t(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",W,!1),M(window,"load",W))),k},this),function(t,e){"function"==typeof define&&define.amd?define(["./rangy-core"],t):"undefined"!=typeof module&&"object"==typeof exports?module.exports=t(require("rangy")):t(e.rangy)}(function(t){return t.createModule("SaveRestore",["WrappedRange"],function(t,e){function n(t,e){return(e||document).getElementById(t)}function o(t,e){var n,o="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),r=p.getDocument(t.startContainer),i=t.cloneRange();return i.collapse(e),n=r.createElement("span"),n.id=o,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(r.createTextNode(v)),i.insertNode(n),n}function r(t,o,r,i){var a=n(r,t);a?(o[i?"setStartBefore":"setEndBefore"](a),g(a)):e.warn("Marker element has been removed. Cannot restore selection.")}function i(t,e){return e.compareBoundaryPoints(t.START_TO_START,t)}function a(e,n){var r,i,a=t.DomRange.getRangeDocument(e),s=e.toString(),l=m(n);return e.collapsed?(i=o(e,!1),{document:a,markerId:i.id,collapsed:!0}):(i=o(e,!1),r=o(e,!0),{document:a,startMarkerId:r.id,endMarkerId:i.id,collapsed:!1,backward:l,toString:function(){return"original text: '"+s+"', new text: '"+e.toString()+"'"}})}function s(o,i){var a=o.document;"undefined"==typeof i&&(i=!0);var s=t.createRange(a);if(o.collapsed){var l=n(o.markerId,a);if(l){l.style.display="inline";var c=l.previousSibling;c&&3==c.nodeType?(g(l),s.collapseToPoint(c,c.length)):(s.collapseBefore(l),g(l))}else e.warn("Marker element has been removed. Cannot restore selection.")}else r(a,s,o.startMarkerId,!0),r(a,s,o.endMarkerId,!1);return i&&s.normalizeBoundaries(),s}function l(e,o){var r,s,l=[],c=m(o);e=e.slice(0),e.sort(i);for(var u=0,h=e.length;h>u;++u)l[u]=a(e[u],c);for(u=h-1;u>=0;--u)r=e[u],s=t.DomRange.getRangeDocument(r),r.collapsed?r.collapseAfter(n(l[u].markerId,s)):(r.setEndBefore(n(l[u].endMarkerId,s)),r.setStartAfter(n(l[u].startMarkerId,s)));return l}function c(n){if(!t.isSelectionValid(n))return e.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var o=t.getSelection(n),r=o.getAllRanges(),i=1==r.length&&o.isBackward(),a=l(r,i);return i?o.setSingleRange(r[0],i):o.setRanges(r),{win:n,rangeInfos:a,restored:!1}}function u(t){for(var e=[],n=t.length,o=n-1;o>=0;o--)e[o]=s(t[o],!0);return e}function h(e,n){if(!e.restored){var o=e.rangeInfos,r=t.getSelection(e.win),i=u(o),a=o.length;1==a&&n&&t.features.selectionHasExtend&&o[0].backward?(r.removeAllRanges(),r.addRange(i[0],!0)):r.setRanges(i),e.restored=!0}}function d(t,e){var o=n(e,t);o&&g(o)}function f(t){for(var e,n=t.rangeInfos,o=0,r=n.length;r>o;++o)e=n[o],e.collapsed?d(t.doc,e.markerId):(d(t.doc,e.startMarkerId),d(t.doc,e.endMarkerId))}var p=t.dom,g=p.removeNode,m=t.Selection.isDirectionBackward,v="\ufeff";t.util.extend(t,{saveRange:a,restoreRange:s,saveRanges:l,restoreRanges:u,saveSelection:c,restoreSelection:h,removeMarkerElement:d,removeMarkers:f})}),t},this);var Showdown={};Showdown.converter=function(){var t,e,n,o=0;this.makeHtml=function(o){return t=new Array,e=new Array,n=new Array,o=o.replace(/~/g,"~T"),o=o.replace(/\$/g,"~D"),o=o.replace(/\r\n/g,"\n"),o=o.replace(/\r/g,"\n"),o="\n\n"+o+"\n\n",o=x(o),o=o.replace(/^[ \t]+$/gm,""),o=a(o),o=i(o),o=l(o),o=A(o),o=o.replace(/~D/g,"$$"),o=o.replace(/~T/g,"~")};var r,i=function(n){var n=n.replace(/^[ ]{0,3}\[(.+)\]:[ \t]*\n?[ \t]*<?(\S+?)>?[ \t]*\n?[ \t]*(?:(\n*)["(](.+?)[")][ \t]*)?(?:\n+|\Z)/gm,function(n,o,r,i,a){return o=o.toLowerCase(),t[o]=S(r),i?i+a:(a&&(e[o]=a.replace(/"/g,"&quot;")),"")});return n},a=function(t){t=t.replace(/\n/g,"\n\n");return t=t.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,s),t=t.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math)\b[^\r]*?.*<\/\2>[ \t]*(?=\n+)\n)/gm,s),t=t.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,s),t=t.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,s),t=t.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,s),t=t.replace(/\n\n/g,"\n")},s=function(t,e){var o=e;return o=o.replace(/\n\n/g,"\n"),o=o.replace(/^\n/,""),o=o.replace(/\n+$/g,""),o="\n\n~K"+(n.push(o)-1)+"K\n\n"},l=function(t){t=g(t);var e=C("<hr />");return t=t.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,e),t=t.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,e),t=t.replace(/^[ ]{0,2}([ ]?\_[ ]?){3,}[ \t]*$/gm,e),t=m(t),t=v(t),t=w(t),t=a(t),t=E(t)},c=function(t){return t=b(t),t=u(t),t=N(t),t=f(t),t=h(t),t=T(t),t=S(t),t=y(t),t=t.replace(/  +\n/g," <br />\n")},u=function(t){var e=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return t=t.replace(e,function(t){var e=t.replace(/(.)<\/?code>(?=.)/g,"$1`");return e=D(e,"\\`*_")})},h=function(t){return t=t.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,d),t=t.replace(/(\[((?:\[[^\]]*\]|[^\[\]])*)\]\([ \t]*()<?(.*?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,d),t=t.replace(/(\[([^\[\]]+)\])()()()()()/g,d)},d=function(n,o,r,i,a,s,l,c){void 0==c&&(c="");var u=o,h=r,d=i.toLowerCase(),f=a,p=c;if(""==f)if(""==d&&(d=h.toLowerCase().replace(/ ?\n/g," ")),f="#"+d,void 0!=t[d])f=t[d],void 0!=e[d]&&(p=e[d]);else{if(!(u.search(/\(\s*\)$/m)>-1))return u;f=""}f=D(f,"*_");var g='<a href="'+f+'"';return""!=p&&(p=p.replace(/"/g,"&quot;"),p=D(p,"*_"),g+=' title="'+p+'"'),g+=">"+h+"</a>"},f=function(t){return t=t.replace(/(!\[(.*?)\][ ]?(?:\n[ ]*)?\[(.*?)\])()()()()/g,p),t=t.replace(/(!\[(.*?)\]\s?\([ \t]*()<?(\S+?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,p)},p=function(n,o,r,i,a,s,l,c){var u=o,h=r,d=i.toLowerCase(),f=a,p=c;if(p||(p=""),""==f){if(""==d&&(d=h.toLowerCase().replace(/ ?\n/g," ")),f="#"+d,void 0==t[d])return u;f=t[d],void 0!=e[d]&&(p=e[d])}h=h.replace(/"/g,"&quot;"),f=D(f,"*_");var g='<img src="'+f+'" alt="'+h+'"';return p=p.replace(/"/g,"&quot;"),p=D(p,"*_"),g+=' title="'+p+'"',g+=" />"},g=function(t){return t=t.replace(/^(.+)[ \t]*\n=+[ \t]*\n+/gm,function(t,e){return C("<h1>"+c(e)+"</h1>")}),t=t.replace(/^(.+)[ \t]*\n-+[ \t]*\n+/gm,function(t,e){return C("<h2>"+c(e)+"</h2>")}),t=t.replace(/^(\#{1,6})[ \t]*(.+?)[ \t]*\#*\n+/gm,function(t,e,n){var o=e.length;return C("<h"+o+">"+c(n)+"</h"+o+">")})},m=function(t){t+="~0";var e=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return o?t=t.replace(e,function(t,e,n){var o=e,i=n.search(/[*+-]/g)>-1?"ul":"ol";o=o.replace(/\n{2,}/g,"\n\n\n");var a=r(o);return a=a.replace(/\s+$/,""),a="<"+i+">"+a+"</"+i+">\n"}):(e=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/g,t=t.replace(e,function(t,e,n,o){var i=e,a=n,s=o.search(/[*+-]/g)>-1?"ul":"ol",a=a.replace(/\n{2,}/g,"\n\n\n"),l=r(a);return l=i+"<"+s+">\n"+l+"</"+s+">\n"})),t=t.replace(/~0/,"")};r=function(t){return o++,t=t.replace(/\n{2,}$/,"\n"),t+="~0",t=t.replace(/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+([^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,function(t,e,n,o,r){var i=r,a=e;return a||i.search(/\n{2,}/)>-1?i=l(O(i)):(i=m(O(i)),i=i.replace(/\n$/,""),i=c(i)),"<li>"+i+"</li>\n"}),t=t.replace(/~0/g,""),o--,t};var v=function(t){return t+="~0",t=t.replace(/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g,function(t,e,n){var o=e,r=n;return o=R(O(o)),o=x(o),o=o.replace(/^\n+/g,""),o=o.replace(/\n+$/g,""),o="<pre><code>"+o+"\n</code></pre>",C(o)+r}),t=t.replace(/~0/,"")},C=function(t){return t=t.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(n.push(t)-1)+"K\n\n"},b=function(t){return t=t.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(t,e,n,o,r){var i=o;return i=i.replace(/^([ \t]*)/g,""),i=i.replace(/[ \t]*$/g,""),i=R(i),e+"<code>"+i+"</code>"})},R=function(t){return t=t.replace(/&/g,"&amp;"),t=t.replace(/</g,"&lt;"),t=t.replace(/>/g,"&gt;"),t=D(t,"*_{}[]\\",!1)},y=function(t){return t=t.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>"),t=t.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")},w=function(t){return t=t.replace(/((^[ \t]*>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(t,e){var n=e;return n=n.replace(/^[ \t]*>[ \t]?/gm,"~0"),n=n.replace(/~0/g,""),n=n.replace(/^[ \t]+$/gm,""),n=l(n),n=n.replace(/(^|\n)/g,"$1  "),n=n.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(t,e){var n=e;return n=n.replace(/^  /gm,"~0"),n=n.replace(/~0/g,"")}),C("<blockquote>\n"+n+"\n</blockquote>")})},E=function(t){t=t.replace(/^\n+/g,""),t=t.replace(/\n+$/g,"");for(var e=t.split(/\n{2,}/g),o=new Array,r=e.length,i=0;r>i;i++){var a=e[i];a.search(/~K(\d+)K/g)>=0?o.push(a):a.search(/\S/)>=0&&(a=c(a),a=a.replace(/^([ \t]*)/g,"<p>"),a+="</p>",o.push(a))}r=o.length;for(var i=0;r>i;i++)for(;o[i].search(/~K(\d+)K/)>=0;){var s=n[RegExp.$1];s=s.replace(/\$/g,"$$$$"),o[i]=o[i].replace(/~K\d+K/,s)}return o.join("\n\n")},S=function(t){return t=t.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),t=t.replace(/<(?![a-z\/?\$!])/gi,"&lt;")},N=function(t){return t=t.replace(/\\(\\)/g,P),t=t.replace(/\\([`*_{}\[\]()>#+-.!])/g,P)},T=function(t){return t=t.replace(/<((https?|ftp|dict):[^'">\s]+)>/gi,'<a href="$1">$1</a>'),t=t.replace(/<(?:mailto:)?([-.\w]+\@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi,function(t,e){return _(A(e))})},_=function(t){function e(t){var e="0123456789ABCDEF",n=t.charCodeAt(0);return e.charAt(n>>4)+e.charAt(15&n)}var n=[function(t){return"&#"+t.charCodeAt(0)+";"},function(t){return"&#x"+e(t)+";"},function(t){return t}];return t="mailto:"+t,t=t.replace(/./g,function(t){if("@"==t)t=n[Math.floor(2*Math.random())](t);else if(":"!=t){var e=Math.random();t=e>.9?n[2](t):e>.45?n[1](t):n[0](t)}return t}),t='<a href="'+t+'">'+t+"</a>",t=t.replace(/">.+:/g,'">')},A=function(t){return t=t.replace(/~E(\d+)E/g,function(t,e){var n=parseInt(e);return String.fromCharCode(n)})},O=function(t){return t=t.replace(/^(\t|[ ]{1,4})/gm,"~0"),t=t.replace(/~0/g,"")},x=function(t){return t=t.replace(/\t(?=\t)/g,"    "),t=t.replace(/\t/g,"~A~B"),t=t.replace(/~B(.+?)~A/g,function(t,e,n){for(var o=e,r=4-o.length%4,i=0;r>i;i++)o+=" ";
return o}),t=t.replace(/~A/g,"    "),t=t.replace(/~B/g,"")},D=function(t,e,n){var o="(["+e.replace(/([\[\]\\])/g,"\\$1")+"])";n&&(o="\\\\"+o);var r=new RegExp(o,"g");return t=t.replace(r,P)},P=function(t,e){var n=e.charCodeAt(0);return"~E"+n+"E"}},"undefined"!=typeof exports&&(exports.Showdown=Showdown);
(function(){function e(e){"use strict";var t={omitExtraWLInCodeBlocks:{"default":!1,describe:"Omit the default extra whiteline added to code blocks",type:"boolean"},noHeaderId:{"default":!1,describe:"Turn on/off generated header id",type:"boolean"},prefixHeaderId:{"default":!1,describe:"Specify a prefix to generated header ids",type:"string"},headerLevelStart:{"default":!1,describe:"The header blocks level start",type:"integer"},parseImgDimensions:{"default":!1,describe:"Turn on/off image dimension parsing",type:"boolean"},simplifiedAutoLink:{"default":!1,describe:"Turn on/off GFM autolink style",type:"boolean"},literalMidWordUnderscores:{"default":!1,describe:"Parse midword underscores as literal underscores",type:"boolean"},strikethrough:{"default":!1,describe:"Turn on/off strikethrough support",type:"boolean"},tables:{"default":!1,describe:"Turn on/off tables support",type:"boolean"},tablesHeaderId:{"default":!1,describe:"Add an id to table headers",type:"boolean"},ghCodeBlocks:{"default":!0,describe:"Turn on/off GFM fenced code blocks support",type:"boolean"},tasklists:{"default":!1,describe:"Turn on/off GFM tasklist support",type:"boolean"},smoothLivePreview:{"default":!1,describe:"Prevents weird effects in live previews due to incomplete input",type:"boolean"}};if(e===!1)return JSON.parse(JSON.stringify(t));var n={};for(var r in t)t.hasOwnProperty(r)&&(n[r]=t[r]["default"]);return n}function t(e,t){"use strict";var n=t?"Error in "+t+" extension->":"Error in unnamed extension",i={valid:!0,error:""};r.helper.isArray(e)||(e=[e]);for(var a=0;a<e.length;++a){var s=n+" sub-extension "+a+": ",o=e[a];if("object"!=typeof o)return i.valid=!1,i.error=s+"must be an object, but "+typeof o+" given",i;if(!r.helper.isString(o.type))return i.valid=!1,i.error=s+'property "type" must be a string, but '+typeof o.type+" given",i;var c=o.type=o.type.toLowerCase();if("language"===c&&(c=o.type="lang"),"html"===c&&(c=o.type="output"),"lang"!==c&&"output"!==c&&"listener"!==c)return i.valid=!1,i.error=s+"type "+c+' is not recognized. Valid values: "lang/language", "output/html" or "listener"',i;if("listener"===c){if(r.helper.isUndefined(o.listeners))return i.valid=!1,i.error=s+'. Extensions of type "listener" must have a property called "listeners"',i}else if(r.helper.isUndefined(o.filter)&&r.helper.isUndefined(o.regex))return i.valid=!1,i.error=s+c+' extensions must define either a "regex" property or a "filter" method',i;if(o.listeners){if("object"!=typeof o.listeners)return i.valid=!1,i.error=s+'"listeners" property must be an object but '+typeof o.listeners+" given",i;for(var l in o.listeners)if(o.listeners.hasOwnProperty(l)&&"function"!=typeof o.listeners[l])return i.valid=!1,i.error=s+'"listeners" property must be an hash of [event name]: [callback]. listeners.'+l+" must be a function but "+typeof o.listeners[l]+" given",i}if(o.filter){if("function"!=typeof o.filter)return i.valid=!1,i.error=s+'"filter" must be a function, but '+typeof o.filter+" given",i}else if(o.regex){if(r.helper.isString(o.regex)&&(o.regex=new RegExp(o.regex,"g")),!o.regex instanceof RegExp)return i.valid=!1,i.error=s+'"regex" property must either be a string or a RegExp object, but '+typeof o.regex+" given",i;if(r.helper.isUndefined(o.replace))return i.valid=!1,i.error=s+'"regex" extensions must implement a replace string or function',i}}return i}function n(e,t){"use strict";var n=t.charCodeAt(0);return"~E"+n+"E"}var r={},i={},a={},s=e(!0),o={github:{omitExtraWLInCodeBlocks:!0,prefixHeaderId:"user-content-",simplifiedAutoLink:!0,literalMidWordUnderscores:!0,strikethrough:!0,tables:!0,tablesHeaderId:!0,ghCodeBlocks:!0,tasklists:!0},vanilla:e(!0)};r.helper={},r.extensions={},r.setOption=function(e,t){"use strict";return s[e]=t,this},r.getOption=function(e){"use strict";return s[e]},r.getOptions=function(){"use strict";return s},r.resetOptions=function(){"use strict";s=e(!0)},r.setFlavor=function(e){"use strict";if(o.hasOwnProperty(e)){var t=o[e];for(var n in t)t.hasOwnProperty(n)&&(s[n]=t[n])}},r.getDefaultOptions=function(t){"use strict";return e(t)},r.subParser=function(e,t){"use strict";if(r.helper.isString(e)){if("undefined"==typeof t){if(i.hasOwnProperty(e))return i[e];throw Error("SubParser named "+e+" not registered!")}i[e]=t}},r.extension=function(e,n){"use strict";if(!r.helper.isString(e))throw Error("Extension 'name' must be a string");if(e=r.helper.stdExtName(e),r.helper.isUndefined(n)){if(!a.hasOwnProperty(e))throw Error("Extension named "+e+" is not registered!");return a[e]}"function"==typeof n&&(n=n()),r.helper.isArray(n)||(n=[n]);var i=t(n,e);if(!i.valid)throw Error(i.error);a[e]=n},r.getAllExtensions=function(){"use strict";return a},r.removeExtension=function(e){"use strict";delete a[e]},r.resetExtensions=function(){"use strict";a={}},r.validateExtension=function(e){"use strict";var n=t(e,null);return n.valid?!0:(console.warn(n.error),!1)},r.hasOwnProperty("helper")||(r.helper={}),r.helper.isString=function(e){"use strict";return"string"==typeof e||e instanceof String},r.helper.forEach=function(e,t){"use strict";if("function"==typeof e.forEach)e.forEach(t);else for(var n=0;n<e.length;n++)t(e[n],n,e)},r.helper.isArray=function(e){"use strict";return e.constructor===Array},r.helper.isUndefined=function(e){"use strict";return"undefined"==typeof e},r.helper.stdExtName=function(e){"use strict";return e.replace(/[_-]||\s/g,"").toLowerCase()},r.helper.escapeCharactersCallback=n,r.helper.escapeCharacters=function(e,t,r){"use strict";var i="(["+t.replace(/([\[\]\\])/g,"\\$1")+"])";r&&(i="\\\\"+i);var a=new RegExp(i,"g");return e=e.replace(a,n)},r.helper.matchRecursiveRegExp=function(e,t,n,r){"use strict";var i,a,s,o,c,l=r||"",u=l.indexOf("g")>-1,d=new RegExp(t+"|"+n,l),h=new RegExp(t,l.replace(/g/g,"")),f=[];do for(i=0;s=d.exec(e);)if(h.test(s[0]))i++||(o=s[0],a=d.lastIndex);else if(i&&!--i){c=s[0];var p=e.slice(a,s.index);if(f.push([o+p+c,p]),!u)return f}while(i&&(d.lastIndex=a));return f},r.helper.isUndefined(console)&&(console={warn:function(e){"use strict";alert(e)},log:function(e){"use strict";alert(e)},error:function(e){"use strict";throw e}}),r.Converter=function(e){"use strict";function n(){e=e||{};for(var t in s)s.hasOwnProperty(t)&&(u[t]=s[t]);if("object"!=typeof e)throw Error("Converter expects the passed parameter to be an object, but "+typeof e+" was passed instead.");for(var n in e)e.hasOwnProperty(n)&&(u[n]=e[n]);u.extensions&&r.helper.forEach(u.extensions,i)}function i(e,n){if(n=n||null,r.helper.isString(e)){if(e=r.helper.stdExtName(e),n=e,r.extensions[e])return console.warn("DEPRECATION WARNING: "+e+" is an old extension that uses a deprecated loading method.Please inform the developer that the extension should be updated!"),void c(r.extensions[e],e);if(r.helper.isUndefined(a[e]))throw Error('Extension "'+e+'" could not be loaded. It was either not found or is not a valid extension.');e=a[e]}"function"==typeof e&&(e=e()),r.helper.isArray(e)||(e=[e]);var i=t(e,n);if(!i.valid)throw Error(i.error);for(var s=0;s<e.length;++s){switch(e[s].type){case"lang":d.push(e[s]);break;case"output":h.push(e[s])}if(e[s].hasOwnProperty(f))for(var o in e[s].listeners)e[s].listeners.hasOwnProperty(o)&&l(o,e[s].listeners[o])}}function c(e,n){"function"==typeof e&&(e=e(new r.Converter)),r.helper.isArray(e)||(e=[e]);var i=t(e,n);if(!i.valid)throw Error(i.error);for(var a=0;a<e.length;++a)switch(e[a].type){case"lang":d.push(e[a]);break;case"output":h.push(e[a]);break;default:throw Error("Extension loader error: Type unrecognized!!!")}}function l(e,t){if(!r.helper.isString(e))throw Error("Invalid argument in converter.listen() method: name must be a string, but "+typeof e+" given");if("function"!=typeof t)throw Error("Invalid argument in converter.listen() method: callback must be a function, but "+typeof t+" given");f.hasOwnProperty(e)||(f[e]=[]),f[e].push(t)}var u={},d=[],h=[],f={};n(),this._dispatch=function(e,t,n){if(f.hasOwnProperty(e))for(var r=0;r<f[e].length;++r){var i=f[e][r](e,t,this,n);i&&"undefined"!=typeof i&&(t=i)}return t},this.listen=function(e,t){return l(e,t),this},this.makeHtml=function(e){if(!e)return e;var t={gHtmlBlocks:[],gHtmlSpans:[],gUrls:{},gTitles:{},gDimensions:{},gListLevel:0,hashLinkCounts:{},langExtensions:d,outputModifiers:h,converter:this};return e=e.replace(/~/g,"~T"),e=e.replace(/\$/g,"~D"),e=e.replace(/\r\n/g,"\n"),e=e.replace(/\r/g,"\n"),e="\n\n"+e+"\n\n",e=r.subParser("detab")(e,u,t),e=r.subParser("stripBlankLines")(e,u,t),r.helper.forEach(d,function(n){e=r.subParser("runExtension")(n,e,u,t)}),e=r.subParser("githubCodeBlocks")(e,u,t),e=r.subParser("hashHTMLBlocks")(e,u,t),e=r.subParser("hashHTMLSpans")(e,u,t),e=r.subParser("stripLinkDefinitions")(e,u,t),e=r.subParser("blockGamut")(e,u,t),e=r.subParser("unhashHTMLSpans")(e,u,t),e=r.subParser("unescapeSpecialChars")(e,u,t),e=e.replace(/~D/g,"$$"),e=e.replace(/~T/g,"~"),r.helper.forEach(h,function(n){e=r.subParser("runExtension")(n,e,u,t)}),e},this.setOption=function(e,t){u[e]=t},this.getOption=function(e){return u[e]},this.getOptions=function(){return u},this.addExtension=function(e,t){t=t||null,i(e,t)},this.useExtension=function(e){i(e)},this.setFlavor=function(e){if(o.hasOwnProperty(e)){var t=o[e];for(var n in t)t.hasOwnProperty(n)&&(u[n]=t[n])}},this.removeExtension=function(e){r.helper.isArray(e)||(e=[e]);for(var t=0;t<e.length;++t){for(var n=e[t],i=0;i<d.length;++i)d[i]===n&&d[i].splice(i,1);for(var a=0;a<h.length;++i)h[a]===n&&h[a].splice(i,1)}},this.getAllExtensions=function(){return{language:d,output:h}}},r.subParser("anchors",function(e,t,n){"use strict";e=n.converter._dispatch("anchors.before",e,t);var i=function(e,t,i,a,s,o,c,l){r.helper.isUndefined(l)&&(l=""),e=t;var u=i,d=a.toLowerCase(),h=s,f=l;if(!h)if(d||(d=u.toLowerCase().replace(/ ?\n/g," ")),h="#"+d,r.helper.isUndefined(n.gUrls[d])){if(!(e.search(/\(\s*\)$/m)>-1))return e;h=""}else h=n.gUrls[d],r.helper.isUndefined(n.gTitles[d])||(f=n.gTitles[d]);h=r.helper.escapeCharacters(h,"*_",!1);var p='<a href="'+h+'"';return""!==f&&null!==f&&(f=f.replace(/"/g,"&quot;"),f=r.helper.escapeCharacters(f,"*_",!1),p+=' title="'+f+'"'),p+=">"+u+"</a>"};return e=e.replace(/(\[((?:\[[^\]]*]|[^\[\]])*)][ ]?(?:\n[ ]*)?\[(.*?)])()()()()/g,i),e=e.replace(/(\[((?:\[[^\]]*]|[^\[\]])*)]\([ \t]*()<?(.*?(?:\(.*?\).*?)?)>?[ \t]*((['"])(.*?)\6[ \t]*)?\))/g,i),e=e.replace(/(\[([^\[\]]+)])()()()()()/g,i),e=n.converter._dispatch("anchors.after",e,t)}),r.subParser("autoLinks",function(e,t,n){"use strict";function i(e,t){var n=r.subParser("unescapeSpecialChars")(t);return r.subParser("encodeEmailAddress")(n)}e=n.converter._dispatch("autoLinks.before",e,t);var a=/\b(((https?|ftp|dict):\/\/|www\.)[^'">\s]+\.[^'">\s]+)(?=\s|$)(?!["<>])/gi,s=/<(((https?|ftp|dict):\/\/|www\.)[^'">\s]+)>/gi,o=/(?:^|[ \n\t])([A-Za-z0-9!#$%&'*+-/=?^_`\{|}~\.]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)(?:$|[ \n\t])/gi,c=/<(?:mailto:)?([-.\w]+@[-a-z0-9]+(\.[-a-z0-9]+)*\.[a-z]+)>/gi;return e=e.replace(s,'<a href="$1">$1</a>'),e=e.replace(c,i),t.simplifiedAutoLink&&(e=e.replace(a,'<a href="$1">$1</a>'),e=e.replace(o,i)),e=n.converter._dispatch("autoLinks.after",e,t)}),r.subParser("blockGamut",function(e,t,n){"use strict";e=n.converter._dispatch("blockGamut.before",e,t),e=r.subParser("blockQuotes")(e,t,n),e=r.subParser("headers")(e,t,n);var i=r.subParser("hashBlock")("<hr />",t,n);return e=e.replace(/^[ ]{0,2}([ ]?\*[ ]?){3,}[ \t]*$/gm,i),e=e.replace(/^[ ]{0,2}([ ]?\-[ ]?){3,}[ \t]*$/gm,i),e=e.replace(/^[ ]{0,2}([ ]?_[ ]?){3,}[ \t]*$/gm,i),e=r.subParser("lists")(e,t,n),e=r.subParser("codeBlocks")(e,t,n),e=r.subParser("tables")(e,t,n),e=r.subParser("hashHTMLBlocks")(e,t,n),e=r.subParser("paragraphs")(e,t,n),e=n.converter._dispatch("blockGamut.after",e,t)}),r.subParser("blockQuotes",function(e,t,n){"use strict";return e=n.converter._dispatch("blockQuotes.before",e,t),e=e.replace(/((^[ \t]{0,3}>[ \t]?.+\n(.+\n)*\n*)+)/gm,function(e,i){var a=i;return a=a.replace(/^[ \t]*>[ \t]?/gm,"~0"),a=a.replace(/~0/g,""),a=a.replace(/^[ \t]+$/gm,""),a=r.subParser("githubCodeBlocks")(a,t,n),a=r.subParser("blockGamut")(a,t,n),a=a.replace(/(^|\n)/g,"$1  "),a=a.replace(/(\s*<pre>[^\r]+?<\/pre>)/gm,function(e,t){var n=t;return n=n.replace(/^  /gm,"~0"),n=n.replace(/~0/g,"")}),r.subParser("hashBlock")("<blockquote>\n"+a+"\n</blockquote>",t,n)}),e=n.converter._dispatch("blockQuotes.after",e,t)}),r.subParser("codeBlocks",function(e,t,n){"use strict";e=n.converter._dispatch("codeBlocks.before",e,t),e+="~0";var i=/(?:\n\n|^)((?:(?:[ ]{4}|\t).*\n+)+)(\n*[ ]{0,3}[^ \t\n]|(?=~0))/g;return e=e.replace(i,function(e,i,a){var s=i,o=a,c="\n";return s=r.subParser("outdent")(s),s=r.subParser("encodeCode")(s),s=r.subParser("detab")(s),s=s.replace(/^\n+/g,""),s=s.replace(/\n+$/g,""),t.omitExtraWLInCodeBlocks&&(c=""),s="<pre><code>"+s+c+"</code></pre>",r.subParser("hashBlock")(s,t,n)+o}),e=e.replace(/~0/,""),e=n.converter._dispatch("codeBlocks.after",e,t)}),r.subParser("codeSpans",function(e,t,n){"use strict";return e=n.converter._dispatch("codeSpans.before",e,t),e=e.replace(/(^|[^\\])(`+)([^\r]*?[^`])\2(?!`)/gm,function(e,t,n,i){var a=i;return a=a.replace(/^([ \t]*)/g,""),a=a.replace(/[ \t]*$/g,""),a=r.subParser("encodeCode")(a),t+"<code>"+a+"</code>"}),e=n.converter._dispatch("codeSpans.after",e,t)}),r.subParser("detab",function(e){"use strict";return e=e.replace(/\t(?=\t)/g,"    "),e=e.replace(/\t/g,"~A~B"),e=e.replace(/~B(.+?)~A/g,function(e,t){for(var n=t,r=4-n.length%4,i=0;r>i;i++)n+=" ";return n}),e=e.replace(/~A/g,"    "),e=e.replace(/~B/g,"")}),r.subParser("encodeAmpsAndAngles",function(e){"use strict";return e=e.replace(/&(?!#?[xX]?(?:[0-9a-fA-F]+|\w+);)/g,"&amp;"),e=e.replace(/<(?![a-z\/?\$!])/gi,"&lt;")}),r.subParser("encodeBackslashEscapes",function(e){"use strict";return e=e.replace(/\\(\\)/g,r.helper.escapeCharactersCallback),e=e.replace(/\\([`*_{}\[\]()>#+-.!])/g,r.helper.escapeCharactersCallback)}),r.subParser("encodeCode",function(e){"use strict";return e=e.replace(/&/g,"&amp;"),e=e.replace(/</g,"&lt;"),e=e.replace(/>/g,"&gt;"),e=r.helper.escapeCharacters(e,"*_{}[]\\",!1)}),r.subParser("encodeEmailAddress",function(e){"use strict";var t=[function(e){return"&#"+e.charCodeAt(0)+";"},function(e){return"&#x"+e.charCodeAt(0).toString(16)+";"},function(e){return e}];return e="mailto:"+e,e=e.replace(/./g,function(e){if("@"===e)e=t[Math.floor(2*Math.random())](e);else if(":"!==e){var n=Math.random();e=n>.9?t[2](e):n>.45?t[1](e):t[0](e)}return e}),e='<a href="'+e+'">'+e+"</a>",e=e.replace(/">.+:/g,'">')}),r.subParser("escapeSpecialCharsWithinTagAttributes",function(e){"use strict";var t=/(<[a-z\/!$]("[^"]*"|'[^']*'|[^'">])*>|<!(--.*?--\s*)+>)/gi;return e=e.replace(t,function(e){var t=e.replace(/(.)<\/?code>(?=.)/g,"$1`");return t=r.helper.escapeCharacters(t,"\\`*_",!1)})}),r.subParser("githubCodeBlocks",function(e,t,n){"use strict";return t.ghCodeBlocks?(e=n.converter._dispatch("githubCodeBlocks.before",e,t),e+="~0",e=e.replace(/(?:^|\n)```(.*)\n([\s\S]*?)\n```/g,function(e,i,a){var s=t.omitExtraWLInCodeBlocks?"":"\n";return a=r.subParser("encodeCode")(a),a=r.subParser("detab")(a),a=a.replace(/^\n+/g,""),a=a.replace(/\n+$/g,""),a="<pre><code"+(i?' class="'+i+" language-"+i+'"':"")+">"+a+s+"</code></pre>",r.subParser("hashBlock")(a,t,n)}),e=e.replace(/~0/,""),e=n.converter._dispatch("githubCodeBlocks.after",e,t)):e}),r.subParser("hashBlock",function(e,t,n){"use strict";return e=e.replace(/(^\n+|\n+$)/g,""),"\n\n~K"+(n.gHtmlBlocks.push(e)-1)+"K\n\n"}),r.subParser("hashElement",function(e,t,n){"use strict";return function(e,t){var r=t;return r=r.replace(/\n\n/g,"\n"),r=r.replace(/^\n/,""),r=r.replace(/\n+$/g,""),r="\n\n~K"+(n.gHtmlBlocks.push(r)-1)+"K\n\n"}}),r.subParser("hashHTMLBlocks",function(e,t,n){"use strict";return e=e.replace(/\n/g,"\n\n"),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|ins|del)\b[^\r]*?\n<\/\2>[ \t]*(?=\n+))/gm,r.subParser("hashElement")(e,t,n)),e=e.replace(/^(<(p|div|h[1-6]|blockquote|pre|table|dl|ol|ul|script|noscript|form|fieldset|iframe|math|style|section|header|footer|nav|article|aside|address|audio|canvas|figure|hgroup|output|video)\b[^\r]*?<\/\2>[ \t]*(?=\n+)\n)/gm,r.subParser("hashElement")(e,t,n)),e=e.replace(/(\n[ ]{0,3}(<(hr)\b([^<>])*?\/?>)[ \t]*(?=\n{2,}))/g,r.subParser("hashElement")(e,t,n)),e=e.replace(/(\n\n[ ]{0,3}<!(--[^\r]*?--\s*)+>[ \t]*(?=\n{2,}))/g,r.subParser("hashElement")(e,t,n)),e=e.replace(/(?:\n\n)([ ]{0,3}(?:<([?%])[^\r]*?\2>)[ \t]*(?=\n{2,}))/g,r.subParser("hashElement")(e,t,n)),e=e.replace(/\n\n/g,"\n")}),r.subParser("hashHTMLSpans",function(e,t,n){"use strict";for(var i=r.helper.matchRecursiveRegExp(e,"<code\\b[^>]*>","</code>","gi"),a=0;a<i.length;++a)e=e.replace(i[a][0],"~L"+(n.gHtmlSpans.push(i[a][0])-1)+"L");return e}),r.subParser("unhashHTMLSpans",function(e,t,n){"use strict";for(var r=0;r<n.gHtmlSpans.length;++r)e=e.replace("~L"+r+"L",n.gHtmlSpans[r]);return e}),r.subParser("headers",function(e,t,n){"use strict";function i(e){var t,i=e.replace(/[^\w]/g,"").toLowerCase();return n.hashLinkCounts[i]?t=i+"-"+n.hashLinkCounts[i]++:(t=i,n.hashLinkCounts[i]=1),a===!0&&(a="section"),r.helper.isString(a)?a+t:t}e=n.converter._dispatch("headers.before",e,t);var a=t.prefixHeaderId,s=isNaN(parseInt(t.headerLevelStart))?1:parseInt(t.headerLevelStart),o=t.smoothLivePreview?/^(.+)[ \t]*\n={2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n=+[ \t]*\n+/gm,c=t.smoothLivePreview?/^(.+)[ \t]*\n-{2,}[ \t]*\n+/gm:/^(.+)[ \t]*\n-+[ \t]*\n+/gm;return e=e.replace(o,function(e,a){var o=r.subParser("spanGamut")(a,t,n),c=t.noHeaderId?"":' id="'+i(a)+'"',l=s,u="<h"+l+c+">"+o+"</h"+l+">";return r.subParser("hashBlock")(u,t,n)}),e=e.replace(c,function(e,a){var o=r.subParser("spanGamut")(a,t,n),c=t.noHeaderId?"":' id="'+i(a)+'"',l=s+1,u="<h"+l+c+">"+o+"</h"+l+">";return r.subParser("hashBlock")(u,t,n)}),e=e.replace(/^(#{1,6})[ \t]*(.+?)[ \t]*#*\n+/gm,function(e,a,o){var c=r.subParser("spanGamut")(o,t,n),l=t.noHeaderId?"":' id="'+i(o)+'"',u=s-1+a.length,d="<h"+u+l+">"+c+"</h"+u+">";return r.subParser("hashBlock")(d,t,n)}),e=n.converter._dispatch("headers.after",e,t)}),r.subParser("images",function(e,t,n){"use strict";function i(e,t,i,a,s,o,c,l){var u=n.gUrls,d=n.gTitles,h=n.gDimensions;if(i=i.toLowerCase(),l||(l=""),""===a||null===a){if((""===i||null===i)&&(i=t.toLowerCase().replace(/ ?\n/g," ")),a="#"+i,r.helper.isUndefined(u[i]))return e;a=u[i],r.helper.isUndefined(d[i])||(l=d[i]),r.helper.isUndefined(h[i])||(s=h[i].width,o=h[i].height)}t=t.replace(/"/g,"&quot;"),t=r.helper.escapeCharacters(t,"*_",!1),a=r.helper.escapeCharacters(a,"*_",!1);var f='<img src="'+a+'" alt="'+t+'"';return l&&(l=l.replace(/"/g,"&quot;"),l=r.helper.escapeCharacters(l,"*_",!1),f+=' title="'+l+'"'),s&&o&&(s="*"===s?"auto":s,o="*"===o?"auto":o,f+=' width="'+s+'"',f+=' height="'+o+'"'),f+=" />"}e=n.converter._dispatch("images.before",e,t);var a=/!\[(.*?)]\s?\([ \t]*()<?(\S+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*(?:(['"])(.*?)\6[ \t]*)?\)/g,s=/!\[(.*?)][ ]?(?:\n[ ]*)?\[(.*?)]()()()()()/g;return e=e.replace(s,i),e=e.replace(a,i),e=n.converter._dispatch("images.after",e,t)}),r.subParser("italicsAndBold",function(e,t,n){"use strict";return e=n.converter._dispatch("italicsAndBold.before",e,t),t.literalMidWordUnderscores?(e=e.replace(/(^|\s|>|\b)__(?=\S)([^]+?)__(?=\b|<|\s|$)/gm,"$1<strong>$2</strong>"),e=e.replace(/(^|\s|>|\b)_(?=\S)([^]+?)_(?=\b|<|\s|$)/gm,"$1<em>$2</em>"),e=e.replace(/(\*\*)(?=\S)([^\r]*?\S[*]*)\1/g,"<strong>$2</strong>"),e=e.replace(/(\*)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")):(e=e.replace(/(\*\*|__)(?=\S)([^\r]*?\S[*_]*)\1/g,"<strong>$2</strong>"),e=e.replace(/(\*|_)(?=\S)([^\r]*?\S)\1/g,"<em>$2</em>")),e=n.converter._dispatch("italicsAndBold.after",e,t)}),r.subParser("lists",function(e,t,n){"use strict";function i(e,i){n.gListLevel++,e=e.replace(/\n{2,}$/,"\n"),e+="~0";var a=/(\n)?(^[ \t]*)([*+-]|\d+[.])[ \t]+((\[(x| )?])?[ \t]*[^\r]+?(\n{1,2}))(?=\n*(~0|\2([*+-]|\d+[.])[ \t]+))/gm,s=/\n[ \t]*\n(?!~0)/.test(e);return e=e.replace(a,function(e,i,a,o,c,l,u){u=u&&""!==u.trim();var d=r.subParser("outdent")(c,t,n),h="";return l&&t.tasklists&&(h=' class="task-list-item" style="list-style-type: none;"',d=d.replace(/^[ \t]*\[(x| )?]/m,function(){var e='<input type="checkbox" disabled style="margin: 0px 0.35em 0.25em -1.6em; vertical-align: middle;"';return u&&(e+=" checked"),e+=">"})),i||d.search(/\n{2,}/)>-1?(d=r.subParser("githubCodeBlocks")(d,t,n),d=r.subParser("blockGamut")(d,t,n)):(d=r.subParser("lists")(d,t,n),d=d.replace(/\n$/,""),d=s?r.subParser("paragraphs")(d,t,n):r.subParser("spanGamut")(d,t,n)),d="\n<li"+h+">"+d+"</li>\n"}),e=e.replace(/~0/g,""),n.gListLevel--,i&&(e=e.replace(/\s+$/,"")),e}function a(e,t,n){var r="ul"===t?/^ {0,2}\d+\.[ \t]/gm:/^ {0,2}[*+-][ \t]/gm,a=[],s="";if(-1!==e.search(r)){!function c(e){var a=e.search(r);-1!==a?(s+="\n\n<"+t+">"+i(e.slice(0,a),!!n)+"</"+t+">\n\n",t="ul"===t?"ol":"ul",r="ul"===t?/^ {0,2}\d+\.[ \t]/gm:/^ {0,2}[*+-][ \t]/gm,c(e.slice(a))):s+="\n\n<"+t+">"+i(e,!!n)+"</"+t+">\n\n"}(e);for(var o=0;o<a.length;++o);}else s="\n\n<"+t+">"+i(e,!!n)+"</"+t+">\n\n";return s}e=n.converter._dispatch("lists.before",e,t),e+="~0";var s=/^(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm;return n.gListLevel?e=e.replace(s,function(e,t,n){var r=n.search(/[*+-]/g)>-1?"ul":"ol";return a(t,r,!0)}):(s=/(\n\n|^\n?)(([ ]{0,3}([*+-]|\d+[.])[ \t]+)[^\r]+?(~0|\n{2,}(?=\S)(?![ \t]*(?:[*+-]|\d+[.])[ \t]+)))/gm,e=e.replace(s,function(e,t,n,r){var i=r.search(/[*+-]/g)>-1?"ul":"ol";return a(n,i)})),e=e.replace(/~0/,""),e=n.converter._dispatch("lists.after",e,t)}),r.subParser("outdent",function(e){"use strict";return e=e.replace(/^(\t|[ ]{1,4})/gm,"~0"),e=e.replace(/~0/g,"")}),r.subParser("paragraphs",function(e,t,n){"use strict";e=n.converter._dispatch("paragraphs.before",e,t),e=e.replace(/^\n+/g,""),e=e.replace(/\n+$/g,"");for(var i=e.split(/\n{2,}/g),a=[],s=i.length,o=0;s>o;o++){var c=i[o];c.search(/~K(\d+)K/g)>=0?a.push(c):c.search(/\S/)>=0&&(c=r.subParser("spanGamut")(c,t,n),c=c.replace(/^([ \t]*)/g,"<p>"),c+="</p>",a.push(c))}for(s=a.length,o=0;s>o;o++)for(;a[o].search(/~K(\d+)K/)>=0;){var l=n.gHtmlBlocks[RegExp.$1];l=l.replace(/\$/g,"$$$$"),a[o]=a[o].replace(/~K\d+K/,l)}return e=n.converter._dispatch("paragraphs.after",e,t),a.join("\n\n")}),r.subParser("runExtension",function(e,t,n,r){"use strict";if(e.filter)t=e.filter(t,r.converter,n);else if(e.regex){var i=e.regex;!i instanceof RegExp&&(i=new RegExp(i,"g")),t=t.replace(i,e.replace)}return t}),r.subParser("spanGamut",function(e,t,n){"use strict";return e=n.converter._dispatch("spanGamut.before",e,t),e=r.subParser("codeSpans")(e,t,n),e=r.subParser("escapeSpecialCharsWithinTagAttributes")(e,t,n),e=r.subParser("encodeBackslashEscapes")(e,t,n),e=r.subParser("images")(e,t,n),e=r.subParser("anchors")(e,t,n),e=r.subParser("autoLinks")(e,t,n),e=r.subParser("encodeAmpsAndAngles")(e,t,n),e=r.subParser("italicsAndBold")(e,t,n),e=r.subParser("strikethrough")(e,t,n),e=e.replace(/  +\n/g," <br />\n"),e=n.converter._dispatch("spanGamut.after",e,t)}),r.subParser("strikethrough",function(e,t,n){"use strict";return t.strikethrough&&(e=n.converter._dispatch("strikethrough.before",e,t),e=e.replace(/(?:~T){2}([\s\S]+?)(?:~T){2}/g,"<del>$1</del>"),e=n.converter._dispatch("strikethrough.after",e,t)),e}),r.subParser("stripBlankLines",function(e){"use strict";return e.replace(/^[ \t]+$/gm,"")}),r.subParser("stripLinkDefinitions",function(e,t,n){"use strict";var i=/^ {0,3}\[(.+)]:[ \t]*\n?[ \t]*<?(\S+?)>?(?: =([*\d]+[A-Za-z%]{0,4})x([*\d]+[A-Za-z%]{0,4}))?[ \t]*\n?[ \t]*(?:(\n*)["|'(](.+?)["|')][ \t]*)?(?:\n+|(?=~0))/gm;return e+="~0",e=e.replace(i,function(e,i,a,s,o,c,l){return i=i.toLowerCase(),n.gUrls[i]=r.subParser("encodeAmpsAndAngles")(a),c?c+l:(l&&(n.gTitles[i]=l.replace(/"|'/g,"&quot;")),t.parseImgDimensions&&s&&o&&(n.gDimensions[i]={width:s,height:o}),"")}),e=e.replace(/~0/,"")}),r.subParser("tables",function(e,t,n){"use strict";var i=function(){var e,i={};return i.th=function(e,i){var a="";return e=e.trim(),""===e?"":(t.tableHeaderId&&(a=' id="'+e.replace(/ /g,"_").toLowerCase()+'"'),e=r.subParser("spanGamut")(e,t,n),i=i&&""!==i.trim()?' style="'+i+'"':"","<th"+a+i+">"+e+"</th>")},i.td=function(e,i){var a=r.subParser("spanGamut")(e.trim(),t,n);return i=i&&""!==i.trim()?' style="'+i+'"':"","<td"+i+">"+a+"</td>"},i.ths=function(){var e="",t=0,n=[].slice.apply(arguments[0]),r=[].slice.apply(arguments[1]);for(t;t<n.length;t+=1)e+=i.th(n[t],r[t])+"\n";return e},i.tds=function(){var e="",t=0,n=[].slice.apply(arguments[0]),r=[].slice.apply(arguments[1]);for(t;t<n.length;t+=1)e+=i.td(n[t],r[t])+"\n";return e},i.thead=function(){var e,t=[].slice.apply(arguments[0]),n=[].slice.apply(arguments[1]);return e="<thead>\n",e+="<tr>\n",e+=i.ths.apply(this,[t,n]),e+="</tr>\n",e+="</thead>\n"},i.tr=function(){var e,t=[].slice.apply(arguments[0]),n=[].slice.apply(arguments[1]);return e="<tr>\n",e+=i.tds.apply(this,[t,n]),e+="</tr>\n"},e=function(e){var t,n,r=0,a=e.split("\n"),s=[];for(r;r<a.length;r+=1){if(t=a[r],t.trim().match(/^[|].*[|]$/)){t=t.trim();var o=[],c=a[r+1].trim(),l=[],u=0;if(c.match(/^[|][-=|: ]+[|]$/))for(l=c.substring(1,c.length-1).split("|"),u=0;u<l.length;++u)l[u]=l[u].trim(),l[u].match(/^[:][-=| ]+[:]$/)?l[u]="text-align:center;":l[u].match(/^[-=| ]+[:]$/)?l[u]="text-align:right;":l[u].match(/^[:][-=| ]+$/)?l[u]="text-align:left;":l[u]="";if(o.push("<table>"),n=t.substring(1,t.length-1).split("|"),0===l.length)for(u=0;u<n.length;++u)l.push("text-align:left");if(o.push(i.thead.apply(this,[n,l])),t=a[++r],t.trim().match(/^[|][-=|: ]+[|]$/)){for(t=a[++r],o.push("<tbody>");t.trim().match(/^[|].*[|]$/);)t=t.trim(),o.push(i.tr.apply(this,[t.substring(1,t.length-1).split("|"),l])),t=a[++r];o.push("</tbody>"),o.push("</table>"),s.push(o.join("\n"));continue}t=a[--r]}s.push(t)}return s.join("\n")},{parse:e}};if(t.tables){e=n.converter._dispatch("tables.before",e,t);var a=i();e=a.parse(e),e=n.converter._dispatch("tables.after",e,t)}return e}),r.subParser("unescapeSpecialChars",function(e){"use strict";return e=e.replace(/~E(\d+)E/g,function(e,t){var n=parseInt(t);return String.fromCharCode(n)})});var c=this;"undefined"!=typeof module&&module.exports?module.exports=r:"function"==typeof define&&define.amd?define("showdown",function(){"use strict";return r}):c.showdown=r}).call(this),function(){var e,t,n,r,i,a,s,o,c,l,u,d,h,f,p={}.hasOwnProperty,g=this;e={absolute:!1,base:"undefined"!=typeof window&&null!==window?window.document.baseURI:"file://"+process.cwd(),debug:!1,inline:!1},n=this.md,i={"\\\\":"\\\\","\\[":"\\[","\\]":"\\]",">":"\\>",_:"\\_","\\*":"\\*","`":"\\`","#":"\\#","([0-9])\\.(\\s|$)":"$1\\.$2","©":"(c)","®":"(r)","™":"(tm)"," ":" ","·":"\\*"," ":" "," ":" "," ":" ","‘":"'","’":"'","“":'"',"”":'"',"…":"...","–":"--","—":"---"},a=/(display|visibility)\s*:\s*[a-z]+/gi,s=/(none|hidden)\s*$/i,o=/^(APPLET|AREA|AUDIO|BUTTON|CANVAS|DATALIST|EMBED|HEAD|INPUT|MAP|MENU|METER|NOFRAMES|NOSCRIPT|OBJECT|OPTGROUP|OPTION|PARAM|PROGRESS|RP|RT|RUBY|SCRIPT|SELECT|STYLE|TEXTAREA|TITLE|VIDEO)$/,c=/^(ADDRESS|ARTICLE|ASIDE|DIV|FIELDSET|FOOTER|HEADER|NAV|P|SECTION)$/,r=function(){h={};for(l in i)p.call(i,l)&&(h[l]=new RegExp(l,"g"));return h}(),d=function(e,t,n){var r,i;if(null==e&&(e=""),null==t&&(t=0),null==n&&(n=" "),!n)return e;for(r=i=0;t>=0?t>i:i>t;r=t>=0?++i:--i)e=n+e;return e},f=function(e){return null==e&&(e=""),e.trim?e.trim():e.replace(/^\s+|\s+$/g,"")},t=function(){function t(t,n){var r,i;this.html=null!=t?t:"",this.options=null!=n?n:{},this.atLeft=this.atNoWS=this.atP=!0,this.buffer="",this.exceptions=[],this.order=1,this.listDepth=0,this.inCode=this.inPre=this.inOrderedList=!1,this.last=null,this.left="\n",this.links=[],this.linkMap={},this.unhandled={},"object"!=typeof this.options&&(this.options={});for(l in e)p.call(e,l)&&(r=e[l],"undefined"==typeof this.options[l]&&(this.options[l]=r));this.win="undefined"!=typeof window&&null!==window?window:null,null==this.win&&(i=require("jsdom").jsdom(null,null,{features:{FetchExternalResources:!1},url:this.options.base}),this.win=i.createWindow()),null==this.win.Node&&(this.win.Node={ELEMENT_NODE:1,TEXT_NODE:3})}return t.prototype.append=function(e){return null!=this.last&&(this.buffer+=this.last),this.last=e},t.prototype.attr=function(e,t,n){var r;return null==n&&(n=!0),r=n||"function"!=typeof e.getAttribute?e[t]:e.getAttribute(t),null!=r?r:""},t.prototype.br=function(){return this.append("  "+this.left),this.atLeft=this.atNoWS=!0},t.prototype.code=function(){var e,t=this;return e=this.inCode,this.inCode=!0,function(){return t.inCode=e}},t.prototype.has=function(e,t,n){return null==n&&(n=!0),n||"function"!=typeof e.hasAttribute?e.hasOwnProperty(t):e.hasAttribute(t)},t.prototype.inCodeProcess=function(e){return e.replace(/`/g,"\\`")},t.prototype.isVisible=function(e){var t,n,r,i,o,c,l,u,d;if(o=this.attr(e,"style",!1),r=null!=o&&"function"==typeof o.match?o.match(a):void 0,l=!0,null!=r)for(u=0,d=r.length;d>u;u++)i=r[u],l=!s.test(i);if(l&&"function"==typeof this.win.getComputedStyle)try{o=this.win.getComputedStyle(e,null),"function"==typeof(null!=o?o.getPropertyValue:void 0)&&(t=o.getPropertyValue("display"),c=o.getPropertyValue("visibility"),l="none"!==t&&"hidden"!==c)}catch(h){n=h,this.thrown(n,"getComputedStyle")}return l},t.prototype.li=function(){var e;return e=this.inOrderedList?""+this.order++ +". ":"* ",e=d(e,2*(this.listDepth-1)),this.append(e)},t.prototype.nonPreProcess=function(e){var t;e=e.replace(/\n([ \t]*\n)+/g,"\n"),e=e.replace(/\n[ \t]+/g,"\n"),e=e.replace(/[ \t]+/g," ");for(l in i)p.call(i,l)&&(t=i[l],e=e.replace(r[l],t));return e},t.prototype.ol=function(){var e,t,n=this;return 0===this.listDepth&&this.p(),e=this.inOrderedList,t=this.order,this.inOrderedList=!0,this.order=1,this.listDepth++,function(){return n.inOrderedList=e,n.order=t,n.listDepth--}},t.prototype.output=function(e){return e&&(this.inPre||(e=this.atNoWS?e.replace(/^[ \t\n]+/,""):/^[ \t]*\n/.test(e)?e.replace(/^[ \t\n]+/,"\n"):e.replace(/^[ \t]+/," ")),""!==e)?(this.atP=/\n\n$/.test(e),this.atLeft=/\n$/.test(e),this.atNoWS=/[ \t\n]$/.test(e),this.append(e.replace(/\n/g,this.left))):void 0},t.prototype.outputLater=function(e){var t=this;return function(){return t.output(e)}},t.prototype.p=function(){return this.atP?void 0:(this.atLeft||(this.append(this.left),this.atLeft=!0),this.append(this.left),this.atNoWS=this.atP=!0)},t.prototype.parse=function(){var e,t,n,r,i,a,s,o;if(this.buffer="",!this.html)return this.buffer;if(e=this.win.document.createElement("div"),"string"==typeof this.html?e.innerHTML=this.html:e.appendChild(this.html),this.process(e),this.links.length)for(this.append("\n\n"),o=this.links,t=a=0,s=o.length;s>a;t=++a)n=o[t],n&&this.append("["+t+"]: "+n+"\n");return this.options.debug&&(i=function(){var e,t;e=this.unhandled,t=[];for(r in e)p.call(e,r)&&t.push(r);return t}.call(this).sort(),console.log(i.length?"Ignored tags;\n"+i.join(", "):"No tags were ignored"),console.log(this.exceptions.length?"Exceptions;\n"+this.exceptions.join("\n"):"No exceptions were thrown")),this.append(""),this.buffer=f(this.buffer)},t.prototype.pre=function(){var e,t=this;return e=this.inPre,this.inPre=!0,function(){return t.inPre=e}},t.prototype.process=function(e){var t,n,r,i,a,s,l,u,d,h,f,p,g,m,v,b,y,C,R;if(this.isVisible(e)){if(e.nodeType===this.win.Node.ELEMENT_NODE){d=!1;try{if(o.test(e.tagName))d=!0;else if(/^H[1-6]$/.test(e.tagName))u=parseInt(e.tagName.match(/([1-6])$/)[1]),this.p(),this.output(""+function(){var e,t;for(t=[],l=e=1;u>=1?u>=e:e>=u;l=u>=1?++e:--e)t.push("#");return t}().join("")+" ");else if(c.test(e.tagName))this.p();else switch(e.tagName){case"BODY":case"FORM":break;case"DETAILS":this.p(),this.has(e,"open",!1)||(d=!0,p=e.getElementsByTagName("summary")[0],p&&this.process(p));break;case"BR":this.br();break;case"HR":this.p(),this.output("---"),this.p();break;case"CITE":case"DFN":case"EM":case"I":case"U":case"VAR":this.output("_"),this.atNoWS=!0,t=this.outputLater("_");break;case"DT":
case"B":case"STRONG":"DT"===e.tagName&&this.p(),this.output("**"),this.atNoWS=!0,t=this.outputLater("**");break;case"Q":this.output('"'),this.atNoWS=!0,t=this.outputLater('"');break;case"OL":case"UL":t="OL"===e.tagName?this.ol():this.ul();break;case"LI":this.replaceLeft("\n"),this.li();break;case"PRE":n=this.pushLeft("    "),r=this.pre(),t=function(){return n(),r()};break;case"CODE":case"KBD":case"SAMP":if(this.inPre)break;this.output("`"),n=this.code(),r=this.outputLater("`"),t=function(){return n(),r()};break;case"BLOCKQUOTE":case"DD":t=this.pushLeft("> ");break;case"A":if(s=this.attr(e,"href",this.options.absolute),!s)break;g=this.attr(e,"title"),g&&(s+=' "'+g+'"'),f=this.options.inline?"("+s+")":"["+(null!=(y=(m=this.linkMap)[s])?y:m[s]=this.links.push(s)-1)+"]",this.output("["),this.atNoWS=!0,t=this.outputLater("]"+f);break;case"IMG":if(d=!0,h=this.attr(e,"src",this.options.absolute),!h)break;this.output("!["+this.attr(e,"alt")+"]("+h+")");break;case"FRAME":case"IFRAME":d=!0;try{(null!=(C=e.contentDocument)?C.documentElement:void 0)&&this.process(e.contentDocument.documentElement)}catch(E){a=E,this.thrown(a,"contentDocument")}break;case"TR":t=this.p;break;default:this.options.debug&&(this.unhandled[e.tagName]=null)}}catch(E){a=E,this.thrown(a,e.tagName)}if(!d)for(R=e.childNodes,v=0,b=R.length;b>v;v++)i=R[v],this.process(i);return null!=t?t.call(this):void 0}return e.nodeType===this.win.Node.TEXT_NODE?this.output(this.inPre?e.nodeValue:this.inCode?this.inCodeProcess(e.nodeValue):this.nonPreProcess(e.nodeValue)):void 0}},t.prototype.pushLeft=function(e){var t,n=this;return t=this.left,this.left+=e,this.atP?this.append(e):this.p(),function(){return n.left=t,n.atLeft=n.atP=!1,n.p()}},t.prototype.replaceLeft=function(e){return this.atLeft?this.last?this.last=this.last.replace(/[ ]{2,4}$/,e):void 0:(this.append(this.left.replace(/[ ]{2,4}$/,e)),this.atLeft=this.atNoWS=this.atP=!0)},t.prototype.thrown=function(e,t){return this.options.debug?this.exceptions.push(""+t+": "+e):void 0},t.prototype.ul=function(){var e,t,n=this;return 0===this.listDepth&&this.p(),e=this.inOrderedList,t=this.order,this.inOrderedList=!1,this.order=1,this.listDepth++,function(){return n.inOrderedList=e,n.order=t,n.listDepth--}},t}(),this.md=u=function(e,n){return new t(e,n).parse()},("undefined"!=typeof module&&null!==module?module.exports:void 0)?module.exports=u:"function"==typeof define&&define.amd&&define("md",function(){return u}),u.version=u.VERSION="3.0.2",u.noConflict=function(){return g.md=n,u}}.call(this),function(e){function t(e,t,n,r){if(e.tag.format&&n.length>0){n.push("\n");for(var i=0;r>i;i++)n.push("	")}}function n(r,i){var a=[],s=0==r.attributes.length,o=0;if(r.tag.isComment)i.allowComments&&(a.push("<!--"),a.push(r.tag.rawAttributes),a.push(">"),i.format&&t(r,i,a,o-1));else{var c=r.tag.render&&(0==i.allowedTags.length||e.inArray(r.tag.name,i.allowedTags)>-1)&&(0==i.removeTags.length||-1==e.inArray(r.tag.name,i.removeTags));if(!r.isRoot&&c&&(a.push("<"),a.push(r.tag.name),e.each(r.attributes,function(){if(-1==e.inArray(this.name,i.removeAttrs)){var t=RegExp(/^(['"]?)(.*?)['"]?$/).exec(this.value),n=t[2],s=t[1]||"'";"class"==this.name&&i.allowedClasses.length>0&&(n=e.grep(n.split(" "),function(t){return e.grep(i.allowedClasses,function(n){return n==t||n[0]==t&&(1==n.length||e.inArray(r.tag.name,n[1])>-1)}).length>0}).join(" ")),null!=n&&(n.length>0||e.inArray(this.name,r.tag.requiredAttributes)>-1)&&(a.push(" "),a.push(this.name),a.push("="),a.push(s),a.push(n),a.push(s))}})),r.tag.isSelfClosing)c&&a.push(" />"),s=!1;else if(r.tag.isNonClosing)s=!1;else{if(!r.isRoot&&c&&a.push(">"),o=i.formatIndent++,r.tag.toProtect)f=e.htmlClean.trim(r.children.join("")).replace(/<br>/gi,"\n"),a.push(f),s=0==f.length;else{for(var f=[],g=0;g<r.children.length;g++){var m=r.children[g],v=e.htmlClean.trim(p(d(m)?m:m.childrenToString()));h(m)&&g>0&&v.length>0&&(l(m)||u(r.children[g-1]))&&f.push(" "),d(m)?v.length>0&&f.push(v):(g!=r.children.length-1||"br"!=m.tag.name)&&(i.format&&t(m,i,f,o),f=f.concat(n(m,i)))}i.formatIndent--,f.length>0&&(i.format&&"\n"!=f[0]&&t(r,i,a,o),a=a.concat(f),s=!1)}!r.isRoot&&c&&(i.format&&t(r,i,a,o-1),a.push("</"),a.push(r.tag.name),a.push(">"))}if(!r.tag.allowEmpty&&s)return[]}return a}function r(t,n){return a(t,function(t){return e.inArray(t.tag.nameOriginal,n)>-1})}function i(e){return a(e,function(e){return e.isRoot||!e.tag.isInline})}function a(e,t,n){n=n||1;var r=e[e.length-n];return t(r)?!0:e.length-n>0&&a(e,t,n+1)?(e.pop(),!0):!1}function s(e){return e?(this.tag=e,this.isRoot=!1):(this.tag=new c("root"),this.isRoot=!0),this.attributes=[],this.children=[],this.hasAttribute=function(e){for(var t=0;t<this.attributes.length;t++)if(this.attributes[t].name==e)return!0;return!1},this.childrenToString=function(){return this.children.join("")},this}function o(e,t){return this.name=e,this.value=t,this}function c(t,n,r,i){return this.name=t.toLowerCase(),this.nameOriginal=this.name,this.render=!0,this.init=function(){if("--"==this.name?(this.isComment=!0,this.isSelfClosing=!0,this.format=!0):(this.isComment=!1,this.isSelfClosing=e.inArray(this.name,R)>-1,this.isNonClosing=e.inArray(this.name,E)>-1,this.isClosing=void 0!=n&&n.length>0,this.isInline=e.inArray(this.name,g)>-1,this.disallowNest=e.inArray(this.name,v)>-1,this.requiredParent=y[e.inArray(this.name,y)+1],this.allowEmpty=i&&e.inArray(this.name,i.allowEmpty)>-1,this.toProtect=e.inArray(this.name,C)>-1,this.format=e.inArray(this.name,m)>-1||!this.isInline),this.rawAttributes=r,this.requiredAttributes=S[e.inArray(this.name,S)+1],i){if(i.tagAttributesCache||(i.tagAttributesCache=[]),-1==e.inArray(this.name,i.tagAttributesCache)){for(var t=w[e.inArray(this.name,w)+1].slice(0),a=0;a<i.allowedAttributes.length;a++){var s=i.allowedAttributes[a][0];(1==i.allowedAttributes[a].length||e.inArray(this.name,i.allowedAttributes[a][1])>-1)&&-1==e.inArray(s,t)&&t.push(s)}i.tagAttributesCache.push(this.name),i.tagAttributesCache.push(t)}this.allowedAttributes=i.tagAttributesCache[e.inArray(this.name,i.tagAttributesCache)+1]}},this.init(),this.rename=function(e){this.name=e,this.init()},this}function l(t){for(;f(t)&&t.children.length>0;)t=t.children[0];if(!d(t))return!1;var n=p(t);return n.length>0&&e.htmlClean.isWhitespace(n.charAt(0))}function u(t){for(;f(t)&&t.children.length>0;)t=t.children[t.children.length-1];if(!d(t))return!1;var n=p(t);return n.length>0&&e.htmlClean.isWhitespace(n.charAt(n.length-1))}function d(e){return e.constructor==String}function h(e){return d(e)||e.tag.isInline}function f(e){return e.constructor==s}function p(e){return e.replace(/&nbsp;|\n/g," ").replace(/\s\s+/g," ")}e.fn.htmlClean=function(t){return this.each(function(){this.value?this.value=e.htmlClean(this.value,t):this.innerHTML=e.htmlClean(this.innerHTML,t)})},e.htmlClean=function(t,a){a=e.extend({},e.htmlClean.defaults,a),a.allowEmpty=b.concat(a.allowEmpty);var l,u=/(<(\/)?(\w+:)?([\w]+)([^>]*)>)|<!--(.*?--)>/gi,h=/([\w\-]+)\s*=\s*(".*?"|'.*?'|[^\s>\/]*)/gi,f=new s,p=[f],g=f;a.bodyOnly&&(l=/<body[^>]*>((\n|.)*)<\/body>/i.exec(t))&&(t=l[1]),t=t.concat("<xxx>");for(var m;l=u.exec(t);){var v=l[6]?new c("--",null,l[6],a):new c(l[4],l[2],l[5],a),y=t.substring(m,l.index);if(y.length>0){var C=g.children[g.children.length-1];g.children.length>0&&d(C=g.children[g.children.length-1])?g.children[g.children.length-1]=C.concat(y):g.children.push(y)}if(m=u.lastIndex,v.isClosing)r(p,[v.name])&&(p.pop(),g=p[p.length-1]);else{for(var R,E=new s(v);R=h.exec(v.rawAttributes);){if("style"==R[1].toLowerCase()&&a.replaceStyles)for(var w=!v.isInline,S=0;S<a.replaceStyles.length;S++)a.replaceStyles[S][0].test(R[2])&&(w||(v.render=!1,w=!0),g.children.push(E),p.push(E),g=E,v=new c(a.replaceStyles[S][1],"","",a),E=new s(v));null!=v.allowedAttributes&&(0==v.allowedAttributes.length||e.inArray(R[1],v.allowedAttributes)>-1)&&E.attributes.push(new o(R[1],R[2]))}e.each(v.requiredAttributes,function(){var e=this.toString();E.hasAttribute(e)||E.attributes.push(new o(e,""))});for(var N=0;N<a.replace.length;N++)for(var T=0;T<a.replace[N][0].length;T++){var A="string"==typeof a.replace[N][0][T];if(A&&a.replace[N][0][T]==v.name||!A&&a.replace[N][0][T].test(l)){v.rename(a.replace[N][1]),N=a.replace.length;break}}var x=!0;if(g.isRoot||(g.tag.isInline&&!v.isInline?(x=i(p))&&(g=p[p.length-1]):g.tag.disallowNest&&v.disallowNest&&!v.requiredParent?x=!1:v.requiredParent&&(x=r(p,v.requiredParent))&&(g=p[p.length-1])),x)if(g.children.push(E),v.toProtect)for(var O;O=u.exec(t);){var P=new c(O[4],O[1],O[5],a);if(P.isClosing&&P.name==v.name){E.children.push(RegExp.leftContext.substring(m)),m=u.lastIndex;break}}else v.isSelfClosing||v.isNonClosing||(p.push(E),g=E)}}return e.htmlClean.trim(n(f,a).join(""))},e.htmlClean.defaults={bodyOnly:!0,allowedTags:[],removeTags:["basefont","center","dir","font","frame","frameset","iframe","isindex","menu","noframes","s","strike","u"],allowedAttributes:[],removeAttrs:[],allowedClasses:[],format:!1,formatIndent:0,replace:[[["b","big"],"strong"],[["i"],"em"]],replaceStyles:[[/font-weight:\s*bold/i,"strong"],[/font-style:\s*italic/i,"em"],[/vertical-align:\s*super/i,"sup"],[/vertical-align:\s*sub/i,"sub"]],allowComments:!1,allowEmpty:[]},e.htmlClean.trim=function(t){return e.htmlClean.trimStart(e.htmlClean.trimEnd(t))},e.htmlClean.trimStart=function(t){return t.substring(e.htmlClean.trimStartIndex(t))},e.htmlClean.trimStartIndex=function(t){for(var n=0;n<t.length-1&&e.htmlClean.isWhitespace(t.charAt(n));n++);return n},e.htmlClean.trimEnd=function(t){return t.substring(0,e.htmlClean.trimEndIndex(t))},e.htmlClean.trimEndIndex=function(t){for(var n=t.length-1;n>=0&&e.htmlClean.isWhitespace(t.charAt(n));n--);return n+1},e.htmlClean.isWhitespace=function(t){return-1!=e.inArray(t,N)};var g=["a","abbr","acronym","address","b","big","br","button","caption","cite","code","del","em","font","hr","i","input","img","ins","label","legend","map","q","s","samp","select","option","param","small","span","strike","strong","sub","sup","tt","u","var"],m=["address","button","caption","code","input","label","legend","select","option","param"],v=["h1","h2","h3","h4","h5","h6","p","th","td","object"],b=["th","td"],y=[null,"li",["ul","ol"],"dt",["dl"],"dd",["dl"],"td",["tr"],"th",["tr"],"tr",["table","thead","tbody","tfoot"],"thead",["table"],"tbody",["table"],"tfoot",["table"],"param",["object"]],C=["script","style","pre","code"],R=["area","base","br","col","command","embed","hr","img","input","keygen","link","meta","param","source","track","wbr"],E=["!doctype","?xml"],w=[["class"],"?xml",[],"!doctype",[],"a",["accesskey","class","href","name","title","rel","rev","type","tabindex"],"abbr",["class","title"],"acronym",["class","title"],"blockquote",["cite","class"],"button",["class","disabled","name","type","value"],"del",["cite","class","datetime"],"form",["accept","action","class","enctype","method","name"],"iframe",["class","height","name","sandbox","seamless","src","srcdoc","width"],"input",["accept","accesskey","alt","checked","class","disabled","ismap","maxlength","name","size","readonly","src","tabindex","type","usemap","value"],"img",["alt","class","height","src","width"],"ins",["cite","class","datetime"],"label",["accesskey","class","for"],"legend",["accesskey","class"],"link",["href","rel","type"],"meta",["content","http-equiv","name","scheme","charset"],"map",["name"],"optgroup",["class","disabled","label"],"option",["class","disabled","label","selected","value"],"q",["class","cite"],"script",["src","type"],"select",["class","disabled","multiple","name","size","tabindex"],"style",["type"],"table",["class","summary"],"th",["class","colspan","rowspan"],"td",["class","colspan","rowspan"],"textarea",["accesskey","class","cols","disabled","name","readonly","rows","tabindex"],"param",["name","value"],"embed",["height","src","type","width"]],S=[[],"img",["alt"]],N=[" "," ","	","\n","\r","\f"]}(jQuery),function(e,t){"function"==typeof define&&define.amd?define(e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e():t.rangy=e()}(function(){function e(e,t){var n=typeof e[t];return n==C||!(n!=y||!e[t])||"unknown"==n}function t(e,t){return!(typeof e[t]!=y||!e[t])}function n(e,t){return typeof e[t]!=R}function r(e){return function(t,n){for(var r=n.length;r--;)if(!e(t,n[r]))return!1;return!0}}function i(e){return e&&T(e,N)&&x(e,S)}function a(e){return t(e,"body")?e.body:e.getElementsByTagName("body")[0]}function s(t){typeof console!=R&&e(console,"log")&&console.log(t)}function o(e,t){_&&t?alert(e):s(e)}function c(e){D.initialized=!0,D.supported=!1,o("Rangy is not supported in this environment. Reason: "+e,D.config.alertOnFail)}function l(e){o("Rangy warning: "+e,D.config.alertOnWarn)}function u(e){return e.message||e.description||String(e)}function d(){if(_&&!D.initialized){var t,n=!1,r=!1;e(document,"createRange")&&(t=document.createRange(),T(t,w)&&x(t,E)&&(n=!0));var o=a(document);if(!o||"body"!=o.nodeName.toLowerCase())return void c("No body element found");if(o&&e(o,"createTextRange")&&(t=o.createTextRange(),i(t)&&(r=!0)),!n&&!r)return void c("Neither Range nor TextRange are available");D.initialized=!0,D.features={implementsDomRange:n,implementsTextRange:r};var l,d;for(var h in P)(l=P[h])instanceof g&&l.init(l,D);for(var f=0,p=B.length;p>f;++f)try{B[f](D)}catch(m){d="Rangy init listener threw an exception. Continuing. Detail: "+u(m),s(d)}}}function h(e,t,n){n&&(e+=" in module "+n.name),D.warn("DEPRECATED: "+e+" is deprecated. Please use "+t+" instead.")}function f(e,t,n,r){e[t]=function(){return h(t,n,r),e[n].apply(e,k.toArray(arguments))}}function p(e){e=e||window,d();for(var t=0,n=M.length;n>t;++t)M[t](e)}function g(e,t,n){this.name=e,this.dependencies=t,this.initialized=!1,this.supported=!1,this.initializer=n}function m(e,t,n){var r=new g(e,t,function(t){if(!t.initialized){t.initialized=!0;try{n(D,t),t.supported=!0}catch(r){var i="Module '"+e+"' failed to load: "+u(r);s(i),r.stack&&s(r.stack)}}});return P[e]=r,r}function v(){}function b(){}var y="object",C="function",R="undefined",E=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],w=["setStart","setStartBefore","setStartAfter","setEnd","setEndBefore","setEndAfter","collapse","selectNode","selectNodeContents","compareBoundaryPoints","deleteContents","extractContents","cloneContents","insertNode","surroundContents","cloneRange","toString","detach"],S=["boundingHeight","boundingLeft","boundingTop","boundingWidth","htmlText","text"],N=["collapse","compareEndPoints","duplicate","moveToElementText","parentElement","select","setEndPoint","getBoundingClientRect"],T=r(e),A=r(t),x=r(n),O=[].forEach?function(e,t){e.forEach(t)}:function(e,t){for(var n=0,r=e.length;r>n;++n)t(e[n],n)},P={},_=typeof window!=R&&typeof document!=R,k={isHostMethod:e,isHostObject:t,isHostProperty:n,areHostMethods:T,areHostObjects:A,areHostProperties:x,isTextRange:i,getBody:a,forEach:O},D={version:"1.3.0",initialized:!1,isBrowser:_,supported:!0,util:k,features:{},modules:P,config:{alertOnFail:!1,alertOnWarn:!1,preferTextRange:!1,autoInitialize:typeof rangyAutoInitialize==R?!0:rangyAutoInitialize}};D.fail=c,D.warn=l;var I;({}).hasOwnProperty?(k.extend=I=function(e,t,n){var r,i;for(var a in t)t.hasOwnProperty(a)&&(r=e[a],i=t[a],n&&null!==r&&"object"==typeof r&&null!==i&&"object"==typeof i&&I(r,i,!0),e[a]=i);return t.hasOwnProperty("toString")&&(e.toString=t.toString),e},k.createOptions=function(e,t){var n={};return I(n,t),e&&I(n,e),n}):c("hasOwnProperty not supported"),_||c("Rangy can only run in a browser"),function(){var e;if(_){var t=document.createElement("div");t.appendChild(document.createElement("span"));var n=[].slice;try{1==n.call(t.childNodes,0)[0].nodeType&&(e=function(e){return n.call(e,0)})}catch(r){}}e||(e=function(e){for(var t=[],n=0,r=e.length;r>n;++n)t[n]=e[n];return t}),k.toArray=e}();var L;_&&(e(document,"addEventListener")?L=function(e,t,n){e.addEventListener(t,n,!1)}:e(document,"attachEvent")?L=function(e,t,n){e.attachEvent("on"+t,n)}:c("Document does not have required addEventListener or attachEvent method"),k.addListener=L);var B=[];k.deprecationNotice=h,k.createAliasForDeprecatedMethod=f,D.init=d,D.addInitListener=function(e){D.initialized?e(D):B.push(e)};var M=[];D.addShimListener=function(e){M.push(e)},_&&(D.shim=D.createMissingNativeApi=p,f(D,"createMissingNativeApi","shim")),g.prototype={init:function(){for(var e,t,n=this.dependencies||[],r=0,i=n.length;i>r;++r){if(t=n[r],e=P[t],!(e&&e instanceof g))throw new Error("required module '"+t+"' not found");if(e.init(),!e.supported)throw new Error("required module '"+t+"' not supported")}this.initializer(this)},fail:function(e){throw this.initialized=!0,this.supported=!1,new Error(e)},warn:function(e){D.warn("Module "+this.name+": "+e)},deprecationNotice:function(e,t){D.warn("DEPRECATED: "+e+" in module "+this.name+" is deprecated. Please use "+t+" instead")},createError:function(e){return new Error("Error in Rangy "+this.name+" module: "+e)}},D.createModule=function(e){var t,n;2==arguments.length?(t=arguments[1],n=[]):(t=arguments[2],n=arguments[1]);var r=m(e,n,t);D.initialized&&D.supported&&r.init()},D.createCoreModule=function(e,t,n){m(e,t,n)},D.RangePrototype=v,D.rangePrototype=new v,D.selectionPrototype=new b,D.createCoreModule("DomUtil",[],function(e,t){function n(e){var t;return typeof e.namespaceURI==_||null===(t=e.namespaceURI)||"http://www.w3.org/1999/xhtml"==t}function r(e){var t=e.parentNode;return 1==t.nodeType?t:null}function i(e){for(var t=0;e=e.previousSibling;)++t;return t}function a(e){switch(e.nodeType){case 7:case 10:return 0;case 3:case 8:return e.length;default:return e.childNodes.length}}function s(e,t){var n,r=[];for(n=e;n;n=n.parentNode)r.push(n);for(n=t;n;n=n.parentNode)if(B(r,n))return n;return null}function o(e,t,n){for(var r=n?t:t.parentNode;r;){if(r===e)return!0;r=r.parentNode}return!1}function c(e,t){return o(e,t,!0)}function l(e,t,n){for(var r,i=n?e:e.parentNode;i;){if(r=i.parentNode,r===t)return i;i=r}return null}function u(e){var t=e.nodeType;return 3==t||4==t||8==t}function d(e){if(!e)return!1;var t=e.nodeType;return 3==t||8==t}function h(e,t){var n=t.nextSibling,r=t.parentNode;return n?r.insertBefore(e,n):r.appendChild(e),e}function f(e,t,n){var r=e.cloneNode(!1);if(r.deleteData(0,t),e.deleteData(t,e.length-t),h(r,e),n)for(var a,s=0;a=n[s++];)a.node==e&&a.offset>t?(a.node=r,a.offset-=t):a.node==e.parentNode&&a.offset>i(e)&&++a.offset;return r}function p(e){if(9==e.nodeType)return e;if(typeof e.ownerDocument!=_)return e.ownerDocument;if(typeof e.document!=_)return e.document;if(e.parentNode)return p(e.parentNode);throw t.createError("getDocument: no document found for node")}function g(e){var n=p(e);if(typeof n.defaultView!=_)return n.defaultView;if(typeof n.parentWindow!=_)return n.parentWindow;throw t.createError("Cannot get a window object for node")}function m(e){if(typeof e.contentDocument!=_)return e.contentDocument;if(typeof e.contentWindow!=_)return e.contentWindow.document;throw t.createError("getIframeDocument: No Document object found for iframe element")}function v(e){if(typeof e.contentWindow!=_)return e.contentWindow;if(typeof e.contentDocument!=_)return e.contentDocument.defaultView;throw t.createError("getIframeWindow: No Window object found for iframe element")}function b(e){return e&&k.isHostMethod(e,"setTimeout")&&k.isHostObject(e,"document")}function y(e,t,n){var r;if(e?k.isHostProperty(e,"nodeType")?r=1==e.nodeType&&"iframe"==e.tagName.toLowerCase()?m(e):p(e):b(e)&&(r=e.document):r=document,!r)throw t.createError(n+"(): Parameter must be a Window object or DOM node");return r}function C(e){for(var t;t=e.parentNode;)e=t;return e}function R(e,n,r,a){var o,c,u,d,h;if(e==r)return n===a?0:a>n?-1:1;if(o=l(r,e,!0))return n<=i(o)?-1:1;if(o=l(e,r,!0))return i(o)<a?-1:1;if(c=s(e,r),!c)throw new Error("comparePoints error: nodes have no common ancestor");if(u=e===c?c:l(e,c,!0),d=r===c?c:l(r,c,!0),u===d)throw t.createError("comparePoints got to case 4 and childA and childB are the same!");for(h=c.firstChild;h;){if(h===u)return-1;if(h===d)return 1;h=h.nextSibling}}function E(e){var t;try{return t=e.parentNode,!1}catch(n){return!0}}function w(e){if(!e)return"[No node]";if(M&&E(e))return"[Broken node]";if(u(e))return'"'+e.data+'"';if(1==e.nodeType){var t=e.id?' id="'+e.id+'"':"";return"<"+e.nodeName+t+">[index:"+i(e)+",length:"+e.childNodes.length+"]["+(e.innerHTML||"[innerHTML not supported]").slice(0,25)+"]"}return e.nodeName}function S(e){for(var t,n=p(e).createDocumentFragment();t=e.firstChild;)n.appendChild(t);return n}function N(e,t,n){var r=D(e),i=e.createElement("div");i.contentEditable=""+!!n,t&&(i.innerHTML=t);var a=r.firstChild;return a?r.insertBefore(i,a):r.appendChild(i),i}function T(e){return e.parentNode.removeChild(e)}function A(e){this.root=e,this._next=e}function x(e){return new A(e)}function O(e,t){this.node=e,this.offset=t}function P(e){this.code=this[e],this.codeName=e,this.message="DOMException: "+this.codeName}var _="undefined",k=e.util,D=k.getBody;k.areHostMethods(document,["createDocumentFragment","createElement","createTextNode"])||t.fail("document missing a Node creation method"),k.isHostMethod(document,"getElementsByTagName")||t.fail("document missing getElementsByTagName method");var I=document.createElement("div");k.areHostMethods(I,["insertBefore","appendChild","cloneNode"]||!k.areHostObjects(I,["previousSibling","nextSibling","childNodes","parentNode"]))||t.fail("Incomplete Element implementation"),k.isHostProperty(I,"innerHTML")||t.fail("Element is missing innerHTML property");var L=document.createTextNode("test");k.areHostMethods(L,["splitText","deleteData","insertData","appendData","cloneNode"]||!k.areHostObjects(I,["previousSibling","nextSibling","childNodes","parentNode"])||!k.areHostProperties(L,["data"]))||t.fail("Incomplete Text Node implementation");var B=function(e,t){for(var n=e.length;n--;)if(e[n]===t)return!0;return!1},M=!1;!function(){var t=document.createElement("b");t.innerHTML="1";var n=t.firstChild;t.innerHTML="<br />",M=E(n),e.features.crashyTextNodes=M}();var H;typeof window.getComputedStyle!=_?H=function(e,t){return g(e).getComputedStyle(e,null)[t]}:typeof document.documentElement.currentStyle!=_?H=function(e,t){return e.currentStyle?e.currentStyle[t]:""}:t.fail("No means of obtaining computed style properties found"),A.prototype={_current:null,hasNext:function(){return!!this._next},next:function(){var e,t,n=this._current=this._next;if(this._current)if(e=n.firstChild)this._next=e;else{for(t=null;n!==this.root&&!(t=n.nextSibling);)n=n.parentNode;this._next=t}return this._current},detach:function(){this._current=this._next=this.root=null}},O.prototype={equals:function(e){return!!e&&this.node===e.node&&this.offset==e.offset},inspect:function(){return"[DomPosition("+w(this.node)+":"+this.offset+")]"},toString:function(){return this.inspect()}},P.prototype={INDEX_SIZE_ERR:1,HIERARCHY_REQUEST_ERR:3,WRONG_DOCUMENT_ERR:4,NO_MODIFICATION_ALLOWED_ERR:7,NOT_FOUND_ERR:8,NOT_SUPPORTED_ERR:9,INVALID_STATE_ERR:11,INVALID_NODE_TYPE_ERR:24},P.prototype.toString=function(){return this.message},e.dom={arrayContains:B,isHtmlNamespace:n,parentElement:r,getNodeIndex:i,getNodeLength:a,getCommonAncestor:s,isAncestorOf:o,isOrIsAncestorOf:c,getClosestAncestorIn:l,isCharacterDataNode:u,isTextOrCommentNode:d,insertAfter:h,splitDataNode:f,getDocument:p,getWindow:g,getIframeWindow:v,getIframeDocument:m,getBody:D,isWindow:b,getContentDocument:y,getRootContainer:C,comparePoints:R,isBrokenNode:E,inspectNode:w,getComputedStyleProperty:H,createTestElement:N,removeNode:T,fragmentFromNodeChildren:S,createIterator:x,DomPosition:O},e.DOMException=P}),D.createCoreModule("DomRange",["DomUtil"],function(e,t){function n(e,t){return 3!=e.nodeType&&(U(e,t.startContainer)||U(e,t.endContainer))}function r(e){return e.document||F(e.startContainer)}function i(e){return Q(e.startContainer)}function a(e){return new M(e.parentNode,W(e))}function s(e){return new M(e.parentNode,W(e)+1)}function o(e,t,n){var r=11==e.nodeType?e.firstChild:e;return $(t)?n==t.length?L.insertAfter(e,t):t.parentNode.insertBefore(e,0==n?t:z(t,n)):n>=t.childNodes.length?t.appendChild(e):t.insertBefore(e,t.childNodes[n]),r}function c(e,t,n){if(N(e),N(t),r(t)!=r(e))throw new H("WRONG_DOCUMENT_ERR");var i=j(e.startContainer,e.startOffset,t.endContainer,t.endOffset),a=j(e.endContainer,e.endOffset,t.startContainer,t.startOffset);return n?0>=i&&a>=0:0>i&&a>0}function l(e){for(var t,n,i,a=r(e.range).createDocumentFragment();n=e.next();){if(t=e.isPartiallySelectedSubtree(),n=n.cloneNode(!t),t&&(i=e.getSubtreeIterator(),n.appendChild(l(i)),i.detach()),10==n.nodeType)throw new H("HIERARCHY_REQUEST_ERR");a.appendChild(n)}return a}function u(e,t,n){var r,i;n=n||{stop:!1};for(var a,s;a=e.next();)if(e.isPartiallySelectedSubtree()){if(t(a)===!1)return void(n.stop=!0);if(s=e.getSubtreeIterator(),u(s,t,n),s.detach(),n.stop)return}else for(r=L.createIterator(a);i=r.next();)if(t(i)===!1)return void(n.stop=!0)}function d(e){for(var t;e.next();)e.isPartiallySelectedSubtree()?(t=e.getSubtreeIterator(),d(t),t.detach()):e.remove()}function h(e){for(var t,n,i=r(e.range).createDocumentFragment();t=e.next();){if(e.isPartiallySelectedSubtree()?(t=t.cloneNode(!1),n=e.getSubtreeIterator(),t.appendChild(h(n)),n.detach()):e.remove(),10==t.nodeType)throw new H("HIERARCHY_REQUEST_ERR");i.appendChild(t)}return i}function f(e,t,n){var r,i=!(!t||!t.length),a=!!n;i&&(r=new RegExp("^("+t.join("|")+")$"));var s=[];return u(new g(e,!1),function(t){if((!i||r.test(t.nodeType))&&(!a||n(t))){var o=e.startContainer;if(t!=o||!$(o)||e.startOffset!=o.length){var c=e.endContainer;t==c&&$(c)&&0==e.endOffset||s.push(t)}}}),s}function p(e){var t="undefined"==typeof e.getName?"Range":e.getName();return"["+t+"("+L.inspectNode(e.startContainer)+":"+e.startOffset+", "+L.inspectNode(e.endContainer)+":"+e.endOffset+")]"}function g(e,t){if(this.range=e,this.clonePartiallySelectedTextNodes=t,!e.collapsed){this.sc=e.startContainer,this.so=e.startOffset,this.ec=e.endContainer,this.eo=e.endOffset;var n=e.commonAncestorContainer;this.sc===this.ec&&$(this.sc)?(this.isSingleCharacterDataNode=!0,this._first=this._last=this._next=this.sc):(this._first=this._next=this.sc!==n||$(this.sc)?V(this.sc,n,!0):this.sc.childNodes[this.so],this._last=this.ec!==n||$(this.ec)?V(this.ec,n,!0):this.ec.childNodes[this.eo-1])}}function m(e){return function(t,n){for(var r,i=n?t:t.parentNode;i;){if(r=i.nodeType,G(e,r))return i;i=i.parentNode}return null}}function v(e,t){if(ie(e,t))throw new H("INVALID_NODE_TYPE_ERR")}function b(e,t){if(!G(t,e.nodeType))throw new H("INVALID_NODE_TYPE_ERR")}function y(e,t){if(0>t||t>($(e)?e.length:e.childNodes.length))throw new H("INDEX_SIZE_ERR")}function C(e,t){if(ne(e,!0)!==ne(t,!0))throw new H("WRONG_DOCUMENT_ERR")}function R(e){if(re(e,!0))throw new H("NO_MODIFICATION_ALLOWED_ERR")}function E(e,t){if(!e)throw new H(t)}function w(e,t){return t<=($(e)?e.length:e.childNodes.length)}function S(e){return!!e.startContainer&&!!e.endContainer&&!(K&&(L.isBrokenNode(e.startContainer)||L.isBrokenNode(e.endContainer)))&&Q(e.startContainer)==Q(e.endContainer)&&w(e.startContainer,e.startOffset)&&w(e.endContainer,e.endOffset)}function N(e){if(!S(e))throw new Error("Range error: Range is not valid. This usually happens after DOM mutation. Range: ("+e.inspect()+")")}function T(e,t){N(e);var n=e.startContainer,r=e.startOffset,i=e.endContainer,a=e.endOffset,s=n===i;$(i)&&a>0&&a<i.length&&z(i,a,t),$(n)&&r>0&&r<n.length&&(n=z(n,r,t),s?(a-=r,i=n):i==n.parentNode&&a>=W(n)&&a++,r=0),e.setStartAndEnd(n,r,i,a)}function A(e){N(e);var t=e.commonAncestorContainer.parentNode.cloneNode(!1);return t.appendChild(e.cloneContents()),t.innerHTML}function x(e){e.START_TO_START=ue,e.START_TO_END=de,e.END_TO_END=he,e.END_TO_START=fe,e.NODE_BEFORE=pe,e.NODE_AFTER=ge,e.NODE_BEFORE_AND_AFTER=me,e.NODE_INSIDE=ve}function O(e){x(e),x(e.prototype)}function P(e,t){return function(){N(this);var n,r,i=this.startContainer,a=this.startOffset,o=this.commonAncestorContainer,c=new g(this,!0);i!==o&&(n=V(i,o,!0),r=s(n),i=r.node,a=r.offset),u(c,R),c.reset();var l=e(c);return c.detach(),t(this,i,a,i,a),l}}function _(t,r){function i(e,t){return function(n){b(n,Z),b(Q(n),X);var r=(e?a:s)(n);(t?o:c)(this,r.node,r.offset)}}function o(e,t,n){var i=e.endContainer,a=e.endOffset;(t!==e.startContainer||n!==e.startOffset)&&((Q(t)!=Q(i)||1==j(t,n,i,a))&&(i=t,a=n),r(e,t,n,i,a))}function c(e,t,n){var i=e.startContainer,a=e.startOffset;(t!==e.endContainer||n!==e.endOffset)&&((Q(t)!=Q(i)||-1==j(t,n,i,a))&&(i=t,a=n),r(e,i,a,t,n))}var l=function(){};l.prototype=e.rangePrototype,t.prototype=new l,B.extend(t.prototype,{setStart:function(e,t){v(e,!0),y(e,t),o(this,e,t)},setEnd:function(e,t){v(e,!0),y(e,t),c(this,e,t)},setStartAndEnd:function(){var e=arguments,t=e[0],n=e[1],i=t,a=n;switch(e.length){case 3:a=e[2];break;case 4:i=e[2],a=e[3]}r(this,t,n,i,a)},setBoundary:function(e,t,n){this["set"+(n?"Start":"End")](e,t)},setStartBefore:i(!0,!0),setStartAfter:i(!1,!0),setEndBefore:i(!0,!1),setEndAfter:i(!1,!1),collapse:function(e){N(this),e?r(this,this.startContainer,this.startOffset,this.startContainer,this.startOffset):r(this,this.endContainer,this.endOffset,this.endContainer,this.endOffset)},selectNodeContents:function(e){v(e,!0),r(this,e,0,e,q(e))},selectNode:function(e){v(e,!1),b(e,Z);var t=a(e),n=s(e);r(this,t.node,t.offset,n.node,n.offset)},extractContents:P(h,r),deleteContents:P(d,r),canSurroundContents:function(){N(this),R(this.startContainer),R(this.endContainer);var e=new g(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},splitBoundaries:function(){T(this)},splitBoundariesPreservingPositions:function(e){T(this,e)},normalizeBoundaries:function(){N(this);var e,t=this.startContainer,n=this.startOffset,i=this.endContainer,a=this.endOffset,s=function(e){var t=e.nextSibling;t&&t.nodeType==e.nodeType&&(i=e,a=e.length,e.appendData(t.data),Y(t))},o=function(e){var r=e.previousSibling;if(r&&r.nodeType==e.nodeType){t=e;var s=e.length;if(n=r.length,e.insertData(0,r.data),Y(r),t==i)a+=n,i=t;else if(i==e.parentNode){var o=W(e);a==o?(i=e,a=s):a>o&&a--}}},c=!0;if($(i))a==i.length?s(i):0==a&&(e=i.previousSibling,e&&e.nodeType==i.nodeType&&(a=e.length,t==i&&(c=!1),e.appendData(i.data),Y(i),i=e));else{if(a>0){var l=i.childNodes[a-1];l&&$(l)&&s(l)}c=!this.collapsed}if(c){if($(t))0==n?o(t):n==t.length&&(e=t.nextSibling,e&&e.nodeType==t.nodeType&&(i==e&&(i=t,a+=t.length),t.appendData(e.data),Y(e)));else if(n<t.childNodes.length){var u=t.childNodes[n];u&&$(u)&&o(u)}}else t=i,n=a;r(this,t,n,i,a)},collapseToPoint:function(e,t){v(e,!0),y(e,t),this.setStartAndEnd(e,t)}}),O(t)}function k(e){e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset,e.commonAncestorContainer=e.collapsed?e.startContainer:L.getCommonAncestor(e.startContainer,e.endContainer)}function D(e,t,n,r,i){e.startContainer=t,e.startOffset=n,e.endContainer=r,e.endOffset=i,e.document=L.getDocument(t),k(e)}function I(e){this.startContainer=e,this.startOffset=0,this.endContainer=e,this.endOffset=0,this.document=e,k(this)}var L=e.dom,B=e.util,M=L.DomPosition,H=e.DOMException,$=L.isCharacterDataNode,W=L.getNodeIndex,U=L.isOrIsAncestorOf,F=L.getDocument,j=L.comparePoints,z=L.splitDataNode,V=L.getClosestAncestorIn,q=L.getNodeLength,G=L.arrayContains,Q=L.getRootContainer,K=e.features.crashyTextNodes,Y=L.removeNode;g.prototype={_current:null,_next:null,_first:null,_last:null,isSingleCharacterDataNode:!1,reset:function(){this._current=null,this._next=this._first},hasNext:function(){return!!this._next},next:function(){var e=this._current=this._next;return e&&(this._next=e!==this._last?e.nextSibling:null,$(e)&&this.clonePartiallySelectedTextNodes&&(e===this.ec&&(e=e.cloneNode(!0)).deleteData(this.eo,e.length-this.eo),this._current===this.sc&&(e=e.cloneNode(!0)).deleteData(0,this.so))),e},remove:function(){var e,t,n=this._current;!$(n)||n!==this.sc&&n!==this.ec?n.parentNode&&Y(n):(e=n===this.sc?this.so:0,
t=n===this.ec?this.eo:n.length,e!=t&&n.deleteData(e,t-e))},isPartiallySelectedSubtree:function(){var e=this._current;return n(e,this.range)},getSubtreeIterator:function(){var e;if(this.isSingleCharacterDataNode)e=this.range.cloneRange(),e.collapse(!1);else{e=new I(r(this.range));var t=this._current,n=t,i=0,a=t,s=q(t);U(t,this.sc)&&(n=this.sc,i=this.so),U(t,this.ec)&&(a=this.ec,s=this.eo),D(e,n,i,a,s)}return new g(e,this.clonePartiallySelectedTextNodes)},detach:function(){this.range=this._current=this._next=this._first=this._last=this.sc=this.so=this.ec=this.eo=null}};var Z=[1,3,4,5,7,8,10],X=[2,9,11],J=[5,6,10,12],ee=[1,3,4,5,7,8,10,11],te=[1,3,4,5,7,8],ne=m([9,11]),re=m(J),ie=m([6,10,12]),ae=document.createElement("style"),se=!1;try{ae.innerHTML="<b>x</b>",se=3==ae.firstChild.nodeType}catch(oe){}e.features.htmlParsingConforms=se;var ce=se?function(e){var t=this.startContainer,n=F(t);if(!t)throw new H("INVALID_STATE_ERR");var r=null;return 1==t.nodeType?r=t:$(t)&&(r=L.parentElement(t)),r=null===r||"HTML"==r.nodeName&&L.isHtmlNamespace(F(r).documentElement)&&L.isHtmlNamespace(r)?n.createElement("body"):r.cloneNode(!1),r.innerHTML=e,L.fragmentFromNodeChildren(r)}:function(e){var t=r(this),n=t.createElement("body");return n.innerHTML=e,L.fragmentFromNodeChildren(n)},le=["startContainer","startOffset","endContainer","endOffset","collapsed","commonAncestorContainer"],ue=0,de=1,he=2,fe=3,pe=0,ge=1,me=2,ve=3;B.extend(e.rangePrototype,{compareBoundaryPoints:function(e,t){N(this),C(this.startContainer,t.startContainer);var n,r,i,a,s=e==fe||e==ue?"start":"end",o=e==de||e==ue?"start":"end";return n=this[s+"Container"],r=this[s+"Offset"],i=t[o+"Container"],a=t[o+"Offset"],j(n,r,i,a)},insertNode:function(e){if(N(this),b(e,ee),R(this.startContainer),U(e,this.startContainer))throw new H("HIERARCHY_REQUEST_ERR");var t=o(e,this.startContainer,this.startOffset);this.setStartBefore(t)},cloneContents:function(){N(this);var e,t;if(this.collapsed)return r(this).createDocumentFragment();if(this.startContainer===this.endContainer&&$(this.startContainer))return e=this.startContainer.cloneNode(!0),e.data=e.data.slice(this.startOffset,this.endOffset),t=r(this).createDocumentFragment(),t.appendChild(e),t;var n=new g(this,!0);return e=l(n),n.detach(),e},canSurroundContents:function(){N(this),R(this.startContainer),R(this.endContainer);var e=new g(this,!0),t=e._first&&n(e._first,this)||e._last&&n(e._last,this);return e.detach(),!t},surroundContents:function(e){if(b(e,te),!this.canSurroundContents())throw new H("INVALID_STATE_ERR");var t=this.extractContents();if(e.hasChildNodes())for(;e.lastChild;)e.removeChild(e.lastChild);o(e,this.startContainer,this.startOffset),e.appendChild(t),this.selectNode(e)},cloneRange:function(){N(this);for(var e,t=new I(r(this)),n=le.length;n--;)e=le[n],t[e]=this[e];return t},toString:function(){N(this);var e=this.startContainer;if(e===this.endContainer&&$(e))return 3==e.nodeType||4==e.nodeType?e.data.slice(this.startOffset,this.endOffset):"";var t=[],n=new g(this,!0);return u(n,function(e){(3==e.nodeType||4==e.nodeType)&&t.push(e.data)}),n.detach(),t.join("")},compareNode:function(e){N(this);var t=e.parentNode,n=W(e);if(!t)throw new H("NOT_FOUND_ERR");var r=this.comparePoint(t,n),i=this.comparePoint(t,n+1);return 0>r?i>0?me:pe:i>0?ge:ve},comparePoint:function(e,t){return N(this),E(e,"HIERARCHY_REQUEST_ERR"),C(e,this.startContainer),j(e,t,this.startContainer,this.startOffset)<0?-1:j(e,t,this.endContainer,this.endOffset)>0?1:0},createContextualFragment:ce,toHtml:function(){return A(this)},intersectsNode:function(e,t){if(N(this),Q(e)!=i(this))return!1;var n=e.parentNode,r=W(e);if(!n)return!0;var a=j(n,r,this.endContainer,this.endOffset),s=j(n,r+1,this.startContainer,this.startOffset);return t?0>=a&&s>=0:0>a&&s>0},isPointInRange:function(e,t){return N(this),E(e,"HIERARCHY_REQUEST_ERR"),C(e,this.startContainer),j(e,t,this.startContainer,this.startOffset)>=0&&j(e,t,this.endContainer,this.endOffset)<=0},intersectsRange:function(e){return c(this,e,!1)},intersectsOrTouchesRange:function(e){return c(this,e,!0)},intersection:function(e){if(this.intersectsRange(e)){var t=j(this.startContainer,this.startOffset,e.startContainer,e.startOffset),n=j(this.endContainer,this.endOffset,e.endContainer,e.endOffset),r=this.cloneRange();return-1==t&&r.setStart(e.startContainer,e.startOffset),1==n&&r.setEnd(e.endContainer,e.endOffset),r}return null},union:function(e){if(this.intersectsOrTouchesRange(e)){var t=this.cloneRange();return-1==j(e.startContainer,e.startOffset,this.startContainer,this.startOffset)&&t.setStart(e.startContainer,e.startOffset),1==j(e.endContainer,e.endOffset,this.endContainer,this.endOffset)&&t.setEnd(e.endContainer,e.endOffset),t}throw new H("Ranges do not intersect")},containsNode:function(e,t){return t?this.intersectsNode(e,!1):this.compareNode(e)==ve},containsNodeContents:function(e){return this.comparePoint(e,0)>=0&&this.comparePoint(e,q(e))<=0},containsRange:function(e){var t=this.intersection(e);return null!==t&&e.equals(t)},containsNodeText:function(e){var t=this.cloneRange();t.selectNode(e);var n=t.getNodes([3]);if(n.length>0){t.setStart(n[0],0);var r=n.pop();return t.setEnd(r,r.length),this.containsRange(t)}return this.containsNodeContents(e)},getNodes:function(e,t){return N(this),f(this,e,t)},getDocument:function(){return r(this)},collapseBefore:function(e){this.setEndBefore(e),this.collapse(!1)},collapseAfter:function(e){this.setStartAfter(e),this.collapse(!0)},getBookmark:function(t){var n=r(this),i=e.createRange(n);t=t||L.getBody(n),i.selectNodeContents(t);var a=this.intersection(i),s=0,o=0;return a&&(i.setEnd(a.startContainer,a.startOffset),s=i.toString().length,o=s+a.toString().length),{start:s,end:o,containerNode:t}},moveToBookmark:function(e){var t=e.containerNode,n=0;this.setStart(t,0),this.collapse(!0);for(var r,i,a,s,o=[t],c=!1,l=!1;!l&&(r=o.pop());)if(3==r.nodeType)i=n+r.length,!c&&e.start>=n&&e.start<=i&&(this.setStart(r,e.start-n),c=!0),c&&e.end>=n&&e.end<=i&&(this.setEnd(r,e.end-n),l=!0),n=i;else for(s=r.childNodes,a=s.length;a--;)o.push(s[a])},getName:function(){return"DomRange"},equals:function(e){return I.rangesEqual(this,e)},isValid:function(){return S(this)},inspect:function(){return p(this)},detach:function(){}}),_(I,D),B.extend(I,{rangeProperties:le,RangeIterator:g,copyComparisonConstants:O,createPrototypeRange:_,inspect:p,toHtml:A,getRangeDocument:r,rangesEqual:function(e,t){return e.startContainer===t.startContainer&&e.startOffset===t.startOffset&&e.endContainer===t.endContainer&&e.endOffset===t.endOffset}}),e.DomRange=I}),D.createCoreModule("WrappedRange",["DomRange"],function(e,t){var n,r,i=e.dom,a=e.util,s=i.DomPosition,o=e.DomRange,c=i.getBody,l=i.getContentDocument,u=i.isCharacterDataNode;if(e.features.implementsDomRange&&!function(){function r(e){for(var t,n=h.length;n--;)t=h[n],e[t]=e.nativeRange[t];e.collapsed=e.startContainer===e.endContainer&&e.startOffset===e.endOffset}function s(e,t,n,r,i){var a=e.startContainer!==t||e.startOffset!=n,s=e.endContainer!==r||e.endOffset!=i,o=!e.equals(e.nativeRange);(a||s||o)&&(e.setEnd(r,i),e.setStart(t,n))}var u,d,h=o.rangeProperties;n=function(e){if(!e)throw t.createError("WrappedRange: Range must be specified");this.nativeRange=e,r(this)},o.createPrototypeRange(n,s),u=n.prototype,u.selectNode=function(e){this.nativeRange.selectNode(e),r(this)},u.cloneContents=function(){return this.nativeRange.cloneContents()},u.surroundContents=function(e){this.nativeRange.surroundContents(e),r(this)},u.collapse=function(e){this.nativeRange.collapse(e),r(this)},u.cloneRange=function(){return new n(this.nativeRange.cloneRange())},u.refresh=function(){r(this)},u.toString=function(){return this.nativeRange.toString()};var f=document.createTextNode("test");c(document).appendChild(f);var p=document.createRange();p.setStart(f,0),p.setEnd(f,0);try{p.setStart(f,1),u.setStart=function(e,t){this.nativeRange.setStart(e,t),r(this)},u.setEnd=function(e,t){this.nativeRange.setEnd(e,t),r(this)},d=function(e){return function(t){this.nativeRange[e](t),r(this)}}}catch(g){u.setStart=function(e,t){try{this.nativeRange.setStart(e,t)}catch(n){this.nativeRange.setEnd(e,t),this.nativeRange.setStart(e,t)}r(this)},u.setEnd=function(e,t){try{this.nativeRange.setEnd(e,t)}catch(n){this.nativeRange.setStart(e,t),this.nativeRange.setEnd(e,t)}r(this)},d=function(e,t){return function(n){try{this.nativeRange[e](n)}catch(i){this.nativeRange[t](n),this.nativeRange[e](n)}r(this)}}}u.setStartBefore=d("setStartBefore","setEndBefore"),u.setStartAfter=d("setStartAfter","setEndAfter"),u.setEndBefore=d("setEndBefore","setStartBefore"),u.setEndAfter=d("setEndAfter","setStartAfter"),u.selectNodeContents=function(e){this.setStartAndEnd(e,0,i.getNodeLength(e))},p.selectNodeContents(f),p.setEnd(f,3);var m=document.createRange();m.selectNodeContents(f),m.setEnd(f,4),m.setStart(f,2),-1==p.compareBoundaryPoints(p.START_TO_END,m)&&1==p.compareBoundaryPoints(p.END_TO_START,m)?u.compareBoundaryPoints=function(e,t){return t=t.nativeRange||t,e==t.START_TO_END?e=t.END_TO_START:e==t.END_TO_START&&(e=t.START_TO_END),this.nativeRange.compareBoundaryPoints(e,t)}:u.compareBoundaryPoints=function(e,t){return this.nativeRange.compareBoundaryPoints(e,t.nativeRange||t)};var v=document.createElement("div");v.innerHTML="123";var b=v.firstChild,y=c(document);y.appendChild(v),p.setStart(b,1),p.setEnd(b,2),p.deleteContents(),"13"==b.data&&(u.deleteContents=function(){this.nativeRange.deleteContents(),r(this)},u.extractContents=function(){var e=this.nativeRange.extractContents();return r(this),e}),y.removeChild(v),y=null,a.isHostMethod(p,"createContextualFragment")&&(u.createContextualFragment=function(e){return this.nativeRange.createContextualFragment(e)}),c(document).removeChild(f),u.getName=function(){return"WrappedRange"},e.WrappedRange=n,e.createNativeRange=function(e){return e=l(e,t,"createNativeRange"),e.createRange()}}(),e.features.implementsTextRange){var d=function(e){var t=e.parentElement(),n=e.duplicate();n.collapse(!0);var r=n.parentElement();n=e.duplicate(),n.collapse(!1);var a=n.parentElement(),s=r==a?r:i.getCommonAncestor(r,a);return s==t?s:i.getCommonAncestor(t,s)},h=function(e){return 0==e.compareEndPoints("StartToEnd",e)},f=function(e,t,n,r,a){var o=e.duplicate();o.collapse(n);var c=o.parentElement();if(i.isOrIsAncestorOf(t,c)||(c=t),!c.canHaveHTML){var l=new s(c.parentNode,i.getNodeIndex(c));return{boundaryPosition:l,nodeInfo:{nodeIndex:l.offset,containerElement:l.node}}}var d=i.getDocument(c).createElement("span");d.parentNode&&i.removeNode(d);for(var h,f,p,g,m,v=n?"StartToStart":"StartToEnd",b=a&&a.containerElement==c?a.nodeIndex:0,y=c.childNodes.length,C=y,R=C;;){if(R==y?c.appendChild(d):c.insertBefore(d,c.childNodes[R]),o.moveToElementText(d),h=o.compareEndPoints(v,e),0==h||b==C)break;if(-1==h){if(C==b+1)break;b=R}else C=C==b+1?b:R;R=Math.floor((b+C)/2),c.removeChild(d)}if(m=d.nextSibling,-1==h&&m&&u(m)){o.setEndPoint(n?"EndToStart":"EndToEnd",e);var E;if(/[\r\n]/.test(m.data)){var w=o.duplicate(),S=w.text.replace(/\r\n/g,"\r").length;for(E=w.moveStart("character",S);-1==(h=w.compareEndPoints("StartToEnd",w));)E++,w.moveStart("character",1)}else E=o.text.length;g=new s(m,E)}else f=(r||!n)&&d.previousSibling,p=(r||n)&&d.nextSibling,g=p&&u(p)?new s(p,0):f&&u(f)?new s(f,f.data.length):new s(c,i.getNodeIndex(d));return i.removeNode(d),{boundaryPosition:g,nodeInfo:{nodeIndex:R,containerElement:c}}},p=function(e,t){var n,r,a,s,o=e.offset,l=i.getDocument(e.node),d=c(l).createTextRange(),h=u(e.node);return h?(n=e.node,r=n.parentNode):(s=e.node.childNodes,n=o<s.length?s[o]:null,r=e.node),a=l.createElement("span"),a.innerHTML="&#feff;",n?r.insertBefore(a,n):r.appendChild(a),d.moveToElementText(a),d.collapse(!t),r.removeChild(a),h&&d[t?"moveStart":"moveEnd"]("character",o),d};r=function(e){this.textRange=e,this.refresh()},r.prototype=new o(document),r.prototype.refresh=function(){var e,t,n,r=d(this.textRange);h(this.textRange)?t=e=f(this.textRange,r,!0,!0).boundaryPosition:(n=f(this.textRange,r,!0,!1),e=n.boundaryPosition,t=f(this.textRange,r,!1,!1,n.nodeInfo).boundaryPosition),this.setStart(e.node,e.offset),this.setEnd(t.node,t.offset)},r.prototype.getName=function(){return"WrappedTextRange"},o.copyComparisonConstants(r);var g=function(e){if(e.collapsed)return p(new s(e.startContainer,e.startOffset),!0);var t=p(new s(e.startContainer,e.startOffset),!0),n=p(new s(e.endContainer,e.endOffset),!1),r=c(o.getRangeDocument(e)).createTextRange();return r.setEndPoint("StartToStart",t),r.setEndPoint("EndToEnd",n),r};if(r.rangeToTextRange=g,r.prototype.toTextRange=function(){return g(this)},e.WrappedTextRange=r,!e.features.implementsDomRange||e.config.preferTextRange){var m=function(e){return e("return this;")()}(Function);"undefined"==typeof m.Range&&(m.Range=r),e.createNativeRange=function(e){return e=l(e,t,"createNativeRange"),c(e).createTextRange()},e.WrappedRange=r}}e.createRange=function(n){return n=l(n,t,"createRange"),new e.WrappedRange(e.createNativeRange(n))},e.createRangyRange=function(e){return e=l(e,t,"createRangyRange"),new o(e)},a.createAliasForDeprecatedMethod(e,"createIframeRange","createRange"),a.createAliasForDeprecatedMethod(e,"createIframeRangyRange","createRangyRange"),e.addShimListener(function(t){var n=t.document;"undefined"==typeof n.createRange&&(n.createRange=function(){return e.createRange(n)}),n=t=null})}),D.createCoreModule("WrappedSelection",["DomRange","WrappedRange"],function(e,t){function n(e){return"string"==typeof e?/^backward(s)?$/i.test(e):!!e}function r(e,n){if(e){if(x.isWindow(e))return e;if(e instanceof v)return e.win;var r=x.getContentDocument(e,t,n);return x.getWindow(r)}return window}function i(e){return r(e,"getWinSelection").getSelection()}function a(e){return r(e,"getDocSelection").document.selection}function s(e){var t=!1;return e.anchorNode&&(t=1==x.comparePoints(e.anchorNode,e.anchorOffset,e.focusNode,e.focusOffset)),t}function o(e,t,n){var r=n?"end":"start",i=n?"start":"end";e.anchorNode=t[r+"Container"],e.anchorOffset=t[r+"Offset"],e.focusNode=t[i+"Container"],e.focusOffset=t[i+"Offset"]}function c(e){var t=e.nativeSelection;e.anchorNode=t.anchorNode,e.anchorOffset=t.anchorOffset,e.focusNode=t.focusNode,e.focusOffset=t.focusOffset}function l(e){e.anchorNode=e.focusNode=null,e.anchorOffset=e.focusOffset=0,e.rangeCount=0,e.isCollapsed=!0,e._ranges.length=0}function u(t){var n;return t instanceof _?(n=e.createNativeRange(t.getDocument()),n.setEnd(t.endContainer,t.endOffset),n.setStart(t.startContainer,t.startOffset)):t instanceof k?n=t.nativeRange:L.implementsDomRange&&t instanceof x.getWindow(t.startContainer).Range&&(n=t),n}function d(e){if(!e.length||1!=e[0].nodeType)return!1;for(var t=1,n=e.length;n>t;++t)if(!x.isAncestorOf(e[0],e[t]))return!1;return!0}function h(e){var n=e.getNodes();if(!d(n))throw t.createError("getSingleElementFromRange: range "+e.inspect()+" did not consist of a single element");return n[0]}function f(e){return!!e&&"undefined"!=typeof e.text}function p(e,t){var n=new k(t);e._ranges=[n],o(e,n,!1),e.rangeCount=1,e.isCollapsed=n.collapsed}function g(t){if(t._ranges.length=0,"None"==t.docSelection.type)l(t);else{var n=t.docSelection.createRange();if(f(n))p(t,n);else{t.rangeCount=n.length;for(var r,i=M(n.item(0)),a=0;a<t.rangeCount;++a)r=e.createRange(i),r.selectNode(n.item(a)),t._ranges.push(r);t.isCollapsed=1==t.rangeCount&&t._ranges[0].collapsed,o(t,t._ranges[t.rangeCount-1],!1)}}}function m(e,n){for(var r=e.docSelection.createRange(),i=h(n),a=M(r.item(0)),s=H(a).createControlRange(),o=0,c=r.length;c>o;++o)s.add(r.item(o));try{s.add(i)}catch(l){throw t.createError("addRange(): Element within the specified Range could not be added to control selection (does it have layout?)")}s.select(),g(e)}function v(e,t,n){this.nativeSelection=e,this.docSelection=t,this._ranges=[],this.win=n,this.refresh()}function b(e){e.win=e.anchorNode=e.focusNode=e._ranges=null,e.rangeCount=e.anchorOffset=e.focusOffset=0,e.detached=!0}function y(e,t){for(var n,r,i=te.length;i--;)if(n=te[i],r=n.selection,"deleteAll"==t)b(r);else if(n.win==e)return"delete"==t?(te.splice(i,1),!0):r;return"deleteAll"==t&&(te.length=0),null}function C(e,n){for(var r,i=M(n[0].startContainer),a=H(i).createControlRange(),s=0,o=n.length;o>s;++s){r=h(n[s]);try{a.add(r)}catch(c){throw t.createError("setRanges(): Element within one of the specified Ranges could not be added to control selection (does it have layout?)")}}a.select(),g(e)}function R(e,t){if(e.win.document!=M(t))throw new D("WRONG_DOCUMENT_ERR")}function E(t){return function(n,r){var i;this.rangeCount?(i=this.getRangeAt(0),i["set"+(t?"Start":"End")](n,r)):(i=e.createRange(this.win.document),i.setStartAndEnd(n,r)),this.setSingleRange(i,this.isBackward())}}function w(e){var t=[],n=new I(e.anchorNode,e.anchorOffset),r=new I(e.focusNode,e.focusOffset),i="function"==typeof e.getName?e.getName():"Selection";if("undefined"!=typeof e.rangeCount)for(var a=0,s=e.rangeCount;s>a;++a)t[a]=_.inspect(e.getRangeAt(a));return"["+i+"(Ranges: "+t.join(", ")+")(anchor: "+n.inspect()+", focus: "+r.inspect()+"]"}e.config.checkSelectionRanges=!0;var S,N,T="boolean",A="number",x=e.dom,O=e.util,P=O.isHostMethod,_=e.DomRange,k=e.WrappedRange,D=e.DOMException,I=x.DomPosition,L=e.features,B="Control",M=x.getDocument,H=x.getBody,$=_.rangesEqual,W=P(window,"getSelection"),U=O.isHostObject(document,"selection");L.implementsWinGetSelection=W,L.implementsDocSelection=U;var F=U&&(!W||e.config.preferTextRange);if(F)S=a,e.isSelectionValid=function(e){var t=r(e,"isSelectionValid").document,n=t.selection;return"None"!=n.type||M(n.createRange().parentElement())==t};else{if(!W)return t.fail("Neither document.selection or window.getSelection() detected."),!1;S=i,e.isSelectionValid=function(){return!0}}e.getNativeSelection=S;var j=S();if(!j)return t.fail("Native selection was null (possibly issue 138?)"),!1;var z=e.createNativeRange(document),V=H(document),q=O.areHostProperties(j,["anchorNode","focusNode","anchorOffset","focusOffset"]);L.selectionHasAnchorAndFocus=q;var G=P(j,"extend");L.selectionHasExtend=G;var Q=typeof j.rangeCount==A;L.selectionHasRangeCount=Q;var K=!1,Y=!0,Z=G?function(t,n){var r=_.getRangeDocument(n),i=e.createRange(r);i.collapseToPoint(n.endContainer,n.endOffset),t.addRange(u(i)),t.extend(n.startContainer,n.startOffset)}:null;O.areHostMethods(j,["addRange","getRangeAt","removeAllRanges"])&&typeof j.rangeCount==A&&L.implementsDomRange&&!function(){var t=window.getSelection();if(t){for(var n=t.rangeCount,r=n>1,i=[],a=s(t),o=0;n>o;++o)i[o]=t.getRangeAt(o);var c=x.createTestElement(document,"",!1),l=c.appendChild(document.createTextNode("   ")),u=document.createRange();if(u.setStart(l,1),u.collapse(!0),t.removeAllRanges(),t.addRange(u),Y=1==t.rangeCount,t.removeAllRanges(),!r){var d=window.navigator.appVersion.match(/Chrome\/(.*?) /);if(d&&parseInt(d[1])>=36)K=!1;else{var h=u.cloneRange();u.setStart(l,0),h.setEnd(l,3),h.setStart(l,2),t.addRange(u),t.addRange(h),K=2==t.rangeCount}}for(x.removeNode(c),t.removeAllRanges(),o=0;n>o;++o)0==o&&a?Z?Z(t,i[o]):(e.warn("Rangy initialization: original selection was backwards but selection has been restored forwards because the browser does not support Selection.extend"),t.addRange(i[o])):t.addRange(i[o])}}(),L.selectionSupportsMultipleRanges=K,L.collapsedNonEditableSelectionsSupported=Y;var X,J=!1;V&&P(V,"createControlRange")&&(X=V.createControlRange(),O.areHostProperties(X,["item","add"])&&(J=!0)),L.implementsControlRange=J,N=q?function(e){return e.anchorNode===e.focusNode&&e.anchorOffset===e.focusOffset}:function(e){return e.rangeCount?e.getRangeAt(e.rangeCount-1).collapsed:!1};var ee;P(j,"getRangeAt")?ee=function(e,t){try{return e.getRangeAt(t)}catch(n){return null}}:q&&(ee=function(t){var n=M(t.anchorNode),r=e.createRange(n);return r.setStartAndEnd(t.anchorNode,t.anchorOffset,t.focusNode,t.focusOffset),r.collapsed!==this.isCollapsed&&r.setStartAndEnd(t.focusNode,t.focusOffset,t.anchorNode,t.anchorOffset),r}),v.prototype=e.selectionPrototype;var te=[],ne=function(e){if(e&&e instanceof v)return e.refresh(),e;e=r(e,"getNativeSelection");var t=y(e),n=S(e),i=U?a(e):null;return t?(t.nativeSelection=n,t.docSelection=i,t.refresh()):(t=new v(n,i,e),te.push({win:e,selection:t})),t};e.getSelection=ne,O.createAliasForDeprecatedMethod(e,"getIframeSelection","getSelection");var re=v.prototype;if(!F&&q&&O.areHostMethods(j,["removeAllRanges","addRange"])){re.removeAllRanges=function(){this.nativeSelection.removeAllRanges(),l(this)};var ie=function(e,t){Z(e.nativeSelection,t),e.refresh()};Q?re.addRange=function(t,r){if(J&&U&&this.docSelection.type==B)m(this,t);else if(n(r)&&G)ie(this,t);else{var i;K?i=this.rangeCount:(this.removeAllRanges(),i=0);var a=u(t).cloneRange();try{this.nativeSelection.addRange(a)}catch(s){}if(this.rangeCount=this.nativeSelection.rangeCount,this.rangeCount==i+1){if(e.config.checkSelectionRanges){var c=ee(this.nativeSelection,this.rangeCount-1);c&&!$(c,t)&&(t=new k(c))}this._ranges[this.rangeCount-1]=t,o(this,t,oe(this.nativeSelection)),this.isCollapsed=N(this)}else this.refresh()}}:re.addRange=function(e,t){n(t)&&G?ie(this,e):(this.nativeSelection.addRange(u(e)),this.refresh())},re.setRanges=function(e){if(J&&U&&e.length>1)C(this,e);else{this.removeAllRanges();for(var t=0,n=e.length;n>t;++t)this.addRange(e[t])}}}else{if(!(P(j,"empty")&&P(z,"select")&&J&&F))return t.fail("No means of selecting a Range or TextRange was found"),!1;re.removeAllRanges=function(){try{if(this.docSelection.empty(),"None"!=this.docSelection.type){var e;if(this.anchorNode)e=M(this.anchorNode);else if(this.docSelection.type==B){var t=this.docSelection.createRange();t.length&&(e=M(t.item(0)))}if(e){var n=H(e).createTextRange();n.select(),this.docSelection.empty()}}}catch(r){}l(this)},re.addRange=function(t){this.docSelection.type==B?m(this,t):(e.WrappedTextRange.rangeToTextRange(t).select(),this._ranges[0]=t,this.rangeCount=1,this.isCollapsed=this._ranges[0].collapsed,o(this,t,!1))},re.setRanges=function(e){this.removeAllRanges();var t=e.length;t>1?C(this,e):t&&this.addRange(e[0])}}re.getRangeAt=function(e){if(0>e||e>=this.rangeCount)throw new D("INDEX_SIZE_ERR");return this._ranges[e].cloneRange()};var ae;if(F)ae=function(t){var n;e.isSelectionValid(t.win)?n=t.docSelection.createRange():(n=H(t.win.document).createTextRange(),n.collapse(!0)),t.docSelection.type==B?g(t):f(n)?p(t,n):l(t)};else if(P(j,"getRangeAt")&&typeof j.rangeCount==A)ae=function(t){if(J&&U&&t.docSelection.type==B)g(t);else if(t._ranges.length=t.rangeCount=t.nativeSelection.rangeCount,t.rangeCount){for(var n=0,r=t.rangeCount;r>n;++n)t._ranges[n]=new e.WrappedRange(t.nativeSelection.getRangeAt(n));o(t,t._ranges[t.rangeCount-1],oe(t.nativeSelection)),t.isCollapsed=N(t)}else l(t)};else{if(!q||typeof j.isCollapsed!=T||typeof z.collapsed!=T||!L.implementsDomRange)return t.fail("No means of obtaining a Range or TextRange from the user's selection was found"),!1;ae=function(e){var t,n=e.nativeSelection;n.anchorNode?(t=ee(n,0),e._ranges=[t],e.rangeCount=1,c(e),e.isCollapsed=N(e)):l(e)}}re.refresh=function(e){var t=e?this._ranges.slice(0):null,n=this.anchorNode,r=this.anchorOffset;if(ae(this),e){var i=t.length;if(i!=this._ranges.length)return!0;if(this.anchorNode!=n||this.anchorOffset!=r)return!0;for(;i--;)if(!$(t[i],this._ranges[i]))return!0;return!1}};var se=function(e,t){var n=e.getAllRanges();e.removeAllRanges();for(var r=0,i=n.length;i>r;++r)$(t,n[r])||e.addRange(n[r]);e.rangeCount||l(e)};J&&U?re.removeRange=function(e){if(this.docSelection.type==B){for(var t,n=this.docSelection.createRange(),r=h(e),i=M(n.item(0)),a=H(i).createControlRange(),s=!1,o=0,c=n.length;c>o;++o)t=n.item(o),t!==r||s?a.add(n.item(o)):s=!0;a.select(),g(this)}else se(this,e)}:re.removeRange=function(e){se(this,e)};var oe;!F&&q&&L.implementsDomRange?(oe=s,re.isBackward=function(){return oe(this)}):oe=re.isBackward=function(){return!1},re.isBackwards=re.isBackward,re.toString=function(){for(var e=[],t=0,n=this.rangeCount;n>t;++t)e[t]=""+this._ranges[t];return e.join("")},re.collapse=function(t,n){R(this,t);var r=e.createRange(t);r.collapseToPoint(t,n),this.setSingleRange(r),this.isCollapsed=!0},re.collapseToStart=function(){if(!this.rangeCount)throw new D("INVALID_STATE_ERR");var e=this._ranges[0];this.collapse(e.startContainer,e.startOffset)},re.collapseToEnd=function(){if(!this.rangeCount)throw new D("INVALID_STATE_ERR");var e=this._ranges[this.rangeCount-1];this.collapse(e.endContainer,e.endOffset)},re.selectAllChildren=function(t){R(this,t);var n=e.createRange(t);n.selectNodeContents(t),this.setSingleRange(n)},re.deleteFromDocument=function(){if(J&&U&&this.docSelection.type==B){for(var e,t=this.docSelection.createRange();t.length;)e=t.item(0),t.remove(e),x.removeNode(e);this.refresh()}else if(this.rangeCount){var n=this.getAllRanges();if(n.length){this.removeAllRanges();for(var r=0,i=n.length;i>r;++r)n[r].deleteContents();this.addRange(n[i-1])}}},re.eachRange=function(e,t){for(var n=0,r=this._ranges.length;r>n;++n)if(e(this.getRangeAt(n)))return t},re.getAllRanges=function(){var e=[];return this.eachRange(function(t){e.push(t)}),e},re.setSingleRange=function(e,t){this.removeAllRanges(),this.addRange(e,t)},re.callMethodOnEachRange=function(e,t){var n=[];return this.eachRange(function(r){n.push(r[e].apply(r,t||[]))}),n},re.setStart=E(!0),re.setEnd=E(!1),e.rangePrototype.select=function(e){ne(this.getDocument()).setSingleRange(this,e)},re.changeEachRange=function(e){var t=[],n=this.isBackward();this.eachRange(function(n){e(n),t.push(n)}),this.removeAllRanges(),n&&1==t.length?this.addRange(t[0],"backward"):this.setRanges(t)},re.containsNode=function(e,t){return this.eachRange(function(n){return n.containsNode(e,t)},!0)||!1},re.getBookmark=function(e){return{backward:this.isBackward(),rangeBookmarks:this.callMethodOnEachRange("getBookmark",[e])}},re.moveToBookmark=function(t){for(var n,r,i=[],a=0;n=t.rangeBookmarks[a++];)r=e.createRange(this.win),r.moveToBookmark(n),i.push(r);t.backward?this.setSingleRange(i[0],"backward"):this.setRanges(i)},re.saveRanges=function(){return{backward:this.isBackward(),ranges:this.callMethodOnEachRange("cloneRange")}},re.restoreRanges=function(e){this.removeAllRanges();for(var t,n=0;t=e.ranges[n];++n)this.addRange(t,e.backward&&0==n)},re.toHtml=function(){var e=[];return this.eachRange(function(t){e.push(_.toHtml(t))}),e.join("")},L.implementsTextRange&&(re.getNativeTextRange=function(){var n;if(n=this.docSelection){var r=n.createRange();if(f(r))return r;throw t.createError("getNativeTextRange: selection is a control selection")}if(this.rangeCount>0)return e.WrappedTextRange.rangeToTextRange(this.getRangeAt(0));throw t.createError("getNativeTextRange: selection contains no range")}),re.getName=function(){return"WrappedSelection"},re.inspect=function(){return w(this)},re.detach=function(){y(this.win,"delete"),b(this)},v.detachAll=function(){y(null,"deleteAll")},v.inspect=w,v.isDirectionBackward=n,e.Selection=v,e.selectionPrototype=re,e.addShimListener(function(e){"undefined"==typeof e.getSelection&&(e.getSelection=function(){return ne(e)}),e=null})});var H=!1,$=function(e){H||(H=!0,!D.initialized&&D.config.autoInitialize&&d())};return _&&("complete"==document.readyState?$():(e(document,"addEventListener")&&document.addEventListener("DOMContentLoaded",$,!1),L(window,"load",$))),D},this),function(e,t){"function"==typeof define&&define.amd?define(["./rangy-core"],e):"undefined"!=typeof module&&"object"==typeof exports?module.exports=e(require("rangy")):e(t.rangy)}(function(e){return e.createModule("SaveRestore",["WrappedRange"],function(e,t){function n(e,t){return(t||document).getElementById(e)}function r(e,t){var n,r="selectionBoundary_"+ +new Date+"_"+(""+Math.random()).slice(2),i=p.getDocument(e.startContainer),a=e.cloneRange();return a.collapse(t),n=i.createElement("span"),n.id=r,n.style.lineHeight="0",n.style.display="none",n.className="rangySelectionBoundary",n.appendChild(i.createTextNode(v)),a.insertNode(n),n}function i(e,r,i,a){var s=n(i,e);s?(r[a?"setStartBefore":"setEndBefore"](s),g(s)):t.warn("Marker element has been removed. Cannot restore selection.")}function a(e,t){return t.compareBoundaryPoints(e.START_TO_START,e)}function s(t,n){var i,a,s=e.DomRange.getRangeDocument(t),o=t.toString(),c=m(n);return t.collapsed?(a=r(t,!1),{document:s,markerId:a.id,collapsed:!0}):(a=r(t,!1),i=r(t,!0),{document:s,startMarkerId:i.id,endMarkerId:a.id,collapsed:!1,backward:c,toString:function(){return"original text: '"+o+"', new text: '"+t.toString()+"'"}})}function o(r,a){var s=r.document;"undefined"==typeof a&&(a=!0);var o=e.createRange(s);if(r.collapsed){var c=n(r.markerId,s);if(c){c.style.display="inline";var l=c.previousSibling;l&&3==l.nodeType?(g(c),o.collapseToPoint(l,l.length)):(o.collapseBefore(c),g(c))}else t.warn("Marker element has been removed. Cannot restore selection.")}else i(s,o,r.startMarkerId,!0),i(s,o,r.endMarkerId,!1);return a&&o.normalizeBoundaries(),o}function c(t,r){var i,o,c=[],l=m(r);t=t.slice(0),t.sort(a);for(var u=0,d=t.length;d>u;++u)c[u]=s(t[u],l);for(u=d-1;u>=0;--u)i=t[u],o=e.DomRange.getRangeDocument(i),i.collapsed?i.collapseAfter(n(c[u].markerId,o)):(i.setEndBefore(n(c[u].endMarkerId,o)),i.setStartAfter(n(c[u].startMarkerId,o)));return c}function l(n){if(!e.isSelectionValid(n))return t.warn("Cannot save selection. This usually happens when the selection is collapsed and the selection document has lost focus."),null;var r=e.getSelection(n),i=r.getAllRanges(),a=1==i.length&&r.isBackward(),s=c(i,a);return a?r.setSingleRange(i[0],a):r.setRanges(i),{win:n,rangeInfos:s,restored:!1}}function u(e){for(var t=[],n=e.length,r=n-1;r>=0;r--)t[r]=o(e[r],!0);return t}function d(t,n){if(!t.restored){var r=t.rangeInfos,i=e.getSelection(t.win),a=u(r),s=r.length;1==s&&n&&e.features.selectionHasExtend&&r[0].backward?(i.removeAllRanges(),i.addRange(a[0],!0)):i.setRanges(a),t.restored=!0}}function h(e,t){var r=n(t,e);r&&g(r)}function f(e){for(var t,n=e.rangeInfos,r=0,i=n.length;i>r;++r)t=n[r],t.collapsed?h(e.doc,t.markerId):(h(e.doc,t.startMarkerId),h(e.doc,t.endMarkerId))}var p=e.dom,g=p.removeNode,m=e.Selection.isDirectionBackward,v="\ufeff";e.util.extend(e,{saveRange:s,restoreRange:o,saveRanges:c,restoreRanges:u,saveSelection:l,restoreSelection:d,removeMarkerElement:h,removeMarkers:f})}),e},this);